/*!***************************************************
 * jmHighlight
 * Version 2.3.0
 * Copyright (c) 2014-2015, Julian Motz
 * For the full copyright and license information, 
 * please view the LICENSE file that was distributed 
 * with this source code.
 *****************************************************/
(function(k,l){"function"===typeof define&&define.amd?define(["jquery"],function(d){return l(d,k)}):"object"===typeof exports?l(require("jquery"),k):l(k.jQuery,k)})(this,function(k,l){function d(a,b,h){this.options=c.extend({},{debug:!1,element:"span",className:"highlight",filter:[],separateWordSearch:!1,diacritics:!0},h);this.keyword="string"===typeof b?b:"";a instanceof c&&0<a.length?(this.$elements=a.find("*"),a=this.getFilteredElements(),0!=a&&(this.$elements=a)):this.$elements=c();return this}
var c=k;d.prototype.diacritics="a\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5\u0100\u0101\u0105\u0104 c\u00c7\u00e7\u0107\u0106\u010d\u010c d\u0111\u0110\u010f\u010e e\u00c8\u00c9\u00ca\u00cb\u00e8\u00e9\u00ea\u00eb\u011b\u011a\u0112\u0113\u0119\u0118 i\u00cc\u00cd\u00ce\u00cf\u00ec\u00ed\u00ee\u00ef\u012a\u012b l\u0142\u0141 n\u00d1\u00f1\u0148\u0147\u0144\u0143 o\u00d2\u00d3\u00d4\u00d5\u00d5\u00d6\u00d8\u00f2\u00f3\u00f4\u00f5\u00f6\u00f8\u014c\u014d r\u0159\u0158 s\u0160\u0161\u015b\u015a t\u0165\u0164 u\u00d9\u00da\u00db\u00dc\u00f9\u00fa\u00fb\u00fc\u016f\u016e\u016a\u016b y\u0178\u00ff\u00fd\u00dd z\u017d\u017e\u017c\u017b\u017a\u0179".split(" ");
d.prototype.getFilteredElements=function(){var a=this.options.filter;if("object"!==typeof a||0==this.$elements instanceof c||"[object Array]"!=Object.prototype.toString.call(a))return!1;var b=this.$elements;return b=b.filter(function(){for(var b=c(this),e=!1,f=0,g=a.length;f<g;f++)b.is(a[f])&&(e=!0);return e?!1:!0})};d.prototype.getTextNodes=function(a){var b=[];if(0==a instanceof c||0==a.length)return b;a.each(function(){c(this).contents().filter(function(){return 3==this.nodeType?!0:!1}).each(function(){b.push(this)})});
return b};d.prototype.getKeywordRegexp=function(a){var b="string"!==typeof a?this.keyword:a;if("string"!==typeof b||""==b)return b;a=b;if(this.options.diacritics)for(var b=b.split(""),h=[],e=0,f=b.length;e<f;e++)for(var g=b[e],c=0,d=this.diacritics.length;c<d;c++){var k=this.diacritics[c];-1==k.indexOf(g)||-1<h.indexOf(k)||(a=a.replace(new RegExp("["+k+"]","gmi"),"["+k+"]"),h.push(k))}return a};d.prototype.highlight=function(a){var b="string"!==typeof a?this.keyword:a;if(0==this.$elements.length||
""==b)return!1;this.$elements=this.$elements.filter("*:not([data-jmHighlight])");a=this.options.separateWordSearch;if("boolean"===typeof a&&a&&(a=b.split(" "),1<a.length)){this.options.debug&&console.log("Highlighting keywords separately");for(var b=0,c=a.length;b<c;b++)if(!this.highlight(a[b]))return!1;return!0}this.options.debug&&(console.log("Highlighting keyword '"+b+"' in elements:"),console.log(this.$elements));a=this.getKeywordRegexp(b);for(var b=new RegExp(a,"gmi"),c=this.getTextNodes(this.$elements),
e=0,f=c.length;e<f;e++){var g=c[e];if("object"===typeof g&&"string"===typeof g.nodeValue&&""!=g.nodeValue.trim()&&b.test(g.nodeValue)){this.options.debug&&console.log(a,g.nodeValue);var d="<"+this.options.element+" class='"+this.options.className+"' data-jmHighlight='true'>",k="</"+this.options.element+">";null!=g.parentNode&&(g.parentNode.innerHTML=g.parentNode.innerHTML.replace(new RegExp("((?![^<]*>)"+a+")","gim"),d+"$1"+k))}}return!0};d.prototype.removeHighlight=function(){if(0==this.$elements.length)return!1;
this.options.debug&&("string"===typeof this.keyword&&""!=this.keyword?console.log("Removing highlighting with keyword: '"+this.keyword+"'"):console.log("Removing highlighting"));var a=new RegExp(this.getKeywordRegexp(),"gmi"),b=this.options.element+"[data-jmHighlight]."+this.options.className,h=this,e=this.$elements.filter(b);this.options.debug&&(console.log(b),console.log(e));e.each(function(){var b=c(this);if(a.test(b.text()))h.appendTextNodes(b,e);else return!0});return!0};d.prototype.appendTextNodes=
function(a,b){if(0==a instanceof c||0==a.length)return!1;var h=a.first()[0],e=h.previousSibling,h=h.nextSibling,f=c(e),g=c(h),d=!1;0<f.length&&(3==e.nodeType?(e.nodeValue+=a.text(),a.remove()):b instanceof c&&0<b.length&&b.is(f)?(f.replaceWith(a.text()+f.text()),a.remove()):a.replaceWith(a.text()),d=!0);0<g.length&&(3==h.nodeType?0==f.length?(h.nodeValue=a.text()+h.nodeValue,a.remove()):(h.nodeValue=f.text()+h.nodeValue,f.remove()):b instanceof c&&0<b.length&&b.is(g)?0==f.length?(g.replaceWith(g.text()+
a.text()),a.remove()):(g.replaceWith(f.text()+g.text()),f.remove()):0==f.length&&a.replaceWith(a.text()),d=!0);0==d&&a.replaceWith(a.text());return!0};c.fn.jmHighlight=function(a,b){return(new d(c(this),a,b)).highlight()};c.fn.jmRemoveHighlight=function(a,b){return(new d(c(this),b,a)).removeHighlight()}});

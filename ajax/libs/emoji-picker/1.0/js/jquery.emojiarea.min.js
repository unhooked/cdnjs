!function(e,t,i){var n=1,o=3,a=["p","div","pre","form"],s=27,r=9;e.emojiarea={assetsPath:"",iconSize:25,icons:{}};var c=":joy:,:kissing_heart:,:heart:,:heart_eyes:,:blush:,:grin:,:+1:,:relaxed:,:pensive:,:smile:,:sob:,:kiss:,:unamused:,:flushed:,:stuck_out_tongue_winking_eye:,:see_no_evil:,:wink:,:smiley:,:cry:,:stuck_out_tongue_closed_eyes:,:scream:,:rage:,:smirk:,:disappointed:,:sweat_smile:,:kissing_closed_eyes:,:speak_no_evil:,:relieved:,:grinning:,:yum:,:laughing:,:ok_hand:,:neutral_face:,:confused:".split(",");e.fn.emojiarea=function(t){return t=e.extend({},t),this.each(function(){var n=e(this);if("contentEditable"in i.body&&t.wysiwyg!==!1){var o=getGuid();new u(n,o,e.extend({},t))}else{var o=getGuid();new h(n,o,t)}n.attr({"data-emojiable":"converted","data-id":o,"data-type":"original-input"})})};var l={};l.restoreSelection=function(){return t.getSelection?function(e){var i=t.getSelection();i.removeAllRanges();for(var n=0,o=e.length;o>n;++n)i.addRange(e[n])}:i.selection&&i.selection.createRange?function(e){e&&e.select()}:void 0}(),l.saveSelection=function(){return t.getSelection?function(){var e=t.getSelection(),i=[];if(e.rangeCount)for(var n=0,o=e.rangeCount;o>n;++n)i.push(e.getRangeAt(n));return i}:i.selection&&i.selection.createRange?function(){var e=i.selection;return"none"!==e.type.toLowerCase()?e.createRange():null}:void 0}(),l.replaceSelection=function(){return t.getSelection?function(e){var n,o=t.getSelection(),a="string"==typeof e?i.createTextNode(e):e;o.getRangeAt&&o.rangeCount&&(n=o.getRangeAt(0),n.deleteContents(),n.insertNode(a),n.setStart(a,0),t.setTimeout(function(){n=i.createRange(),n.setStartAfter(a),n.collapse(!0),o.removeAllRanges(),o.addRange(n)},0))}:i.selection&&i.selection.createRange?function(e){var t=i.selection.createRange();"string"==typeof e?t.text=e:t.pasteHTML(e.outerHTML)}:void 0}(),l.insertAtCursor=function(e,t){e=" "+e;var n,o,a,s=t.value;"undefined"!=typeof t.selectionStart&&"undefined"!=typeof t.selectionEnd?(o=t.selectionStart,n=t.selectionEnd,t.value=s.substring(0,o)+e+s.substring(t.selectionEnd),t.selectionStart=t.selectionEnd=o+e.length):"undefined"!=typeof i.selection&&"undefined"!=typeof i.selection.createRange&&(t.focus(),a=i.selection.createRange(),a.text=e,a.select())},l.extend=function(e,t){if("undefined"!=typeof e&&e||(e={}),"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},l.escapeRegex=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},l.htmlEntities=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},l.emojiInserted=function(e,t){ConfigStorage.get("emojis_recent",function(t){t=t||c||[];var i=t.indexOf(e);return i?(-1!=i&&t.splice(i,1),t.unshift(e),t.length>42&&(t=t.slice(42)),void ConfigStorage.set({emojis_recent:t})):!1})};var d=function(){};d.prototype.setup=function(){var e=this;this.$editor.on("focus",function(){e.hasFocus=!0}),this.$editor.on("blur",function(){e.hasFocus=!1}),e.emojiMenu=new p(e),this.setupButton()},d.prototype.setupButton=function(){var t=this,i=e("[data-id="+this.id+"][data-type=picker]");i.on("click",function(e){t.emojiMenu.show(t)}),this.$button=i,this.$dontHideOnClick="emoji-picker"},d.createIcon=function(t,i){var n=t[0],o=t[1],a=t[2],s=t[3],r=e.emojiarea.assetsPath+"/emoji_spritesheet_!.png",c=e.emojiarea.assetsPath+"/blank.gif",d=i&&Config.Mobile?26:e.emojiarea.iconSize,h=-(d*a),u=-(d*o),p=Config.EmojiCategorySpritesheetDimens[n][1]*d,m=Config.EmojiCategorySpritesheetDimens[n][0]*d,g="display:inline-block;";return g+="width:"+d+"px;",g+="height:"+d+"px;",g+="background:url('"+r.replace("!",n)+"') "+h+"px "+u+"px no-repeat;",g+="background-size:"+p+"px "+m+"px;",'<img src="'+c+'" class="img" style="'+g+'" alt="'+l.htmlEntities(s)+'">'},e.emojiarea.createIcon=d.createIcon;var h=function(e,t,i){this.options=i,this.$textarea=e,this.$editor=e,this.id=t,this.setup()};h.prototype.insert=function(t){e.emojiarea.icons.hasOwnProperty(t)&&(l.insertAtCursor(t,this.$textarea[0]),l.emojiInserted(t,this.menu),this.$textarea.trigger("change"))},h.prototype.val=function(){return"\n"==this.$textarea?"":this.$textarea.val()},l.extend(h.prototype,d.prototype);var u=function(t,n,o){var a=this;this.options=o||{},"unicode"===e(t).attr("data-emoji-input")?this.options.inputMethod="unicode":this.options.inputMethod="image",this.id=n,this.$textarea=t,this.emojiPopup=o.emojiPopup,this.$editor=e("<div>").addClass("emoji-wysiwyg-editor").addClass(e(t)[0].className),this.$editor.data("self",this),t.attr("maxlength")&&this.$editor.attr("maxlength",t.attr("maxlength"));var s=this.emojiPopup.unicodeToImage(t.val());this.$editor.html(s),this.$editor.attr({"data-id":n,"data-type":"input",placeholder:t.attr("placeholder"),contenteditable:"true"});var r="blur change";this.options.norealTime||(r+=" keyup"),this.$editor.on(r,function(e){return a.onChange.apply(a,[e])}),this.$editor.on("mousedown focus",function(){i.execCommand("enableObjectResizing",!1,!1)}),this.$editor.on("blur",function(){i.execCommand("enableObjectResizing",!0,!0)});var c=this.$editor;this.$editor.on("change keydown keyup resize scroll",function(e){8!=e.which&&c.text().length+c.find("img").length>=c.attr("maxlength")&&e.preventDefault(),a.updateBodyPadding(c)}),t.after("<i class='emoji-picker-icon emoji-picker "+this.options.popupButtonClasses+"' data-id='"+n+"' data-type='picker'></i>"),t.hide().after(this.$editor),this.setup(),e(i.body).on("mousedown",function(){a.hasFocus&&(a.selection=l.saveSelection())})};u.prototype.updateBodyPadding=function(t){var i=e("[data-id="+this.id+"][data-type=picker]");e(t).hasScrollbar()?(i.hasClass("parent-has-scroll")||i.addClass("parent-has-scroll"),e(t).hasClass("parent-has-scroll")||e(t).addClass("parent-has-scroll")):(i.hasClass("parent-has-scroll")&&i.removeClass("parent-has-scroll"),e(t).hasClass("parent-has-scroll")&&e(t).removeClass("parent-has-scroll"))},u.prototype.onChange=function(e){this.$textarea.val(this.val()).trigger("change")},u.prototype.insert=function(t){var i="";if("unicode"==this.options.inputMethod)i=this.emojiPopup.colonToUnicode(t);else{var n=e(d.createIcon(e.emojiarea.icons[t]));n[0].attachEvent&&n[0].attachEvent("onresizestart",function(e){e.returnValue=!1},!1),i=n[0]}this.$editor.trigger("focus"),this.selection&&l.restoreSelection(this.selection);try{l.replaceSelection(i)}catch(o){}l.emojiInserted(t,this.menu),this.onChange()},u.prototype.val=function(){for(var e=[],t=[],i=this.emojiPopup,s=function(){e.push(t.join("")),t=[]},r=function(e){if(e.nodeType===o)t.push(e.nodeValue);else if(e.nodeType===n){var i=e.tagName.toLowerCase(),c=-1!==a.indexOf(i);if(c&&t.length&&s(),"img"===i){var l=e.getAttribute("alt")||"";return void(l&&t.push(l))}"br"===i&&s();for(var d=e.childNodes,h=0;h<d.length;h++)r(d[h]);c&&t.length&&s()}},c=this.$editor[0].childNodes,l=0;l<c.length;l++)r(c[l]);t.length&&s();var d=e.join("\n");return i.colonToUnicode(d)},l.extend(u.prototype,d.prototype),jQuery.fn.hasScrollbar=function(){var e=this.get(0).scrollHeight;return this.outerHeight()<e};var p=function(n){var o=this;o.id=n.id;var a=e(i.body),c=e(t);this.visible=!1,this.emojiarea=n,p.menuZIndex=5e3,this.$menu=e("<div>"),this.$menu.addClass("emoji-menu"),this.$menu.attr("data-id",o.id),this.$menu.attr("data-type","menu"),this.$menu.hide(),this.$itemsTailWrap=e('<div class="emoji-items-wrap1"></div>').appendTo(this.$menu),this.$categoryTabs=e('<table class="emoji-menu-tabs"><tr><td><a class="emoji-menu-tab icon-recent" ></a></td><td><a class="emoji-menu-tab icon-smile" ></a></td><td><a class="emoji-menu-tab icon-flower"></a></td><td><a class="emoji-menu-tab icon-bell"></a></td><td><a class="emoji-menu-tab icon-car"></a></td><td><a class="emoji-menu-tab icon-grid"></a></td></tr></table>').appendTo(this.$itemsTailWrap),this.$itemsWrap=e('<div class="emoji-items-wrap nano mobile_scrollable_wrap"></div>').appendTo(this.$itemsTailWrap),this.$items=e('<div class="emoji-items nano-content">').appendTo(this.$itemsWrap),a.append(this.$menu),Config.Mobile||this.$itemsWrap.nanoScroller({preventPageScrolling:!0,tabIndex:-1}),a.on("keydown",function(e){e.keyCode!==s&&e.keyCode!==r||o.hide()}),a.on("message_send",function(e){o.hide()}),a.on("mouseup",function(i){i=i.originalEvent||i;var n=i.originalTarget||i.target||t;if(!e(n).hasClass(o.emojiarea.$dontHideOnClick)){for(;n&&n!=t;)if(n=n.parentNode,n==o.$menu[0]||o.emojiarea&&n==o.emojiarea.$button[0])return;o.hide()}}),c.on("resize",function(){o.visible&&o.reposition()}),this.$menu.on("mouseup","a",function(e){return e.stopPropagation(),!1}),this.$menu.on("click","a",function(i){if(o.emojiarea.updateBodyPadding(o.emojiarea.$editor),e(this).hasClass("emoji-menu-tab"))return o.getTabIndex(this)!==o.currentCategory&&o.selectCategory(o.getTabIndex(this)),!1;var n=e(".label",e(this)).text();return t.setTimeout(function(){o.onItemSelected(n),(i.ctrlKey||i.metaKey)&&o.hide()},0),i.stopPropagation(),!1}),this.selectCategory(0)};p.prototype.getTabIndex=function(e){return this.$categoryTabs.find(".emoji-menu-tab").index(e)},p.prototype.selectCategory=function(e){this.$categoryTabs.find(".emoji-menu-tab").each(function(t){t===e?this.className+="-selected":this.className=this.className.replace("-selected","")}),this.currentCategory=e,this.load(e),Config.Mobile||this.$itemsWrap.nanoScroller({scroll:"top"})},p.prototype.onItemSelected=function(e){this.emojiarea.$editor.text().length+this.emojiarea.$editor.find("img").length>=this.emojiarea.$editor.attr("maxlength")||this.emojiarea.insert(e)},p.prototype.load=function(t){var i=[],n=e.emojiarea.icons,o=e.emojiarea.assetsPath,a=this;o.length&&"/"!==o.charAt(o.length-1)&&(o+="/");var s=function(){a.$items.html(i.join("")),Config.Mobile||setTimeout(function(){a.$itemsWrap.nanoScroller()},100)};if(t>0){for(var r in n)n.hasOwnProperty(r)&&n[r][0]===t-1&&i.push('<a href="javascript:void(0)" title="'+l.htmlEntities(r)+'">'+d.createIcon(n[r],!0)+'<span class="label">'+l.htmlEntities(r)+"</span></a>");s()}else ConfigStorage.get("emojis_recent",function(e){e=e||c||[];var t,o;for(o=0;o<e.length;o++)t=e[o],n[t]&&i.push('<a href="javascript:void(0)" title="'+l.htmlEntities(t)+'">'+d.createIcon(n[t],!0)+'<span class="label">'+l.htmlEntities(t)+"</span></a>");s()})},p.prototype.reposition=function(){this.tether||(this.tether=new Tether({element:'[data-id="'+this.id+'"][data-type="menu"]',target:'[data-id="'+this.id+'"][data-type="picker"]',attachment:"left center",targetAttachment:"bottom left",offset:"0 12px",constraints:[{to:"html",pin:!0}]}))},p.prototype.hide=function(e){this.visible=!1,this.$menu.hide("fast")},p.prototype.show=function(t){return this.visible?this.hide():(this.reposition(),e(this.$menu).css("z-index",++p.menuZIndex),this.$menu.show("fast"),this.currentCategory||this.load(0),void(this.visible=!0))}}(jQuery,window,document);
//# sourceMappingURL=jquery.emojiarea.min.js.map
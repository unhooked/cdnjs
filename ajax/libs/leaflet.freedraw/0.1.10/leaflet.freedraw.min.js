/*! leaflet.freedraw by Adam Timberlake <adam.timberlake@gmail.com> created on 2014-08-21 */
!function(a,b,c){"use strict";var d=function(a,b){throw b&&console.error("See: https://github.com/Wildhoney/Leaflet.FreeDraw/blob/master/EXCEPTIONS.md#"+b),"Leaflet.FreeDraw: "+a+"."};a.FreeDraw=function(b){this.setMap(b),this.map.dragging.disable(),this.options=new a.FreeDraw.Options,this.hull=new a.FreeDraw.Hull,this.lineFunction=c.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"),this.createD3(),this._attachMouseDown(),this._attachMouseMove(),this._attachMouseUpLeave()},a.FreeDraw.prototype={map:null,svg:{},creating:!1,lineFunction:function(){},latLngs:[],options:{},hull:{},edges:[],allowEdit:!0,fromPoint:{x:0,y:0},movingEdge:null,setMap:function(a){a&&a instanceof b.Map||d("Upon instantiation an instance of L.Map must be passed","passing-an-lmap-instance"),this.map=a},enableEdit:function(){this.allowEdit=!0,this.map.dragging.disable()},disableEdit:function(){this.allowEdit=!1,this.map.dragging.enable()},createD3:function(){this.svg=c.select("body").append("svg").attr("class",this.options.svgClassName).attr("width",200).attr("height",200)},destroyD3:function(){return this.svg.remove(),this.svg={},this},drawPolygon:function(a){this.destroyD3().createD3();var c=b.polygon(a,{color:"#D7217E",weight:0,fill:!0,fillColor:"#D7217E",fillOpacity:.75,smoothFactor:this.options.smoothFactor}).addTo(this.map);return this.attachEdges(c),c},attachEdges:function(a){var c=a._parts[0];c.forEach(function(d,e){var f=b.divIcon({className:this.options.iconClassName}),g=this.map.layerPointToLatLng(d);f=b.marker(g,{icon:f}).addTo(this.map),f._polygon=a,f._index=e,f._length=c.length,this.edges.push(f),f.on("mousedown",function(a){a.originalEvent.preventDefault(),a.originalEvent.stopPropagation(),this.movingEdge=a.target}.bind(this))}.bind(this))},updatePolygonEdge:function(a,c,d){var e=this.map.containerPointToLatLng(b.point(c,d));a.setLatLng(e);var f=this.edges.filter(function(b){return b._polygon===a._polygon}),g=[];f.forEach(function(a){g.push(a.getLatLng())}),a._polygon.setLatLngs(g),a._polygon.redraw()},_attachMouseDown:function(){this.map.on("mousedown",function(a){var b=2;if(this.allowEdit&&a.originalEvent.button!==b){var c=a.originalEvent;c.stopPropagation(),c.preventDefault(),this.latLngs=[],this.creating=!0,this.fromPoint={x:c.clientX,y:c.clientY}}}.bind(this))},_attachMouseMove:function(){this.map.on("mousemove",function(a){var b=a.originalEvent;return this.movingEdge?void this._editMouseMove(b):void(this.creating&&this._createMouseMove(b))}.bind(this))},_editMouseMove:function(a){var c=b.point(a.clientX,a.clientY),d=this.movingEdge._icon.style;d[b.DomUtil.TRANSFORM]=c,this.updatePolygonEdge(this.movingEdge,c.x,c.y)},_attachMouseUpLeave:function(){this.map.on("mouseup mouseleave",function(){return this.movingEdge?void(this.movingEdge=null):void this._createMouseUp()}.bind(this))},_createMouseMove:function(a){var c=a.clientX,d=a.clientY,e=b.point(c,d),f=this.map.containerPointToLatLng(e),g=[this.fromPoint,{x:c,y:d}];this.svg.append("path").attr("d",this.lineFunction(g)).attr("stroke","#D7217E").attr("stroke-width",2).attr("fill","none"),this.fromPoint.x=c,this.fromPoint.y=d,this.latLngs.push(f)},_createMouseUp:function(){if(this.creating=!1,!(this.latLngs.length<=2)){if(this.options.hullAlgorithm){this.hull.setMap(this.map);var a=this.hull[this.options.hullAlgorithm](this.latLngs)}this.latLngs.push(this.latLngs[0]),this.drawPolygon(a||this.latLngs),this.latLngs=[]}}}}(window,window.L,window.d3),function(a){"use strict";a.FreeDraw.Hull=function(){},a.FreeDraw.Hull.prototype={map:{},setMap:function(a){this.map=a},brian3kbGrahamScan:function(a){var b=new ConvexHullGrahamScan,c=[],d=[],e=[];a.forEach(function(a){d.push(this.map.latLngToContainerPoint(a))}.bind(this)),d.forEach(function(a){b.addPoint(a.x,a.y)}.bind(this));var f=b.getHull();return f.forEach(function(a){c.push(L.point(a.x,a.y))}.bind(this)),c.push(c[0]),c.forEach(function(a){e.push(this.map.containerPointToLatLng(a))}.bind(this)),e},wildhoneyConcaveHull:function(a){return a.push(a[0]),new ConcaveHull(a).getLatLngs()}}}(window),function(a){a.module("searchApp").directive("map",function(){return{restrict:"EA",scope:!0,controller:["$scope",function(b){b.SMOOTH_FACTOR=5,b.MINIMUM_ALLOWED_EDGES=4,b.svg={},b.map={},b.markers=[],b.pointerEdit=null,b.editAllowed=!0,b.initialiseMap=function(a){var c=b.map=L.map(a).setView([51.505,-.09],13);return c.dragging.disable(),L.tileLayer("http://c.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg",{maxZoom:18}).addTo(c),c},b.allowEdit=function(a){var c=a?"disable":"enable";b.map.dragging[c](),b.editAllowed=a},b.createD3=function(){return d3.select("body").append("svg").attr("class","custom-line").attr("width",200).attr("height",200)},b.destroyD3=function(){return b.svg.remove(),this},b.drawPolygon=function(a){b.svg=b.destroyD3().createD3();var c=L.polyline(a,{color:"red",fill:!0,fillColor:"#ff0000",fillOpacity:.45,smoothFactor:b.SMOOTH_FACTOR});return c.addTo(b.map),b.attachEdges(c),c},b.attachEdges=function(c){var d=c._parts[0];a.forEach(d,function(a,e){var f=L.divIcon({className:"icon-edge"}),g=b.map.layerPointToLatLng(a),h=L.marker(g,{icon:f}).addTo(b.map);h._polygon=c,h._index=e,h._length=d.length,b.markers.push(h),h.on("mousedown",function(a){a.originalEvent.preventDefault(),a.originalEvent.stopPropagation(),b.pointerEdit=a.target})})},b.updatePolygonEdge=function(c,d,e){var f=b.map.containerPointToLatLng(L.point(d,e));c.setLatLng(f);var g=b.markers.filter(function(a){return a._polygon===c._polygon}),h=[];a.forEach(g,function(a){h.push(a.getLatLng())}),c._polygon.setLatLngs(h),c._polygon.redraw()},b.sharePolygonBoundaries=function(c){var d=c._parts[0],e=[];a.forEach(d,function(a){var c=b.map.containerPointToLatLng(a);e.push(c)})},b.removePolygon=function(a){a._container.remove(),b.markers=b.markers.filter(function(b){var c=b._polygon===a;return c?void b._icon.remove():!0})}}],link:function(a,b){var c=a.initialiseMap(b[0]),d=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear");a.svg=a.createD3();var e=!1,f=[],g=null;b.bind("keydown",function(b){27===b.originalEvent.keyCode&&(f=[],e=!1,a.svg=a.destroyD3().createD3())}),b.bind("mousedown",function(b){a.editAllowed&&(b.stopPropagation(),b.preventDefault(),f=[],e=!0,g={x:b.clientX,y:b.clientY})}),b.bind("mouseup mouseleave",function(){if(a.editAllowed){if(e=!1,a.pointerEdit)return a.sharePolygonBoundaries(a.pointerEdit._polygon),void(a.pointerEdit=null);if(0===f.length)return!1;f.push(f[0]);var b=a.drawPolygon(f);if(b.on("click",function(){a.editAllowed&&a.removePolygon(b)}),b._parts[0].length<a.MINIMUM_ALLOWED_EDGES)return void a.removePolygon(b);f=[],a.sharePolygonBoundaries(b)}}),b.bind("mousemove",function(b){if(a.editAllowed){if(a.pointerEdit){var h=L.point(b.clientX,b.clientY),i=a.pointerEdit._icon.style;return i[L.DomUtil.TRANSFORM]=h,a.updatePolygonEdge(a.pointerEdit,h.x,h.y),void function(){var b=a.pointerEdit._index===a.pointerEdit._length-1;if(b){var c=a.markers.filter(function(b){return b._polygon===a.pointerEdit._polygon})[0];a.updatePolygonEdge(c,h.x,h.y)}}()}if(!e)return!1;var j=b.clientX,k=b.clientY,l=L.point(j,k),m=c.containerPointToLatLng(l),n=[g,{x:j,y:k}];a.svg.append("path").attr("d",d(n)).attr("stroke","blue").attr("stroke-width",2).attr("fill","none"),g={x:j,y:k},f.push(m)}})}}})}(window.angular),function(a){"use strict";a.FreeDraw.Options=function(){},a.FreeDraw.Options.prototype={multiplePolygons:!0,hullAlgorithm:"brian3kbGrahamScan",hullAlgorithms:{"brian3kb/graham_scan_js":"brian3kbGrahamScan","Wildhoney/ConcaveHull":"wildhoneyConcaveHull"},svgClassName:"tracer",smoothFactor:5,iconClassName:"polygon-elbow",allowMultiplePolygons:function(a){this.multiplePolygons=!!a},setSVGClassName:function(a){this.svgClassName=a},setSmoothFactor:function(a){this.smoothFactor=+a},setIconClassName:function(a){this.iconClassName=a},setHullAlgorithm:function(a){(!a||this.hullAlgorithms.hasOwnProperty(a))&&(this.hullAlgorithm=this.hullAlgorithms[a])}}}(window);
/*! leaflet.freedraw by Adam Timberlake <adam.timberlake@gmail.com> created on 2014-08-28 */
!function(a,b,c,d){"use strict";b.freeDraw=function(a){return new b.FreeDraw(a)},b.FreeDraw=b.FeatureGroup.extend({map:null,svg:{},element:{},creating:!1,lineFunction:function(){},latLngs:[],preferences:{},options:{},markerLayer:b.layerGroup(),hull:{},edges:[],mode:1,polygonCount:0,fromPoint:{x:0,y:0},movingEdge:null,boundaryUpdateRequired:!1,silenced:!1,initialize:function(a){"undefined"==typeof c&&b.FreeDraw.Throw("D3 is a required library","http://d3js.org/"),this.preferences=new b.FreeDraw.Preferences,this.hull=new b.FreeDraw.Hull,b.Util.setOptions(this,a),this.setMode(this.options.mode||this.mode)},onAdd:function(a){this.map=a,this.element=a._container,this.mode=this.mode||b.FreeDraw.MODES.VIEW,this.lineFunction=c.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"),this.createD3(),this._attachMouseDown(),this._attachMouseMove(),this._attachMouseUpLeave(),this.setMode(this.mode)},onRemove:function(){this.clearPolygons()},silently:function(a){this.silenced=!0,a.apply(this),this.silenced=!1},cancelAction:function(){this.creating=!1,this.movingEdge=null,this.destroyD3().createD3()},setMode:function(a){a=0===a?b.FreeDraw.MODES.VIEW:a;var c=!!(a&b.FreeDraw.MODES.CREATE),d=c?"disable":"enable";this.mode=a,this.fire("mode",{mode:a}),this.map&&(!this.boundaryUpdateRequired||this.mode&b.FreeDraw.MODES.EDIT||(this.notifyBoundaries(),this.boundaryUpdateRequired=!1),this.map.dragging[d](),this.map.touchZoom[d](),this.map.doubleClickZoom[d](),this.map.scrollWheelZoom[d](),function(b,c,d,e){e(c,"mode-create"),e(c,"mode-edit"),e(c,"mode-delete"),e(c,"mode-view"),a&b.CREATE&&d(c,"mode-create"),a&b.EDIT&&d(c,"mode-edit"),a&b.DELETE&&d(c,"mode-delete"),a&b.VIEW&&d(c,"mode-view")}(b.FreeDraw.MODES,this.map._container,b.DomUtil.addClass,b.DomUtil.removeClass))},unsetMode:function(a){this.setMode(this.mode^a)},createD3:function(){this.svg=c.select(this.options.element||this.element).append("svg").attr("class",this.preferences.svgClassName).attr("width",200).attr("height",200)},destroyD3:function(){return this.svg.remove(),this.svg={},this},latLngsToClipperPoints:function(a){return a.map(function(a){var b=this.map.latLngToContainerPoint(a);return{X:b.x,Y:b.y}}.bind(this))},clipperPolygonsToLatLngs:function(a){var c=[];return a.forEach(function(a){a.forEach(function(a){a=b.point(a.X,a.Y);var d=this.map.containerPointToLatLng(a);c.push(d)}.bind(this))}.bind(this)),c},createPolygon:function(a){this.destroyD3().createD3();var c=function(){var b=d.Clipper.CleanPolygon(this.latLngsToClipperPoints(a),1.1),c=d.Clipper.SimplifyPolygon(b,d.PolyFillType.pftNonZero);return this.clipperPolygonsToLatLngs(c)}.apply(this);if(0===c.length)return!1;var e=b.polygon(c,{color:"#D7217E",weight:0,fill:!0,fillColor:"#D7217E",fillOpacity:.75,smoothFactor:this.preferences.smoothFactor});return e.addTo(this.map),e._latlngs=[],this.attachEdges(e),e._parts[0].forEach(function(a){e._latlngs.push(this.map.layerPointToLatLng(a))}.bind(this)),this.preferences.attemptMerge&&!this.silenced&&this.mergePolygons(),this.silenced||this.notifyBoundaries(),e},mergePolygons:function(){var a=function(){var a=[],c=[];this.edges.forEach(function(b){-1===a.indexOf(b._polygon)&&a.push(b._polygon)}.bind(this)),a.forEach(function(a){c.push(this.latLngsToClipperPoints(a._latlngs))}.bind(this));var e=d.Clipper.SimplifyPolygons(c,d.PolyFillType.pftNonZero);this.silently(function(){this.clearPolygons(),e.forEach(function(a){var c=[];a.forEach(function(a){a=b.point(a.X,a.Y),c.push(this.map.containerPointToLatLng(a))}.bind(this)),a=this.createPolygon(c),a.on("click",function(){this.mode&b.FreeDraw.MODES.DELETE&&this.destroyPolygon(a)}.bind(this))}.bind(this))})}.bind(this);a(),a()},destroyPolygon:function(a){this.map.removeLayer(a),this.edges=this.edges.filter(function(b){return b._polygon!==a?!0:void this.map.removeLayer(b)}.bind(this)),this.silenced||this.notifyBoundaries()},clearPolygons:function(){this.edges.forEach(function(a){this.destroyPolygon(a._polygon)}.bind(this)),this.silenced||this.notifyBoundaries()},notifyBoundaries:function(){var a=[],b=null,c=-1;this.edges.forEach(function(d){d._polygonId!==b&&c++,"undefined"==typeof a[c]&&(a[c]=[]),b=d._polygonId,a[c].push(d._latlng)}.bind(this)),this.polygonCount=a.length,this.fire("markers",{latLngs:a})},setMarkers:function(a,c){if("undefined"==typeof c||c instanceof b.DivIcon||b.FreeDraw.Throw("Second argument must be an instance of L.DivIcon"),this.map.removeLayer(this.markerLayer),this.markerLayer=b.layerGroup(),this.markerLayer.addTo(this.map),a&&0!==a.length)for(var d=c?{icon:c}:{},e=0,f=a.length;f>e;e++){a[e]instanceof b.LatLng||b.FreeDraw.Throw("Supplied markers must be instances of L.LatLng");var g=b.marker(a[e],d);this.markerLayer.addLayer(g)}},attachEdges:function(a){var c=a._parts[0];c.forEach(function(d,e){var f=b.divIcon({className:this.preferences.iconClassName}),g=this.map.layerPointToLatLng(d);f=b.marker(g,{icon:f}).addTo(this.map),f._polygon=a,f._polygonId=a._leaflet_id,f._index=e,f._length=c.length,this.edges.push(f),f.on("mousedown touchstart",function(a){a.originalEvent.preventDefault(),a.originalEvent.stopPropagation(),this.movingEdge=a.target}.bind(this))}.bind(this))},updatePolygonEdge:function(a,c,d){var e=this.map.containerPointToLatLng(b.point(c,d));a.setLatLng(e);var f=this.edges.filter(function(b){return b._polygon===a._polygon}),g=[];f.forEach(function(a){g.push(a.getLatLng())}),a._polygon.setLatLngs(g),a._polygon.redraw()},_attachMouseDown:function(){this.map.on("mousedown touchstart",function(a){var c=2;if(a.originalEvent.button!==c&&(this.preferences.multiplePolygons||!this.edges.length)){var d=a.originalEvent;d.stopPropagation(),d.preventDefault(),this.latLngs=[],this.fromPoint={x:d.clientX,y:d.clientY},this.mode&b.FreeDraw.MODES.CREATE&&(this.creating=!0)}}.bind(this))},_attachMouseMove:function(){this.map.on("mousemove touchmove",function(a){var b=a.originalEvent;return this.movingEdge?void this._editMouseMove(b):void(this.creating&&this._createMouseMove(b))}.bind(this))},_editMouseMove:function(a){var c=b.point(a.clientX,a.clientY),d=this.movingEdge._icon.style;d[b.DomUtil.TRANSFORM]=c,this.updatePolygonEdge(this.movingEdge,c.x,c.y)},_attachMouseUpLeave:function(){var b=function(){return this.movingEdge?(this.preferences.boundariesAfterEdit?this.boundaryUpdateRequired=!0:this.notifyBoundaries(),void(this.movingEdge=null)):void this._createMouseUp()}.bind(this);this.map.on("mouseup touchend",b);var c=a.document.getElementsByTagName("body")[0];c.onmouseleave=b},_createMouseMove:function(a){var c=a.clientX,d=a.clientY,e=b.point(c,d),f=this.map.containerPointToLatLng(e),g=[this.fromPoint,{x:c,y:d}];this.svg.append("path").attr("d",this.lineFunction(g)).attr("stroke","#D7217E").attr("stroke-width",2).attr("fill","none"),this.fromPoint.x=c,this.fromPoint.y=d,this.latLngs.push(f)},_createMouseUp:function(){if(this.creating=!1,!(this.latLngs.length<=2)){if(this.preferences.hullAlgorithm){this.hull.setMap(this.map);var a=this.hull[this.preferences.hullAlgorithm](this.latLngs)}this.latLngs.push(this.latLngs[0]);var c=this.createPolygon(a||this.latLngs);c&&(this.latLngs=[],c.on("click",function(){this.mode&b.FreeDraw.MODES.DELETE&&this.destroyPolygon(c)}.bind(this)),this.preferences.createExitMode&&this.setMode(this.mode^b.FreeDraw.MODES.CREATE))}}}),b.FreeDraw.MODES={VIEW:1,CREATE:2,EDIT:4,DELETE:8,ALL:15},b.FreeDraw.Throw=function(b,c){throw c&&a.console.error("http://"===c.substr(0,7)||"https://"===c.substr(0,8)?c:"See: https://github.com/Wildhoney/Leaflet.FreeDraw/blob/master/EXCEPTIONS.md#"+c),"Leaflet.FreeDraw: "+b+"."}}(window,window.L,window.d3,window.ClipperLib),function(){"use strict";L.FreeDraw.Hull=function(){},L.FreeDraw.Hull.prototype={map:{},setMap:function(a){this.map=a},brian3kbGrahamScan:function(a){var b=new ConvexHullGrahamScan,c=[],d=[],e=[];a.forEach(function(a){d.push(this.map.latLngToContainerPoint(a))}.bind(this)),d.forEach(function(a){b.addPoint(a.x,a.y)}.bind(this));var f=b.getHull();return f.forEach(function(a){c.push(L.point(a.x,a.y))}.bind(this)),c.push(c[0]),c.forEach(function(a){e.push(this.map.containerPointToLatLng(a))}.bind(this)),e},wildhoneyConcaveHull:function(a){return a.push(a[0]),new ConcaveHull(a).getLatLngs()}}}(),function(a,b,c,d){"use strict";var e=function(){"undefined"==typeof d&&b.FreeDraw.Throw("JSClipper is a required library for polygon merging and/or simplification","http://sourceforge.net/p/jsclipper/wiki/Home%206/")};b.FreeDraw.Preferences=function(){},b.FreeDraw.Preferences.prototype={multiplePolygons:!0,simplifyPolygon:!1,hullAlgorithm:!1,boundariesAfterEdit:!1,createExitMode:!0,hullAlgorithms:{"brian3kb/graham_scan_js":{method:"brian3kbGrahamScan",name:"Graham Scan JS",global:"ConvexHullGrahamScan",link:"https://github.com/brian3kb/graham_scan_js"},"Wildhoney/ConcaveHull":{method:"wildhoneyConcaveHull",name:"Concave Hull",global:"ConcaveHull",link:"https://github.com/Wildhoney/ConcaveHull"}},attemptMerge:!1,svgClassName:"tracer",smoothFactor:5,iconClassName:"polygon-elbow",allowPolygonMerging:function(a){e(),this.attemptMerge=!!a},exitModeAfterCreate:function(a){this.createExitMode=!!a},allowMultiplePolygons:function(a){this.multiplePolygons=!!a},setSVGClassName:function(a){this.svgClassName=a},setBoundariesAfterEdit:function(a){this.boundariesAfterEdit=!!a},setSmoothFactor:function(a){this.smoothFactor=+a},setPolygonSimplification:function(a){e(),this.simplifyPolygon=!!a},setIconClassName:function(a){this.iconClassName=a},setHullAlgorithm:function(c){(!c||this.hullAlgorithms.hasOwnProperty(c))&&(c=this.hullAlgorithms[c],"undefined"==typeof a[c.global]&&b.FreeDraw.Throw(c.name+" is a required library for concave/convex hulls",c.link),this.hullAlgorithm=c.method)}}}(window,window.L,window.d3,window.ClipperLib);
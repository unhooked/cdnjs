!function(t,e){document.MBLOADED||("function"==typeof define&&(define.amd||define.cmd)?define("mobilebone",function(a){return e(t,a)}):t.Mobilebone=e(t,{}))}(this,function(t,e){if(document.MBLOADED)return"Don't repeat load Mobilebone!";var a={},n=[],r=n.slice,i=/^#?\w+(?:[\-_]\w+)*$/i,o="WebkitAppearance"in document.documentElement.style||"undefined"!=typeof document.webkitHidden,s="pushState"in history&&"replaceState"in history;e.support=s;var l=!1;if(e.VERSION="2.6.1",e.captureLink=!0,e.captureForm=!0,e.rootTransition=t,e.mergeCallback=!0,e.classAnimation="slide",e.classPage="page",e.classMask="mask",e.pushStateEnabled=!0,e.evalScript=!1,window.navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window&&(e.pushStateEnabled=!1),0==s)return e;history.popstate=!1,e.transition=function(t,n,i,l){if(0!=arguments.length&&t!=n){3==arguments.length&&1==isNaN(1*i)&&(l=i,i=l.back),n=n||null,i=i||!1,l=l||{};var u={root:this.rootTransition,form:this.form||this.classAnimation,onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,preventdefault:this.preventdefault,fallback:this.fallback,callback:this.callback},d=function(t){if(!t||!t.getAttribute)return{};var a={},n=c(t.getAttribute("data-params")||"");return["title","root","form"].forEach(function(e){a[e]=t.getAttribute("data-"+e)||n[e]||l[e]||u[e]}),"string"==typeof a.root&&(a.root=e.getFunction(a.root)),["onpagefirstinto","callback","fallback","animationstart","animationend","preventdefault"].forEach(function(r){if(1==e.mergeCallback&&"function"==typeof u[r]){var i=t.getAttribute("data-"+r)||n[r];"function"==typeof a.root[i]?a[r]=function(){u[r].apply(this,arguments),a.root[i].apply(this,arguments)}:"function"==typeof l[r]?a[r]=function(){u[r].apply(this,arguments),l[r].apply(this,arguments)}:a[r]=u[r]}else a[r]=t.getAttribute("data-"+r)||n[r]||l[r]||u[r]}),a},f=d(n),p=d(t);if(null!=n&&n.classList){var y=f.preventdefault,m=!1;"string"==typeof y&&(y=f.root[y])}if(null!=t&&t.classList){var h=p.preventdefault,g=!1;"string"==typeof h&&(h=p.root[h])}if("function"==typeof y&&(m=y.call(f.root,t,n,l)),1==m&&y===h)return!1;if("function"==typeof h&&(g=h.call(p.root,t,n,l)),1==g)return!1;var v=function(t,e){1!=t.flagAniBind&&["animationstart","animationend"].forEach(function(a,n){var r=p[a],i="webkit"+a.replace(/^a|s|e/g,function(t){return t.toUpperCase()}),s=o?i:a;n&&t.addEventListener(s,function(){0==this.classList.contains("in")&&(this.style.display="none",1==this.removeSelf&&(this.parentElement.removeChild(this),this.removeSelf=null)),this.classList.remove(d(this).form)}),"string"==typeof r&&p.root[r]?t.addEventListener(s,function(){e.root[r].call(e.root,this,this.classList.contains("in")?"into":"out",l)}):"function"==typeof r&&t.addEventListener(s,function(){r.call(e.root,this,this.classList.contains("in")?"into":"out",l)}),t.flagAniBind=!0})};if(null!=n&&n.classList&&1!=m){n.classList.add(f.form),n.offsetWidth=n.offsetWidth,n.style.display="block",n.classList.add("out"),n.classList.remove("in"),n.classList[i?"add":"remove"]("reverse"),n.removeSelf=n.removeSelf||null,v(n,f);var b=f.fallback;"string"==typeof b&&(b=f.root[b]),"function"==typeof b&&b.call(f.root,t,n,l)}if(null!=t&&t.classList){var k=p.title,A=document.querySelector("h1"),E=document.querySelector("."+this.classPage);k&&l.title!==!1?(document.title=k,A&&(A.innerHTML=k,A.title=k)):E==t&&!n&&document.title&&t.setAttribute("data-title",document.title);var L=l.id||t.id,w=l.id||t.id;l.id&&(L=L.split("?")[0]);var S=a["_"+L];l.remove!==!1&&a[L]&&a[L]!=t&&(S&&a[S]&&1==l.reload&&(delete a[S],delete a["_"+L]),1==l.reload&&(t.removeSelf=!0),a[L]!=n?a[L].parentElement&&a[L].parentElement.removeChild(a[L]):n.removeSelf=!0,delete a[L]),n&&t.classList.add(p.form),t.offsetWidth=t.offsetWidth,t.style.display="block",t.classList.remove("out"),t.classList.add("in"),t.classList[i?"add":"remove"]("reverse");var T=p.onpagefirstinto;t.firstintoBind||("string"==typeof T&&p.root[T]?p.root[T].call(p.root,t,n,l):"function"==typeof T&&T.call(p.root,t,n,l),r.call(t.querySelectorAll("form")).forEach(function(t){e.submit(t)}),t.firstintoBind=!0),v(t,p);var B=w,C="";B&&0==/^#/.test(B)&&(B="#"+B),C=B.replace(/^#/,"#&"),s&&this.pushStateEnabled&&l.history!==!1&&B&&C!=location.hash&&(history.popstate=!1,history[n?"pushState":"replaceState"](null,document.title,B.replace(/^#/,"#&"))),a[L]||(a[L]=t,w!==L&&(a[w]=t,a["_"+L]=w));var P=p.callback;"string"==typeof P&&(P=p.root[P]),"function"==typeof P&&P.call(p.root,t,n,l),setTimeout(function(){history.popstate=!0},17)}}},e.getCleanUrl=function(t,e,a){var n="",i="",o="";if(t)if(1==t.nodeType)if(t.action){if(n=t.getAttribute("action"),t.method&&"POST"==t.method.toUpperCase())return n;window.$&&$.fn&&$.fn.serialize?i=$(t).serialize():(i={},r.call(t.querySelectorAll("input,select,textarea")).forEach(function(t){if(t.name&&!t.disabled){var e=t.value.trim(),a=t.name;/^radio|checkbox/i.test(t.type)?t.checked&&(i[a]?i[a].push(e):i[a]=[e]):i[a]=[e]}}))}else{n=t.getAttribute("href"),i=t.getAttribute("data-formdata")||t.getAttribute("data-data")||"";var s="container",l=t.getAttribute("data-"+s);if(-1==i.indexOf(s)&&l){var c=s+"="+l;i=i?i+"&"+c:c}}else t.url&&(n=t.url,i=t.data);if(!(n=n||e))return"";if(i=i||a||"","object"==typeof i){var u=[];for(key in i)i[key].forEach||(i[key]=[i[key]]),i[key].forEach(function(t){u.push(key+"="+encodeURIComponent(t))});i=u.length>0?u.join("&"):""}return o=n.split("#")[0].replace(/&+$/,""),"?"==o.slice(-1)&&(o=o.split("?")[0]),""!=i&&(/\?/.test(o)?(i=i.replace(/^&|\?/,""),o=o+"&"+i):""!=i&&(i=i.replace("?",""),o=o+"?"+i)),o},e.createPage=function(t,a,n){var i=null,o=null,s=this.classPage,l=null;if(t){"undefined"==typeof n&&"object"==typeof a&&(n=a),n=n||{};var c,u,d,f={};a&&(1==a.nodeType?((a.href||a.action)&&(c=a.getAttribute("data-title")||n.title),i=n.response,u=a.getAttribute("data-container"),o=document.getElementById(u),d=a.getAttribute("data-classpage"),f.target=a,l=a.getAttribute("data-reload"),("form"==a.tagName.toLowerCase()||null!==l&&"false"!=l)&&(f.reload=!0),f.back="back"==a.getAttribute("data-rel"),"false"==a.getAttribute("data-history")&&(f.history=!1)):(i=a.response||n.response,c=a.title||n.title,o=a.container||n.container,d=a.classPage||n.classPage,f.target=a.target,f.back=a.back||n.back),o&&d&&(s=d));var p=(s==d?o:document).querySelector(".in."+s),y=null,m=document.createElement("div");"string"==typeof t?m.innerHTML=t:m.appendChild(t),1==e.evalScript&&1!=t.firstintoBind&&r.call(m.getElementsByTagName("script")).forEach(function(t){var e=t.innerHTML.trim(),a=t.getAttribute("type");if(""!=e.trim()&&!t.src){var n=document.getElementsByTagName("head")[0]||document.documentElement,r=document.createElement("script");a&&(r.type=a),r.appendChild(document.createTextNode(e)),setTimeout(function(){n.insertBefore(r,n.firstChild),n.removeChild(r),r=null},17),t=null}});var h=m.getElementsByTagName("title")[0];(y=m.querySelector("."+s))||(m.className=s+" out",y=m),"string"==typeof c?y.setAttribute("data-title",c):h&&h.innerText&&y.setAttribute("data-title",h.innerText),(o||document.body).appendChild(y),m=null,f.response=i||t,f.id=this.getCleanUrl(a)||y.id||"unique"+Date.now(),"object"==typeof n&&("undefined"!=typeof n.history&&(f.history=n.history),"undefined"!=typeof n.remove&&(f.remove=n.remove),"undefined"!=typeof n.target&&(f.target=n.target),"undefined"!=typeof n.title&&(f.title=n.title)),s==d&&(f.history=!1,f.classPage=s),this.transition(y,p,f)}},e.getFunction=function(e){if("string"==typeof e){for(var a=t,n=e.split("."),r=0;r<n.length&&(a=a[n[r]]);r+=1);return a}},e.ajax=function(t){if(t){var a,n={url:"",type:"",dataType:"",data:{},timeout:1e4,async:!0,username:"",password:"",success:function(){},error:function(){},complete:function(){}},r={},i=null,o=null,s={};if(1==t.nodeType){s=c(t.getAttribute("data-params")||"");for(key in n)r[key]=t.getAttribute("data-"+key)||s[key]||n[key],"function"==typeof n[key]&&"string"==typeof r[key]&&(r[key]=this.getFunction(r[key]),"function"!=typeof r[key]&&(r[key]=n[key]));r.url=this.getCleanUrl(t,r.url),r.target=t,r.back="back"==t.getAttribute("data-rel");var l=t.tagName.toLowerCase();if("form"==l)r.type=t.method,o=new FormData(t);else if("a"==l){var u=t.getAttribute("data-container"),d=t.getAttribute("data-classpage"),f=u&&document.getElementById(u);f&&d&&d!=e.classPage&&(r.history=!1,r.title=!1)}a=t.getAttribute("data-mask"),"true"!=a&&""!=a||(i=t.querySelector("."+this.classMask))}else{if(!t.url)return;for(key2 in n)r[key2]=t[key2]||n[key2];r.url=this.getCleanUrl(null,r.url,r.data),r.title=t.title,r.back=t.back,r.container=t.container}var p=f||document.body;"string"!=typeof a&&(i=p.querySelector("."+this.classMask)),null==i&&(i=document.createElement("div"),i.className=this.classMask,i.innerHTML='<i class="loading"></i>',"string"==typeof a?t.appendChild(i):p.appendChild(i)),i.style.display="block";var y=new XMLHttpRequest;y.open(r.type||"GET",r.url+(/\?/.test(r.url)?"&":"?")+"r="+Date.now(),r.async,r.username,r.password),y.timeout=r.timeout,y.onload=function(){var a=null;if(200==y.status){if("json"==r.dataType||"JSON"==r.dataType)try{a=JSON.parse(y.response),r.response=a,e.createPage(e.jsonHandle(a),t,r)}catch(n){r.message="JSON parse errorï¼š"+n.message,r.error.call(r,y,y.status)}else if("unknown"==r.dataType){r.history=!1;try{a=JSON.parse(y.response),r.response=a,e.createPage(e.jsonHandle(a),t,r)}catch(n){a=y.response,e.createPage(a,t,r)}}else a=y.response,e.createPage(a,t,r);r.success.call(r,a,y.status)}else r.message="The status code exception!",r.error.call(r,y,y.status);r.complete.call(r,y,y.status),i.style.display="none"},y.onerror=function(t){r.message="Illegal request address or an unexpected network error!",r.error.call(r,y,y.status),i.style.display="none"},y.ontimeout=function(){r.message="The request timeout!",r.error.call(r,y,y.status),i.style.display="none"},y.setRequestHeader("Type","ajax"),y.setRequestHeader("From","mobilebone"),y.send(o)}},e.submit=function(t){if(t&&"string"==typeof t.action){var a=t.getAttribute("data-ajax");"false"==a||0==e.captureForm&&"true"!=a||t.addEventListener("submit",function(t){var a=this.getAttribute("data-preventdefault"),n=e.getFunction(a);return"function"==typeof n&&1==n(this)?(t.preventDefault(),!1):(e.ajax(this),void t.preventDefault())})}},e.isBack=function(t,e){return 1==history.tempBack?(history.tempBack=null,!0):"undefined"==typeof t?!0:e?4==t.compareDocumentPosition(e):!1},e.jsonHandle=function(t){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},e.init=function(){if(1==l)return"Don't repeat initialization!";var a=location.hash.replace("#&","#"),n=null,r=null;""==a||"#"==a?this.transition(document.querySelector("."+this.classPage)):1==i.test(a)&&(n=document.querySelector(a))&&n.classList.contains(this.classPage)?this.transition(n):(2==a.split("container=").length&&(r=document.getElementById(a.split("container=")[1].split("&")[0])),this.ajax({url:a.replace("#",""),dataType:"unknown",container:r,error:function(){n=document.querySelector("."+e.classPage),e.transition(n)}}));var o=t.$||t.jQuery||t.Zepto;o&&o.fn&&o.fn.tap&&"ontouchstart"in window==1?(o(document).tap(this.handleTapEvent),document.addEventListener("click",function(t){var a=t.target;if(a&&("a"==a.tagName.toLowerCase()||(a=a.getParentElementByTag("a")))){var n=a.getAttribute("data-ajax"),r=a.href;return"external"==a.getAttribute("data-rel")||"false"==n||r.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0]&&"true"!=n||0==e.captureLink&&"true"!=n?void(/^http/i.test(r)&&(location.href=r)):void t.preventDefault()}})):document.addEventListener("click",this.handleTapEvent);var s=!!navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i)&&"undefined"!=typeof document.hidden&&!window.chrome;"ontouchstart"in window==1&&s&&(document.addEventListener("touchmove",function(){history.popstateswipe=!0}),document.addEventListener("touchend",function(){history.popstateswipe=!1})),l=!0},e.handleTapEvent=function(t){var n=null;t&&1==t.nodeType&&(n=t,n.preventDefault=function(){}),n=n||t.target||t.touches[0],href=n.href,href&&0!=/a/i.test(n.tagName)||!(n=n.getParentElementByTag("a"))||(href=n.href);var r=document.querySelector(".in."+e.classPage);if(null!=r&&n){var i={target:n},o=n.getAttribute("data-preventdefault")||c(n.getAttribute("data-params")||"").preventdefault,s=e.getFunction(o);if("function"==typeof s&&1==s(n))return t.preventDefault(),!1;var l=n.getElementsByClassName(e.classMask)[0];if(l&&"none"!=l.style.display)return t.preventDefault(),!1;var u=n.getAttribute("data-container"),d=n.getAttribute("data-classpage"),f=u&&document.getElementById(u);f&&d&&d!=e.classPage&&(r=f.querySelector(".in."+d)||f.querySelector(d),i.history=!1,i.title=!1,i.classPage=d);var p=1==e.captureLink,y=n.getAttribute("data-rel"),m=!1;"back"==y&&(m=!0);var h="external"==y;if(href){if(href=href.replace("#&","#"),""===n.getAttribute("href").replace(/#/g,""))return void t.preventDefault();if(/^javascript/.test(href)){if(0==m)return}else if(h=h||href.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0],(1==h||0==p)&&"true"!=n.getAttribute("data-ajax"))return;if(1==/^#/.test(n.getAttribute("href"))){var g=href.split("#")[1],v=g&&document.getElementById(g);0==m&&"auto"==y&&(m=e.isBack(v,r)),v&&e.transition(v,r,m,i),t.preventDefault()}else if(/^javascript/.test(href))history.tempBack=!0,history.back();else if("false"!=n.getAttribute("data-ajax")){var b=e.getCleanUrl(n),k=n.getAttribute("data-reload");n.getAttribute("href");if(null!=k&&"false"!=k||!a[b])e.ajax(n);else{0==m&&"auto"==y&&(m=e.isBack(a[b],r)),i.id=b;var A=f||document.body;0==A.contains(a[b])&&A.appendChild(a[b]),e.transition(a[b],r,m,i)}t.preventDefault()}}}},Element.prototype.getParentElementByTag=function(t){if(!t)return null;var e=null,a=this,n=function(){if(a=a.parentElement,!a)return null;var r=a.tagName.toLowerCase();r===t?e=a:"body"==r?e=null:n()};return n(),e};var c=function(t){var e={};return"string"==typeof t&&t.split("&").forEach(function(t){var a=t.split("=");a.length>1&&(e[a[0]]=t.replace(a[0]+"=",""))}),e};return window.addEventListener("DOMContentLoaded",function(){0==l&&e.init()}),window.addEventListener("popstate",function(){if(1==history.popstateswipe)return location.reload(),void(history.popstateswipe=!1);if(0==history.popstate)return void(history.popstate=!0);var t=location.hash.replace("#&","").replace(/^#/,""),n=null,r=null;if(""==t){if(n=document.querySelector("."+e.classPage),n.id)return}else if(n=a[t],2==t.split("container=").length&&(r=document.getElementById(t.split("container=")[1].split("&")[0])),n&&0==i.test(t))return void e.createPage(n,{url:t,dataType:"unknown",history:!1,back:!0,container:r});if(!n){if(0==i.test(t))return void e.ajax({url:t,dataType:"unknown",back:e.isBack(),container:r});n=document.querySelector("#"+t)}var o=document.querySelector(".in."+e.classPage);n&&n==o||0==e.pushStateEnabled||n&&e.transition(n,o,e.isBack(n,o),{id:t,history:!1,remove:!1})}),document.MBLOADED=!0,e});
//# sourceMappingURL=mobilebone.min.js.map
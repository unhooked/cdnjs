!function(t,e){"function"==typeof define&&(define.amd||define.cmd)?define("mobilebone",function(n){return e(t,n)}):t.Mobilebone=e(t,{})}(this,function(t,e){var n={},a=[],i=a.slice,r="pushState"in history&&"replaceState"in history&&!(window.navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window)&&-1===window.navigator.userAgent.search(/CriOS/);if(e.support=r,0==r)return e;e.VERSION="1.1.3",e.autoInit=!0,e.captureLink=!0,e.rootTransition=t,e.classPage="page",e.classMask="mask",e.pushStateEnabled=!0,e.transition=function(t,a,i,o){if(0!=arguments.length&&t!=a){3==arguments.length&&1==isNaN(1*i)&&(o=i,i=!1),a=a||null,i=i||!1,o=o||{};var l={root:this.rootTransition,form:"slide",onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,callback:this.callback},c=function(t){if(!t||!t.getAttribute)return{};var n={},a=s(t.getAttribute("data-params")||"");return["title","root","form","onpagefirstinto","callback","animationstart","animationend"].forEach(function(e){n[e]=t.getAttribute("data-"+e)||a[e]||o[e]||l[e]}),"string"==typeof n.root&&(n.root=e.getFunction(n.root)),n},u=c(a),d=c(t);if(null!=a&&a.classList&&(a.classList.add("out"),a.classList.add(u.form),a.classList.remove("in"),a.classList[i?"add":"remove"]("reverse")),null!=t&&t.classList){var f=d.title,p=document.querySelector("h1"),y=document.querySelector("."+this.classPage);f?(document.title=f,p&&(p.innerHTML=f,p.title=f)):y==t&&!a&&document.title&&t.setAttribute("data-title",document.title);var h=o.id||t.id;n[h]&&n[h]!=t&&(n[h].parentElement.removeChild(n[h]),delete n[h]),t.style.display="block",t.clientWidth,t.classList.remove("out"),t.classList.add("in"),a&&t.classList.add(d.form),t.classList[i?"add":"remove"]("reverse");var g=d.onpagefirstinto;n[h]||("string"==typeof g&&d.root[g]?d.root[g](t,a,o.response):"function"==typeof g&&g(t,a,o.response));var m="WebkitAppearance"in document.documentElement.style||"undefined"!=typeof document.webkitHidden;["animationstart","animationend"].forEach(function(e,a){var i=d[e],r="webkit"+e.replace(/^a|s|e/g,function(t){return t.toUpperCase()});if(!n[h]){var s=m?r:e;a&&t.addEventListener(s,function(){0==this.classList.contains("in")&&(this.style.display="none")}),"string"==typeof i&&d.root[i]?t.addEventListener(s,function(){d.root[i](this,this.classList.contains("in")?"into":"out")}):"function"==typeof i&&t.addEventListener(s,function(){i(this,this.classList.contains("in")?"into":"out")})}});var v=h;v&&0==/^#/.test(v)&&(v="#"+v),r&&this.pushStateEnabled&&o.history!==!1&&v&&history[a?"pushState":"replaceState"](null,document.title,v.replace(/^#/,"#&")),n[h]||(n[h]=t);var k=d.callback;"string"==typeof k&&(k=d.root[k]),"function"==typeof k&&k(t,a,o.response)}}},e.getCleanUrl=function(t,e,n){var a="",i="",r="";if(t&&(1==t.nodeType?(a=t.getAttribute("href"),i=t.getAttribute("data-formdata")||t.getAttribute("data-data")):t.url&&(a=t.url,i=t.data)),!(a=a||e))return"";if(i=i||n||"","object"==typeof i){var s=[];for(key in n)s.push(key+"="+encodeURIComponent(n[key]));i=s.length>0?s.join("&"):""}return r=a.split("#")[0].replace(/&+$/,""),"?"==r.slice(-1)&&(r=r.split("?")[0]),""!=i&&(/\?/.test(r)?(i=i.replace(/^&|\?/,""),r=r+"&"+i):""!=i&&(i=i.replace("?",""),r=r+"?"+i)),r},e.getPage=function(t){var e=null;return i.call(document.querySelectorAll("."+this.classPage)).forEach(function(n){null==e&&n.contains(t)&&(e=n)}),e},e.createPage=function(t,e,n){var a=null;if(t){n=n||{};var i,r=document.querySelector(".in."+this.classPage);e&&(1==e.nodeType?(e.classList.contains(this.classPage)?r=e:e.href&&(r=this.getPage(e),i=e.getAttribute("data-title")||n.title),a=n.response):(a=e.response||n.response,i=e.title||n.title));var s=null,o=document.createElement("div");"string"==typeof t?o.innerHTML=t:o.appendChild(t);var l=o.getElementsByTagName("title")[0];(s=o.querySelector("."+this.classPage))?l?s.setAttribute("data-title",l.innerText):"string"==typeof i&&s.setAttribute("data-title",i):(o.className="page out","string"==typeof i&&o.setAttribute("data-title",i),s=o),document.body.appendChild(s),o=null,this.transition(s,r,{response:a||t,id:this.getCleanUrl(e)||s.id||"unique"+Date.now()})}},e.getFunction=function(e){if("string"==typeof e){for(var n=t,a=e.split("."),i=0;i<a.length&&(n=n[a[i]]);i+=1);return n}},e.ajax=function(t){if(t){var n,a={url:"",dataType:"",data:{},timeout:1e4,async:!0,username:"",password:"",success:function(){},error:function(){},complete:function(){}},i={},r=null,o={};if(1==t.nodeType){o=s(t.getAttribute("data-params")||"");for(key in a)i[key]=t.getAttribute("data-"+key)||o[key]||a[key],"function"==typeof a[key]&&"string"==typeof i[key]&&(i[key]=this.getFunction(i[key]),"function"!=typeof i[key]&&(i[key]=a[key]));i.url=this.getCleanUrl(t,i.url),n=t.getAttribute("data-mask"),"true"!=n&&""!=n||(r=t.querySelector("."+this.classMask))}else{if(!t.url)return;for(key2 in a)i[key2]=t[key2]||a[key2];i.url=this.getCleanUrl(null,i.url,i.data),i.title=t.title}"string"!=typeof n&&(r=document.querySelector("body > ."+this.classMask)),null==r&&(r=document.createElement("div"),r.className=this.classMask,r.innerHTML='<i class="loading"></i>',"string"==typeof n?t.appendChild(r):document.body.appendChild(r)),r.style.visibility="visible";var l=new XMLHttpRequest;l.open("GET",i.url+(/\?/.test(i.url)?"&":"?")+"r="+Date.now(),i.async,i.username,i.password),l.timeout=i.timeout,l.onload=function(){var n=null;if(200==l.status){if("json"==i.dataType||"JSON"==i.dataType)try{n=JSON.parse(l.response),i.response=n,e.createPage(e.jsonHandle(n),t,i)}catch(a){i.message="JSON parse errorï¼š"+a.message,i.error.call(i,l,l.status)}else if("unknown"==i.dataType)try{n=JSON.parse(l.response),i.response=n,e.createPage(e.jsonHandle(n),t,i)}catch(a){n=l.response,e.createPage(n,t,i)}else n=l.response,e.createPage(n,t,i);i.success.call(i,n,l.status)}else i.message="The status code exception!",i.error.call(i,l,l.status);i.complete.call(i,l,l.status),r.style.visibility="hidden"},l.onerror=function(t){i.message="Illegal request address or an unexpected network error!",i.error.call(i,l,l.status),r.style.visibility="hidden"},l.ontimeout=function(){i.message="The request timeout!",i.error.call(i,l,l.status),r.style.visibility="hidden"},l.send(null)}},e.isBack=function(t,n){var a=-1,r=-1;return 1==history.tempBack?r=0:i.call(document.querySelectorAll("."+e.classPage)).forEach(function(e,i){e==t?a=i:e==n&&(r=i)}),history.tempBack=null,r>a},e.jsonHandle=function(t){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},e.init=function(){var n=location.hash.replace("#&","#"),a=null;""==n||"#"==n?this.transition(document.querySelector("."+this.classPage)):0==/&/.test(n)&&(a=document.querySelector(n))&&a.classList.contains(this.classPage)?this.transition(a):this.ajax({url:n.replace("#",""),dataType:"unknown",error:function(){a=document.querySelector("."+e.classPage),e.transition(a)}});var i="click",r=t.$||t.jQuery||t.Zepto;r&&r.fn&&r.fn.tap&&(i="tap"),1==this.captureLink&&document.addEventListener(i,this.handleTapEvent)},e.handleTapEvent=function(t){var a=t.target||t.touches[0],i=a.href;!i&&(a=a.getParentElementByTag("a"))&&(i=a.href);var r=document.querySelector(".in."+e.classPage);if(null!=r&&a){var s=a.getElementsByClassName(e.classMask)[0];if(s&&"hidden"!=s.style.visibility)return t.preventDefault(),!1;var o=1==e.captureLink,l=a.getAttribute("data-rel"),c=!1;"back"==l&&(c=!0);var u="external"==l;if(i){if(/^javascript/.test(i)){if(0==c)return}else if(u=u||i.split("/")[0]!==location.href.split("/")[0],(1==u||0==o)&&"true"!=a.getAttribute("data-ajax"))return;if(1==/^#/.test(a.getAttribute("href"))){var d=i.split("#")[1],f=d&&document.getElementById(d);0==c&&"auto"==l&&(c=e.isBack(f,r)),f&&e.transition(f,r,c),t.preventDefault()}else if(/^javascript/.test(i))history.tempBack=!0,history.back();else if("false"!=a.getAttribute("data-ajax")){var p=e.getCleanUrl(a),y=a.getAttribute("data-reload"),h=a.getAttribute("href");null!=y&&"false"!=y||!n[p]?e.ajax(a):(0==c&&"auto"==l&&(c=e.isBack(n[h],r)),e.transition(n[h],r,c,{id:h})),t.preventDefault()}}}},Element.prototype.getParentElementByTag=function(t){if(!t)return null;var e=null,n=this,a=function(){n=n.parentElement;var i=n.tagName.toLowerCase();i===t?e=n:"body"==i?e=null:a()};return a(),e};var s=function(t){var e={};return"string"==typeof t&&t.split("&").forEach(function(t){var n=t.split("=");n.length>1&&(e[n[0]]=t.replace(n[0]+"=",""))}),e};return window.addEventListener("DOMContentLoaded",function(){1==e.autoInit&&e.init()}),r&&window.addEventListener("popstate",function(){var t=location.hash.replace("#&","").replace("#","");if(""!=t){var a=n[t]||document.querySelector(location.hash),i=document.querySelector(".in."+e.classPage);a&&a==i||n[t]&&e.pushStateEnabled&&e.transition(n[t],document.querySelector(".in."+e.classPage),e.isBack(a,i),{history:!1})}}),e});
//# sourceMappingURL=mobilebone.min.js.map
!function(t,e){"function"==typeof define&&(define.amd||define.cmd)?define("mobilebone",function(a){return e(t,a)}):t.Mobilebone=e(t,{})}(this,function(t,e){var a={},n=[],i=n.slice,r=/^.[^:#\[\.,]*$/,s="pushState"in history&&"replaceState"in history;if(e.support=s,0==s)return e;var o=!1;e.VERSION="2.0.1",e.captureLink=!0,e.captureForm=!0,e.rootTransition=t,e.mergeCallback=!0,e.classPage="page",e.classMask="mask",e.pushStateEnabled=!0,window.navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window&&(e.pushStateEnabled=!1),e.transition=function(t,n,r,o){if(0!=arguments.length&&t!=n){3==arguments.length&&1==isNaN(1*r)&&(o=r,r=!1),n=n||null,r=r||!1,o=o||{};var u={root:this.rootTransition,form:this.form||"slide",onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,fallback:this.fallback,callback:this.callback},c=function(t){if(!t||!t.getAttribute)return{};var a={},n=l(t.getAttribute("data-params")||"");return["title","root","form"].forEach(function(e){a[e]=t.getAttribute("data-"+e)||n[e]||o[e]||u[e]}),"string"==typeof a.root&&(a.root=e.getFunction(a.root)),["onpagefirstinto","callback","fallback","animationstart","animationend"].forEach(function(i){if(1==e.mergeCallback&&"function"==typeof u[i]){var r=t.getAttribute("data-"+i)||n[i];"function"==typeof a.root[r]?a[i]=function(){u[i].apply(null,arguments),a.root[r].apply(null,arguments)}:"function"==typeof o[i]?a[i]=function(){u[i].apply(null,arguments),o[i].apply(null,arguments)}:a[i]=u[i]}else a[i]=t.getAttribute("data-"+i)||n[i]||o[i]||u[i]}),a},f=c(n),d=c(t);if(null!=n&&n.classList){n.classList.add("out"),n.classList.add(f.form),n.classList.remove("in"),n.classList[r?"add":"remove"]("reverse");var p=f.fallback;"string"==typeof p&&(p=f.root[p]),"function"==typeof p&&p(t,n,o.response)}if(null!=t&&t.classList){var y=d.title,m=document.querySelector("h1"),g=document.querySelector("."+this.classPage);y?(document.title=y,m&&(m.innerHTML=y,m.title=y)):g==t&&!n&&document.title&&t.setAttribute("data-title",document.title);var h=o.id||t.id;o.remove!==!1&&a[h]&&a[h]!=t&&a[h].parentElement&&(a[h].parentElement.removeChild(a[h]),delete a[h]),t.style.display="block",t.clientWidth,t.classList.remove("out"),t.classList.add("in"),n&&t.classList.add(d.form),t.classList[r?"add":"remove"]("reverse");var v=d.onpagefirstinto;a[h]||("string"==typeof v&&d.root[v]?d.root[v](t,n,o.response):"function"==typeof v&&v(t,n,o.response),i.call(t.querySelectorAll("form")).forEach(function(t){e.submit(t)}));var b="WebkitAppearance"in document.documentElement.style||"undefined"!=typeof document.webkitHidden;["animationstart","animationend"].forEach(function(e,n){var i=d[e],r="webkit"+e.replace(/^a|s|e/g,function(t){return t.toUpperCase()});if(!a[h]){var s=b?r:e;n&&t.addEventListener(s,function(){0==this.classList.contains("in")&&(this.style.display="none")}),"string"==typeof i&&d.root[i]?t.addEventListener(s,function(){d.root[i](this,this.classList.contains("in")?"into":"out")}):"function"==typeof i&&t.addEventListener(s,function(){i(this,this.classList.contains("in")?"into":"out")})}});var k=h;k&&0==/^#/.test(k)&&(k="#"+k),s&&this.pushStateEnabled&&o.history!==!1&&k&&history[n?"pushState":"replaceState"](null,document.title,k.replace(/^#/,"#&")),a[h]||(a[h]=t);var E=d.callback;"string"==typeof E&&(E=d.root[E]),"function"==typeof E&&E(t,n,o.response)}}},e.getCleanUrl=function(t,e,a){var n="",i="",r="";if(t)if(1==t.nodeType){if(t.action)return t.getAttribute("action");n=t.getAttribute("href"),i=t.getAttribute("data-formdata")||t.getAttribute("data-data")}else t.url&&(n=t.url,i=t.data);if(!(n=n||e))return"";if(i=i||a||"","object"==typeof i){var s=[];for(key in a)s.push(key+"="+encodeURIComponent(a[key]));i=s.length>0?s.join("&"):""}return r=n.split("#")[0].replace(/&+$/,""),"?"==r.slice(-1)&&(r=r.split("?")[0]),""!=i&&(/\?/.test(r)?(i=i.replace(/^&|\?/,""),r=r+"&"+i):""!=i&&(i=i.replace("?",""),r=r+"?"+i)),r},e.createPage=function(t,e,a){var n=null;if(t){a=a||{};var i,r=document.querySelector(".in."+this.classPage);e&&(1==e.nodeType?((e.href||e.action)&&(i=e.getAttribute("data-title")||a.title),n=a.response):(n=e.response||a.response,i=e.title||a.title));var s=null,o=document.createElement("div");"string"==typeof t?o.innerHTML=t:o.appendChild(t);var l=o.getElementsByTagName("title")[0];(s=o.querySelector("."+this.classPage))?l?s.setAttribute("data-title",l.innerText):"string"==typeof i&&s.setAttribute("data-title",i):(o.className="page out","string"==typeof i&&o.setAttribute("data-title",i),s=o),document.body.appendChild(s),o=null;var u={response:n||t,id:this.getCleanUrl(e)||s.id||"unique"+Date.now()};"object"==typeof a&&("undefined"!=typeof a.history&&(u.history=a.history),"undefined"!=typeof a.remove&&(u.remove=a.remove)),this.transition(s,r,u)}},e.getFunction=function(e){if("string"==typeof e){for(var a=t,n=e.split("."),i=0;i<n.length&&(a=a[n[i]]);i+=1);return a}},e.ajax=function(t){if(t){var a,n={url:"",type:"",dataType:"",data:{},timeout:1e4,async:!0,username:"",password:"",success:function(){},error:function(){},complete:function(){}},i={},r=null,s=null,o={};if(1==t.nodeType){o=l(t.getAttribute("data-params")||"");for(key in n)i[key]=t.getAttribute("data-"+key)||o[key]||n[key],"function"==typeof n[key]&&"string"==typeof i[key]&&(i[key]=this.getFunction(i[key]),"function"!=typeof i[key]&&(i[key]=n[key]));i.url=this.getCleanUrl(t,i.url);var u=t.tagName.toLowerCase();"form"==u&&(i.type=t.method,s=new FormData(t)),a=t.getAttribute("data-mask"),"true"!=a&&""!=a||(r=t.querySelector("."+this.classMask))}else{if(!t.url)return;for(key2 in n)i[key2]=t[key2]||n[key2];i.url=this.getCleanUrl(null,i.url,i.data),i.title=t.title}"string"!=typeof a&&(r=document.querySelector("body > ."+this.classMask)),null==r&&(r=document.createElement("div"),r.className=this.classMask,r.innerHTML='<i class="loading"></i>',"string"==typeof a?t.appendChild(r):document.body.appendChild(r)),r.style.visibility="visible";var c=new XMLHttpRequest;c.open(i.type||"GET",i.url+(/\?/.test(i.url)?"&":"?")+"r="+Date.now(),i.async,i.username,i.password),c.timeout=i.timeout,c.onload=function(){var a=null;if(200==c.status){if("json"==i.dataType||"JSON"==i.dataType)try{a=JSON.parse(c.response),i.response=a,e.createPage(e.jsonHandle(a),t,i)}catch(n){i.message="JSON parse errorï¼š"+n.message,i.error.call(i,c,c.status)}else if("unknown"==i.dataType){i.history=!1,i.remove=!1;try{a=JSON.parse(c.response),i.response=a,e.createPage(e.jsonHandle(a),t,i)}catch(n){a=c.response,e.createPage(a,t,i)}}else a=c.response,e.createPage(a,t,i);i.success.call(i,a,c.status)}else i.message="The status code exception!",i.error.call(i,c,c.status);i.complete.call(i,c,c.status),r.style.visibility="hidden"},c.onerror=function(t){i.message="Illegal request address or an unexpected network error!",i.error.call(i,c,c.status),r.style.visibility="hidden"},c.ontimeout=function(){i.message="The request timeout!",i.error.call(i,c,c.status),r.style.visibility="hidden"},c.send(s)}},e.submit=function(t){if(t&&"string"==typeof t.action){var a=t.getAttribute("data-ajax");"false"==a||0==this.captureForm&&"true"!=a||t.addEventListener("submit",function(t){e.ajax(this),t.preventDefault()})}},e.isBack=function(t,a){var n=-1,r=-1;return 1==history.tempBack?r=0:i.call(document.querySelectorAll("."+e.classPage)).forEach(function(e,i){e==t?n=i:e==a&&(r=i)}),history.tempBack=null,r>n},e.jsonHandle=function(t){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},e.init=function(){if(1==o)return"Don't repeat initialization!";var a=location.hash.replace("#&","#"),n=null;""==a||"#"==a?this.transition(document.querySelector("."+this.classPage)):1==r.test(a)&&(n=document.querySelector(a))&&n.classList.contains(this.classPage)?this.transition(n):this.ajax({url:a.replace("#",""),dataType:"unknown",error:function(){n=document.querySelector("."+e.classPage),e.transition(n)}});var i="click",s=t.$||t.jQuery||t.Zepto;s&&s.fn&&s.fn.tap&&(i="tap"),1==this.captureLink&&(document.addEventListener(i,this.handleTapEvent),"tap"==i&&document.addEventListener("click",function(t){var a=t.target;if(a&&("a"==a.tagName.toLowerCase()||(a=a.getParentElementByTag("a")))){var n=a.getAttribute("data-ajax"),i=a.href;"external"==a.getAttribute("data-rel")||"false"==n||i.split("/")[0]!==location.href.split("/")[0]&&"true"!=n||0==e.captureLink&&"true"!=n||t.preventDefault()}})),o=!0},e.handleTapEvent=function(t){var n=t.target||t.touches[0],i=n.href;i&&0!=/a/i.test(n.tagName)||!(n=n.getParentElementByTag("a"))||(i=n.href);var r=document.querySelector(".in."+e.classPage);if(null!=r&&n){var s=n.getElementsByClassName(e.classMask)[0];if(s&&"hidden"!=s.style.visibility)return t.preventDefault(),!1;var o=1==e.captureLink,l=n.getAttribute("data-rel"),u=!1;"back"==l&&(u=!0);var c="external"==l;if(i){if(""===n.getAttribute("href").replace(/#/g,""))return void t.preventDefault();if(/^javascript/.test(i)){if(0==u)return}else if(c=c||i.split("/")[0]!==location.href.split("/")[0],(1==c||0==o)&&"true"!=n.getAttribute("data-ajax"))return;if(1==/^#/.test(n.getAttribute("href"))){var f=i.split("#")[1],d=f&&document.getElementById(f);0==u&&"auto"==l&&(u=e.isBack(d,r)),d&&e.transition(d,r,u),t.preventDefault()}else if(/^javascript/.test(i))history.tempBack=!0,history.back();else if("false"!=n.getAttribute("data-ajax")){var p=e.getCleanUrl(n),y=n.getAttribute("data-reload");n.getAttribute("href");null!=y&&"false"!=y||!a[p]?e.ajax(n):(0==u&&"auto"==l&&(u=e.isBack(a[p],r)),e.transition(a[p],r,u,{id:p})),t.preventDefault()}}}},Element.prototype.getParentElementByTag=function(t){if(!t)return null;var e=null,a=this,n=function(){if(a=a.parentElement,!a)return null;var i=a.tagName.toLowerCase();i===t?e=a:"body"==i?e=null:n()};return n(),e};var l=function(t){var e={};return"string"==typeof t&&t.split("&").forEach(function(t){var a=t.split("=");a.length>1&&(e[a[0]]=t.replace(a[0]+"=",""))}),e};return window.addEventListener("DOMContentLoaded",function(){0==o&&e.init()}),window.addEventListener("popstate",function(){var t=location.hash.replace("#&","").replace("#","");if(""!=t){var n=a[t];if(!n){if(0==r.test(t))return void e.ajax({url:t,dataType:"unknown"});n=document.querySelector("#"+t)}var i=document.querySelector(".in."+e.classPage);n&&n==i||0==e.pushStateEnabled||n&&e.transition(n,i,e.isBack(n,i),{history:!1,remove:!1})}}),e});
//# sourceMappingURL=mobilebone.min.js.map
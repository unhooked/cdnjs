!function(t,e){document.MBLOADED||("function"==typeof define&&(define.amd||define.cmd)?define("mobilebone",function(a){return e(t,a)}):t.Mobilebone=e(t,{}))}(this,function(t,e){if(document.MBLOADED)return"Don't repeat load Mobilebone!";var a={},n=[],i=n.slice,r=/^#?\w+(?:[\-_]\w+)*$/i,o="pushState"in history&&"replaceState"in history;e.support=o;var s=!1;if(e.VERSION="2.5.0",e.captureLink=!0,e.captureForm=!0,e.rootTransition=t,e.mergeCallback=!0,e.classAnimation="slide",e.classPage="page",e.classMask="mask",e.pushStateEnabled=!0,e.evalScript=!1,window.navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window&&(e.pushStateEnabled=!1),0==o)return e;history.popstate=!1,e.transition=function(t,n,r,s){if(0!=arguments.length&&t!=n){3==arguments.length&&1==isNaN(1*r)&&(s=r,r=!1),n=n||null,r=r||!1,s=s||{};var u={root:this.rootTransition,form:this.form||this.classAnimation,onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,preventdefault:this.preventdefault,fallback:this.fallback,callback:this.callback},c=function(t){if(!t||!t.getAttribute)return{};var a={},n=l(t.getAttribute("data-params")||"");return["title","root","form"].forEach(function(e){a[e]=t.getAttribute("data-"+e)||n[e]||s[e]||u[e]}),"string"==typeof a.root&&(a.root=e.getFunction(a.root)),["onpagefirstinto","callback","fallback","animationstart","animationend","preventdefault"].forEach(function(i){if(1==e.mergeCallback&&"function"==typeof u[i]){var r=t.getAttribute("data-"+i)||n[i];"function"==typeof a.root[r]?a[i]=function(){u[i].apply(this,arguments),a.root[r].apply(this,arguments)}:"function"==typeof s[i]?a[i]=function(){u[i].apply(this,arguments),s[i].apply(this,arguments)}:a[i]=u[i]}else a[i]=t.getAttribute("data-"+i)||n[i]||s[i]||u[i]}),a},d=c(n),f=c(t);if(null!=n&&n.classList){var p=d.preventdefault,y=!1;"string"==typeof p&&(p=d.root[p])}if(null!=t&&t.classList){var m=f.preventdefault,h=!1;"string"==typeof m&&(m=f.root[m])}if("function"==typeof p&&(y=p.call(d.root,t,n,s)),1==y&&p===m)return!1;if("function"==typeof m&&(h=m.call(f.root,t,n,s)),1==h)return!1;if(null!=n&&n.classList&&1!=y){n.classList.add(d.form),n.offsetWidth=n.offsetWidth,n.style.display="block",n.classList.add("out"),n.classList.remove("in"),n.classList[r?"add":"remove"]("reverse");var g=d.fallback;"string"==typeof g&&(g=d.root[g]),"function"==typeof g&&g.call(d.root,t,n,s)}if(null!=t&&t.classList){var v=f.title,b=document.querySelector("h1"),k=document.querySelector("."+this.classPage);v?(document.title=v,b&&(b.innerHTML=v,b.title=v)):k==t&&!n&&document.title&&t.setAttribute("data-title",document.title);var E=s.id||t.id,A=s.id||t.id;s.id&&(E=E.split("?")[0]);var L=a["_"+E];s.remove!==!1&&a[E]&&a[E]!=t&&a[E].parentElement&&(a[E].parentElement.removeChild(a[E]),delete a[E],L&&a[L]&&1==s.reload&&(delete a[L],delete a["_"+E])),n&&t.classList.add(f.form),t.offsetWidth=t.offsetWidth,t.style.display="block",t.classList.remove("out"),t.classList.add("in"),t.classList[r?"add":"remove"]("reverse");var w=f.onpagefirstinto;a[E]||a[A]||("string"==typeof w&&f.root[w]?f.root[w](t,n,s):"function"==typeof w&&w(t,n,s),i.call(t.querySelectorAll("form")).forEach(function(t){e.submit(t)}));var S="WebkitAppearance"in document.documentElement.style||"undefined"!=typeof document.webkitHidden;["animationstart","animationend"].forEach(function(e,n){var i=f[e],r="webkit"+e.replace(/^a|s|e/g,function(t){return t.toUpperCase()});if(!a[E]){var o=S?r:e;n&&t.addEventListener(o,function(){0==this.classList.contains("in")&&(this.style.display="none"),this.classList.remove(c(this).form)}),"string"==typeof i&&f.root[i]?t.addEventListener(o,function(){f.root[i](this,this.classList.contains("in")?"into":"out",s)}):"function"==typeof i&&t.addEventListener(o,function(){i(this,this.classList.contains("in")?"into":"out",s)})}});var T=A,C="";T&&0==/^#/.test(T)&&(T="#"+T),C=T.replace(/^#/,"#&"),o&&this.pushStateEnabled&&s.history!==!1&&T&&C!=location.hash&&(history.popstate=!1,history[n?"pushState":"replaceState"](null,document.title,T.replace(/^#/,"#&"))),a[E]||(a[E]=t,A!==E&&(a[A]=t,a["_"+E]=A));var P=f.callback;"string"==typeof P&&(P=f.root[P]),"function"==typeof P&&P.call(f.root,t,n,s),setTimeout(function(){history.popstate=!0},17)}}},e.getCleanUrl=function(t,e,a){var n="",r="",o="";if(t)if(1==t.nodeType)if(t.action){if(n=t.getAttribute("action"),t.method&&"POST"==t.method.toUpperCase())return n;window.$&&$.fn&&$.fn.serialize?r=$(t).serialize():(r={},i.call(t.querySelectorAll("input,select,textarea")).forEach(function(t){if(t.name&&!t.disabled){var e=t.value.trim(),a=t.name;/^radio|checkbox/i.test(t.type)?t.checked&&(r[a]?r[a].push(e):r[a]=[e]):r[a]=[e]}}))}else n=t.getAttribute("href"),r=t.getAttribute("data-formdata")||t.getAttribute("data-data");else t.url&&(n=t.url,r=t.data);if(!(n=n||e))return"";if(r=r||a||"","object"==typeof r){var s=[];for(key in r)r[key].forEach||(r[key]=[r[key]]),r[key].forEach(function(t){s.push(key+"="+encodeURIComponent(t))});r=s.length>0?s.join("&"):""}return o=n.split("#")[0].replace(/&+$/,""),"?"==o.slice(-1)&&(o=o.split("?")[0]),""!=r&&(/\?/.test(o)?(r=r.replace(/^&|\?/,""),o=o+"&"+r):""!=r&&(r=r.replace("?",""),o=o+"?"+r)),o},e.createPage=function(t,a,n){var r=null,o=null,s=this.classPage,l=null;if(t){n=n||{};var u,c,d,f={};a&&(1==a.nodeType?((a.href||a.action)&&(u=a.getAttribute("data-title")||n.title),r=n.response,c=a.getAttribute("data-container"),o=document.getElementById(c),d=a.getAttribute("data-classpage"),f.target=a,l=a.getAttribute("data-reload"),("form"==a.tagName.toLowerCase()||null!==l&&"false"!=l)&&(f.reload=!0)):(r=a.response||n.response,u=a.title||n.title,o=a.container||n.container,d=a.classPage||n.classPage,f.target=a.target),o&&d&&(s=d));var p=(s==d?o:document).querySelector(".in."+s),y=null,m=document.createElement("div");"string"==typeof t?(m.innerHTML=t,1==e.evalScript&&i.call(m.getElementsByTagName("script")).forEach(function(t){var e=t.innerHTML.trim(),a=t.getAttribute("type");if(""!=e.trim()&&!t.src){var n=document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");a&&(i.type=a),i.appendChild(document.createTextNode(e)),setTimeout(function(){n.insertBefore(i,n.firstChild),n.removeChild(i)},16),t=null}})):m.appendChild(t);var h=m.getElementsByTagName("title")[0];(y=m.querySelector("."+s))?h?y.setAttribute("data-title",h.innerText):"string"==typeof u&&y.setAttribute("data-title",u):(m.className=s+" out","string"==typeof u&&m.setAttribute("data-title",u),y=m),(o||document.body).appendChild(y),m=null,f.response=r||t,f.id=this.getCleanUrl(a)||y.id||"unique"+Date.now(),"object"==typeof n&&("undefined"!=typeof n.history&&(f.history=n.history),"undefined"!=typeof n.remove&&(f.remove=n.remove),"undefined"!=typeof n.target&&(f.target=n.target)),s==d&&(f.history=!1,f.classPage=s),this.transition(y,p,f)}},e.getFunction=function(e){if("string"==typeof e){for(var a=t,n=e.split("."),i=0;i<n.length&&(a=a[n[i]]);i+=1);return a}},e.ajax=function(t){if(t){var a,n={url:"",type:"",dataType:"",data:{},timeout:1e4,async:!0,username:"",password:"",success:function(){},error:function(){},complete:function(){}},i={},r=null,o=null,s={};if(1==t.nodeType){s=l(t.getAttribute("data-params")||"");for(key in n)i[key]=t.getAttribute("data-"+key)||s[key]||n[key],"function"==typeof n[key]&&"string"==typeof i[key]&&(i[key]=this.getFunction(i[key]),"function"!=typeof i[key]&&(i[key]=n[key]));i.url=this.getCleanUrl(t,i.url),i.target=t;var u=t.tagName.toLowerCase();"form"==u&&(i.type=t.method,o=new FormData(t)),a=t.getAttribute("data-mask"),"true"!=a&&""!=a||(r=t.querySelector("."+this.classMask))}else{if(!t.url)return;for(key2 in n)i[key2]=t[key2]||n[key2];i.url=this.getCleanUrl(null,i.url,i.data),i.title=t.title}"string"!=typeof a&&(r=document.querySelector("body > ."+this.classMask)),null==r&&(r=document.createElement("div"),r.className=this.classMask,r.innerHTML='<i class="loading"></i>',"string"==typeof a?t.appendChild(r):document.body.appendChild(r)),r.style.visibility="visible";var c=new XMLHttpRequest;c.open(i.type||"GET",i.url+(/\?/.test(i.url)?"&":"?")+"r="+Date.now(),i.async,i.username,i.password),c.timeout=i.timeout,c.onload=function(){var a=null;if(200==c.status){if("json"==i.dataType||"JSON"==i.dataType)try{a=JSON.parse(c.response),i.response=a,e.createPage(e.jsonHandle(a),t,i)}catch(n){i.message="JSON parse errorï¼š"+n.message,i.error.call(i,c,c.status)}else if("unknown"==i.dataType){i.history=!1,i.remove=!1;try{a=JSON.parse(c.response),i.response=a,e.createPage(e.jsonHandle(a),t,i)}catch(n){a=c.response,e.createPage(a,t,i)}}else a=c.response,e.createPage(a,t,i);i.success.call(i,a,c.status)}else i.message="The status code exception!",i.error.call(i,c,c.status);i.complete.call(i,c,c.status),r.style.visibility="hidden"},c.onerror=function(t){i.message="Illegal request address or an unexpected network error!",i.error.call(i,c,c.status),r.style.visibility="hidden"},c.ontimeout=function(){i.message="The request timeout!",i.error.call(i,c,c.status),r.style.visibility="hidden"},c.setRequestHeader("Type","ajax"),c.setRequestHeader("From","mobilebone"),c.send(o)}},e.submit=function(t){if(t&&"string"==typeof t.action){var a=t.getAttribute("data-ajax");"false"==a||0==this.captureForm&&"true"!=a||t.addEventListener("submit",function(t){var a=this.getAttribute("data-preventdefault"),n=e.getFunction(a);return"function"==typeof n&&1==n(this)?(t.preventDefault(),!1):(e.ajax(this),void t.preventDefault())})}},e.isBack=function(t,e){return 1==history.tempBack?(history.tempBack=null,!0):4==t.compareDocumentPosition(e)},e.jsonHandle=function(t){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},e.init=function(){if(1==s)return"Don't repeat initialization!";var a=location.hash.replace("#&","#"),n=null;""==a||"#"==a?this.transition(document.querySelector("."+this.classPage)):1==r.test(a)&&(n=document.querySelector(a))&&n.classList.contains(this.classPage)?this.transition(n):this.ajax({url:a.replace("#",""),dataType:"unknown",error:function(){n=document.querySelector("."+e.classPage),e.transition(n)}});var i="click",o=t.$||t.jQuery||t.Zepto;o&&o.fn&&o.fn.tap&&"ontouchstart"in window==1&&(i="tap"),1==this.captureLink&&(document.addEventListener(i,this.handleTapEvent),"tap"==i&&document.addEventListener("click",function(t){var a=t.target;if(a&&("a"==a.tagName.toLowerCase()||(a=a.getParentElementByTag("a")))){var n=a.getAttribute("data-ajax"),i=a.href;"external"==a.getAttribute("data-rel")||"false"==n||i.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0]&&"true"!=n||0==e.captureLink&&"true"!=n||t.preventDefault()}}));var l=!!navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i)&&"undefined"!=typeof document.hidden&&!window.chrome;"ontouchstart"in window==1&&l&&(document.addEventListener("touchmove",function(){history.popstateswipe=!0}),document.addEventListener("touchend",function(){history.popstateswipe=!1})),s=!0},e.handleTapEvent=function(t){var n=t.target||t.touches[0],i=n.href;i&&0!=/a/i.test(n.tagName)||!(n=n.getParentElementByTag("a"))||(i=n.href);var r=document.querySelector(".in."+e.classPage);if(null!=r&&n){var o={target:n},s=n.getAttribute("data-preventdefault")||l(n.getAttribute("data-params")||"").preventdefault,u=e.getFunction(s);if("function"==typeof u&&1==u(n))return t.preventDefault(),!1;var c=n.getElementsByClassName(e.classMask)[0];if(c&&"hidden"!=c.style.visibility)return t.preventDefault(),!1;var d=n.getAttribute("data-container"),f=n.getAttribute("data-classpage"),p=d&&document.getElementById(d);if(p&&f&&f!=e.classPage){if(r=p.querySelector(".in."+f)||p.querySelector(f),null==r)return!1;o.history=!1,o.classPage=f}var y=1==e.captureLink,m=n.getAttribute("data-rel"),h=!1;"back"==m&&(h=!0);var g="external"==m;if(i){if(i=i.replace("#&","#"),""===n.getAttribute("href").replace(/#/g,""))return void t.preventDefault();if(/^javascript/.test(i)){if(0==h)return}else if(g=g||i.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0],(1==g||0==y)&&"true"!=n.getAttribute("data-ajax"))return;if(1==/^#/.test(n.getAttribute("href"))){var v=i.split("#")[1],b=v&&document.getElementById(v);0==h&&"auto"==m&&(h=e.isBack(b,r)),b&&e.transition(b,r,h,o),t.preventDefault()}else if(/^javascript/.test(i))history.tempBack=!0,history.back();else if("false"!=n.getAttribute("data-ajax")){var k=e.getCleanUrl(n),E=n.getAttribute("data-reload");n.getAttribute("href");null!=E&&"false"!=E||!a[k]?e.ajax(n):(0==h&&"auto"==m&&(h=e.isBack(a[k],r)),o.id=k,0==document.body.contains(a[k])&&document.body.appendChild(a[k]),e.transition(a[k],r,h,o)),t.preventDefault()}}}},Element.prototype.getParentElementByTag=function(t){if(!t)return null;var e=null,a=this,n=function(){if(a=a.parentElement,!a)return null;var i=a.tagName.toLowerCase();i===t?e=a:"body"==i?e=null:n()};return n(),e};var l=function(t){var e={};return"string"==typeof t&&t.split("&").forEach(function(t){var a=t.split("=");a.length>1&&(e[a[0]]=t.replace(a[0]+"=",""))}),e};return window.addEventListener("DOMContentLoaded",function(){0==s&&e.init()}),window.addEventListener("popstate",function(){if(1==history.popstateswipe)return location.reload(),void(history.popstateswipe=!1);if(0==history.popstate)return void(history.popstate=!0);var t=location.hash.replace("#&","").replace(/^#/,""),n=null;if(""==t){if(n=document.querySelector("."+e.classPage),n.id)return}else n=a[t];if(!n){if(0==r.test(t))return void e.ajax({url:t,dataType:"unknown"});n=document.querySelector("#"+t)}var i=document.querySelector(".in."+e.classPage);n&&n==i||0==e.pushStateEnabled||n&&e.transition(n,i,e.isBack(n,i),{id:t,history:!1,remove:!1})}),document.MBLOADED=!0,e});
//# sourceMappingURL=mobilebone.min.js.map
!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.CovJSON=f()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function getRangeAxisOrder(domain,range){var needsRangeAxisOrder=[].concat(_toConsumableArray(domain.axes.values())).filter(function(axis){return axis.values.length>1}).length>1,axisOrder=domain._rangeAxisOrder||range._axisNames;if(needsRangeAxisOrder&&!axisOrder)throw new Error("Range axis order missing");return axisOrder=axisOrder||[].concat(_toConsumableArray(domain.axes.keys()))}function getRangeShapeArray(domain,range){var axisOrder=getRangeAxisOrder(domain,range),shape=axisOrder.map(function(k){return domain.axes.get(k).values.length});if(range._shape){var matchesDomain=range._shape.length===shape.length&&range._shape.every(function(v,i){return v===shape[i]});if(!matchesDomain)throw new Error("range.shape must match domain axis sizes")}return shape}function _subsetByIndex(cov,constraints){return cov.loadDomain().then(function(domain){constraints=(0,_subset.normalizeIndexSubsetConstraints)(domain,constraints);var newdomain=(0,_subset.subsetDomainByIndex)(domain,constraints);domain._rangeAxisOrder&&(newdomain._rangeAxisOrder=domain._rangeAxisOrder);var rangeWrapper=function rangeWrapper(range){var _ndarr$hi$lo,_ndarr$hi,ndarr=range._ndarr,axisNames=getRangeAxisOrder(domain,range),los=axisNames.map(function(name){return constraints[name].start}),his=axisNames.map(function(name){return constraints[name].stop}),steps=axisNames.map(function(name){return constraints[name].step}),newndarr=(_ndarr$hi$lo=(_ndarr$hi=ndarr.hi.apply(ndarr,_toConsumableArray(his))).lo.apply(_ndarr$hi,_toConsumableArray(los))).step.apply(_ndarr$hi$lo,_toConsumableArray(steps)),newrange={dataType:range.dataType,get:createRangeGetFunction(newndarr,axisNames),_ndarr:newndarr,_axisNames:axisNames,_shape:axisNames.map(function(axisName){return newdomain.axes.get(axisName).values.length})};newrange.shape=new Map;var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=axisNames[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var axisName=_step2.value,size=newdomain.axes.get(axisName).values.length;newrange.shape.set(axisName,size)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}return newrange},loadRange=function loadRange(key){return cov.loadRange(key).then(rangeWrapper)},loadRanges=function loadRanges(keys){return cov.loadRanges(keys).then(function(ranges){return new Map([].concat(_toConsumableArray(ranges)).map(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],range=_ref2[1];return[key,rangeWrapper(range)]}))})},newcov={type:_constants.COVERAGE,domainProfiles:cov.domainProfiles,domainType:cov.domainType,parameters:cov.parameters,loadDomain:function loadDomain(){return Promise.resolve(newdomain)},loadRange:loadRange,loadRanges:loadRanges};return newcov.subsetByIndex=_subsetByIndex.bind(null,newcov),newcov.subsetByValue=_subset.subsetCoverageByValue.bind(null,newcov),newcov})}function transformParameter(params,key){if(!("__transformDone"in params[key])){var param=params[key];if(param.key=key,param.unit&&"string"==typeof param.unit.symbol&&(param.unit.symbol={value:param.unit.symbol}),param.categoryEncoding){var map=new Map,_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _iterator3=Object.keys(param.categoryEncoding)[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var category=_step3.value,vals=param.categoryEncoding[category];Array.isArray(vals)||(vals=[vals]),map.set(category,vals)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}param.categoryEncoding=map}param.__transformDone=!0}}function transformRange(range,domain){if(!("__transformDone"in range)){var values=range.values,targetDataType=range.dataType,isTyped=ArrayBuffer.isView(values),missingIsEncoded="number"==typeof range.validMin,hasOffsetFactor="offset"in range;"offset"in range&&(0,_util.assert)("factor"in range);var offset=range.offset,factor=range.factor;missingIsEncoded&&((0,_util.assert)("validMin"in range),(0,_util.assert)("validMax"in range));var validMin=range.validMin,validMax=range.validMax,vals=void 0;if(missingIsEncoded||hasOffsetFactor){if(vals=new Array(values.length),hasOffsetFactor){for(var i=0;i<values.length;i++){var val=values[i];missingIsEncoded&&(validMin>val||val>validMax)?vals[i]=null:missingIsEncoded||null!==val?vals[i]=val*factor+offset:vals[i]=null}void 0!==validMin&&(range.validMin=validMin*factor+offset,range.validMax=validMax*factor+offset)}else for(var i=0;i<values.length;i++){var val=values[i];validMin>val||val>validMax?vals[i]=null:vals[i]=val}delete range.offset,delete range.factor,delete range.validMin,delete range.validMax}else vals=values;if(void 0===range.actualMin){var _minMax=(0,_array.minMax)(vals),_minMax2=_slicedToArray(_minMax,2),min=_minMax2[0],max=_minMax2[1];null!==min&&(range.actualMin=min,range.actualMax=max)}range.shape&&(range._shape=range.shape),range.axisNames&&(range._axisNames=range.axisNames,delete range.axisNames);var axisNames=getRangeAxisOrder(domain,range),shapeArr=getRangeShapeArray(domain,range),ndarr=(0,_ndarray2["default"])(vals,shapeArr);range._ndarr=ndarr,range.get=createRangeGetFunction(ndarr,axisNames);var shapeMap=new Map,_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _iterator4=domain.axes[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var _step4$value=_slicedToArray(_step4.value,2),axisName=_step4$value[0],axis=_step4$value[1];shapeMap.set(axisName,axis.values.length)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4["return"]&&_iterator4["return"]()}finally{if(_didIteratorError4)throw _iteratorError4}}return range.shape=shapeMap,range.__transformDone=!0,range}}function createRangeGetFunction(ndarr,axisOrder){for(var ndargs="",i=0;i<axisOrder.length;i++)ndargs&&(ndargs+=","),ndargs+="'"+axisOrder[i]+"' in obj ? obj['"+axisOrder[i]+"'] : 0";var fn=new Function("ndarr","return function ndarrget (obj) { return ndarr.get("+ndargs+") }")(ndarr);return fn}function transformDomain(domain,referencing,domainType){if(!("__transformDone"in domain)){domain.profiles=[];var profile=domain.profile;profile&&("http"!==profile.substr(0,4)&&(profile=_util.PREFIX+profile),domain.domainType=profile,domain.profiles.push(profile)),domain.domainType||(domain.domainType=domainType);var axes=new Map,_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _iterator5=Object.keys(domain.axes)[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var axisName=_step5.value;axes.set(axisName,domain.axes[axisName])}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5["return"]&&_iterator5["return"]()}finally{if(_didIteratorError5)throw _iteratorError5}}domain.axes=axes;var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _iterator6=axes[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var _step6$value=_slicedToArray(_step6.value,2),key=_step6$value[0],axis=_step6$value[1];if(axis.key=key,("Tuple"===axis.dataType||"Polygon"===axis.dataType)&&(axis.dataType=_util.PREFIX+axis.dataType),axis.dimensions&&(axis.components=axis.dimensions),axis.components||(axis.components=[key]),axis.dimensions=axis.components,"start"in axis&&"stop"in axis&&"num"in axis){var arr=new Float64Array(axis.num),step=void 0;if(1===axis.num){if(axis.start!==axis.stop)throw new Error("regular axis of length 1 must have equal start/stop values");step=0}else step=(axis.stop-axis.start)/(axis.num-1);for(var i=0;i<axis.num;i++)arr[i]=axis.start+i*step;axis.values=arr,delete axis.start,delete axis.stop,delete axis.num}if(!ArrayBuffer.isView(axis.values)){if(Array.isArray(axis.values)&&"number"==typeof axis.values[0]){for(var arr=new Float64Array(axis.values.length),i=0;i<axis.values.length;i++)arr[i]=axis.values[i];axis.values=arr}axis.bounds=wrapBounds(axis)}}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6["return"]&&_iterator6["return"]()}finally{if(_didIteratorError6)throw _iteratorError6}}referencing&&(domain.referencing=referencing);var _iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _iterator7=domain.referencing[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){var obj=_step7.value;if(obj.system)break;obj.system=obj.srs||obj.trs||obj.rs,obj.dimensions&&(obj.components=obj.dimensions),delete obj.srs,delete obj.trs,delete obj.rs}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{!_iteratorNormalCompletion7&&_iterator7["return"]&&_iterator7["return"]()}finally{if(_didIteratorError7)throw _iteratorError7}}return domain.rangeAxisOrder&&(domain._rangeAxisOrder=domain.rangeAxisOrder,delete domain.rangeAxisOrder),domain.__transformDone=!0,domain}}function wrapBounds(axis){if(axis.bounds){var _ret=function(){var bounds=axis.bounds;return{v:{get:function get(i){return[bounds[2*i],bounds[2*i+1]]}}}}();if("object"===("undefined"==typeof _ret?"undefined":_typeof(_ret)))return _ret.v}}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.transformParameter=transformParameter,exports.transformDomain=transformDomain;var _ndarray=require("ndarray"),_ndarray2=_interopRequireDefault(_ndarray),_subset=require("covutils/lib/subset.js"),_array=require("covutils/lib/array.js"),_constants=require("./constants.js"),_util=require("./util.js"),_http=require("./http"),Coverage=function(){function Coverage(covjson,options){_classCallCheck(this,Coverage),this._covjson=covjson,this.type=_constants.COVERAGE,this.ld={},this._exposeLd(covjson),this.options=options?(0,_util.shallowcopy)(options):{},this.id=covjson.id,this.parameters=new Map;var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=Object.keys(covjson.parameters)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var key=_step.value;transformParameter(covjson.parameters,key),this.parameters.set(key,covjson.parameters[key])}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}this.profiles=[];var profile=this._covjson.profile;profile&&("http"!==profile.substr(0,4)&&(profile=_util.PREFIX+profile),this.profiles.push(profile)),this.domainProfiles=[];var domainProfile=void 0;domainProfile="string"==typeof this._covjson.domain?this._covjson.domainProfile:this._covjson.domain.profile,domainProfile&&("http"!==domainProfile.substr(0,4)&&(domainProfile=_util.PREFIX+domainProfile),this.domainType=domainProfile,this.domainProfiles.push(domainProfile)),!profile&&domainProfile&&(profile=domainProfile+_constants.COVERAGE,this.profiles.push(profile)),this._updateLoadStatus()}return _createClass(Coverage,[{key:"_updateLoadStatus",value:function _updateLoadStatus(){var _this=this,isLoaded=function isLoaded(prop){return"object"===("undefined"==typeof prop?"undefined":_typeof(prop))},domainLoaded=isLoaded(this._covjson.domain),rangesLoaded=Object.keys(this._covjson.ranges).every(function(key){return isLoaded(_this._covjson.ranges[key])});this.loaded=domainLoaded&&rangesLoaded}},{key:"_exposeLd",value:function _exposeLd(covjson){if(covjson["@context"]){var copy=(0,_util.shallowcopy)(covjson);delete copy.domain,delete copy.ranges,this.ld=JSON.parse(JSON.stringify(copy))}}},{key:"loadDomain",value:function loadDomain(){var _this2=this,domainOrUrl=this._covjson.domain;if(this._domainPromise)return this._domainPromise;var promise=void 0;if("object"===("undefined"==typeof domainOrUrl?"undefined":_typeof(domainOrUrl))){var domain=domainOrUrl;transformDomain(domain,this.options.referencing,this.domainType),promise=Promise.resolve(domain)}else{var url=domainOrUrl;promise=(0,_http.load)(url).then(function(result){var domain=result.data;return transformDomain(domain,_this2.options.referencing,_this2.domainType),_this2._covjson.domain=domain,_this2._updateLoadStatus(),domain})}return this._domainPromise=promise,promise}},{key:"loadRange",value:function loadRange(paramKey){var _this3=this;return this.loadDomain().then(function(domain){var rangeOrUrl=_this3._covjson.ranges[paramKey];if("object"===("undefined"==typeof rangeOrUrl?"undefined":_typeof(rangeOrUrl))){var range=rangeOrUrl;return transformRange(range,domain),Promise.resolve(range)}var url=rangeOrUrl;return(0,_http.load)(url).then(function(result){var range=result.data;return transformRange(range,domain),_this3.options.cacheRanges&&(_this3._covjson.ranges[paramKey]=range,_this3._updateLoadStatus()),range})})}},{key:"loadRanges",value:function loadRanges(paramKeys){var _this4=this;return void 0===paramKeys&&(paramKeys=this.parameters.keys()),paramKeys=Array.from(paramKeys),Promise.all(paramKeys.map(function(k){return _this4.loadRange(k)})).then(function(ranges){for(var map=new Map,i=0;i<paramKeys.length;i++)map.set(paramKeys[i],ranges[i]);return map})}},{key:"subsetByIndex",value:function subsetByIndex(constraints){return _subsetByIndex(this,constraints)}},{key:"subsetByValue",value:function subsetByValue(constraints){return(0,_subset.subsetCoverageByValue)(this,constraints)}}]),Coverage}();exports["default"]=Coverage},{"./constants.js":3,"./http":4,"./util.js":7,"covutils/lib/array.js":9,"covutils/lib/subset.js":12,ndarray:13}],2:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function matchesFilter(domain,filter){var _iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _iterator5=Object.keys(filter)[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var axisName=_step5.value,condition=filter[axisName];if(!domain.axes.has(axisName))throw new Error('Axis "'+axisName+'" does not exist');var axis=domain.axes.get(axisName),vals=axis.values,min=vals[0],max=vals[vals.length-1];if("number"!=typeof min&&"string"!=typeof min)throw new Error("Can only filter primitive axis values");var start=condition.start,stop=condition.stop;if((0,_referencing.isISODateAxis)(domain,axisName)){var _ref=[(0,_util.asTime)(min),(0,_util.asTime)(max)][stop]=[(0,_util.asTime)(start),(0,_util.asTime)(stop)],_ref2=_slicedToArray(_ref,2);min=_ref2[0],max=_ref2[1]}else if((0,_referencing.isLongitudeAxis)(domain,axisName))var lonWrapper=(0,_referencing.getLongitudeWrapper)(domain,axisName)[stop]=[lonWrapper(start),lonWrapper(stop)];if(min>max){var _ref3=[max,min];min=_ref3[0],max=_ref3[1]}if(start>max||min>stop)return!1}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5["return"]&&_iterator5["return"]()}finally{if(_didIteratorError5)throw _iteratorError5}}return!0}function mergeInto(inputObj,targetObj){var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _iterator6=Object.keys(inputObj)[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var k=_step6.value;targetObj[k]=inputObj[k]}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6["return"]&&_iterator6["return"]()}finally{if(_didIteratorError6)throw _iteratorError6}}}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.CollectionQuery=void 0;var _constants=require("./constants.js"),_Coverage=require("./Coverage.js"),_Coverage2=_interopRequireDefault(_Coverage),_util=require("./util.js"),_referencing=require("covutils/lib/referencing.js"),CoverageCollection=function(){function CoverageCollection(covjson){_classCallCheck(this,CoverageCollection),this.type=_constants.COVERAGECOLLECTION,this.ld={},this._exposeLd(covjson),this.id=covjson.id,this.profiles=[];var profile=covjson.profile,domainType=void 0;profile&&("http"!==profile.substr(0,4)&&((0,_util.endsWith)(profile,_constants.COVERAGECOLLECTION)&&(domainType=profile.substr(0,profile.length-_constants.COVERAGECOLLECTION.length)),profile=_util.PREFIX+profile),this.profiles.push(profile)),domainType||(domainType=covjson.domainType),domainType&&"http"!==domainType.substr(0,4)&&(domainType=_util.PREFIX+domainType),this.domainType=domainType,!profile&&domainType&&(profile=domainType+_constants.COVERAGECOLLECTION,this.profiles.push(profile));var covs=[],rootParams=covjson.parameters?covjson.parameters:{},covOptions={};covjson.referencing&&(covOptions.referencing=covjson.referencing);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=covjson.coverages[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var coverage=_step.value;coverage.domainProfile||(coverage.domainProfile=domainType),coverage.parameters||(coverage.parameters={});var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _iterator3=Object.keys(rootParams)[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var key=_step3.value;key in coverage.ranges&&(coverage.parameters[key]=rootParams[key])}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}covjson["@context"]&&(coverage["@context"]=covjson["@context"]),covs.push(new _Coverage2["default"](coverage,covOptions))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}if(this.coverages=covs,covjson.parameters){this.parameters=new Map;var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=Object.keys(covjson.parameters)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var key=_step2.value;(0,_Coverage.transformParameter)(covjson.parameters,key),this.parameters.set(key,covjson.parameters[key])}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}}covjson.domainTemplate&&((0,_Coverage.transformDomain)(covjson.domainTemplate),this.domainTemplate=covjson.domainTemplate)}return _createClass(CoverageCollection,[{key:"query",value:function query(){return new CollectionQuery(this)}},{key:"_exposeLd",value:function _exposeLd(covjson){if(covjson["@context"]){var copy=(0,_util.shallowcopy)(covjson);delete copy.coverages,this.ld=JSON.parse(JSON.stringify(copy))}}}]),CoverageCollection}();exports["default"]=CoverageCollection;var CollectionQuery=exports.CollectionQuery=function(){function CollectionQuery(collection){_classCallCheck(this,CollectionQuery),this._collection=collection,this._filter={},this._subset={}}return _createClass(CollectionQuery,[{key:"filter",value:function filter(spec){return mergeInto(spec,this._filter),this}},{key:"subset",value:function subset(spec){return mergeInto(spec,this._subset),this}},{key:"embed",value:function embed(spec){return this}},{key:"execute",value:function execute(){var _this=this,coll=this._collection,newcoll={type:_constants.COVERAGECOLLECTION,coverages:[],parameters:coll.parameters,domainTemplate:coll.domainTemplate,profiles:coll.profiles},promises=[],_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _loop=function _loop(){var cov=_step4.value;promises.push(cov.loadDomain().then(function(domain){return matchesFilter(domain,_this._filter)?0!==Object.keys(_this._subset).length?cov.subsetByValue(_this._subset).then(function(subsetted){newcoll.coverages.push(subsetted)}):void newcoll.coverages.push(cov):void 0}))},_iterator4=coll.coverages[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0)_loop()}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4["return"]&&_iterator4["return"]()}finally{if(_didIteratorError4)throw _iteratorError4}}return Promise.all(promises).then(function(){return newcoll.query=function(){return new CollectionQuery(newcoll)},newcoll})}}]),CollectionQuery}()},{"./Coverage.js":1,"./constants.js":3,"./util.js":7,"covutils/lib/referencing.js":11}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _constants=require("covutils/lib/constants.js");Object.defineProperty(exports,"DOMAIN",{enumerable:!0,get:function get(){return _constants.DOMAIN}}),Object.defineProperty(exports,"COVERAGE",{enumerable:!0,get:function get(){return _constants.COVERAGE}}),Object.defineProperty(exports,"COVERAGECOLLECTION",{enumerable:!0,get:function get(){return _constants.COVERAGECOLLECTION}});var LINKRELPREFIX=exports.LINKRELPREFIX="http://www.iana.org/assignments/relation/"},{"covutils/lib/constants.js":10}],4:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function load(url){var options=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],responseType=arguments.length<=2||void 0===arguments[2]?"arraybuffer":arguments[2];if(-1===["arraybuffer","text"].indexOf(responseType))throw new Error;var headers=options.headers||{};return new Promise(function(resolve,reject){var req=new XMLHttpRequest;req.open("GET",url),req.responseType=responseType;var accept=(0,_httpCommon.getAcceptHeader)(options.eagerload);if(req.setRequestHeader("Accept",accept),headers){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=Object.keys(headers)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var header=_step.value;req.setRequestHeader(header,headers[header])}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}req.addEventListener("load",function(){try{if(!(req.status>=200&&req.status<300||304===req.status))return void reject(new Error('Resource "'+url+'" not found, HTTP status code: '+req.status));var type=req.getResponseHeader("Content-Type");(0,_httpCommon.matchesMediaTypes)(type,[_httpCommon.MEDIATYPE.OCTETSTREAM,_httpCommon.MEDIATYPE.TEXT])&&((0,_util.endsWith)(url,_httpCommon.EXT.COVJSON)?type=_httpCommon.MEDIATYPE.COVJSON:(0,_util.endsWith)(url,_httpCommon.EXT.COVCBOR)&&(type=_httpCommon.MEDIATYPE.COVCBOR));var data=void 0;if((0,_httpCommon.matchesMediaTypes)(type,_httpCommon.MEDIATYPE.COVCBOR)){var arrayBuffer=req.response,t0=new Date;data=_cborJs2["default"].decode(arrayBuffer),console.log("CBOR decoding: "+(new Date-t0)+"ms")}else{if(!(0,_httpCommon.matchesMediaTypes)(type,[_httpCommon.MEDIATYPE.COVJSON,_httpCommon.MEDIATYPE.JSONLD,_httpCommon.MEDIATYPE.JSON]))return void reject(new Error("Unsupported media type: "+type));if("arraybuffer"===responseType){if(!window.TextDecoder)return void reject({responseType:"text"});var t0=new Date;data=JSON.parse((new TextDecoder).decode(new DataView(req.response))),console.log("JSON decoding: "+(new Date-t0)+"ms")}else{var t0=new Date;data=JSON.parse(req.response),console.log("JSON decoding (slow path): "+(new Date-t0)+"ms")}}var responseHeaders=parseResponseHeaders(req.getAllResponseHeaders());resolve({data:data,headers:responseHeaders})}catch(e){reject(e)}}),req.addEventListener("error",function(){reject(new Error("Network error loading resource at "+url))}),req.send()})["catch"](function(e){if(e.responseType)return load(url,headers,e.responseType);throw e})}function parseResponseHeaders(headerStr){var headers={};if(!headerStr)return headers;for(var headerPairs=headerStr.split("\r\n"),i=0;i<headerPairs.length;i++){var headerPair=headerPairs[i],index=headerPair.indexOf(": ");if(index>0){var key=headerPair.substring(0,index).toLowerCase(),val=headerPair.substring(index+2);headers[key]=val}}return headers}Object.defineProperty(exports,"__esModule",{value:!0}),exports.load=load;var _cborJs=require("cbor-js"),_cborJs2=_interopRequireDefault(_cborJs),_util=require("./util.js"),_httpCommon=require("./http-common.js")},{"./http-common.js":5,"./util.js":7,"cbor-js":8}],5:[function(require,module,exports){"use strict";function getAcceptHeader(standalone){var covjsonProfile=standalone?'; profile="'+COVJSON_PROFILE_STANDALONE+'"':"",accept=MEDIATYPE.COVCBOR+"; q=1.0, "+MEDIATYPE.COVJSON+covjsonProfile+"; q=0.5, "+MEDIATYPE.JSONLD+"; q=0.1, "+MEDIATYPE.JSON+"; q=0.1";return accept}function matchesMediaTypes(mediaType,matchingMediaTypes){return Array.isArray(matchingMediaTypes)||(matchingMediaTypes=[matchingMediaTypes]),matchingMediaTypes.some(function(t){return 0===mediaType.indexOf(t)})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAcceptHeader=getAcceptHeader,exports.matchesMediaTypes=matchesMediaTypes;var MEDIATYPE=exports.MEDIATYPE={COVCBOR:"application/prs.coverage+cbor",COVJSON:"application/prs.coverage+json",JSONLD:"application/ld+json",JSON:"application/json",OCTETSTREAM:"application/octet-stream",TEXT:"text/plain"},COVJSON_PROFILE_STANDALONE=exports.COVJSON_PROFILE_STANDALONE="http://coveragejson.org/profiles/standalone",EXT=exports.EXT={COVJSON:".covjson",COVCBOR:".covcbor"}},{}],6:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function load(url,options){return http.load(url,options)}function read(input){var options=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return"object"===("undefined"==typeof input?"undefined":_typeof(input))?Promise.resolve().then(function(){return transformCovJSON(input)}):load(input,options).then(function(_ref){var data=_ref.data,headers=_ref.headers;return transformCovJSON(data,headers)})}function transformCovJSON(obj,headers){if(checkValidCovJSON(obj),-1===[_constants.COVERAGE,_constants.COVERAGECOLLECTION,_constants.DOMAIN].indexOf(obj.type))throw new Error("CoverageJSON document must be of Coverage, CoverageCollection, or Domain type");var result=void 0;return obj.type===_constants.DOMAIN?((0,_Coverage.transformDomain)(obj),result=obj):result=obj.type===_constants.COVERAGE?new _Coverage2["default"](obj):new _CoverageCollection2["default"](obj),(obj.type===_constants.COVERAGE||obj.type===_constants.COVERAGECOLLECTION)&&addLinkRelations(result,headers),result}function addLinkRelations(cov,headers){if(headers&&headers.link){var ld=cov.ld,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=headers.link.split(",")[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var link=_step.value;link=link.trim();var parts=link.split(";"),url=parts[0].substr(1,parts[0].length-2),_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=parts.slice(1)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var param=_step2.value,relStart=param.indexOf("rel=");if(-1!==relStart){var rel=param.substring(relStart+5,param.length-1);rel.startsWith("http://")||rel.startsWith("https://")||(rel=_constants.LINKRELPREFIX+rel),ld[rel]?Array.isArray(ld[rel])?ld[rel].push(url):ld[rel]=[ld[rel],url]:ld[rel]=url;
}}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}}function checkValidCovJSON(obj){(0,_util.assert)("type"in obj,'"type" missing'),obj.type===_constants.COVERAGE?((0,_util.assert)("parameters"in obj,'"parameters" missing'),(0,_util.assert)("domain"in obj,'"domain" missing'),(0,_util.assert)("ranges"in obj,'"ranges" missing')):obj.type===_constants.COVERAGECOLLECTION&&(0,_util.assert)(Array.isArray(obj.coverages),'"coverages" must be an array')}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:!0}),exports.load=load,exports.read=read;var _Coverage=require("./Coverage.js"),_Coverage2=_interopRequireDefault(_Coverage),_CoverageCollection=require("./CoverageCollection.js"),_CoverageCollection2=_interopRequireDefault(_CoverageCollection),_util=require("./util.js"),_constants=require("./constants.js"),_http=require("./http"),http=_interopRequireWildcard(_http)},{"./Coverage.js":1,"./CoverageCollection.js":2,"./constants.js":3,"./http":4,"./util.js":7}],7:[function(require,module,exports){"use strict";function assert(condition,message){if(!condition)throw message=message||"Assertion failed",new Error(message)}function shallowcopy(obj){var copy=Object.create(Object.getPrototypeOf(obj));for(var prop in obj)copy[prop]=obj[prop];return copy}function endsWith(subject,search){var position=subject.length-search.length,lastIndex=subject.indexOf(search,position);return-1!==lastIndex&&lastIndex===position}Object.defineProperty(exports,"__esModule",{value:!0});var _array=require("covutils/lib/array.js");Object.defineProperty(exports,"minMax",{enumerable:!0,get:function get(){return _array.minMax}}),Object.defineProperty(exports,"indicesOfNearest",{enumerable:!0,get:function get(){return _array.indicesOfNearest}}),Object.defineProperty(exports,"indexOfNearest",{enumerable:!0,get:function get(){return _array.indexOfNearest}}),exports.assert=assert,exports.shallowcopy=shallowcopy,exports.endsWith=endsWith;var PREFIX=exports.PREFIX="http://coveragejson.org/def#"},{"covutils/lib/array.js":9}],8:[function(require,module,exports){!function(global,undefined){"use strict";function encode(value){function ensureSpace(length){for(var newByteLength=data.byteLength,requiredLength=offset+length;requiredLength>newByteLength;)newByteLength*=2;if(newByteLength!==data.byteLength){var oldDataView=dataView;data=new ArrayBuffer(newByteLength),dataView=new DataView(data);for(var uint32count=offset+3>>2,i=0;uint32count>i;++i)dataView.setUint32(4*i,oldDataView.getUint32(4*i))}return lastLength=length,dataView}function write(){offset+=lastLength}function writeFloat64(value){write(ensureSpace(8).setFloat64(offset,value))}function writeUint8(value){write(ensureSpace(1).setUint8(offset,value))}function writeUint8Array(value){for(var dataView=ensureSpace(value.length),i=0;i<value.length;++i)dataView.setUint8(offset+i,value[i]);write()}function writeUint16(value){write(ensureSpace(2).setUint16(offset,value))}function writeUint32(value){write(ensureSpace(4).setUint32(offset,value))}function writeUint64(value){var low=value%POW_2_32,high=(value-low)/POW_2_32,dataView=ensureSpace(8);dataView.setUint32(offset,high),dataView.setUint32(offset+4,low),write()}function writeTypeAndLength(type,length){24>length?writeUint8(type<<5|length):256>length?(writeUint8(type<<5|24),writeUint8(length)):65536>length?(writeUint8(type<<5|25),writeUint16(length)):4294967296>length?(writeUint8(type<<5|26),writeUint32(length)):(writeUint8(type<<5|27),writeUint64(length))}function encodeItem(value){var i;if(value===!1)return writeUint8(244);if(value===!0)return writeUint8(245);if(null===value)return writeUint8(246);if(value===undefined)return writeUint8(247);switch(typeof value){case"number":if(Math.floor(value)===value){if(value>=0&&POW_2_53>=value)return writeTypeAndLength(0,value);if(value>=-POW_2_53&&0>value)return writeTypeAndLength(1,-(value+1))}return writeUint8(251),writeFloat64(value);case"string":var utf8data=[];for(i=0;i<value.length;++i){var charCode=value.charCodeAt(i);128>charCode?utf8data.push(charCode):2048>charCode?(utf8data.push(192|charCode>>6),utf8data.push(128|63&charCode)):55296>charCode?(utf8data.push(224|charCode>>12),utf8data.push(128|charCode>>6&63),utf8data.push(128|63&charCode)):(charCode=(1023&charCode)<<10,charCode|=1023&value.charCodeAt(++i),charCode+=65536,utf8data.push(240|charCode>>18),utf8data.push(128|charCode>>12&63),utf8data.push(128|charCode>>6&63),utf8data.push(128|63&charCode))}return writeTypeAndLength(3,utf8data.length),writeUint8Array(utf8data);default:var length;if(Array.isArray(value))for(length=value.length,writeTypeAndLength(4,length),i=0;length>i;++i)encodeItem(value[i]);else if(value instanceof Uint8Array)writeTypeAndLength(2,value.length),writeUint8Array(value);else{var keys=Object.keys(value);for(length=keys.length,writeTypeAndLength(5,length),i=0;length>i;++i){var key=keys[i];encodeItem(key),encodeItem(value[key])}}}}var data=new ArrayBuffer(256),dataView=new DataView(data),lastLength,offset=0;if(encodeItem(value),"slice"in data)return data.slice(0,offset);for(var ret=new ArrayBuffer(offset),retView=new DataView(ret),i=0;offset>i;++i)retView.setUint8(i,dataView.getUint8(i));return ret}function decode(data,tagger,simpleValue){function read(value,length){return offset+=length,value}function readArrayBuffer(length){return read(new Uint8Array(data,offset,length),length)}function readFloat16(){var tempArrayBuffer=new ArrayBuffer(4),tempDataView=new DataView(tempArrayBuffer),value=readUint16(),sign=32768&value,exponent=31744&value,fraction=1023&value;if(31744===exponent)exponent=261120;else if(0!==exponent)exponent+=114688;else if(0!==fraction)return fraction*POW_2_24;return tempDataView.setUint32(0,sign<<16|exponent<<13|fraction<<13),tempDataView.getFloat32(0)}function readFloat32(){return read(dataView.getFloat32(offset),4)}function readFloat64(){return read(dataView.getFloat64(offset),8)}function readUint8(){return read(dataView.getUint8(offset),1)}function readUint16(){return read(dataView.getUint16(offset),2)}function readUint32(){return read(dataView.getUint32(offset),4)}function readUint64(){return readUint32()*POW_2_32+readUint32()}function readBreak(){return 255!==dataView.getUint8(offset)?!1:(offset+=1,!0)}function readLength(additionalInformation){if(24>additionalInformation)return additionalInformation;if(24===additionalInformation)return readUint8();if(25===additionalInformation)return readUint16();if(26===additionalInformation)return readUint32();if(27===additionalInformation)return readUint64();if(31===additionalInformation)return-1;throw"Invalid length encoding"}function readIndefiniteStringLength(majorType){var initialByte=readUint8();if(255===initialByte)return-1;var length=readLength(31&initialByte);if(0>length||initialByte>>5!==majorType)throw"Invalid indefinite length element";return length}function appendUtf16data(utf16data,length){for(var i=0;length>i;++i){var value=readUint8();128&value&&(224>value?(value=(31&value)<<6|63&readUint8(),length-=1):240>value?(value=(15&value)<<12|(63&readUint8())<<6|63&readUint8(),length-=2):(value=(15&value)<<18|(63&readUint8())<<12|(63&readUint8())<<6|63&readUint8(),length-=3)),65536>value?utf16data.push(value):(value-=65536,utf16data.push(55296|value>>10),utf16data.push(56320|1023&value))}}function decodeItem(){var initialByte=readUint8(),majorType=initialByte>>5,additionalInformation=31&initialByte,i,length;if(7===majorType)switch(additionalInformation){case 25:return readFloat16();case 26:return readFloat32();case 27:return readFloat64()}if(length=readLength(additionalInformation),0>length&&(2>majorType||majorType>6))throw"Invalid length";switch(majorType){case 0:return length;case 1:return-1-length;case 2:if(0>length){for(var elements=[],fullArrayLength=0;(length=readIndefiniteStringLength(majorType))>=0;)fullArrayLength+=length,elements.push(readArrayBuffer(length));var fullArray=new Uint8Array(fullArrayLength),fullArrayOffset=0;for(i=0;i<elements.length;++i)fullArray.set(elements[i],fullArrayOffset),fullArrayOffset+=elements[i].length;return fullArray}return readArrayBuffer(length);case 3:var utf16data=[];if(0>length)for(;(length=readIndefiniteStringLength(majorType))>=0;)appendUtf16data(utf16data,length);else appendUtf16data(utf16data,length);return String.fromCharCode.apply(null,utf16data);case 4:var retArray;if(0>length)for(retArray=[];!readBreak();)retArray.push(decodeItem());else for(retArray=new Array(length),i=0;length>i;++i)retArray[i]=decodeItem();return retArray;case 5:var retObject={};for(i=0;length>i||0>length&&!readBreak();++i){var key=decodeItem();retObject[key]=decodeItem()}return retObject;case 6:return tagger(decodeItem(),length);case 7:switch(length){case 20:return!1;case 21:return!0;case 22:return null;case 23:return undefined;default:return simpleValue(length)}}}var dataView=new DataView(data),offset=0;"function"!=typeof tagger&&(tagger=function(value){return value}),"function"!=typeof simpleValue&&(simpleValue=function(){return undefined});var ret=decodeItem();if(offset!==data.byteLength)throw"Remaining bytes";return ret}var POW_2_24=Math.pow(2,-24),POW_2_32=Math.pow(2,32),POW_2_53=Math.pow(2,53),obj={encode:encode,decode:decode};"function"==typeof define&&define.amd?define("cbor/cbor",obj):"undefined"!=typeof module&&module.exports?module.exports=obj:global.CBOR||(global.CBOR=obj)}(this)},{}],9:[function(require,module,exports){"use strict";function minMax(arr){for(var len=arr.length,min=1/0,max=-(1/0);len--;){var el=arr[len];null==el||(min>el?min=el:el>max&&(max=el))}return min===1/0?min=max:max===-(1/0)&&(max=min),(min===1/0||min===-(1/0))&&(min=null,max=null),[min,max]}function indicesOfNearest(a,x){if(0===a.length)throw new Error("Array must have at least one element");var lo=-1,hi=a.length,ascending=1===a.length||a[0]<a[1];if(ascending)for(;hi-lo>1;){var mid=Math.round((lo+hi)/2);a[mid]<=x?lo=mid:hi=mid}else for(;hi-lo>1;){var _mid=Math.round((lo+hi)/2);a[_mid]>=x?lo=_mid:hi=_mid}return a[lo]===x&&(hi=lo),-1===lo&&(lo=hi),hi===a.length&&(hi=lo),[lo,hi]}function indexOfNearest(a,x){var i=indicesOfNearest(a,x),lo=i[0],hi=i[1];return Math.abs(x-a[lo])<=Math.abs(x-a[hi])?lo:hi}Object.defineProperty(exports,"__esModule",{value:!0}),exports.minMax=minMax,exports.indicesOfNearest=indicesOfNearest,exports.indexOfNearest=indexOfNearest},{}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DOMAIN=exports.DOMAIN="Domain",COVERAGE=exports.COVERAGE="Coverage",COVERAGECOLLECTION=exports.COVERAGECOLLECTION=COVERAGE+"Collection"},{}],11:[function(require,module,exports){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function getLongitudeWrapper(domain,axisName){if(!isLongitudeAxis(domain,axisName))throw new Error("'"+axisName+"' is not a longitude axis");var vals=domain.axes.get(axisName).values,lon_min=vals[0],lon_max=vals[vals.length-1];if(lon_min>lon_max){var _ref=[lon_max,lon_min];lon_min=_ref[0],lon_max=_ref[1]}var x_mid=(lon_max+lon_min)/2,x_min=x_mid-180,x_max=x_mid+180;return function(lon){return lon>=x_min&&x_max>=lon?lon:((lon-x_min)%360+360)%360+x_min}}function isLongitudeAxis(domain,axisName){var ref=getReferenceObject(domain,axisName);if(!ref)return!1;var crsId=ref.system.id;if(-1===EllipsoidalCRSs.indexOf(crsId))return!1;var compIdx=ref.components.indexOf(axisName),isLongitude=LongitudeAxisIndex[crsId]===compIdx;return isLongitude}function isISODateAxis(domain,axisName){var val=domain.axes.get(axisName).values[0];return"string"!=typeof val?!1:!isNaN(new Date(val).getTime())}function getReferenceObject(domain,component){var ref=domain.referencing.find(function(ref){return-1!==ref.components.indexOf(component)});return ref}function asTime(inp){var res=void 0,err=!1;if("string"==typeof inp?res=new Date(inp).getTime():inp instanceof Date?res=inp.getTime():err=!0,isNaN(res)&&(err=!0),err)throw new Error("Invalid date: "+inp);return res}Object.defineProperty(exports,"__esModule",{value:!0});var _LongitudeAxisIndex;exports.getLongitudeWrapper=getLongitudeWrapper,exports.isLongitudeAxis=isLongitudeAxis,exports.isISODateAxis=isISODateAxis,exports.asTime=asTime;var OPENGIS_CRS_PREFIX="http://www.opengis.net/def/crs/",EPSG4979=OPENGIS_CRS_PREFIX+"EPSG/0/4979",EPSG4326=OPENGIS_CRS_PREFIX+"EPSG/0/4326",CRS84=OPENGIS_CRS_PREFIX+"OGC/1.3/CRS84",EllipsoidalCRSs=[EPSG4979,EPSG4326,CRS84],LongitudeAxisIndex=(_LongitudeAxisIndex={},_defineProperty(_LongitudeAxisIndex,EPSG4979,1),_defineProperty(_LongitudeAxisIndex,EPSG4326,1),_defineProperty(_LongitudeAxisIndex,CRS84,0),_LongitudeAxisIndex)},{}],12:[function(require,module,exports){"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function normalizeIndexSubsetConstraints(domain,constraints){var normalizedConstraints={};for(var axisName in constraints)if(domain.axes.has(axisName)&&void 0!==constraints[axisName]&&null!==constraints[axisName]){if("number"==typeof constraints[axisName]){var constraint=constraints[axisName];normalizedConstraints[axisName]={start:constraint,stop:constraint+1}}else normalizedConstraints[axisName]=constraints[axisName];var _normalizedConstraint=normalizedConstraints[axisName],_normalizedConstraint2=_normalizedConstraint.start,start=void 0===_normalizedConstraint2?0:_normalizedConstraint2,_normalizedConstraint3=_normalizedConstraint.stop,stop=void 0===_normalizedConstraint3?domain.axes.get(axisName).values.length:_normalizedConstraint3,_normalizedConstraint4=_normalizedConstraint.step,step=void 0===_normalizedConstraint4?1:_normalizedConstraint4;if(0>=step)throw new Error("Invalid constraint for "+axisName+": step="+step+" must be > 0");if(start>=stop||0>start)throw new Error("Invalid constraint for "+axisName+": stop="+stop+" must be > start="+start+" and both >= 0");normalizedConstraints[axisName]={start:start,stop:stop,step:step}}var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=domain.axes.keys()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _axisName=_step.value;if(!(_axisName in normalizedConstraints)){var len=domain.axes.get(_axisName).values.length;normalizedConstraints[_axisName]={start:0,stop:len,step:1}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return normalizedConstraints}function subsetDomainByIndex(domain,constraints){constraints=normalizeIndexSubsetConstraints(domain,constraints);var newdomain={type:_constants.DOMAIN,profiles:domain.profiles,axes:new Map(domain.axes),referencing:domain.referencing},_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _loop=function _loop(){var axisName=_step2.value,axis=domain.axes.get(axisName),coords=axis.values,bounds=axis.bounds,constraint=constraints[axisName],newcoords=void 0,newbounds=void 0,start=constraint.start,stop=constraint.stop,step=constraint.step;if(0===start&&stop===coords.length&&1===step)newcoords=coords,newbounds=bounds;else if(1===step)newcoords=coords.subarray?coords.subarray(start,stop):coords.slice(start,stop),bounds&&(newbounds={get:function get(i){return bounds.get(start+i)}});else{var q=Math.trunc((stop-start)/step),r=(stop-start)%step,len=q+r;newcoords=new coords.constructor(len);for(var i=start,j=0;stop>i;i+=step,j++)newcoords[j]=coords[i];bounds&&(newbounds={get:function get(i){return bounds.get(start+i*step)}})}var newaxis={dataType:axis.dataType,components:axis.components,values:newcoords,bounds:newbounds};newdomain.axes.set(axisName,newaxis)},_iterator2=Object.keys(constraints)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0)_loop()}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}return newdomain}function subsetCoverageByIndex(cov,constraints){return cov.loadDomain().then(function(domain){constraints=normalizeIndexSubsetConstraints(domain,constraints);var newdomain=subsetDomainByIndex(domain,constraints),rangeWrapper=function rangeWrapper(range){var newrange={dataType:range.dataType,get:function get(obj){var newobj={},_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _iterator3=Object.keys(obj)[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var axisName=_step3.value,_constraints$axisName=constraints[axisName],_start=_constraints$axisName.start,_step4=_constraints$axisName.step;newobj[axisName]=_start+obj[axisName]*_step4}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}return range.get(newobj)}};newrange.shape=new Map;var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _iterator4=domain.axes.keys()[Symbol.iterator](),_step5;!(_iteratorNormalCompletion4=(_step5=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var axisName=_step5.value,size=newdomain.axes.get(axisName).values.length;newrange.shape.set(axisName,size)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4["return"]&&_iterator4["return"]()}finally{if(_didIteratorError4)throw _iteratorError4}}return newrange},loadRange=function loadRange(key){return cov.loadRange(key).then(rangeWrapper)},loadRanges=function loadRanges(keys){return cov.loadRanges(keys).then(function(ranges){return new Map([].concat(_toConsumableArray(ranges)).map(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],range=_ref2[1];return[key,rangeWrapper(range)]}))})},newcov={type:_constants.COVERAGE,profiles:cov.profiles,domainProfiles:cov.domainProfiles,parameters:cov.parameters,loadDomain:function loadDomain(){return Promise.resolve(newdomain)},loadRange:loadRange,loadRanges:loadRanges};return newcov.subsetByIndex=subsetCoverageByIndex.bind(null,newcov),newcov.subsetByValue=subsetCoverageByValue.bind(null,newcov),newcov})}function subsetCoverageByValue(cov,constraints){return cov.loadDomain().then(function(domain){var indexConstraints={},_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _iterator5=Object.keys(constraints)[Symbol.iterator](),_step6;!(_iteratorNormalCompletion5=(_step6=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var axisName=_step6.value,spec=constraints[axisName];if(void 0!==spec&&null!==spec&&domain.axes.has(axisName)){var axis=domain.axes.get(axisName),vals=axis.values,isISODate=(0,_referencing.isISODateAxis)(domain,axisName),isLongitude=(0,_referencing.isLongitudeAxis)(domain,axisName),lonWrapper=isLongitude?(0,_referencing.getLongitudeWrapper)(domain,axisName):void 0;if("number"==typeof spec||"string"==typeof spec||spec instanceof Date){var match=spec;isISODate?(match=(0,_referencing.asTime)(match),vals=vals.map(function(v){return new Date(v).getTime()})):isLongitude&&(match=lonWrapper(match));var i=void 0;if(i=vals.indexOf?vals.indexOf(match):Array.prototype.indexOf.call(vals,match),-1===i)throw new Error("Domain value not found: "+spec);indexConstraints[axisName]=i}else if("target"in spec){var target=spec.target;if(isISODate)target=(0,_referencing.asTime)(target),vals=vals.map(function(v){return new Date(v).getTime()});else if(isLongitude)target=lonWrapper(target);else if("number"!=typeof vals[0]||"number"!=typeof target)throw new Error("Invalid axis or constraint value type");var _i=(0,_array.indexOfNearest)(vals,target);indexConstraints[axisName]=_i}else{if(!("start"in spec&&"stop"in spec))throw new Error("Invalid subset constraints");var _start2=spec.start,_stop=spec.stop;if(isISODate){var _ref3=[(0,_referencing.asTime)(_start2),(0,_referencing.asTime)(_stop)];_start2=_ref3[0],_stop=_ref3[1],vals=vals.map(function(v){return new Date(v).getTime()})}else if(isLongitude){var _ref4=[lonWrapper(_start2),lonWrapper(_stop)];_start2=_ref4[0],_stop=_ref4[1]}else if("number"!=typeof vals[0]||"number"!=typeof _start2)throw new Error("Invalid axis or constraint value type");var _indicesOfNearest=(0,_array.indicesOfNearest)(vals,_start2),_indicesOfNearest2=_slicedToArray(_indicesOfNearest,2),lo1=_indicesOfNearest2[0],hi1=_indicesOfNearest2[1],_indicesOfNearest3=(0,_array.indicesOfNearest)(vals,_stop),_indicesOfNearest4=_slicedToArray(_indicesOfNearest3,2),lo2=_indicesOfNearest4[0],hi2=_indicesOfNearest4[1],imin=Math.min(lo1,hi1,lo2,hi2),imax=Math.max(lo1,hi1,lo2,hi2)+1;indexConstraints[axisName]={start:imin,stop:imax}}}}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5["return"]&&_iterator5["return"]()}finally{if(_didIteratorError5)throw _iteratorError5}}return cov.subsetByIndex(indexConstraints)})}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();exports.normalizeIndexSubsetConstraints=normalizeIndexSubsetConstraints,exports.subsetDomainByIndex=subsetDomainByIndex,exports.subsetCoverageByIndex=subsetCoverageByIndex,exports.subsetCoverageByValue=subsetCoverageByValue;var _referencing=require("./referencing.js"),_array=require("./array.js"),_constants=require("./constants.js")},{"./array.js":9,"./constants.js":10,"./referencing.js":11}],13:[function(require,module,exports){function compare1st(a,b){return a[0]-b[0]}function order(){var stride=this.stride,terms=new Array(stride.length),i;for(i=0;i<terms.length;++i)terms[i]=[Math.abs(stride[i]),i];terms.sort(compare1st);var result=new Array(terms.length);for(i=0;i<result.length;++i)result[i]=terms[i][1];return result}function compileConstructor(dtype,dimension){var className=["View",dimension,"d",dtype].join("");0>dimension&&(className="View_Nil"+dtype);var useGetters="generic"===dtype;if(-1===dimension){var code="function "+className+"(a){this.data=a;};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+className+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+className+"(a){return new "+className+"(a);}",procedure=new Function(code);return procedure()}if(0===dimension){var code="function "+className+"(a,d) {this.data = a;this.offset = d};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+className+"_copy() {return new "+className+"(this.data,this.offset)};proto.pick=function "+className+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+className+"_get(){return "+(useGetters?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+className+"_set(v){return "+(useGetters?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+className+"(a,b,c,d){return new "+className+"(a,d)}",procedure=new Function("TrivialArray",code);return procedure(CACHED_CONSTRUCTORS[dtype][0])}var code=["'use strict'"],indices=iota(dimension),args=indices.map(function(i){return"i"+i}),index_str="this.offset+"+indices.map(function(i){return"this.stride["+i+"]*i"+i}).join("+"),shapeArg=indices.map(function(i){return"b"+i}).join(","),strideArg=indices.map(function(i){return"c"+i}).join(",");code.push("function "+className+"(a,"+shapeArg+","+strideArg+",d){this.data=a","this.shape=["+shapeArg+"]","this.stride=["+strideArg+"]","this.offset=d|0}","var proto="+className+".prototype","proto.dtype='"+dtype+"'","proto.dimension="+dimension),code.push("Object.defineProperty(proto,'size',{get:function "+className+"_size(){return "+indices.map(function(i){return"this.shape["+i+"]"}).join("*"),"}})"),1===dimension?code.push("proto.order=[0]"):(code.push("Object.defineProperty(proto,'order',{get:"),4>dimension?(code.push("function "+className+"_order(){"),2===dimension?code.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===dimension&&code.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):code.push("ORDER})")),code.push("proto.set=function "+className+"_set("+args.join(",")+",v){"),useGetters?code.push("return this.data.set("+index_str+",v)}"):code.push("return this.data["+index_str+"]=v}"),code.push("proto.get=function "+className+"_get("+args.join(",")+"){"),useGetters?code.push("return this.data.get("+index_str+")}"):code.push("return this.data["+index_str+"]}"),code.push("proto.index=function "+className+"_index(",args.join(),"){return "+index_str+"}"),code.push("proto.hi=function "+className+"_hi("+args.join(",")+"){return new "+className+"(this.data,"+indices.map(function(i){return["(typeof i",i,"!=='number'||i",i,"<0)?this.shape[",i,"]:i",i,"|0"].join("")}).join(",")+","+indices.map(function(i){return"this.stride["+i+"]"}).join(",")+",this.offset)}");var a_vars=indices.map(function(i){return"a"+i+"=this.shape["+i+"]"}),c_vars=indices.map(function(i){return"c"+i+"=this.stride["+i+"]"});code.push("proto.lo=function "+className+"_lo("+args.join(",")+"){var b=this.offset,d=0,"+a_vars.join(",")+","+c_vars.join(","));for(var i=0;dimension>i;++i)code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){d=i"+i+"|0;b+=c"+i+"*d;a"+i+"-=d}");code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"c"+i}).join(",")+",b)}"),code.push("proto.step=function "+className+"_step("+args.join(",")+"){var "+indices.map(function(i){return"a"+i+"=this.shape["+i+"]"}).join(",")+","+indices.map(function(i){return"b"+i+"=this.stride["+i+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var i=0;dimension>i;++i)code.push("if(typeof i"+i+"==='number'){d=i"+i+"|0;if(d<0){c+=b"+i+"*(a"+i+"-1);a"+i+"=ceil(-a"+i+"/d)}else{a"+i+"=ceil(a"+i+"/d)}b"+i+"*=d}");code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"b"+i}).join(",")+",c)}");for(var tShape=new Array(dimension),tStride=new Array(dimension),i=0;dimension>i;++i)tShape[i]="a[i"+i+"]",tStride[i]="b[i"+i+"]";code.push("proto.transpose=function "+className+"_transpose("+args+"){"+args.map(function(n,idx){return n+"=("+n+"===undefined?"+idx+":"+n+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+className+"(this.data,"+tShape.join(",")+","+tStride.join(",")+",this.offset)}"),code.push("proto.pick=function "+className+"_pick("+args+"){var a=[],b=[],c=this.offset");for(var i=0;dimension>i;++i)code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){c=(c+this.stride["+i+"]*i"+i+")|0}else{a.push(this.shape["+i+"]);b.push(this.stride["+i+"])}");code.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),code.push("return function construct_"+className+"(data,shape,stride,offset){return new "+className+"(data,"+indices.map(function(i){return"shape["+i+"]"}).join(",")+","+indices.map(function(i){return"stride["+i+"]"}).join(",")+",offset)}");var procedure=new Function("CTOR_LIST","ORDER",code.join("\n"));return procedure(CACHED_CONSTRUCTORS[dtype],order)}function arrayDType(data){if(isBuffer(data))return"buffer";if(hasTypedArrays)switch(Object.prototype.toString.call(data)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(data)?"array":"generic"}function wrappedNDArrayCtor(data,shape,stride,offset){if(void 0===data){var ctor=CACHED_CONSTRUCTORS.array[0];return ctor([])}"number"==typeof data&&(data=[data]),void 0===shape&&(shape=[data.length]);var d=shape.length;if(void 0===stride){stride=new Array(d);for(var i=d-1,sz=1;i>=0;--i)stride[i]=sz,sz*=shape[i]}if(void 0===offset){offset=0;for(var i=0;d>i;++i)stride[i]<0&&(offset-=(shape[i]-1)*stride[i])}for(var dtype=arrayDType(data),ctor_list=CACHED_CONSTRUCTORS[dtype];ctor_list.length<=d+1;)ctor_list.push(compileConstructor(dtype,ctor_list.length-1));var ctor=ctor_list[d+1];return ctor(data,shape,stride,offset)}var iota=require("iota-array"),isBuffer=require("is-buffer"),hasTypedArrays="undefined"!=typeof Float64Array,CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};module.exports=wrappedNDArrayCtor},{"iota-array":14,"is-buffer":15}],14:[function(require,module,exports){"use strict";function iota(n){for(var result=new Array(n),i=0;n>i;++i)result[i]=i;return result}module.exports=iota},{}],15:[function(require,module,exports){module.exports=function(obj){return!(null==obj||!(obj._isBuffer||obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)))}},{}]},{},[6])(6)});
//# sourceMappingURL=covjson-reader.min.js.map
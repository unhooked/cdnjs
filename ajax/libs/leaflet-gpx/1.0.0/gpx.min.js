var _MAX_POINT_INTERVAL_MS=15e3,_SECOND_IN_MILLIS=1e3,_MINUTE_IN_MILLIS=60*_SECOND_IN_MILLIS,_HOUR_IN_MILLIS=60*_MINUTE_IN_MILLIS,_DEFAULT_MARKER_OPTS={startIconUrl:"pin-icon-start.png",endIconUrl:"pin-icon-end.png",shadowUrl:"pin-shadow.png",wptIconUrls:{},iconSize:[33,50],shadowSize:[50,50],iconAnchor:[16,45],shadowAnchor:[16,47]},_DEFAULT_POLYLINE_OPTS={color:"blue"},_DEFAULT_GPX_OPTS={parseElements:["track","route","waypoint"]};L.GPX=L.FeatureGroup.extend({initialize:function(t,e){e.max_point_interval=e.max_point_interval||_MAX_POINT_INTERVAL_MS,e.marker_options=this._merge_objs(_DEFAULT_MARKER_OPTS,e.marker_options||{}),e.polyline_options=this._merge_objs(_DEFAULT_POLYLINE_OPTS,e.polyline_options||{}),e.gpx_options=this._merge_objs(_DEFAULT_GPX_OPTS,e.gpx_options||{}),L.Util.setOptions(this,e),L.GPXTrackIcon=L.Icon.extend({options:e.marker_options}),this._gpx=t,this._layers={},this._info={name:null,length:0,elevation:{gain:0,loss:0,max:0,min:1/0,_points:[]},hr:{avg:0,_total:0,_points:[]},duration:{start:null,end:null,moving:0,total:0}},t&&this._parse(t,e,this.options.async)},get_duration_string:function(t,e){var n="";t>=_HOUR_IN_MILLIS&&(n+=Math.floor(t/_HOUR_IN_MILLIS)+":",t%=_HOUR_IN_MILLIS);var i=Math.floor(t/_MINUTE_IN_MILLIS);t%=_MINUTE_IN_MILLIS,10>i&&(n+="0"),n+=i+"'";var o=Math.floor(t/_SECOND_IN_MILLIS);return t%=_SECOND_IN_MILLIS,10>o&&(n+="0"),n+=o,n+=!e&&t>0?"."+Math.round(1e3*Math.floor(t))/1e3:'"'},to_miles:function(t){return t/1.60934},to_ft:function(t){return 3.28084*t},m_to_km:function(t){return t/1e3},m_to_mi:function(t){return t/1609.34},get_name:function(){return this._info.name},get_desc:function(){return this._info.desc},get_author:function(){return this._info.author},get_copyright:function(){return this._info.copyright},get_distance:function(){return this._info.length},get_distance_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))},get_start_time:function(){return this._info.duration.start},get_end_time:function(){return this._info.duration.end},get_moving_time:function(){return this._info.duration.moving},get_total_time:function(){return this._info.duration.total},get_moving_pace:function(){return this.get_moving_time()/this.m_to_km(this.get_distance())},get_moving_pace_imp:function(){return this.get_moving_time()/this.get_distance_imp()},get_moving_speed:function(){return this.m_to_km(this.get_distance())/(this.get_moving_time()/36e5)},get_moving_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_moving_time()/36e5)},get_total_speed:function(){return this.m_to_km(this.get_distance())/(this.get_total_time()/36e5)},get_total_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_total_time()/36e5)},get_elevation_gain:function(){return this._info.elevation.gain},get_elevation_loss:function(){return this._info.elevation.loss},get_elevation_data:function(){var t=this;return this._info.elevation._points.map(function(e){return t._prepare_data_point(e,t.m_to_km,null,function(t,e){return t.toFixed(2)+" km, "+e.toFixed(0)+" m"})})},get_elevation_data_imp:function(){var t=this;return this._info.elevation._points.map(function(e){return t._prepare_data_point(e,t.m_to_mi,t.to_ft,function(t,e){return t.toFixed(2)+" mi, "+e.toFixed(0)+" ft"})})},get_elevation_max:function(){return this._info.elevation.max},get_elevation_min:function(){return this._info.elevation.min},get_elevation_max_imp:function(){return this.to_miles(this.m_to_km(this.get_elevation_max()))},get_elevation_min_imp:function(){return this.to_miles(this.m_to_km(this.get_elevation_min()))},get_average_hr:function(){return this._info.hr.avg},get_heartrate_data:function(){var t=this;return this._info.hr._points.map(function(e){return t._prepare_data_point(e,t.m_to_km,null,function(t,e){return t.toFixed(2)+" km, "+e.toFixed(0)+" bpm"})})},get_heartrate_data_imp:function(){var t=this;return this._info.hr._points.map(function(e){return t._prepare_data_point(e,t.m_to_mi,null,function(t,e){return t.toFixed(2)+" mi, "+e.toFixed(0)+" bpm"})})},reload:function(){this.clearLayers(),this._parse(this._gpx,this.options,this.options.async)},_merge_objs:function(t,e){var n={};for(var i in t)n[i]=t[i];for(var i in e)n[i]=e[i];return n},_prepare_data_point:function(t,e,n,i){var o=[e&&e(t[0])||t[0],n&&n(t[1])||t[1]];return o.push(i&&i(o[0],o[1])||o[0]+": "+o[1]),o},_load_xml:function(t,e,n,i){void 0==i&&(i=this.options.async),void 0==n&&(n=this.options);var o=new window.XMLHttpRequest;o.open("GET",t,i);try{o.overrideMimeType("text/xml")}catch(a){}o.onreadystatechange=function(){4==o.readyState&&200==o.status&&e(o.responseXML,n)},o.send(null)},_parse:function(t,e,n){var i=this,o=function(t,e){var n=i._parse_gpx_data(t,e);n&&(i.addLayer(n),i.fire("loaded"))};if("<"===t.substr(0,1)){var a=new DOMParser;setTimeout(function(){o(a.parseFromString(t,"text/xml"),e)})}else this._load_xml(t,o,e,n)},_parse_gpx_data:function(t,e){var n,i,o,a=[],r=[],_=e.gpx_options.parseElements;_.indexOf("route")>-1&&r.push(["rte","rtept"]),_.indexOf("track")>-1&&r.push(["trkseg","trkpt"]);var s=t.getElementsByTagName("name");s.length>0&&(this._info.name=s[0].textContent);var h=t.getElementsByTagName("desc");h.length>0&&(this._info.desc=h[0].textContent);var l=t.getElementsByTagName("author");l.length>0&&(this._info.author=l[0].textContent);var m=t.getElementsByTagName("copyright");for(m.length>0&&(this._info.copyright=m[0].textContent),n=0;n<r.length;n++)for(o=t.getElementsByTagName(r[n][0]),i=0;i<o.length;i++){var u=this._parse_trkseg(o[i],t,e,r[n][1]);if(0!==u.length){var g=new L.Polyline(u,e.polyline_options);if(this.fire("addline",{line:g}),a.push(g),e.marker_options.startIconUrl){var p=new L.Marker(u[0],{clickable:!1,icon:new L.GPXTrackIcon({iconUrl:e.marker_options.startIconUrl})});this.fire("addpoint",{point:p}),a.push(p)}e.marker_options.endIconUrl&&(p=new L.Marker(u[u.length-1],{clickable:!1,icon:new L.GPXTrackIcon({iconUrl:e.marker_options.endIconUrl})}),this.fire("addpoint",{point:p}),a.push(p))}}if(this._info.hr.avg=Math.round(this._info.hr._total/this._info.hr._points.length),_.indexOf("waypoint")>-1)for(o=t.getElementsByTagName("wpt"),i=0;i<o.length;i++){var f=new L.LatLng(o[i].getAttribute("lat"),o[i].getAttribute("lon")),c=o[i].getElementsByTagName("name");s="",c.length>0&&(s=c[0].textContent);var d=o[i].getElementsByTagName("desc");h="",d.length>0&&(h=d[0].textContent);var v=o[i].getElementsByTagName("sym"),I="";v.length>0&&(I=v[0].textContent);var M=e.marker_options.wptIconUrls[I],x=new L.Marker(f,{clickable:!0,title:s,icon:M?new L.GPXTrackIcon({iconUrl:M}):new L.Icon.Default});x.bindPopup("<b>"+s+"</b>"+(h.length>0?"<br>"+h:"")).openPopup(),this.fire("addpoint",{point:x}),a.push(x)}if(a.length){var N=a[0];return a.length>1&&(N=new L.FeatureGroup(a)),N}},_parse_trkseg:function(t,e,n,i){var o=t.getElementsByTagName(i);if(!o.length)return[];for(var a=[],r=null,_=0;_<o.length;_++){var s,h=new L.LatLng(o[_].getAttribute("lat"),o[_].getAttribute("lon"));if(h.meta={time:null,ele:null,hr:null},s=o[_].getElementsByTagName("time"),s.length>0&&(h.meta.time=new Date(Date.parse(s[0].textContent))),s=o[_].getElementsByTagName("ele"),s.length>0&&(h.meta.ele=parseFloat(s[0].textContent)),s=o[_].getElementsByTagNameNS("*","hr"),s.length>0&&(h.meta.hr=parseInt(s[0].textContent),this._info.hr._points.push([this._info.length,h.meta.hr]),this._info.hr._total+=h.meta.hr),h.meta.ele>this._info.elevation.max&&(this._info.elevation.max=h.meta.ele),h.meta.ele<this._info.elevation.min&&(this._info.elevation.min=h.meta.ele),this._info.elevation._points.push([this._info.length,h.meta.ele]),this._info.duration.end=h.meta.time,null!=r){this._info.length+=this._dist3d(r,h);var l=h.meta.ele-r.meta.ele;l>0?this._info.elevation.gain+=l:this._info.elevation.loss+=Math.abs(l),l=Math.abs(h.meta.time-r.meta.time),this._info.duration.total+=l,l<n.max_point_interval&&(this._info.duration.moving+=l)}else this._info.duration.start=h.meta.time;r=h,a.push(h)}return a},_dist2d:function(t,e){var n=6371e3,i=this._deg2rad(e.lat-t.lat),o=this._deg2rad(e.lng-t.lng),a=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this._deg2rad(t.lat))*Math.cos(this._deg2rad(e.lat))*Math.sin(o/2)*Math.sin(o/2),r=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),_=n*r;return _},_dist3d:function(t,e){var n=this._dist2d(t,e),i=Math.abs(e.meta.ele-t.meta.ele);return Math.sqrt(Math.pow(n,2)+Math.pow(i,2))},_deg2rad:function(t){return t*Math.PI/180}});
//# sourceMappingURL=gpx.min.js.map
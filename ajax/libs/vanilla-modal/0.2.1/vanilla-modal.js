/**
 * @name vanilla-modal
 * @version 0.2.0
 * @author Ben Ceglowski
 * @url http://phuse.ca
 * @date 2015-01-23
 * @license MIT
 */;!function(a,b,c){"use strict";var d,e=function(a){d=this,d.userOptions=a||{},d.settings={modal:".modal",modalInner:".modal-inner",modalContent:".modal-content",open:'[rel="modal:open"]',close:'[rel="modal:close"]',parent:"body","class":"modal-visible",href:!1,clickOutside:!1,transitions:!0,onBeforeOpen:function(){},onBeforeClose:function(){},onOpen:function(){},onClose:function(){}},d.DOM={},d.isOpen=!1,d.transitionEnd=null;try{d.sniffTransitionEnd(),d.bootstrap(),d.prepareDOM(),d.addParentAttr(),d.attachEvents()}catch(b){}return this};e.prototype={sniffTransitionEnd:function(){var a=b.createElement("div"),e={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var f in e)if(e.hasOwnProperty(f)&&a.style[f]!==c)return d.transitionEnd=e[f]},bootstrap:function(){if("object"==typeof d.userOptions)for(var a in d.userOptions)d.settings[a]=d.userOptions[a]},prepareDOM:function(){d.DOM.modal=b.querySelector(d.settings.modal),d.DOM.modalInner=d.DOM.modal.querySelector(d.settings.modalInner),d.DOM.modalContent=d.DOM.modal.querySelector(d.settings.modalContent),d.DOM.open=b.querySelectorAll(d.settings.open),d.DOM.close=b.querySelectorAll(d.settings.close),d.DOM.parent=b.querySelector(d.settings.parent)},addParentAttr:function(){d.DOM.parent.setAttribute("data-gets-modal","")},addClass:function(a,b){if(!(!a instanceof HTMLElement)){var c=a.className.split(" ");-1===c.indexOf(b)&&c.push(b),a.className=c.join(" ")}},removeClass:function(a,b){if(!(!a instanceof HTMLElement)){var c=a.className.split(" ");c.indexOf(b)>-1&&c.splice(c.indexOf(b),1),a.className=c.join(" ")}},open:function(a){if("string"==typeof a)d.settings.href=b.querySelector(a);else if(a instanceof MouseEvent&&"string"==typeof this.hash)d.settings.href=b.querySelector(this.hash),a.preventDefault();else{if("undefined"==typeof d.settings.href)return;if("string"==typeof d.settings.href&&(d.settings.href=b.querySelector(d.settings.href)),!d.settings.href||!d.settings.href.length||!d.settings.href instanceof HTMLElement)return}"function"==typeof d.settings.onBeforeOpen&&d.settings.onBeforeOpen.bind(d),d.acquireDOMNode(),d.addClass(d.DOM.parent,d.settings["class"]);var c=d.settings.href.id?d.settings.href.id:"anonymous";return d.DOM.parent.setAttribute("data-current-modal",c),d.isOpen=!0,"function"==typeof d.settings.onOpen&&d.settings.onOpen.bind(d),d},close:function(a){return a&&a.preventDefault(),"function"==typeof d.settings.onBeforeClose&&d.settings.onBeforeClose.bind(d),d.removeClass(d.DOM.parent,d.settings["class"]),d.transitionEnd&&d.settings.transitions!==!1?d.closeWithTransition():d.closeWithoutTransition(),d},transitionHandler:function(){d.DOM.modal.removeEventListener(d.transitionEnd,d.transitionHandler,!1),d.DOM.parent.removeAttribute("data-current-modal"),d.returnDOMNode(),d.isOpen=!1,"function"==typeof d.settings.onClose&&d.settings.onClose.bind(d)},closeWithTransition:function(){d.DOM.modal.addEventListener(d.transitionEnd,d.transitionHandler,!1)},closeWithoutTransition:function(){d.DOM.parent.removeAttribute("data-current-modal"),d.returnDOMNode(),d.isOpen=!1,"function"==typeof d.settings.onClose&&d.settings.onClose.bind(d)},acquireDOMNode:function(){if(d.settings.href)for(;d.settings.href.childNodes.length>0;)d.DOM.modalContent.appendChild(d.settings.href.childNodes[0])},returnDOMNode:function(){if(d.settings.href)for(;d.DOM.modalContent.childNodes.length>0;)d.settings.href.appendChild(d.DOM.modalContent.childNodes[0])},detectEscapeKey:function(a){27===a.keyCode&&d.isOpen===!0&&(a.preventDefault(),d.close())},modalClickHandler:function(a){for(var c=a.target;c!=b.body;){if(c===d.DOM.modalInner)return;c=c.parentNode}d.close()},attachEvents:function(){for(var a=0;a<d.DOM.open.length;a++)!function(a){d.DOM.open[a].addEventListener("click",d.open,!1)}(a);for(var a=0;a<d.DOM.close.length;a++)!function(a){d.DOM.close[a].addEventListener("click",d.close,!1)}(a);d.settings.clickOutside===!0&&d.DOM.modal.addEventListener("click",d.modalClickHandler,!1),b.addEventListener("keydown",d.detectEscapeKey,!1)},destroy:function(){d.close();for(var a=0;a<d.DOM.open.length;a++)!function(a){d.DOM.open[a].removeEventListener("click",d.open)}(a);for(var a=0;a<d.DOM.close.length;a++)!function(a){d.DOM.close[a].addEventListener("click",d.close)}(a);d.settings.clickOutside===!0&&d.DOM.modal.removeEventListener("click",d.modalClickHandler),b.removeEventListener("keydown",d.detectEscapeKey)}},"function"==typeof define&&define.amd?define("VanillaModal",function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:a.VanillaModal=e}(window,document);
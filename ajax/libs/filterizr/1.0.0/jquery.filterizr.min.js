!function(t,i){if(!i)throw Error("Filterizr requires jQuery to work.");var r=function(t){this.init(t)};r.prototype={init:function(t){this.root={x:0,y:0,w:t}},fit:function(t){var i,r,e,n=t.length;for(this.root.h=n>0?t[0].h:0,i=0;n>i;i++)e=t[i],(r=this.findNode(this.root,e.w,e.h))?e.fit=this.splitNode(r,e.w,e.h):e.fit=this.growDown(e.w,e.h)},findNode:function(t,i,r){return t.used?this.findNode(t.right,i,r)||this.findNode(t.down,i,r):i<=t.w&&r<=t.h?t:null},splitNode:function(t,i,r){return t.used=!0,t.down={x:t.x,y:t.y+r,w:t.w,h:t.h-r},t.right={x:t.x+i,y:t.y,w:t.w-i,h:r},t},growDown:function(t,i){var r;return this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+i,down:{x:0,y:this.root.h,w:this.root.w,h:i},right:this.root},(r=this.findNode(this.root,t,i))?this.splitNode(r,t,i):null}},i.fn.filterizr=function(){var t=arguments;if(this._fltr||(this._fltr=i.fn.filterizr.prototype.init(this.selector,"object"==typeof t[0]?t[0]:void 0)),"string"==typeof t[0]){if(-1<t[0].lastIndexOf("_"))throw Error("Filterizr error: You cannot call private methods");if("function"!=typeof this._fltr[t[0]])throw Error("Filterizr error: There is no such function");this._fltr[t[0]](t[1],t[2])}return this},i.fn.filterizr.prototype={init:function(t,r){var e=i(t).extend(i.fn.filterizr.prototype);return e.options={animationDuration:.5,callbacks:{onFilteringStart:function(){},onFilteringEnd:function(){}},delay:0,delayMode:"progressive",easing:"ease-out",filter:"all",filterOutCss:{opacity:0,transform:"scale(0.5)"},filterInCss:{opacity:1,transform:"scale(1)"},layout:"sameSize",selector:"string"==typeof t?t:".filtr-container",setupControls:!0},0===arguments.length&&(t=e.options.selector,r=e.options),1===arguments.length&&"object"==typeof arguments[0]&&(r=arguments[0]),r&&e.setOptions(r),e.css({padding:0,position:"relative"}),e._lastCategory=0,e._isAnimating=!1,e._mainArray=e._getFiltrItems(),e._subArrays=e._makeSubarrays(),e._activeArray=e._getCollectionByFilter(e.options.filter),e._uID="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=16*Math.random()|0;return("x"==t?i:3&i|8).toString(16)}),e._setupEvents(),e.options.setupControls&&e._setupControls(),e.filter(e.options.filter),e},filter:function(t){var i=this._getCollectionByFilter(t);this.options.filter=t,this.trigger("filteringStart"),t=this._getArrayOfUniqueItems(this._activeArray,i);for(var r=0;r<t.length;r++)t[r]._filterOut();this._activeArray=i,this._placeItems(i)},shuffle:function(){this._mainArray=this._fisherYatesShuffle(this._mainArray),this._subArrays=this._makeSubarrays(),this._placeItems(this._getCollectionByFilter(this.options.filter))},sort:function(t,i){this._mainArray.sort(this._comparator(t||"domIndex",i||"asc")),this._subArrays=this._makeSubarrays(),this._placeItems(this._getCollectionByFilter(this.options.filter))},setOptions:function(t){var i,r=0;for(i in t)this.options[i]=t[i];if(this._mainArray&&(t.animationDuration||t.delay||t.easing||t.delayMode))for(r=0;r<this._mainArray.length;r++)this._mainArray[r].css("transition","all "+this.options.animationDuration+"s "+this.options.easing+" "+this._mainArray[r]._calcDelay()+"ms");this.options.filterInCss.transform||(this.options.filterInCss.transform="translate3d(0,0,0)"),this.options.filterOutCss.transform||(this.options.filterOutCss.transform="translate3d(0,0,0)")},_getFiltrItems:function(){var t=this,r=i(t.find(".filtr-item")),n=[];return i.each(r,function(r,o){var s=i(o).extend(e)._init(r,t);n.push(s)}),n},_makeSubarrays:function(){for(var t=[],i=0;i<this._lastCategory;i++)t.push([]);for(i=0;i<this._mainArray.length;i++)if("object"==typeof this._mainArray[i]._category)for(var r in this._mainArray[i]._category)t[this._mainArray[i]._category[r]-1].push(this._mainArray[i]);else t[this._mainArray[i]._category-1].push(this._mainArray[i]);return t},_setupControls:function(){var t=this;i("*[data-filter]").click(function(){var r=i(this).data("filter");t.options.filter!==r&&t.filter(r)}),i("*[data-shuffle]").click(function(){t.shuffle()}),i("*[data-sortAsc]").click(function(){var r=i("*[data-sortOrder]").val();t.sort(r,"asc")}),i("*[data-sortDesc]").click(function(){var r=i("*[data-sortOrder]").val();t.sort(r,"desc")})},_setupEvents:function(){var r=this;i(t).resize(function(){r._delayEvent(function(){r.trigger("resizeFiltrContainer")},250,r._uID)}),r.on("resizeFiltrContainer",function(){r.filter(r.options.filter)}).on("filteringStart",function(){r.options.callbacks.onFilteringStart()}).on("filteringEnd",function(){r.options.callbacks.onFilteringEnd()})},_calcItemPositions:function(){var t=this._activeArray,e=0,n=Math.round(this.width()/this.find(".filtr-item").outerWidth()),o=0,s=t[0].outerWidth(),a=0,h=0,l=0,f=0,a=0,u=[];if("packed"===this.options.layout){for(i.each(this._activeArray,function(t,i){i._updateDimensions()}),e=new r(this.outerWidth()),e.fit(this._activeArray),f=0;f<t.length;f++)u.push({left:t[f].fit.x,top:t[f].fit.y});e=e.root.h}if("horizontal"===this.options.layout)for(f=o=1;f<=t.length;f++)s=t[f-1].outerWidth(),a=t[f-1].outerHeight(),u.push({left:h,top:l}),h+=s,a>e&&(e=a);else if("vertical"===this.options.layout){for(f=1;f<=t.length;f++)a=t[f-1].outerHeight(),u.push({left:h,top:l}),l+=a;e=l}else if("sameHeight"===this.options.layout){for(o=1,n=this.outerWidth(),f=1;f<=t.length;f++)s=t[f-1].width(),e=t[f-1].outerWidth(),a=0,t[f]&&(a=t[f].width()),u.push({left:h,top:l}),a=h+s+a,a>n?(h=a=0,l+=t[0].outerHeight(),o++):h+=e;e=o*t[0].outerHeight()}else if("sameWidth"===this.options.layout){for(f=1;f<=t.length;f++){if(u.push({left:h,top:l}),0===f%n&&o++,h+=s,l=0,o>0)for(a=o;a>0;)l+=t[f-n*a].outerHeight(),a--;0===f%n&&(h=0)}for(f=0;n>f;f++){for(o=0,s=f;t[s];)o+=t[s].outerHeight(),s+=n;o>e&&(e=o),o=0}}else if("sameSize"===this.options.layout){for(f=1;f<=t.length;f++)u.push({left:h,top:l}),h+=s,0===f%n&&(l+=t[0].outerHeight(),h=0);o=Math.ceil(t.length/n),e=o*t[0].outerHeight()}return this.css("height",e),u},_placeItems:function(t){this._isAnimating=!0,this._itemPositions=this._calcItemPositions();for(var i=0;i<t.length;i++)t[i]._filterIn(this._itemPositions[i])},_getCollectionByFilter:function(t){return"all"===t?this._mainArray:this._subArrays[t-1]},_makeDeepCopy:function(t){var i,r={};for(i in t)r[i]=t[i];return r},_comparator:function(t,i){return function(r,e){return"asc"===i?r[t]<e[t]?-1:r[t]>e[t]?1:0:"desc"===i?e[t]<r[t]?-1:e[t]>r[t]?1:0:void 0}},_getArrayOfUniqueItems:function(t,i){var r,e,n=[],o={},s=i.length;for(r=0;s>r;r++)o[i[r].domIndex]=!0;for(s=t.length,r=0;s>r;r++)e=t[r],e.domIndex in o||n.push(e);return n},_delayEvent:function(){var t={};return function(i,r,e){if(null===e)throw Error("UniqueID needed");t[e]&&clearTimeout(t[e]),t[e]=setTimeout(i,r)}}(),_fisherYatesShuffle:function(t){for(var i,r,e=t.length;e;)r=Math.floor(Math.random()*e--),i=t[e],t[e]=t[r],t[r]=i;return t}};var e={_init:function(t,i){var r=this;return r._parent=i,r._category=r._getCategory(),r._lastPos={},r.domIndex=t,r.sortData=r.data("sort"),r.w=0,r.h=0,r._isFilteredOut=!0,r._filteringOut=!1,r._filteringIn=!1,r.css(i.options.filterOutCss).css({"-webkit-backface-visibility":"hidden",perspective:"1000px","-webkit-perspective":"1000px","-webkit-transform-style":"preserve-3d",position:"absolute",transition:"all "+i.options.animationDuration+"s "+i.options.easing+" "+r._calcDelay()+"ms"}),r.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){r._onTransitionEnd()}),r},_updateDimensions:function(){this.w=this.outerWidth(),this.h=this.outerHeight()},_calcDelay:function(){var t=0;return"progressive"===this._parent.options.delayMode?t=this._parent.options.delay*this.domIndex:0===this.domIndex%2&&(t=this._parent.options.delay),t},_getCategory:function(){var t=this.data("category");if("string"==typeof t){var i,t=t.split(", ");for(i in t)t[i]>this._parent._lastCategory&&(this._parent._lastCategory=t[i])}else t>this._parent._lastCategory&&(this._parent._lastCategory=t);return t},_onTransitionEnd:function(){this._filteringOut?(this._isFilteredOut=!0,this._filteringOut=!1):this._filteringIn&&(this._filteringIn=this._isFilteredOut=!1),this._parent._isAnimating&&(this._parent.trigger("filteringEnd"),this._parent._isAnimating=!1)},_filterOut:function(){var t=this._parent._makeDeepCopy(this._parent.options.filterOutCss);t.transform+=" translate3d("+this._lastPos.left+"px,"+this._lastPos.top+"px, 0)",this.css(t),this._filteringOut=!0},_filterIn:function(t){var i=this._parent._makeDeepCopy(this._parent.options.filterInCss);this._filteringIn=!0,this._lastPos=t,i.transform+=" translate3d("+t.left+"px,"+t.top+"px, 0)",this.css(i)}}}(this,jQuery);

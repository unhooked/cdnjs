+function(e){function t(e){return"%"==e[e.length-1]}function r(){var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl"),r=t&&t.getExtension("OES_texture_float");return r}function i(e,t,r){function i(e,t){var r=s.createShader(e);if(s.shaderSource(r,t),s.compileShader(r),!s.getShaderParameter(r,s.COMPILE_STATUS))throw new Error("compile error: "+s.getShaderInfoLog(r));return r}var o={};if(o.id=s.createProgram(),s.attachShader(o.id,i(s.VERTEX_SHADER,e)),s.attachShader(o.id,i(s.FRAGMENT_SHADER,t)),s.linkProgram(o.id),!s.getProgramParameter(o.id,s.LINK_STATUS))throw new Error("link error: "+s.getProgramInfoLog(o.id));o.uniforms={},o.locations={},s.useProgram(o.id),s.enableVertexAttribArray(0);for(var n,a=/uniform (\w+) (\w+)/g,u=e+t;null!=(match=a.exec(u));)n=match[2],o.locations[n]=s.getUniformLocation(o.id,n);return o}function o(e,t){s.activeTexture(s.TEXTURE0+(t||0)),s.bindTexture(s.TEXTURE_2D,e)}function n(e){var t=/url\(["']?([^"']*)["']?\)/.exec(e.css("background-image"));return null==t?null:t[1]}function a(e){return e.match(/^data:/)}var s,u=e(window),h=r();e("head").prepend("<style>.jquery-ripples { position: relative; z-index: 0; }</style>");var d=function(t,r){function i(){o.step(),requestAnimationFrame(i)}var o=this;this.$el=e(t),this.$el.addClass("jquery-ripples");var u=n(this.$el);if(u){this.interactive=r.interactive,this.resolution=r.resolution||256,this.textureDelta=new Float32Array([1/this.resolution,1/this.resolution]),this.perturbance=r.perturbance,this.dropRadius=r.dropRadius;var h=document.createElement("canvas");h.width=this.$el.innerWidth(),h.height=this.$el.innerHeight(),this.canvas=h,this.$canvas=e(h),this.$canvas.css({position:"absolute",left:0,top:0,right:0,bottom:0,zIndex:-1}),this.$el.append(h),this.context=s=h.getContext("webgl")||h.getContext("experimental-webgl"),s.getExtension("OES_texture_float");var d=s.getExtension("OES_texture_float_linear");e(window).on("resize",function(){o.$el.innerWidth()==o.canvas.width&&o.$el.innerHeight()==o.canvas.height||(h.width=o.$el.innerWidth(),h.height=o.$el.innerHeight())}),this.$el.on("mousemove.ripples",function(e){o.visible&&o.running&&o.interactive&&o.dropAtMouse(e,o.dropRadius,.01)}).on("mousedown.ripples",function(e){o.visible&&o.running&&o.interactive&&o.dropAtMouse(e,1.5*o.dropRadius,.14)}),this.textures=[],this.framebuffers=[];for(var c=0;2>c;c++){var f=s.createTexture(),l=s.createFramebuffer();if(s.bindFramebuffer(s.FRAMEBUFFER,l),l.width=this.resolution,l.height=this.resolution,s.bindTexture(s.TEXTURE_2D,f),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,d?s.LINEAR:s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,d?s.LINEAR:s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.resolution,this.resolution,0,s.RGBA,s.FLOAT,null),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,f,0),s.checkFramebufferStatus(s.FRAMEBUFFER)!=s.FRAMEBUFFER_COMPLETE)throw new Error("Rendering to this texture is not supported (incomplete framebuffer)");s.bindTexture(s.TEXTURE_2D,null),s.bindFramebuffer(s.FRAMEBUFFER,null),this.textures.push(f),this.framebuffers.push(l)}this.running=!0,this.quad=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.quad),s.bufferData(s.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),s.STATIC_DRAW),this.initShaders();var g=new Image;g.crossOrigin=a(u)?null:r.crossOrigin||"",g.onload=function(){function e(e){return 0==(e&e-1)}s=o.context;var t=e(g.width)&&e(g.height)?s.REPEAT:s.CLAMP_TO_EDGE;o.backgroundWidth=g.width,o.backgroundHeight=g.height;var r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,1),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,t),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,g),o.backgroundTexture=r,o.$el.css("backgroundImage","none")},g.src=u,this.visible=!0,s.clearColor(0,0,0,0),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),requestAnimationFrame(i)}};d.DEFAULTS={resolution:256,dropRadius:20,perturbance:.03,interactive:!0,crossOrigin:""},d.prototype={step:function(){s=this.context,this.visible&&this.backgroundTexture&&(this.computeTextureBoundaries(),this.running&&this.update(),this.render())},drawQuad:function(){s.bindBuffer(s.ARRAY_BUFFER,this.quad),s.vertexAttribPointer(0,2,s.FLOAT,!1,0,0),s.drawArrays(s.TRIANGLE_FAN,0,4)},render:function(){s.viewport(0,0,this.canvas.width,this.canvas.height),s.enable(s.BLEND),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.useProgram(this.renderProgram.id),o(this.backgroundTexture,0),o(this.textures[0],1),s.uniform1f(this.renderProgram.locations.perturbance,this.perturbance),s.uniform2fv(this.renderProgram.locations.topLeft,this.renderProgram.uniforms.topLeft),s.uniform2fv(this.renderProgram.locations.bottomRight,this.renderProgram.uniforms.bottomRight),s.uniform2fv(this.renderProgram.locations.containerRatio,this.renderProgram.uniforms.containerRatio),s.uniform1i(this.renderProgram.locations.samplerBackground,0),s.uniform1i(this.renderProgram.locations.samplerRipples,1),this.drawQuad(),s.disable(s.BLEND)},update:function(){s.viewport(0,0,this.resolution,this.resolution);for(var e=0;2>e;e++)s.bindFramebuffer(s.FRAMEBUFFER,this.framebuffers[e]),o(this.textures[1-e]),s.useProgram(this.updateProgram[e].id),this.drawQuad();s.bindFramebuffer(s.FRAMEBUFFER,null)},computeTextureBoundaries:function(){var e=this.$el.css("background-size"),r=this.$el.css("background-attachment"),i=this.$el.css("background-position").split(" "),o="fixed"==r?u:this.$el,n=o.offset()||{left:pageXOffset,top:pageYOffset},a=o.innerWidth(),s=o.innerHeight();if("cover"==e)var h=Math.max(a/this.backgroundWidth,s/this.backgroundHeight),d=this.backgroundWidth*h,c=this.backgroundHeight*h;else if("contain"==e)var h=Math.min(a/this.backgroundWidth,s/this.backgroundHeight),d=this.backgroundWidth*h,c=this.backgroundHeight*h;else{e=e.split(" ");var d=e[0]||"",c=e[1]||d;t(d)?d=a*parseFloat(d)/100:"auto"!=d&&(d=parseFloat(d)),t(c)?c=s*parseFloat(c)/100:"auto"!=c&&(c=parseFloat(c)),"auto"==d&&"auto"==c?(d=this.backgroundWidth,c=this.backgroundHeight):("auto"==d&&(d=this.backgroundWidth*(c/this.backgroundHeight)),"auto"==c&&(c=this.backgroundHeight*(d/this.backgroundWidth)))}var f=i[0]||"",l=i[1]||f;f="left"==f?n.left:"center"==f?n.left+a/2-d/2:"right"==f?n.left+a-d:t(f)?n.left+(a-d)*parseFloat(f)/100:parseFloat(f),l="top"==l?n.top:"center"==l?n.top+s/2-c/2:"bottom"==l?n.top+s-c:t(l)?n.top+(s-c)*parseFloat(l)/100:parseFloat(l);var g=this.$el.offset();this.renderProgram.uniforms.topLeft=new Float32Array([(g.left-f)/d,(g.top-l)/c]),this.renderProgram.uniforms.bottomRight=new Float32Array([this.renderProgram.uniforms.topLeft[0]+this.$el.innerWidth()/d,this.renderProgram.uniforms.topLeft[1]+this.$el.innerHeight()/c]);var p=Math.max(this.canvas.width,this.canvas.height);this.renderProgram.uniforms.containerRatio=new Float32Array([this.canvas.width/p,this.canvas.height/p])},initShaders:function(){var e=["attribute vec2 vertex;","varying vec2 coord;","void main() {","coord = vertex * 0.5 + 0.5;","gl_Position = vec4(vertex, 0.0, 1.0);","}"].join("\n");this.dropProgram=i(e,["precision highp float;","const float PI = 3.141592653589793;","uniform sampler2D texture;","uniform vec2 center;","uniform float radius;","uniform float strength;","varying vec2 coord;","void main() {","vec4 info = texture2D(texture, coord);","float drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / radius);","drop = 0.5 - cos(drop * PI) * 0.5;","info.r += drop * strength;","gl_FragColor = info;","}"].join("\n")),this.updateProgram=[0,0],this.updateProgram[0]=i(e,["precision highp float;","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 coord;","void main() {","vec4 info = texture2D(texture, coord);","vec2 dx = vec2(delta.x, 0.0);","vec2 dy = vec2(0.0, delta.y);","float average = (","texture2D(texture, coord - dx).r +","texture2D(texture, coord - dy).r +","texture2D(texture, coord + dx).r +","texture2D(texture, coord + dy).r",") * 0.25;","info.g += (average - info.r) * 2.0;","info.g *= 0.995;","info.r += info.g;","gl_FragColor = info;","}"].join("\n")),s.uniform2fv(this.updateProgram[0].locations.delta,this.textureDelta),this.updateProgram[1]=i(e,["precision highp float;","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 coord;","void main() {","vec4 info = texture2D(texture, coord);","vec3 dx = vec3(delta.x, texture2D(texture, vec2(coord.x + delta.x, coord.y)).r - info.r, 0.0);","vec3 dy = vec3(0.0, texture2D(texture, vec2(coord.x, coord.y + delta.y)).r - info.r, delta.y);","info.ba = normalize(cross(dy, dx)).xz;","gl_FragColor = info;","}"].join("\n")),s.uniform2fv(this.updateProgram[1].locations.delta,this.textureDelta),this.renderProgram=i(["precision highp float;","attribute vec2 vertex;","uniform vec2 topLeft;","uniform vec2 bottomRight;","uniform vec2 containerRatio;","varying vec2 ripplesCoord;","varying vec2 backgroundCoord;","void main() {","backgroundCoord = mix(topLeft, bottomRight, vertex * 0.5 + 0.5);","backgroundCoord.y = 1.0 - backgroundCoord.y;","ripplesCoord = vec2(vertex.x, -vertex.y) * containerRatio * 0.5 + 0.5;","gl_Position = vec4(vertex.x, -vertex.y, 0.0, 1.0);","}"].join("\n"),["precision highp float;","uniform sampler2D samplerBackground;","uniform sampler2D samplerRipples;","uniform float perturbance;","varying vec2 ripplesCoord;","varying vec2 backgroundCoord;","void main() {","vec2 offset = -texture2D(samplerRipples, ripplesCoord).ba;","float specular = pow(max(0.0, dot(offset, normalize(vec2(-0.6, 1.0)))), 4.0);","gl_FragColor = texture2D(samplerBackground, backgroundCoord + offset * perturbance) + specular;","}"].join("\n"))},dropAtMouse:function(e,t,r){this.drop(e.pageX-this.$el.offset().left,e.pageY-this.$el.offset().top,t,r)},drop:function(e,t,r,i){s=this.context;var n=this.$el.outerWidth(),a=this.$el.outerHeight(),u=Math.max(n,a);r/=u;var h=new Float32Array([(2*e-n)/u,(a-2*t)/u]);s.viewport(0,0,this.resolution,this.resolution),s.bindFramebuffer(s.FRAMEBUFFER,this.framebuffers[0]),o(this.textures[1]),s.useProgram(this.dropProgram.id),s.uniform2fv(this.dropProgram.locations.center,h),s.uniform1f(this.dropProgram.locations.radius,r),s.uniform1f(this.dropProgram.locations.strength,i),this.drawQuad();var d=this.framebuffers[0];this.framebuffers[0]=this.framebuffers[1],this.framebuffers[1]=d,d=this.textures[0],this.textures[0]=this.textures[1],this.textures[1]=d,s.bindFramebuffer(s.FRAMEBUFFER,null)},destroy:function(){this.canvas.remove(),this.$el.off(".ripples"),this.$el.css("backgroundImage",""),this.$el.removeClass("jquery-ripples").removeData("ripples")},show:function(){this.$canvas.show(),this.$el.css("backgroundImage","none"),this.visible=!0},hide:function(){this.$canvas.hide(),this.$el.css("backgroundImage",""),this.visible=!1},pause:function(){this.running=!1},play:function(){this.running=!0},set:function(e,t){switch(e){case"dropRadius":case"perturbance":case"interactive":this[e]=t}}};var c=e.fn.ripples;e.fn.ripples=function(t){if(!h)throw new Error("Your browser does not support WebGL or the OES_texture_float extension.");var r=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;return this.each(function(){var i=e(this),o=i.data("ripples"),n=e.extend({},d.DEFAULTS,i.data(),"object"==typeof t&&t);(o||"string"!=typeof t)&&(o?"string"==typeof t&&d.prototype[t].apply(o,r):i.data("ripples",o=new d(this,n)))})},e.fn.ripples.Constructor=d,e.fn.ripples.noConflict=function(){return e.fn.ripples=c,this}}(window.jQuery);
//# sourceMappingURL=jquery.ripples.min.js.map
/*!
* js-data
* @version 3.0.0-beta.6 - Homepage <http://www.js-data.io/>
* @author js-data project authors
* @copyright (c) 2014-2016 js-data project authors
* @license MIT <https://github.com/js-data/js-data/blob/master/LICENSE>
*
* @overview js-data is a framework-agnostic, datastore-agnostic ORM/ODM for Node.js and the Browser.
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("js-data",["exports"],t):t(e.JSData=e.JSData||{})}(this,function(e){"use strict";function t(){Object.defineProperty(this,"_listeners",{value:{}})}function n(e,t,n){return e===t?0:(n&&(e=n(e),t=n(t)),null===e&&null===t?0:null===e?-1:null===t?1:t>e?-1:e>t?1:0)}function r(e,t,n){return e.splice(t,0,n),e}function i(e,t){return e.splice(t,1),e}function o(e,t,r){for(var i=0,o=e.length,a=void 0,s=void 0;o>i;){if(s=(i+o)/2|0,a=n(t,e[s],r),0===a)return{found:!0,index:s};0>a?o=s:i=s+1}return{found:!1,index:o}}function a(e,t){if(j.classCallCheck(this,a),e||(e=[]),!j.isArray(e))throw new Error("fieldList must be an array.");t||(t={}),this.fieldList=e,this.fieldGetter=t.fieldGetter,this.hashCode=t.hashCode,this.isIndex=!0,this.keys=[],this.values=[]}function s(e,t){var n="new "+J;t||(t={});var r=t.localField;if(!r)throw j.err(n,"opts.localField")(400,"string",r);var i=t.foreignKey=t.foreignKey||t.localKey;if(!i&&(t.type===N||t.type===T))throw j.err(n,"opts.foreignKey")(400,"string",i);var o=t.localKeys,a=t.foreignKeys;if(!i&&!o&&!a&&t.type===D)throw j.err(n,"opts.<foreignKey|localKeys|foreignKeys>")(400,"string",i);if(j.isString(e)){if(t.relation=e,!j.isFunction(t.getRelation))throw j.err(n,"opts.getRelation")(400,"function",t.getRelation)}else{if(!e)throw j.err(n,"related")(400,"Mapper or string",e);t.relation=e.name,Object.defineProperty(this,"relatedMapper",{value:e})}Object.defineProperty(this,"inverse",{value:void 0,writable:!0}),j.fillIn(this,t)}var u={};u.typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u.defineProperty=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},u.toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)};var c="utils",l=1/0,f=1.7976931348623157e308,d="[object Boolean]",h="[object Date]",p="[object Function]",v="[object Number]",g="[object Object]",y="[object RegExp]",m="[object String]",b=Object.prototype.toString,A=/^(.+)\.(.+)$/,_={400:function(){return"expected: "+arguments[0]+", found: "+(arguments[2]?arguments[1]:u.typeof(arguments[1]))},404:function(){return arguments[0]+" not found"}},O=function(e){if(!e)return 0;if(e=+e,e===l||e===-l){var t=0>e?-1:1;return t*f}var n=e%1;return e===e?n?e-n:e:0},w=function(e){return b.call(e)},x=function(e){return!!e&&"object"===("undefined"==typeof e?"undefined":u.typeof(e))&&e.constructor===Object},C=function(e,t){if(!t)return e;var n=t.split(".");return n.forEach(function(t){e[t]||(e[t]={}),e=e[t]}),e},j={Promise:Promise,_:function(e,t){j.forOwn(t,function(t,n){n&&j.isUndefined(e[n])&&!j.isFunction(t)&&0!==n.indexOf("_")&&(e[n]=t)})},_forRelation:function(e,t,n,r){var i=t.relation,o=null,a=void 0;if(e||(e={}),e.with||(e.with=[]),(a=j._getIndex(e.with,i))>=0?o=i:(a=j._getIndex(e.with,t.localField))>=0&&(o=t.localField),e.withAll)return void n.call(r,t,{});if(o){var s={};j.fillIn(s,t.getRelation()),j.fillIn(s,e),s.with=e.with.slice(),s._activeWith=s.with.splice(a,1)[0],s.with.forEach(function(e,t){e&&0===e.indexOf(o)&&e.length>=o.length&&"."===e[o.length]?s.with[t]=e.substr(o.length+1):s.with[t]=""}),n.call(r,t,s)}},_getIndex:function(e,t){var n=-1;return e.forEach(function(e,r){return e===t?(n=r,!1):j.isObject(e)&&e.relation===t?(n=r,!1):void 0}),n},addHiddenPropsToTarget:function(e,t){var n={};j.forOwn(t,function(e,t){n[t]={writable:!0,value:e}}),Object.defineProperties(e,n)},areDifferent:function(e,t,n){n||(n={});var r=j.diffObjects(e,t,n),i=Object.keys(r.added).length+Object.keys(r.removed).length+Object.keys(r.changed).length;return i>0},classCallCheck:function(e,t){if(!(e instanceof t))throw j.err(""+t.name)(500,"Cannot call a class as a function")},copy:function(e,t,n,r,i,o){if(t){if(e===t)throw j.err(c+".copy")(500,"Cannot copy! Source and destination are identical.");if(n=n||[],r=r||[],j.isObject(e)){var a=n.indexOf(e);if(-1!==a)return r[a];n.push(e),r.push(t)}var s=void 0;if(j.isArray(e)){var u=void 0;for(t.length=0,u=0;u<e.length;u++)s=j.copy(e[u],null,n,r,i,o),j.isObject(e[u])&&(n.push(e[u]),r.push(s)),t.push(s)}else{j.isArray(t)?t.length=0:j.forOwn(t,function(e,n){delete t[n]});for(var l in e)if(e.hasOwnProperty(l)){if(j.isBlacklisted(l,i))continue;s=j.copy(e[l],null,n,r,i,o),j.isObject(e[l])&&(n.push(e[l]),r.push(s)),t[l]=s}}}else t=e,e&&(j.isArray(e)?t=j.copy(e,[],n,r,i,o):j.isDate(e)?t=new Date(e.getTime()):j.isRegExp(e)?(t=new RegExp(e.source,e.toString().match(/[^\/]*$/)[0]),t.lastIndex=e.lastIndex):j.isObject(e)&&(t=o?j.copy(e,{},n,r,i,o):j.copy(e,Object.create(Object.getPrototypeOf(e)),n,r,i,o)));return t},deepFillIn:function(e,t){return t&&j.forOwn(t,function(t,n){var r=e[n];x(t)&&x(r)?j.deepFillIn(r,t):e.hasOwnProperty(n)&&void 0!==e[n]||(e[n]=t)}),e},deepMixIn:function(e,t){return t&&j.forOwn(t,function(t,n){var r=e[n];x(t)&&x(r)?j.deepMixIn(r,t):e[n]=t}),e},diffObjects:function(e,t,n){n||(n={});var r=n.equalsFn,i=n.ignore,o={added:{},changed:{},removed:{}};return j.isFunction(r)||(r=j.deepEqual),j.forOwn(t,function(t,n){var a=e[n];j.isBlacklisted(n,i)||r(a,t)||(j.isUndefined(a)?o.removed[n]=void 0:r(a,t)||(o.changed[n]=a))}),j.forOwn(e,function(e,n){j.isUndefined(t[n])&&!j.isBlacklisted(n,i)&&(o.added[n]=e)}),o},equal:function(e,t){return e==t},err:function(e,t){return function(n){var r="["+e+":"+t+"] ",i=_[n].apply(null,Array.prototype.slice.call(arguments,1));return i=""+r+i+"\nhttp://www.js-data.io/v3.0/docs/errors#"+n,new Error(i)}},eventify:function(e,t,n){e=e||this;var r={};t||n||(t=function(){return r},n=function(e){r=e}),Object.defineProperties(e,{emit:{value:function(){for(var e=t.call(this)||{},n=arguments.length,r=Array(n),i=0;n>i;i++)r[i]=arguments[i];var o=r.shift(),a=e[o]||[],s=void 0;for(s=0;s<a.length;s++)a[s].f.apply(a[s].c,r);for(a=e.all||[],r.unshift(o),s=0;s<a.length;s++)a[s].f.apply(a[s].c,r)}},off:{value:function(e,r){var i=t.call(this),o=i[e];if(o)if(r){for(var a=0;a<o.length;a++)if(o[a].f===r){o.splice(a,1);break}}else o.splice(0,o.length);else n.call(this,{})}},on:{value:function(e,r,i){t.call(this)||n.call(this,{});var o=t.call(this);o[e]=o[e]||[],o[e].push({c:i,f:r})}}})},extend:function(e,t){var n=this,r=void 0;e||(e={}),t||(t={}),e.hasOwnProperty("constructor")?(r=e.constructor,delete e.constructor):r=function(){j.classCallCheck(this,r);for(var e=arguments.length,t=Array(e),i=0;e>i;i++)t[i]=arguments[i];n.apply(this,t)},r.prototype=Object.create(n&&n.prototype,{constructor:{configurable:!0,enumerable:!1,value:r,writable:!0}});var i=Object;return i.setPrototypeOf?i.setPrototypeOf(r,n):t.strictEs6Class?r.__proto__=n:j.forOwn(n,function(e,t){r[t]=e}),r.hasOwnProperty("__super__")||Object.defineProperty(r,"__super__",{configurable:!0,value:n}),j.addHiddenPropsToTarget(r.prototype,e),j.fillIn(r,t),r},fillIn:function(e,t){return j.forOwn(t,function(t,n){e.hasOwnProperty(n)&&void 0!==e[n]||(e[n]=t)}),e},findIndex:function(e,t){var n=-1;return e?(e.forEach(function(e,r){return t(e)?(n=r,!1):void 0}),n):n},forEachRelation:function(e,t,n,r){var i=e.relationList||[];i.length&&i.forEach(function(e){j._forRelation(t,e,n,r)})},forOwn:function(e,t,n){var r=Object.keys(e),i=r.length,o=void 0;for(o=0;i>o;o++)t.call(n,e[r[o]],r[o],e)},fromJson:function(e){return j.isString(e)?JSON.parse(e):e},get:function(e,t){if(t){for(var n=t.split("."),r=n.pop();t=n.shift();)if(e=e[t],null==e)return;return e[r]}},getSuper:function(e,t){var n=t?e:e.constructor;return n.hasOwnProperty("__super__")?n.__super__:Object.getPrototypeOf(n)||n.__proto__},intersection:function(e,t){if(!e||!t)return[];var n=[],r=void 0,i=void 0,o=e.length;for(i=0;o>i;i++)r=e[i],-1===n.indexOf(r)&&-1!==t.indexOf(r)&&n.push(r);return n},isArray:Array.isArray,isBlacklisted:function(e,t){if(!t||!t.length)return!1;for(var n=void 0,r=0;r<t.length;r++)if(w(t[r])===y&&t[r].test(e)||t[r]===e)return n=e;return!!n},isBoolean:function(e){return w(e)===d},isBrowser:!1,isDate:function(e){return e&&"object"===("undefined"==typeof e?"undefined":u.typeof(e))&&w(e)===h},isFunction:function(e){return"function"==typeof e||e&&w(e)===p},isInteger:function(e){return w(e)===v&&e==O(e)},isNull:function(e){return null===e},isNumber:function(e){var t="undefined"==typeof e?"undefined":u.typeof(e);return"number"===t||e&&"object"===t&&w(e)===v},isObject:function(e){return w(e)===g},isRegExp:function(e){return w(e)===y},isSorN:function(e){return j.isString(e)||j.isNumber(e)},isString:function(e){return"string"==typeof e||e&&"object"===("undefined"==typeof e?"undefined":u.typeof(e))&&w(e)===m},isUndefined:function(e){return void 0===e},logify:function(e){j.addHiddenPropsToTarget(e,{dbg:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this.log.apply(this,["debug"].concat(t))},log:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];if(e&&!n.length&&(n.push(e),e="debug"),"debug"!==e||this.debug){var i=e.toUpperCase()+": ("+(this.name||this.constructor.name)+")";if(console[e]){var o;(o=console)[e].apply(o,[i].concat(n))}else{var a;(a=console).log.apply(a,[i].concat(n))}}}})},noDupeAdd:function(e,t,n){if(e){var r=this.findIndex(e,n);0>r&&e.push(t)}},omit:function(e,t){var n={};return j.forOwn(e,function(e,r){-1===t.indexOf(r)&&(n[r]=e)}),n},pick:function(e,t){var n={};return j.forOwn(e,function(e,r){-1!==t.indexOf(r)&&(n[r]=e)}),n},plainCopy:function(e){return j.copy(e,void 0,void 0,void 0,void 0,!0)},reject:function(e){return j.Promise.reject(e)},remove:function(e,t){if(e&&e.length){var n=this.findIndex(e,t);n>=0&&e.splice(n,1)}},resolve:function(e){return j.Promise.resolve(e)},set:function(e,t,n){if(j.isObject(t))j.forOwn(t,function(t,n){j.set(e,n,t)});else{var r=A.exec(t);r?C(e,r[1])[r[2]]=n:e[t]=n}},deepEqual:function(e,t){if(e===t)return!0;var n=!0;if(j.isObject(e)&&j.isObject(t)){if(j.forOwn(e,function(e,r){n=n&&j.deepEqual(e,t[r])}),!n)return n;j.forOwn(t,function(t,r){n=n&&j.deepEqual(t,e[r])})}else{if(!j.isArray(e)||!j.isArray(t))return!1;e.forEach(function(e,r){return n=n&&j.deepEqual(e,t[r]),n?void 0:!1})}return n},toJson:JSON.stringify,unset:function(e,t){for(var n=t.split("."),r=n.pop();t=n.shift();)if(e=e[t],null==e)return;e[r]=void 0}};try{j.isBrowser=!!window}catch(e){j.isBrowser=!1}t.extend=j.extend,j.logify(t.prototype),j.eventify(t.prototype,function(){return this._listeners},function(e){this._listeners=e});var I="Query",E="Index inaccessible after first operation",F={limit:"",offset:"",orderBy:"",skip:"",sort:"",where:""},R=/([.*+?^=!:${}()|[\]\/\\])/g,S=/%/g,k=/_/g,P=function(e){return e.replace(R,"\\$1")},M=t.extend({constructor:function e(t){j.classCallCheck(this,e),this.collection=t,this.data=null},_applyWhereFromObject:function(e){var t=[],n=[],r=[];return j.forOwn(e,function(e,i){j.isObject(e)||(e={"==":e}),j.forOwn(e,function(e,o){t.push(i),n.push(o),r.push(e)})}),{fields:t,ops:n,predicates:r}},_applyWhereFromArray:function(e){var t=this,n=[];return e.forEach(function(r,i){if(!j.isString(r)){var o=e[i-1],a=j.isArray(r)?t._applyWhereFromArray:t._applyWhereFromObject,s=a.call(t,r);"or"===o&&(s.isOr=!0),n.push(s)}}),n.isArray=!0,n},_testObjectGroup:function(e,t,n,r){var i=void 0,o=n.fields,a=n.ops,s=n.predicates,u=a.length;for(i=0;u>i;i++){var c=a[i],l="|"===c.charAt(0);c=l?c.substr(1):c;var f=this.evaluate(j.get(r,o[i]),c,s[i]);void 0!==f&&(e=t?f:l?e||f:e&&f),t=!1}return{keep:e,first:t}},_testArrayGroup:function(e,t,n,r){var i=void 0,o=n.length;for(i=0;o>i;i++){var a=n[i],s=a.isArray?this._testArrayGroup:this._testObjectGroup,u=s.call(this,!0,!0,a,r);e=n[i-1]?a.isOr?e||u.keep:e&&u.keep:u.keep,t=u.first}return{keep:e,first:t}},between:function(e,t,n){if(n||(n={}),this.data)throw j.err(I+"#between")(500,"Cannot access index");return this.data=this.collection.getIndex(n.index).between(e,t,n),this},compare:function(e,t,n,r){var i=e[t],o=j.get(n,i[0]),a=j.get(r,i[0]);if(o&&j.isString(o)&&(o=o.toUpperCase()),a&&j.isString(a)&&(a=a.toUpperCase()),void 0===n&&(n=null),void 0===r&&(r=null),"DESC"===i[1].toUpperCase()){var s=a;a=o,o=s}return a>o?-1:o>a?1:t<e.length-1?this.compare(e,t+1,n,r):0},evaluate:function(e,t,n){var r=this.constructor.ops;return r[t]?r[t](e,n):0===t.indexOf("like")?!j.isNull(this.like(n,t.substr(4)).exec(e)):0===t.indexOf("notLike")?j.isNull(this.like(n,t.substr(7)).exec(e)):void 0},filter:function(e,t){var n=this;return e||(e={}),this.getData(),j.isObject(e)?!function(){var t={};(j.isObject(e.where)||j.isArray(e.where))&&(t=e.where),j.forOwn(e,function(e,n){n in F||n in t||(t[n]={"==":e})});var r=void 0;j.isObject(t)&&0!==Object.keys(t).length?r=n._applyWhereFromArray([t]):j.isArray(t)&&(r=n._applyWhereFromArray(t)),r&&(n.data=n.data.filter(function(e,t){return n._testArrayGroup(!0,!0,r,e).keep}));var i=e.orderBy||e.sort;j.isString(i)&&(i=[[i,"ASC"]]),j.isArray(i)||(i=null),i&&!function(){var e=0;i.forEach(function(e,t){j.isString(e)&&(i[t]=[e,"ASC"])}),n.data.sort(function(t,r){return n.compare(i,e,t,r)})}(),j.isNumber(e.skip)?n.skip(e.skip):j.isNumber(e.offset)&&n.skip(e.offset),j.isNumber(e.limit)&&n.limit(e.limit)}():j.isFunction(e)&&(this.data=this.data.filter(e,t)),this},forEach:function(e,t){return this.getData().forEach(e,t),this},get:function(e,t){if(e||(e=[]),t||(t={}),this.data)throw j.err(I+"#get")(500,E);return e&&!j.isArray(e)&&(e=[e]),e.length?(this.data=this.collection.getIndex(t.index).get(e),this):(this.getData(),this)},getAll:function(){var e=this,t={};if(this.data)throw j.err(I+"#getAll")(500,E);for(var n=arguments.length,r=Array(n),i=0;n>i;i++)r[i]=arguments[i];if(!r.length||1===r.length&&j.isObject(r[0]))return this.getData(),this;r.length&&j.isObject(r[r.length-1])&&(t=r[r.length-1],r.pop());var o=this.collection,a=o.getIndex(t.index);return this.data=[],r.forEach(function(t){e.data=e.data.concat(a.get(t))}),this},getData:function(){return this.data||(this.data=this.collection.index.getAll()),this.data},like:function(e,t){return new RegExp("^"+P(e).replace(S,".*").replace(k,".")+"$",t)},limit:function(e){if(!j.isNumber(e))throw j.err(I+"#limit","num")(400,"number",e);var t=this.getData();return this.data=t.slice(0,Math.min(t.length,e)),this},map:function(e,t){return this.data=this.getData().map(e,t),this},mapCall:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return this.data=this.getData().map(function(t){return t[e].apply(t,n)}),this},run:function(){var e=this.data;return this.data=null,e},skip:function(e){if(!j.isNumber(e))throw j.err(I+"#skip","num")(400,"number",e);var t=this.getData();return e<t.length?this.data=t.slice(e):this.data=[],this}},{ops:{"=":function(e,t){return e==t},"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"<":function(e,t){return t>e},"<=":function(e,t){return t>=e},isectEmpty:function(e,t){return!j.intersection(e||[],t||[]).length},isectNotEmpty:function(e,t){return j.intersection(e||[],t||[]).length},in:function(e,t){return-1!==t.indexOf(e)},notIn:function(e,t){return-1===t.indexOf(e)},contains:function(e,t){return-1!==(e||[]).indexOf(t)},notContains:function(e,t){return-1===(e||[]).indexOf(t)}}});j.addHiddenPropsToTarget(a.prototype,{set:function(e,t){j.isArray(e)||(e=[e]);var n=e.shift()||null,i=o(this.keys,n);if(0===e.length)if(i.found){var s=o(this.values[i.index],t,this.hashCode);s.found||r(this.values[i.index],s.index,t)}else r(this.keys,i.index,n),r(this.values,i.index,[t]);else if(i.found)this.values[i.index].set(e,t);else{r(this.keys,i.index,n);var u=new a([],{hashCode:this.hashCode});u.set(e,t),r(this.values,i.index,u)}},get:function(e){j.isArray(e)||(e=[e]);var t=e.shift()||null,n=o(this.keys,t);return 0===e.length?n.found?this.values[n.index].isIndex?this.values[n.index].getAll():this.values[n.index]:[]:n.found?this.values[n.index].get(e):[]},getAll:function(e){e||(e={});var t=[],n=this.values;if("desc"===e.order)for(var r=n.length-1;r>=0;r--){var i=n[r];t=i.isIndex?t.concat(i.getAll(e)):t.concat(i)}else for(var o=0;o<n.length;o++){var a=n[o];t=a.isIndex?t.concat(a.getAll(e)):t.concat(a)}return t},visitAll:function(e,t){this.values.forEach(function(n){n.isIndex?n.visitAll(e,t):n.forEach(e,t)})},between:function(e,t,n){n||(n={}),j.isArray(e)||(e=[e]),j.isArray(t)||(t=[t]),j.fillIn(n,{leftInclusive:!0,rightInclusive:!1,limit:void 0,offset:0});var r=this._between(e,t,n);return n.limit?r.slice(n.offset,n.limit+n.offset):r.slice(n.offset)},_between:function(e,t,n){var r=[],i=e.shift(),a=t.shift(),s=void 0;if(s=void 0!==i?o(this.keys,i):{found:!1,index:0},0===e.length){s.found&&n.leftInclusive===!1&&(s.index+=1);for(var u=s.index;u<this.keys.length;u+=1){if(void 0!==a)if(n.rightInclusive){if(this.keys[u]>a)break}else if(this.keys[u]>=a)break;if(r=this.values[u].isIndex?r.concat(this.values[u].getAll()):r.concat(this.values[u]),n.limit&&r.length>=n.limit+n.offset)break}}else for(var c=s.index;c<this.keys.length;c+=1){var l=this.keys[c];if(l>a)break;if(r=this.values[c].isIndex?l===i?r.concat(this.values[c]._between(j.copy(e),t.map(function(){}),n)):l===a?r.concat(this.values[c]._between(e.map(function(){}),j.copy(t),n)):r.concat(this.values[c].getAll()):r.concat(this.values[c]),n.limit&&r.length>=n.limit+n.offset)break}return n.limit?r.slice(0,n.limit+n.offset):r},peek:function(){return this.values.length?this.values[0].isIndex?this.values[0].peek():this.values[0]:[]},clear:function(){this.keys=[],this.values=[]},insertRecord:function(e){var t=this.fieldList.map(function(t){return j.isFunction(t)?t(e)||null:e[t]||null});this.set(t,e)},removeRecord:function(e){var t=this,n=void 0;return this.values.forEach(function(r,a){if(r.isIndex){if(r.removeRecord(e))return 0===r.keys.length&&(i(t.keys,a),i(t.values,a)),n=!0,!1}else{var s=o(r,e,t.hashCode);if(s.found)return i(r,s.index),0===r.length&&(i(t.keys,a),i(t.values,a)),n=!0,!1}}),n?e:void 0},updateRecord:function(e){this.removeRecord(e),this.insertRecord(e)}});var K="Collection",L={idAttribute:"id",onConflict:"merge"},U=t.extend({constructor:function e(t,n){j.classCallCheck(this,e),e.__super__.call(this),t&&!j.isArray(t)&&(n=t,t=[]),j.isString(n)&&(n={idAttribute:n}),t||(t=[]),n||(n={}),Object.defineProperties(this,{mapper:{value:void 0,writable:!0},queryClass:{value:void 0,writable:!0}}),j.fillIn(this,n),j.fillIn(this,j.copy(L)),this.queryClass||(this.queryClass=M);var r=this.recordId();Object.defineProperties(this,{index:{value:new a([r],{hashCode:function(e){return j.get(e,r)}})},indexes:{value:{}}}),t&&this.add(t)},_onRecordEvent:function(){this.emit.apply(this,arguments)},add:function(e,t){var n=this;t||(t={}),j._(t,this),e=this.beforeAdd(e,t)||e;var r=!1,i=this.recordId();if(!j.isArray(e)){if(!j.isObject(e))throw j.err(K+"#add","records")(400,"object or array",e);e=[e],r=!0}e=e.map(function(e){var r=n.recordId(e);if(!j.isSorN(r))throw j.err(K+"#add","record."+i)(400,"string or number",r);var o=n.get(r);if(e===o)return o;if(o){var a=t.onConflict||n.onConflict;if("merge"===a)j.deepMixIn(o,e);else{if("replace"!==a)throw j.err(K+"#add","opts.onConflict")(400,"one of (merge, replace)",a,!0);j.forOwn(o,function(t,n){n===i||e.hasOwnProperty(n)||delete o[n]}),o.set(e)}e=o,n.updateIndexes(e)}else e=n.mapper?n.mapper.createRecord(e,t):e,n.index.insertRecord(e),j.forOwn(n.indexes,function(t,n){t.insertRecord(e)}),e&&j.isFunction(e.on)&&e.on("all",n._onRecordEvent,n);return e});var o=r?e[0]:e;return this.emit("add",o),this.afterAdd(e,t,o)||o},afterAdd:function(){},afterRemove:function(){},afterRemoveAll:function(){},beforeAdd:function(){},beforeRemove:function(){},beforeRemoveAll:function(){},between:function(e,t,n){return this.query().between(e,t,n).run()},createIndex:function(e,t,n){var r=this;j.isString(e)&&void 0===t&&(t=[e]),n||(n={}),n.hashCode||(n.hashCode=function(e){return r.recordId(e)});var i=this.indexes[e]=new a(t,n);return this.index.visitAll(i.insertRecord,i),this},filter:function(e,t){return this.query().filter(e,t).run()},forEach:function(e,t){this.index.visitAll(e,t)},get:function(e){var t=this.query().get(e).run();return t.length?t[0]:void 0},getAll:function(){var e;return(e=this.query()).getAll.apply(e,arguments).run()},getIndex:function(e){var t=e?this.indexes[e]:this.index;if(!t)throw j.err(K+"#getIndex",e)(404,"index");return t},limit:function(e){return this.query().limit(e).run()},map:function(e,t){var n=[];return this.index.visitAll(function(r){n.push(e.call(t,r))}),n},mapCall:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];var i=[];return this.index.visitAll(function(t){i.push(t[e].apply(t,n))}),i},recordId:function(e){return e?j.get(e,this.recordId()):this.mapper?this.mapper.idAttribute:this.idAttribute},query:function(){var e=this.queryClass;return new e(this)},reduce:function(e,t){var n=this.getAll();return n.reduce(e,t)},remove:function(e,t){t||(t={}),this.beforeRemove(e,t);var n=this.get(e);return n&&(this.index.removeRecord(n),j.forOwn(this.indexes,function(e,t){e.removeRecord(n)}),n&&j.isFunction(n.off)&&(n.off("all",this._onRecordEvent,this),this.emit("remove",n))),this.afterRemove(e,t,n)||n},removeAll:function(e,t){var n=this;t||(t={}),this.beforeRemoveAll(e,t);var r=this.filter(e);return r.forEach(function(e){n.remove(n.recordId(e),t)}),this.afterRemoveAll(e,t,r)||r},skip:function(e){return this.query().skip(e).run()},toJSON:function(e){return this.mapCall("toJSON",e)},updateIndex:function(e,t){t||(t={}),this.getIndex(t.index).updateRecord(e)},updateIndexes:function(e){this.index.updateRecord(e),j.forOwn(this.indexes,function(t,n){t.updateRecord(e)})}}),N="belongsTo",D="hasMany",T="hasOne",J="Relation";j.addHiddenPropsToTarget(s.prototype,{getRelation:function(){return this.relatedMapper},getForeignKey:function(e){return this.type===N?j.get(e,this.foreignKey):j.get(e,this.mapper.idAttribute)},setForeignKey:function(e,t){var n=this;e&&t&&(this.type===N?j.set(e,this.foreignKey,j.get(t,this.getRelation().idAttribute)):!function(){var r=n.mapper.idAttribute;j.isArray(t)?t.forEach(function(t){j.set(t,n.foreignKey,j.get(e,r))}):j.set(t,n.foreignKey,j.get(e,r))}())},getLocalField:function(e){return j.get(e,this.localField)},setLocalField:function(e,t){return j.set(e,this.localField,t)},getInverse:function(e){var t=this;return this.inverse?this.inverse:(this.getRelation().relationList.forEach(function(n){if(n.getRelation()===e){if(n.foreignKey&&n.foreignKey!==t.foreignKey)return;return t.inverse=n,!1}}),this.inverse)}});var q=function(e,t,n){n.name=e.name;var r=new s(t,n);Object.defineProperty(r,"mapper",{value:e}),e.relationList||Object.defineProperty(e,"relationList",{value:[]}),e.relationFields||Object.defineProperty(e,"relationFields",{value:[]}),e.relationList.push(r),e.relationFields.push(r.localField)},Q=function(e,t){return t||(t={}),t.type=N,function(n){q(n,e,t)}},B=function(e,t){return t||(t={}),t.type=D,function(n){q(n,e,t)}},G=function(e,t){return t||(t={}),t.type=T,function(n){q(n,e,t)}},$="Record",W=function(e,t){var n=e.datastore;return n&&n[t]?function(){for(var r=arguments.length,i=Array(r),o=0;r>o;o++)i[o]=arguments[o];return n[t].apply(n,[e.name].concat(i))}:e[t].bind(e)},V=t.extend({constructor:function e(t,n){j.classCallCheck(this,e),t||(t={}),n||(n={});var r={};Object.defineProperties(this,{_get:{value:function(e){return j.get(r,e)}},_set:{value:function(e,t){return j.set(r,e,t)}},_unset:{value:function(e){return j.unset(r,e)}}});var i=this._set;i("creating",!0),n.noValidate&&i("noValidate",!0),j.fillIn(this,t),i("creating",!1),i("noValidate",!1),i("previous",j.copy(t))},_mapper:function(){var e=this.constructor.mapper;if(!e)throw j.err($+"#_mapper","")(404,"mapper");return e},afterLoadRelations:function(){},beforeLoadRelations:function(){},changes:function(e){return e||(e={}),j.diffObjects("function"==typeof this.toJSON?this.toJSON(e):this,this._get("previous"),e)},commit:function(){return this._set("changed"),this._set("previous",j.copy(this)),this},destroy:function(e){e||(e={});var t=this._mapper();return W(t,"destroy")(j.get(this,t.idAttribute),e)},get:function(e){return j.get(this,e)},hasChanges:function(e){var t=!!(this._get("changed")||[]).length;return t||j.areDifferent("function"==typeof this.toJSON?this.toJSON(e):this,this._get("previous"),e)},hashCode:function(){return j.get(this,this._mapper().idAttribute)},isValid:function(e){return!this._mapper().validate(this,e)},loadRelations:function(e,t){var n=this,r=void 0,i=this._mapper();return e||(e=[]),j.isString(e)&&(e=[e]),t||(t={}),t.with=e,j._(t,i),t.adapter=i.getAdapterName(t),r=t.op="beforeLoadRelations",j.resolve(this[r](e,t)).then(function(){r=t.op="loadRelations",i.dbg(r,n,e,t);var o=[],a=void 0;return j.forEachRelation(i,t,function(e,r){var s=e.getRelation();if(r.raw=!1,j.isFunction(e.load))a=e.load(i,e,n,t);else if("hasMany"===e.type||"hasOne"===e.type)e.foreignKey?a=W(s,"findAll")(u.defineProperty({},e.foreignKey,j.get(n,i.idAttribute)),r).then(function(t){return"hasOne"===e.type?t.length?t[0]:void 0:t}):e.localKeys?a=W(s,"findAll")({where:u.defineProperty({},s.idAttribute,{in:j.get(n,e.localKeys)})}):e.foreignKeys&&(a=W(s,"findAll")({where:u.defineProperty({},e.foreignKeys,{contains:j.get(n,i.idAttribute)})},t));else if("belongsTo"===e.type){var c=j.get(n,e.foreignKey);j.isSorN(c)&&(a=W(s,"find")(c,r))}a&&(a=a.then(function(t){e.setLocalField(n,t)}),o.push(a))}),Promise.all(o)}).then(function(){return r=t.op="afterLoadRelations",j.resolve(n[r](e,t)).then(function(){return n})})},previous:function(e){return e?this._get("previous."+e):this._get("previous")},revert:function(e){var t=this,n=this._get("previous");return e||(e={}),e.preserve||(e.preserve=[]),j.forOwn(this,function(r,i){i!==t._mapper().idAttribute&&!n.hasOwnProperty(i)&&t.hasOwnProperty(i)&&-1===e.preserve.indexOf(i)&&delete t[i]}),j.forOwn(n,function(n,r){-1===e.preserve.indexOf(r)&&(t[r]=n)}),this.commit(),this},save:function(e){e||(e={});var t=this._mapper(),n=j.get(this,t.idAttribute),r=this;if(j.isUndefined(n))return W(t,"create")(r,e);if(e.changesOnly){var i=this.changes(e);r={},j.fillIn(r,i.added),j.fillIn(r,i.changed)}return W(t,"update")(n,r,e)},set:function(e,t,n){j.isObject(e)&&(n=t),n||(n={}),n.silent&&this._set("silent",!0),j.set(this,e,t),this._get("eventId")||this._set("silent")},toJSON:function(e){var t=this,n=this.constructor.mapper;if(n)return n.toJSON(this,e);var r=function(){var e={};return j.forOwn(t,function(t,n){e[n]=j.copy(t)}),{v:e}}();return"object"===("undefined"==typeof r?"undefined":u.typeof(r))?r.v:void 0},unset:function(e,t){this.set(e,void 0,t)},validate:function(e){return this._mapper().validate(this,e)}});j.eventify(V.prototype,function(){return this._get("events")},function(e){this._set("events",e)});var H="Schema",z={array:j.isArray,boolean:j.isBoolean,integer:j.isInteger,null:j.isNull,number:j.isNumber,object:j.isObject,string:j.isString},X=function(e,t){var n="";return e&&(n+=j.isNumber(e)?"["+e+"]":t?"."+e:""+e),n},Y=function(e){e||(e={});var t="",n=e.path||[];return n.forEach(function(e){t+=X(e,t)}),t+=X(e.prop,t)},Z=function(e,t,n){return{expected:t,actual:""+e,path:Y(n)}},ee=function(e,t,n,r){r.push(Z(e,t,n))},te=function(e,t,n,r){var i=n[e];return t.length>i?Z(t.length,"length no more than "+i,r):void 0},ne=function(e,t,n,r){var i=n[e];return t.length<i?Z(t.length,"length no less than "+i,r):void 0},re={allOf:function(e,t,n){var r=[];return t.allOf.forEach(function(t){r=r.concat(de(e,t,n)||[])}),r.length?void 0:r},anyOf:function(e,t,n){var r=!1,i=[];return t.anyOf.forEach(function(t){var o=de(e,t,n);o?i=i.concat(o):r=!0}),r?void 0:i},dependencies:function(e,t,n){},enum:function(e,t,n){var r=t.enum;return-1===r.indexOf(e)?Z(e,"one of ("+r.join(", ")+")",n):void 0},items:function e(t,n,r){r||(r={});for(var e=n.items,i=[],o=j.isArray(e),a=t.length,s=0;a>s;s++)o&&(e=n.items[s]),r.prop=s,i=i.concat(de(t[s],e,r)||[]);return i.length?i:void 0},maximum:function e(t,n,r){var e=n.maximum,i=n.exclusiveMaximum;return("undefined"==typeof t?"undefined":u.typeof(t))===("undefined"==typeof e?"undefined":u.typeof(e))&&(i?t>e:t>=e)?Z(t,"no more than "+e,r):void 0},maxItems:function(e,t,n){return te("maxItems",e,t,n)},maxLength:function(e,t,n){return te("maxLength",e,t,n)},maxProperties:function e(t,n,r){var e=n.maxProperties,i=Object.keys(t).length;return i>e?Z(i,"no more than "+e+" properties",r):void 0},minimum:function e(t,n,r){var e=n.minimum,i=n.exclusiveMinimum;return("undefined"==typeof t?"undefined":u.typeof(t))===("undefined"==typeof e?"undefined":u.typeof(e))&&(i?e>t:e>=t)?Z(t,"no less than "+e,r):void 0},minItems:function(e,t,n){return ne("minItems",e,t,n)},minLength:function(e,t,n){return ne("minLength",e,t,n)},minProperties:function e(t,n,r){var e=n.minProperties,i=Object.keys(t).length;return e>i?Z(i,"no more than "+e+" properties",r):void 0},multipleOf:function(e,t,n){},not:function(e,t,n){return de(e,t.not,n)?void 0:Z("succeeded","should have failed",n)},oneOf:function(e,t,n){var r=!1,i=[];return t.oneOf.forEach(function(t){var o=de(e,t,n);if(o)i=i.concat(o);else{if(r)return i=[Z("valid against more than one","valid against only one",n)],r=!1,!1;r=!0}}),r?void 0:i},pattern:function e(t,n,r){var e=n.pattern;return j.isString(t)&&!t.match(e)?Z(t,e,r):void 0},properties:function e(t,n,r){r||(r={});var i=j.isUndefined(n.additionalProperties)?!0:n.additionalProperties,o={},e=n.properties||{},a=n.patternProperties||{},s=[];j.forOwn(t,function(e,t){o[t]=void 0}),j.forOwn(e||{},function(e,n){j.isUndefined(t[n])&&!j.isUndefined(e.default)&&(t[n]=j.copy(e.default)),r.prop=n,s=s.concat(de(t[n],e,r)||[]),delete o[n]}),j.forOwn(a,function(e,n){j.forOwn(o,function(i,a){a.match(n)&&(r.prop=a,s=s.concat(de(t[a],e,r)||[]),delete o[a])})});var u=Object.keys(o);return i===!1?u.length&&ee("extra fields: "+u.join(", "),"no extra fields",r,s):j.isObject(i)&&u.forEach(function(e){r.prop=e,s=s.concat(de(t[e],i,r)||[])}),s.length?s:void 0},required:function e(t,n,r){var e=n.required,i=[];return r.existingOnly||e.forEach(function(e){if(j.isUndefined(j.get(t,e))){var n=r.prop;r.prop=e,ee(void 0,"a value",r,i),r.prop=n}}),i.length?i:void 0},type:function e(t,n,r){var e=n.type,i=void 0;if(j.isString(e)&&(e=[e]),e.forEach(function(e){return z[e](t,n,r)?(i=e,!1):void 0}),!i)return Z(j.isUndefined(t)||null===t?""+t:"undefined"==typeof t?"undefined":u.typeof(t),"one of ("+e.join(", ")+")",r);var o=_e[i];return o?o(t,n,r):void 0},uniqueItems:function(e,t,n){if(e&&e.length&&t.uniqueItems){var r=e.length,i=void 0,o=void 0,a=void 0;for(o=r-1;o>0;o--)for(i=e[o],a=o-1;a>=0;a--)if(i===e[a])return Z(i,"no duplicates",n)}}},ie=function(e,t,n,r){return!j.isUndefined(n[e])&&re[e](t,n,r)},oe=function(e,t,n,r){var i=[];return e.forEach(function(e){i=i.concat(ie(e,t,n,r)||[])}),i.length?i:void 0},ae=["enum","type","allOf","anyOf","oneOf","not"],se=["items","maxItems","minItems","uniqueItems"],ue=["multipleOf","maximum","minimum"],ce=["maxProperties","minProperties","required","properties","dependencies"],le=["maxLength","minLength","pattern"],fe=function(e,t,n){return oe(ae,e,t,n)},de=function e(t,n,r){var i=[];r||(r={});var o=void 0,a=r.prop;if(!j.isUndefined(n)){if(!j.isObject(n))throw j.err(H+"#validate")(500,'Invalid schema at path: "'+r.path+'"');return j.isUndefined(r.path)&&(r.path=[]),j.isUndefined(r.prop)||(o=!0,r.path.push(r.prop),r.prop=void 0),n.extends&&(i=j.isFunction(n.extends.validate)?i.concat(n.extends.validate(t,r)||[]):i.concat(e(t,n.extends,r)||[])),j.isUndefined(t)?(n.required!==!0||r.existingOnly||ee(t,"a value",r,i),o&&(r.path.pop(),r.prop=a),i.length?i:void 0):(i=i.concat(fe(t,n,r)||[]),o&&(r.path.pop(),r.prop=a),i.length?i:void 0)}},he="changing",pe="changed",ve="creating",ge="eventId",ye="noValidate",me="silent",be="validation failed",Ae=function(e,t,n){
var r={enumerable:j.isUndefined(t.enumerable)?!0:!!t.enumerable},i="props."+e,o="previous."+e,a=n.getter,s=n.setter,u=n.unsetter;return r.get=function(){return this._get(i)},r.set=function(n){var r=this,c=this[a],l=this[s],f=this[u];if(!c(ye)){var d=t.validate(n);if(d){var h=new Error(be);throw h.errors=d,h}}return t.track&&!c(ve)&&!function(){var t=c(o),a=c(i),s=c(he),u=c(pe);s||(u=[]);var d=u.indexOf(e);a!==n&&-1===d&&u.push(e),t===n&&d>=0&&u.splice(d,1),u.length||(s=!1,f(he),f(pe),c(ge)&&(clearTimeout(c(ge)),f(ge))),!s&&u.length&&(l(pe,u),l(he,!0),l(ge,setTimeout(function(){if(f(pe),f(ge),f(he),!c(me)){var e=void 0;for(e=0;e<u.length;e++)r.emit("change:"+u[e],r,j.get(r,u[e]));r.emit("change",r,r.changes())}f(me)},0)))}(),l(i,n),n},r},_e={array:function(e,t,n){return oe(se,e,t,n)},integer:function(e,t,n){return _e.numeric(e,t,n)},number:function(e,t,n){return _e.numeric(e,t,n)},numeric:function(e,t,n){return oe(ue,e,t,n)},object:function(e,t,n){return oe(ce,e,t,n)},string:function(e,t,n){return oe(le,e,t,n)}},Oe=t.extend({constructor:function e(t){t||(t={}),j.fillIn(this,t),t.properties&&j.forOwn(t.properties,function(n,r){n instanceof e||(t.properties[r]=new e(n))})},apply:function(e,t){t||(t={}),t.getter=t.getter||"_get",t.setter=t.setter||"_set",t.unsetter=t.unsetter||"_unset";var n=this.properties||{};j.forOwn(n,function(n,r){Object.defineProperty(e,r,Ae(r,n,t))})},validate:function(e,t){return de(e,this,t)}},{typeGroupValidators:_e,types:z,validate:de,validationKeywords:re}),we="Mapper",xe=["beforeCreate","beforeCreateMany","beforeUpdate","beforeUpdateAll","beforeUpdateMany"],Ce=function(e){return function(){for(var t=this,n=arguments.length,r=Array(n),i=0;n>i;i++)r[i]=arguments[i];var o=r[r.length-e],a=o.op;if(this.dbg.apply(this,[a].concat(r)),-1!==xe.indexOf(a)&&o.validate!==!1){var s=o.existingOnly;0===a.indexOf("beforeUpdate")&&j.isUndefined(o.existingOnly)&&(o.existingOnly=!0);var u=this.validate(r["beforeUpdate"===a?1:0],j.pick(o,["existingOnly"]));if(o.existingOnly=s,u)return j.reject(u)}(o.notify||void 0===o.notify&&this.notify)&&setTimeout(function(){t.emit.apply(t,[a].concat(r))})}},je=Ce(1),Ie=Ce(2),Ee={count:{defaults:[{},{}],skip:!0,types:[]},destroy:{defaults:[{},{}],skip:!0,types:[]},destroyAll:{defaults:[{},{}],skip:!0,types:[]},find:{defaults:[void 0,{}],types:[]},findAll:{defaults:[{},{}],types:[]},sum:{defaults:[void 0,{},{}],skip:!0,types:[]},update:{adapterArgs:function(e,t,n,r){return[t,e.toJSON(n,r),r]},beforeAssign:1,defaults:[void 0,{},{}],types:[]},updateAll:{adapterArgs:function(e,t,n,r){return[e.toJSON(t,r),n,r]},beforeAssign:0,defaults:[{},{},{}],types:[]},updateMany:{adapterArgs:function(e,t,n){return[t.map(function(t){return e.toJSON(t,n)}),n]},beforeAssign:0,defaults:[[],{}],types:[]}},Fe={_adapters:{},applySchema:!0,debug:!1,defaultAdapter:"http",idAttribute:"id",notify:!0,raw:!1},Re=t.extend({constructor:function e(t){var n=this;if(j.classCallCheck(this,e),e.__super__.call(this),t||(t={}),Object.defineProperties(this,{_adapters:{value:void 0,writable:!0},recordClass:{value:void 0,writable:!0},lifecycleMethods:{value:Ee},schema:{value:void 0,writable:!0}}),j.fillIn(this,t),j.fillIn(this,j.copy(Fe)),!this.name)throw j.err("new "+we,"opts.name")(400,"string",this.name);this.schema instanceof Oe||(this.schema=new Oe(this.schema||{})),this.schema instanceof Oe&&(this.schema.type||(this.schema.type="object")),j.isUndefined(this.recordClass)&&!function(){var e=V;n.recordClass=e.extend({constructor:function(){var t=function(n,r){j.classCallCheck(this,t),e.call(this,n,r)};return t}()})}(),this.recordClass&&(this.recordClass.mapper=this,j.getSuper(this.recordClass,!0)===V&&this.schema&&this.schema.apply&&this.applySchema&&this.schema.apply(this.recordClass.prototype))},afterCount:Ie,afterCreate:Ie,afterCreateMany:Ie,afterDestroy:Ie,afterDestroyAll:Ie,afterFind:Ie,afterFindAll:Ie,afterSum:Ie,afterUpdate:Ie,afterUpdateAll:Ie,afterUpdateMany:Ie,beforeCreate:je,beforeCreateMany:je,beforeCount:je,beforeDestroy:je,beforeDestroyAll:je,beforeFind:je,beforeFindAll:je,beforeSum:je,beforeUpdate:je,beforeUpdateAll:je,beforeUpdateMany:je,_end:function(e,t,n){if(t.raw&&j._(e,t),n)return e;var r=t.raw?e.data:e;return r&&j.isFunction(this.wrap)&&(r=this.wrap(r,t),t.raw?e.data=r:e=r),e},belongsTo:function(e,t){return Q(e,t)(this)},count:function(e,t){return this.crud("count",e,t)},create:function(e,t){var n=this,r=void 0,i=void 0;return e||(e={}),t||(t={}),j._(t,this),i=t.adapter=this.getAdapterName(t),r=t.op="beforeCreate",j.resolve(this[r](e,t)).then(function(o){e=j.isUndefined(o)?e:o;var a={};t.with||(t.with=[]);var s=[];return j.forEachRelation(n,t,function(t,n){var r=t.getLocalField(e),i=t.getRelation(),o=i.idAttribute;n.raw=!1,r&&(t.type===N?s.push(i.create(r,n).then(function(n){t.setLocalField(a,n),t.setForeignKey(e,n)})):t.type===D&&t.localKeys&&s.push(i.createMany(r,n).then(function(n){t.setLocalField(a,n),j.set(e,t.localKeys,n.map(function(e){return j.get(e,o)}))})))}),j.Promise.all(s).then(function(){return r=t.op="create",n.dbg(r,e,t),j.resolve(n.getAdapter(i)[r](n,n.toJSON(e,{with:t.pass||[]}),t))}).then(function(r){var i=t.raw?r.data:r;return s=[],j.forEachRelation(n,t,function(t,n){var r=t.getLocalField(e);if(r){n.raw=!1;var o=void 0;t.type===D&&t.foreignKey?(t.setForeignKey(i,r),o=t.getRelation().createMany(r,n).then(function(e){t.setLocalField(i,e)})):t.type===T?(t.setForeignKey(i,r),o=t.getRelation().create(r,n).then(function(e){t.setLocalField(i,e)})):t.type===N&&t.getLocalField(a)?t.setLocalField(i,t.getLocalField(a)):t.type===D&&t.localKeys&&t.getLocalField(a)&&t.setLocalField(i,t.getLocalField(a)),o&&s.push(o)}}),j.Promise.all(s).then(function(){return r})})}).then(function(i){return i=n._end(i,t),r=t.op="afterCreate",j.resolve(n[r](e,t,i)).then(function(e){return j.isUndefined(e)?i:e})})},createInstance:function(e,t){return this.createRecord(e,t)},createMany:function(e,t){var n=this,r=void 0,i=void 0;return e||(e=[]),t||(t={}),j._(t,this),i=t.adapter=this.getAdapterName(t),r=t.op="beforeCreateMany",j.resolve(this[r](e,t)).then(function(o){e=j.isUndefined(o)?e:o;var a={};t.with||(t.with=[]);var s=[];return j.forEachRelation(n,t,function(t,n){var r=e.map(function(e){return t.getLocalField(e)}).filter(function(e){return e});t.type===N&&r.length===e.length&&s.push(t.getRelation().createMany(r,n).then(function(r){var i=n.raw?r.data:r;t.setLocalField(a,i),e.forEach(function(e,n){t.setForeignKey(e,i[n])})}))}),j.Promise.all(s).then(function(){r=t.op="createMany";var o=e.map(function(e){return n.toJSON(e,{with:t.pass||[]})});return n.dbg(r,e,t),j.resolve(n.getAdapter(i)[r](n,o,t))}).then(function(r){var i=t.raw?r.data:r;return s=[],j.forEachRelation(n,t,function(r,o){var u=e.map(function(e){return r.getLocalField(e)}).filter(function(e){return e});if(u.length===e.length){var c=r.getLocalField(a),l=void 0;r.type===D?n.log("warn","deep createMany of hasMany type not supported!"):r.type===T?(i.forEach(function(e,t){r.setForeignKey(e,u[t])}),l=r.getRelation().createMany(u,o).then(function(e){var n=t.raw?e.data:e;i.forEach(function(e,t){r.setLocalField(e,n[t])})})):r.type===N&&c&&c.length===i.length&&i.forEach(function(e,t){r.setLocalField(e,c[t])}),l&&s.push(l)}}),j.Promise.all(s).then(function(){return r})})}).then(function(i){return i=n._end(i,t),r=t.op="afterCreateMany",j.resolve(n[r](e,t,i)).then(function(e){return j.isUndefined(e)?i:e})})},createRecord:function(e,t){var n=this;if(e||(e={}),j.isArray(e))return e.map(function(e){return n.createRecord(e,t)});if(!j.isObject(e))throw j.err(we+"#createRecord","props")(400,"array or object",e);var r=this.recordClass,i=this.relationList||[];return i.forEach(function(n){var r=n.getRelation(),i=n.getLocalField(e);if(i&&!r.is(i)){if(j.isArray(i)&&(!i.length||r.is(i[0])))return;j.set(e,n.localField,r.createRecord(i,t))}}),r?e instanceof r?e:new r(e,t):e},crud:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),i=1;n>i;i++)r[i-1]=arguments[i];var o=this.lifecycleMethods[e];if(!o)throw j.err(we+"#crud",e)(404,"method");var a=""+e.charAt(0).toUpperCase()+e.substr(1),s="before"+a,c="after"+a,l=void 0,f=void 0;o.defaults.forEach(function(e,t){j.isUndefined(r[t])&&(r[t]=j.copy(e))});var d=r[r.length-1];return j._(d,this),f=d.adapter=this.getAdapterName(d),l=d.op=s,j.resolve(this[l].apply(this,u.toConsumableArray(r))).then(function(n){var i;return j.isUndefined(r[o.beforeAssign])||(r[o.beforeAssign]=j.isUndefined(n)?r[o.beforeAssign]:n),l=d.op=e,r=o.adapterArgs?o.adapterArgs.apply(o,[t].concat(u.toConsumableArray(r))):r,t.dbg.apply(t,[l].concat(u.toConsumableArray(r))),j.resolve((i=t.getAdapter(f))[l].apply(i,[t].concat(u.toConsumableArray(r))))}).then(function(e){return e=t._end(e,d,!!o.skip),r.push(e),l=d.op=c,j.resolve(t[l].apply(t,u.toConsumableArray(r))).then(function(t){return j.isUndefined(t)?e:t})})},destroy:function(e,t){return this.crud("destroy",e,t)},destroyAll:function(e,t){return this.crud("destroyAll",e,t)},find:function(e,t){return this.crud("find",e,t)},findAll:function(e,t){return this.crud("findAll",e,t)},getAdapter:function(e){this.dbg("getAdapter","name:",e);var t=this.getAdapterName(e);if(!t)throw j.err(we+"#getAdapter","name")(400,"string",e);return this.getAdapters()[t]},getAdapterName:function(e){return e||(e={}),j.isString(e)&&(e={adapter:e}),e.adapter||e.defaultAdapter},getAdapters:function(){return this._adapters},getSchema:function(){return this.schema},hasMany:function(e,t){return B(e,t)(this)},hasOne:function(e,t){return G(e,t)(this)},is:function(e){var t=this.recordClass;return t?e instanceof t:!1},registerAdapter:function(e,t,n){n||(n={}),this.getAdapters()[e]=t,(n===!0||n.default)&&(this.defaultAdapter=e)},sum:function(e,t,n){return this.crud("sum",e,t,n)},toJSON:function(e,t){var n=this,r=void 0;if(t||(t={}),j.isArray(e))return e.map(function(e){return n.toJSON(e,t)});r=e;var i=(this?this.relationFields:[])||[],o={},a=void 0;if(this&&this.schema&&(a=this.schema.properties||{},j.forOwn(a,function(e,t){o[t]=j.plainCopy(r[t])})),a||(a={}),!t.strict)for(var s in r)a[s]||-1!==i.indexOf(s)||(o[s]=j.plainCopy(r[s]));return this&&t.withAll&&(t.with=i.slice()),this&&t.with&&(j.isString(t.with)&&(t.with=[t.with]),j.forEachRelation(this,t,function(e,t){var n=e.getLocalField(r);n&&(j.isArray(n)?e.setLocalField(o,n.map(function(n){return e.getRelation().toJSON(n,t)})):e.setLocalField(o,e.getRelation().toJSON(n,t)))})),o},update:function(e,t,n){return this.crud("update",e,t,n)},updateAll:function(e,t,n){return this.crud("updateAll",e,t,n)},updateMany:function(e,t){return this.crud("updateMany",e,t)},validate:function(e,t){t||(t={});var n=this.getSchema(),r=j.pick(t,["existingOnly"]);if(!j.isArray(e))return n.validate(e,r);var i=e.map(function(e){return n.validate(e,j.pick(r,["existingOnly"]))}),o=!1;return i.forEach(function(e){e&&(o=!0)}),o?i:void 0},wrap:function(e,t){return this.createRecord(e,t)}}),Se="Container",ke=["count","create","createMany","createRecord","dbg","destroy","destroyAll","find","findAll","getSchema","is","log","sum","toJSON","update","updateAll","updateMany","validate"],Pe={constructor:function e(t){j.classCallCheck(this,e),e.__super__.call(this),t||(t={}),Object.defineProperties(this,{_adapters:{value:{}},_mappers:{value:{}}}),j.fillIn(this,t),this.mapperDefaults=this.mapperDefaults||{},this.mapperClass=this.mapperClass||Re},_onMapperEvent:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];var i=n.shift();this.emit.apply(this,[i,e].concat(n))},as:function(e){var t=this,n={};return ke.forEach(function(t){n[t]={writable:!0,value:function(){var n;return(n=this.getMapper(e))[t].apply(n,arguments)}}}),n.getMapper={writable:!0,value:function(){return t.getMapper(e)}},Object.create(this,n)},defineMapper:function(e,t){var n=this;if(j.isObject(e)&&(t=e,e=t.name),!j.isString(e))throw j.err(Se+"#defineMapper","name")(400,"string",e);t||(t={}),t.name=e,t.relations||(t.relations={});var r=t.mapperClass||this.mapperClass;delete t.mapperClass,j.fillIn(t,this.mapperDefaults);var i=this._mappers[e]=new r(t);return i.relations||(i.relations={}),i.name=e,i._adapters=this.getAdapters(),i.datastore=this,i.on("all",function(){for(var t=arguments.length,r=Array(t),i=0;t>i;i++)r[i]=arguments[i];return n._onMapperEvent.apply(n,[e].concat(r))}),j.forOwn(i.relations,function(e,t){j.forOwn(e,function(e,r){j.isObject(e)&&(e=[e]),e.forEach(function(e){e.getRelation=function(){return n.getMapper(r)};var o=n._mappers[r]||r;t===N?i.belongsTo(o,e):t===T?i.hasOne(o,e):t===D&&i.hasMany(o,e)})})}),i},defineResource:function(e,t){return console.warn("DEPRECATED: defineResource is deprecated, use defineMapper instead"),this.defineMapper(e,t)},getAdapter:function(e){var t=this.getAdapterName(e);if(!t)throw j.err(Se+"#getAdapter","name")(400,"string",e);return this.getAdapters()[t]},getAdapterName:function(e){return e||(e={}),j.isString(e)&&(e={adapter:e}),e.adapter||this.mapperDefaults.defaultAdapter},getAdapters:function(){return this._adapters},getMapper:function(e){var t=this._mappers[e];if(!t)throw j.err(Se+"#getMapper",e)(404,"mapper");return t},registerAdapter:function(e,t,n){n||(n={}),this.getAdapters()[e]=t,(n===!0||n.default)&&(this.mapperDefaults.defaultAdapter=e,j.forOwn(this._mappers,function(t){t.defaultAdapter=e}))}};ke.forEach(function(e){Pe[e]=function(t){for(var n,r=arguments.length,i=Array(r>1?r-1:0),o=1;r>o;o++)i[o-1]=arguments[o];return(n=this.getMapper(t))[e].apply(n,i)}});var Me=t.extend(Pe),Ke="LinkedCollection",Le=U.extend({constructor:function e(t,n){if(j.classCallCheck(this,e),Object.defineProperties(this,{_added:{value:{}},datastore:{writable:!0,value:void 0}}),e.__super__.call(this,t,n),!this.datastore)throw j.err("new "+Ke,"opts.datastore")(400,"DataStore",this.datastore);return this},_onRecordEvent:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];j.getSuper(this).prototype._onRecordEvent.apply(this,t);var r=t[0];j.isString(r)&&0===r.indexOf("change")&&this.updateIndexes(t[1])},add:function(e,t){var n=this,r=this.datastore,i=this.mapper,o=i.relationList,a=(new Date).getTime(),s=!!i.recordClass,c=i.idAttribute,l=void 0;return j.isObject(e)&&!j.isArray(e)&&(l=!0,e=[e]),e=j.getSuper(this).prototype.add.call(this,e,t),o.length&&e.length&&i.relationList.forEach(function(t){var n=t.relation,i=r.getMapper(n),o=i.idAttribute,a=t.foreignKey,s=r.getCollection(n),l=t.type,f=l===D,d=j.isUndefined(t.add)?!0:!!t.add,h=void 0;e.forEach(function(e){h=t.getLocalField(e);var n=j.get(e,c);if(j.isFunction(t.add))h=t.add(r,t,e);else if(h)if(f)h=h.map(function(n){return n!==s.get(s.recordId(n))&&(a&&t.setForeignKey(e,n),d&&(n=s.add(n))),n});else{var i=j.get(h,o);h!==s.get(i)&&(t.setForeignKey(e,h),d&&(h=s.add(h)))}if(!h||j.isArray(h)&&!h.length)if(l===N){var p=j.get(e,a);j.isUndefined(p)||(h=s.get(p))}else if(l===T){var v=s.filter(u.defineProperty({},a,n));h=v.length?v[0]:void 0}else if(l===D)if(a){var g=s.filter(u.defineProperty({},a,n));h=g.length?g:void 0}else if(t.localKeys&&j.get(e,t.localKeys)){var y=s.filter({where:u.defineProperty({},o,{in:j.get(e,t.localKeys)})});h=y.length?y:void 0}else if(t.foreignKeys){var m=s.filter({where:u.defineProperty({},t.foreignKeys,{contains:n})});h=m.length?m:void 0}h&&t.setLocalField(e,h)})}),e.forEach(function(e){n._added[n.recordId(e)]=a,s&&e._set("$",a)}),l?e[0]:e},remove:function(e,t){var n=this.mapper,r=j.getSuper(this).prototype.remove.call(this,e,t);return r&&(delete this._added[e],n.recordClass&&r._set("$")),r},removeAll:function(e,t){var n=this,r=this.mapper,i=j.getSuper(this).prototype.removeAll.call(this,e,t);return i.forEach(function(e){delete n._added[n.recordId(e)],r.recordClass&&e._set("$")}),i}}),Ue="DataStore",Ne=["add","between","createIndex","filter","get","getAll","query","toJson"],De=["addToCache","cachedFind","cachedFindAll","cacheFind","cacheFindAll","hashQuery"],Te=function(e,t,n){e&&e._set?e._set(t,n):j.set(e,t,n)},Je=function(e,t,n){var r=this._completedQueries[e][t];return j.isFunction(r)?r(e,t,n):r},qe={constructor:function e(t){return j.classCallCheck(this,e),e.__super__.call(this,t),this.collectionClass=this.collectionClass||Le,this._collections={},this._pendingQueries={},this._completedQueries={},this},_callSuper:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return this.constructor.__super__.prototype[e].apply(this,n)},_end:function(e,t,n){var r=n.raw?t.data:t;return r&&j.isFunction(this.addToCache)&&(r=this.addToCache(e,r,n),n.raw?t.data=r:t=r),t},_onCollectionEvent:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];var i=n.shift();this.emit.apply(this,[i,e].concat(n))},addToCache:function(e,t,n){return this.getCollection(e).add(t,n)},as:function(e){var t=this,n={};return De.forEach(function(t){n[t]={writable:!0,value:function(){for(var n=arguments.length,r=Array(n),i=0;n>i;i++)r[i]=arguments[i];return this[t].apply(this,[e].concat(r))}}}),ke.forEach(function(t){n[t]={writable:!0,value:function(){var n;return(n=this.getMapper(e))[t].apply(n,arguments)}}}),n.getMapper={writable:!0,value:function(){return t.getMapper(e)}},Ne.forEach(function(t){n[t]={writable:!0,value:function(){var n;return(n=this.getCollection(e))[t].apply(n,arguments)}}}),n.getCollection={writable:!0,value:function(){return t.getCollection(e)}},Object.create(this,n)},cachedFind:Je,cachedFindAll:Je,cacheFind:function(e,t,n,r){var i=this;this._completedQueries[e][n]=function(e,t,n){return i.get(e,t)}},cacheFindAll:function(e,t,n,r){var i=this;this._completedQueries[e][n]=function(e,t,n){return i.filter(e,j.fromJson(t))}},clear:function(){var e={};return j.forOwn(this._collections,function(t,n){e[n]=t.removeAll()}),e},create:function(e,t,n){var r=this;return n||(n={}),this._callSuper("create",e,t,n).then(function(t){return r._end(e,t,n)})},createMany:function(e,t,n){var r=this;return n||(n={}),this._callSuper("createMany",e,t,n).then(function(t){return r._end(e,t,n)})},defineMapper:function(e,t){var n=this,r=j.getSuper(n).prototype.defineMapper.call(n,e,t);n._pendingQueries[e]={},n._completedQueries[e]={},r.relationList||Object.defineProperty(r,"relationList",{value:[]});var i=n._collections[e]=new n.collectionClass(null,{_added:{},datastore:n,mapper:r}),o=r.schema||{},a=o.properties||{};j.forOwn(a,function(e,t){e.indexed&&i.createIndex(t)}),i.createIndex("addedTimestamps",["$"],{fieldGetter:function(e){return i._added[i.recordId(e)]}}),i.on("all",function(){for(var t=arguments.length,r=Array(t),i=0;t>i;i++)r[i]=arguments[i];n._onCollectionEvent.apply(n,[e].concat(r))});var s=r.idAttribute;return r.relationList.forEach(function(e){var t=e.relation,o=e.localField,a="links."+o,u=e.foreignKey,c=e.type,l={index:u},f=void 0,d=function(){return this._get(a)};c===N?(i.indexes[u]||i.createIndex(u),f={get:d,set:function(o){var c=this,f=this._get(a);if(o===f)return f;var d=j.get(c,s),h=e.getInverse(r);if(o){var p=e.getRelation().idAttribute,v=j.get(o,p);if(j.isUndefined(v)||(o=n.get(t,v)||o),c._set(a,o),Te(c,u,v),i.updateIndex(c,l),h.type===T)j.set(o,h.localField,c);else if(h.type===D){var g=j.get(o,h.localField);j.noDupeAdd(g,c,function(e){return d===j.get(e,s)})}}else c._set(a,void 0),Te(c,u,void 0),i.updateIndex(c,l);if(f)if(h.type===T)j.set(f,h.localField,void 0);else if(h.type===D){var y=j.get(f,h.localField);j.remove(y,function(e){return d===j.get(e,s)})}return o}},r.recordClass.prototype.hasOwnProperty(u)&&!function(){var e=r.recordClass;r.recordClass=e.extend({constructor:function(){var t=function(n,r){j.classCallCheck(this,t),e.call(this,n,r)};return t}()})}(),Object.defineProperty(r.recordClass.prototype,u,{enumerable:!0,get:function(){return this._get(u)},set:function(e){var r=this;if(j.isUndefined(e))j.set(r,o,void 0);else{Te(r,u,e);var i=n.get(t,e);i&&j.set(r,o,i)}}})):c===D?!function(){var i=e.localKeys,o=e.foreignKeys;n._collections[t]&&u&&!n.getCollection(t).indexes[u]&&n.getCollection(t).createIndex(u),f={get:function(){var e=this,t=d.call(e);return t||e._set(a,[]),d.call(e)},set:function(c){var f=this;c||(c=[]),c&&!j.isArray(c)&&(c=[c]);var d=j.get(f,s),h=e.getRelation().idAttribute,p=e.getInverse(r),v=p.localField,g=f._get(a);g||(g=[]);var y=g;g=[];var m={};return c.forEach(function(e){var r=j.get(e,h);j.isUndefined(r)||(e=n.get(t,r)||e,m[r]=e),g.push(e)}),u?(c.forEach(function(e){Te(e,u,d),n.getCollection(t).updateIndex(e,l),j.set(e,v,f)}),y.forEach(function(e){var r=j.get(e,h);j.isUndefined(r)||m.hasOwnProperty(r)||(Te(e,u,void 0),n.getCollection(t).updateIndex(e,l),j.set(e,v,void 0))})):i?!function(){var e=[];c.forEach(function(t){j.set(t,v,f),e.push(j.get(t,h))}),j.set(f,i,e),y.forEach(function(e){var t=j.get(e,h);j.isUndefined(t)||m.hasOwnProperty(t)||j.set(e,v,void 0)})}():o&&(y.forEach(function(e){var t=j.get(e,o)||[];j.remove(t,function(e){return d===e});var n=j.get(e,v)||[];j.remove(n,function(e){return d===j.get(e,s)})}),c.forEach(function(e){var t=j.get(e,o)||[];j.noDupeAdd(t,d,function(e){return d===e});var n=j.get(e,v)||[];j.noDupeAdd(n,f,function(e){return d===j.get(e,s)})})),f._set(a,g),g}}}():c===T&&(n._collections[t]&&u&&!n.getCollection(t).indexes[u]&&n.getCollection(t).createIndex(u),f={get:d,set:function(i){var o=this,c=this._get(a);if(i===c)return c;var f=j.get(i,e.getRelation().idAttribute),d=e.getInverse(r).localField;return c&&(Te(c,u,void 0),n.getCollection(t).updateIndex(c,l),j.set(c,d,void 0)),i?(j.isUndefined(f)||(i=n.get(t,f)||i),o._set(a,i),Te(i,u,j.get(o,s)),n.getCollection(t).updateIndex(i,l),j.set(i,d,o)):o._set(a,void 0),i}}),f&&(f.enumerable=j.isUndefined(e.enumerable)?!1:e.enumerable,e.get&&!function(){var t=f.get;f.get=function(){var n=this;return e.get(e,this,function(){for(var e=arguments.length,r=Array(e),i=0;e>i;i++)r[i]=arguments[i];return t.apply(n,r)})}}(),e.set&&!function(){var t=f.set;f.set=function(n){var r=this;return e.set(e,this,n,function(e){return t.call(r,void 0===e?n:e)})}}(),Object.defineProperty(r.recordClass.prototype,o,f))}),r},destroy:function(e,t,n){var r=this;return n||(n={}),this._callSuper("destroy",e,t,n).then(function(i){return n.raw?i.data=r.getCollection(e).remove(t,n):i=r.getCollection(e).remove(t,n),delete r._pendingQueries[e][t],delete r._completedQueries[e][t],i})},destroyAll:function(e,t,n){var r=this;return n||(n={}),this._callSuper("destroyAll",e,t,n).then(function(i){n.raw?i.data=r.getCollection(e).removeAll(t,n):i=r.getCollection(e).removeAll(t,n);var o=r.hashQuery(e,t,n);return delete r._pendingQueries[e][o],delete r._completedQueries[e][o],i})},eject:function(e,t,n){return console.warn('DEPRECATED: "eject" is deprecated, use "remove" instead'),this.remove(e,t,n)},ejectAll:function(e,t,n){return console.warn('DEPRECATED: "ejectAll" is deprecated, use "removeAll" instead'),this.removeAll(e,t,n)},find:function(e,t,n){var r=this;n||(n={});var i=this._pendingQueries[e][t];if(j.fillIn(n,this.getMapper(e)),i)return i;var o=this.cachedFind(e,t,n),a=void 0;return a=n.force||!o?this._pendingQueries[e][t]=this._callSuper("find",e,t,n).then(function(i){return delete r._pendingQueries[e][t],i=r._end(e,i,n),r.cacheFind(e,i,t,n),i},function(n){return delete r._pendingQueries[e][t],j.reject(n)}):j.resolve(o)},findAll:function(e,t,n){var r=this;n||(n={});var i=this.hashQuery(e,t,n),o=this._pendingQueries[e][i];if(j.fillIn(n,this.getMapper(e)),o)return o;var a=this.cachedFindAll(e,i,n),s=void 0;return s=n.force||!a?this._pendingQueries[e][i]=this._callSuper("findAll",e,t,n).then(function(t){return delete r._pendingQueries[e][i],t=r._end(e,t,n),r.cacheFindAll(e,t,i,n),t},function(t){return delete r._pendingQueries[e][i],j.reject(t)}):j.resolve(a)},getCollection:function(e){var t=this._collections[e];if(!t)throw j.err(Ue+"#getCollection",e)(404,"collection");return t},hashQuery:function(e,t,n){return j.toJson(t)},inject:function(e,t,n){return console.warn('DEPRECATED: "inject" is deprecated, use "add" instead'),this.add(e,t,n)},remove:function(e,t,n){var r=this.getCollection(e).remove(t,n);return r&&this.removeRelated(e,[r],n),r},removeAll:function(e,t,n){var r=this.getCollection(e).removeAll(t,n);return r.length&&this.removeRelated(e,r,n),r},removeRelated:function(e,t,n){var r=this;j.forEachRelation(this.getMapper(e),n,function(e,n){t.forEach(function(t){var i=void 0,o=void 0;if(!e.foreignKey||e.type!==T&&e.type!==D?e.type===D&&e.localKeys?o={where:u.defineProperty({},e.getRelation().idAttribute,{in:j.get(t,e.localKeys)})}:e.type===D&&e.foreignKeys?o={where:u.defineProperty({},e.foreignKeys,{contains:e.getForeignKey(t)})}:e.type===N&&(i=r.remove(e.relation,e.getForeignKey(t),n)):o=u.defineProperty({},e.foreignKey,e.getForeignKey(t)),o&&(i=r.removeAll(e.relation,o,n)),i){if(j.isArray(i)&&!i.length)return;e.type===T&&(i=i[0]),e.setLocalField(t,i)}})})},update:function(e,t,n,r){var i=this;return r||(r={}),this._callSuper("update",e,t,n,r).then(function(t){return i._end(e,t,r)})},updateAll:function(e,t,n,r){var i=this;return r||(r={}),this._callSuper("updateAll",e,n,t,r).then(function(t){return i._end(e,t,r)})},updateMany:function(e,t,n){var r=this;return n||(n={}),this._callSuper("updateMany",e,t,n).then(function(t){return r._end(e,t,n)})}};Ne.forEach(function(e){qe[e]=function(t){for(var n,r=arguments.length,i=Array(r>1?r-1:0),o=1;r>o;o++)i[o-1]=arguments[o];return(n=this.getCollection(t))[e].apply(n,i)}});var Qe=Me.extend(qe),Be={beta:6,full:"3.0.0-beta.6",major:3,minor:0,patch:0};e.version=Be,e.Collection=U,e.Component=t,e.Container=Me,e.DataStore=Qe,e.Index=a,e.LinkedCollection=Le,e.Mapper=Re,e.Query=M,e.Record=V,e.Schema=Oe,e.utils=j,e.belongsToType=N,e.hasManyType=D,e.hasOneType=T,e.belongsTo=Q,e.hasMany=B,e.hasOne=G});
//# sourceMappingURL=js-data.min.map
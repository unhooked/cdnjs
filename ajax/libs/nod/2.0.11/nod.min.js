function nod(e){function n(e){var n=Array.isArray(e)?e:[e];n.forEach(function(e){var n,o;if(Array.isArray(e.validate)){if(!Array.isArray(e.errorMessage))throw'If you pass in `validate:...` as an array, then `errorMessage:...` also needs to be an array. "'+e.validate+'", and "'+e.errorMessage+'"';n=e.validate,o=e.errorMessage,n.forEach(function(n,r){e.validate=n,e.errorMessage=o[r],t(e)})}else t(e)})}function t(e){function n(e,n){var t=nod.getElements(n);t.forEach(function(n){var t=p.findOrMake(n,h,null,x);e.subscribeTo(t.id)})}var t=[],o=nod.getCheckFunction(e),r=nod.getElements(e.selector),s=r.map(function(n){return{listener:p.findOrMake(n,h,e.triggerEvents,x),checker:C.findOrMake(n,h),checkHandler:E.findOrMake(n,h,x),domNode:b.findOrMake(n,h,x)}});o.validate="function"==typeof e.validate?e.validate.toString():e.validate,"one-of"!==e.validate&&"only-one-of"!==e.validate&&"some-radio"!==e.validate||t.push(e.selector),"string"==typeof e.validate&&e.validate.indexOf("same-as")>-1&&t.push(e.validate.split(":")[1]),s.forEach(function(r){r.checker.subscribeTo(r.listener.id),n(r.checker,e.triggeredBy),n(r.checker,t);var s=nod.unique();r.checker.addCheck(o,s),r.checkHandler.subscribeTo(s,e.errorMessage,e.defaultStatus),x.noDom?g.subscribe(r.checkHandler.id):r.domNode.subscribeTo(r.checkHandler.id)}),i()}function o(e){var n=nod.getElement(e);n.addEventListener("submit",r,!1)}function r(e){if(x.preventSubmit&&!c(nod.constants.VALID)){e.preventDefault(),C.forEach(function(n){n.performCheck({event:e})});for(var n=0,t=E.length;t>n;n++){var o=E[n];if(o.getStatus().status===nod.constants.INVALID){o.element.focus();break}}}}function s(e){var n=nod.getElements(e);n.forEach(function(e){p.removeItem(e),C.removeItem(e),E.removeItem(e),b.removeItem(e)})}function a(e,n){if(arguments.length>1){var t=e;e={},e[t]=n}for(var r in e)x[r]=e[r];(e.submit||e.disableSubmit)&&i(),e.form&&o(e.form)}function i(){x.submit&&x.disableSubmit&&nod.getElements(x.submit).forEach(function(e){e.disabled=!c(nod.constants.VALID)})}function c(e){for(var n=0,t=E.length;t>n;n++)if(E[n].getStatus().status!==e)return!1;return!0}function u(e){e=Array.isArray(e)?e:[e],e.forEach(function(e){var n=nod.getElements(e.selector);n.forEach(function(n){var t=b.findOrMake(n);t.setMessageOptions(e.parent,e.errorSpan)})})}function d(e,n){var t=nod.getElement(e),o=E.findOrMake(t).getStatus();return n?o:o.status}function f(e){var n=e?nod.getElements(e).map(C.findOrMake):C;n.forEach(function(e){e.performCheck()})}function l(e,n){var t=nod.getElement(e),o=b.findOrMake(t);o.set({result:nod.constants.INVALID,errorMessage:n||""})}function v(e){var n=nod.getElement(e),t=b.findOrMake(n);t.set({result:nod.constants.VALID,errorMessage:""})}function m(){for(var e=0,n=b.length;n>e;e++)v(b[e].element)}var x={},h=nod.makeMediator(),g=nod.makeEventEmitter(h),p=nod.makeCollection(nod.makeListener),C=nod.makeCollection(nod.makeChecker),E=nod.makeCollection(nod.makeCheckHandler),b=nod.makeCollection(nod.makeDomNode);h.subscribe("all",i),h.subscribe("all",function(e){"function"==typeof x.tap&&"check"===e.type&&x.tap(e)});var k={add:n,remove:s,areAll:c,getStatus:d,configure:a,setMessageOptions:u,performCheck:f,setInvalid:l,setValid:v,setAllNodeValid:m};return e&&k.configure(e),k}nod.constants={VALID:"valid",INVALID:"invalid",UNCHECKED:"unchecked"},nod.classes={successClass:"nod-success",successMessageClass:"nod-success-message",errorClass:"nod-error",errorMessageClass:"nod-error-message"},nod.unique=function(){var e=0;return function(){return e++}}(),nod.makeMediator=function(){var e=[],n=[];return{subscribe:function(t,o){"all"===t?n.push(o):(e[t]||(e[t]=[]),-1===e[t].indexOf(o)&&e[t].push(o))},fire:function(t){var o=e[t.id].concat(n);o.forEach(function(e){e(t)})}}},nod.findCollectionIndex=function(e,n){for(var t in e)if(e[t].element===n)return t;return-1},nod.makeCollection=function(e){var n=[];return n.findOrMake=function(t){var o=nod.findCollectionIndex(n,t);if(-1!==o)return n[o];var r=e.apply(null,arguments);return n.push(r),r},n.removeItem=function(e){var t=nod.findCollectionIndex(n,e),o=n[t];o&&("function"==typeof o.dispose&&o.dispose(),n.splice(t,1))},n},nod.makeListener=function(e,n,t,o){function r(e){n.fire({id:i,event:e,type:"change"})}function s(){e.removeEventListener("input",r,!1),e.removeEventListener("change",r,!1),e.removeEventListener("blur",r,!1),a&&a.off(),t&&t.forEach(function(n){e.removeEventListener(n,r,!1)})}var a,i=nod.unique();return e.addEventListener("input",r,!1),e.addEventListener("change",r,!1),e.addEventListener("blur",r,!1),o.jQuery&&(a=o.jQuery(e),a.on("propertychange change click keyup input paste",r)),t&&(t=Array.isArray(t)?t:[t],t.forEach(function(n){e.addEventListener(n,r,!1)})),{element:e,dispose:s,id:i}},nod.makeChecker=function(e,n){function t(e){n.subscribe(e,o)}function o(e){s.forEach(function(n){n(e||{})})}function r(t,o){function r(r){n.fire({id:o,type:"check",result:r,element:e,validate:t.validate})}s.push(function(n){var o=void 0!==e.value?e.value:e.innerHTML;n.element=e,t(r,o,n)})}var s=[];return{subscribeTo:t,addCheck:r,performCheck:o,element:e}},nod.makeCheckHandler=function(e,n,t){function o(e,t,o){i[e]||(i[e]={status:o||nod.constants.UNCHECKED,errorMessage:t}),n.subscribe(e,r)}function r(e){i[e.id].status=e.result?nod.constants.VALID:nod.constants.INVALID,s()}function s(){var t=a();n.fire({id:c,type:"result",result:t.status,element:e,errorMessage:t.errorMessage})}function a(){var e,n;for(var t in i)if(e=i[t].status,i[t].status===nod.constants.INVALID){n=i[t].errorMessage;break}return{status:e,errorMessage:n}}var i={},c=nod.unique();return{id:c,subscribeTo:o,checkHandler:r,getStatus:a,element:e}},nod.hasClass=function(e,n){return n.classList?n.classList.contains(e):!!n.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},nod.removeClass=function(e,n){n.classList?n.classList.remove(e):nod.hasClass(e,n)&&(n.className=n.className.replace(new RegExp("(?:^|\\s)"+e+"(?!\\S)"),""))},nod.addClass=function(e,n){n.classList?n.classList.add(e):nod.hasClass(e,n)||(n.className+=" "+e)},nod.getParent=function(e,n){var t=n.parentClass;return t?(t="."===t.charAt(0)?t.slice(1):t,nod.findParentWithClass(e.parentNode,t)):e.parentNode},nod.findParentWithClass=function(e,n){return e.parentNode?nod.hasClass(n,e)?e:nod.findParentWithClass(e.parentNode,n):e},nod.makeDomNode=function(e,n,t){function o(e){var n=t.successClass||nod.classes.successClass,o=t.errorClass||nod.classes.errorClass;switch(e){case nod.constants.VALID:nod.removeClass(o,u),nod.addClass(n,u);break;case nod.constants.INVALID:nod.removeClass(n,u),nod.addClass(o,u)}}function r(e,n){var o=t.successMessageClass||nod.classes.successMessageClass,r=t.errorMessageClass||nod.classes.errorMessageClass;switch(l.style.display="none",e){case nod.constants.VALID:nod.removeClass(r,l),nod.addClass(o,l),t.successMessage&&(l.textContent=t.successMessage,l.style.display="");break;case nod.constants.INVALID:nod.removeClass(o,l),nod.addClass(r,l),l.textContent=n,l.style.display=""}}function s(e){var n=e.result,s=e.errorMessage;d===nod.constants.INVALID||0===t.delay?(d=n,o(n),r(n,s)):(clearTimeout(f),f=setTimeout(function(){d=n,o(n),r(n,s),f=null},t.delay||700))}function a(e){n.subscribe(e,s)}function i(e,n){e&&(u=nod.getElement(e)),n&&(l.parentNode.removeChild(l),l=nod.getElement(n),v=!0)}function c(){nod.removeClass(t.errorClass||nod.classes.errorClass,u),nod.removeClass(t.successClass||nod.classes.successClass,u),l.parentNode&&!v&&l.parentNode.removeChild(l)}var u=nod.getParent(e,t),d=nod.constants.UNCHECKED,f=null,l=document.createElement("span"),v=!1;return l.style.display="none",t.noDom||u.appendChild(l),{subscribeTo:a,element:e,setMessageOptions:i,dispose:c,set:s}},nod.makeEventEmitter=function(e){function n(e){if(!CustomEvent)throw"nod.validate tried to fire a custom event, but the browser does not support CustomEvent's";o=new CustomEvent("nod.validation",{detail:e}),e.element.dispatchEvent(o)}function t(t){e.subscribe(t,n)}var o;return{subscribe:t}},nod.getElement=function(e){return nod.getElements(e)[0]},nod.getElements=function(e){if(!e)return[];if("string"==typeof e){if(window.jQuery)return window.jQuery(e).get();var n=document.querySelectorAll(e);return[].map.call(n,function(e){return e})}if(e.jquery)return e.get();if(1===e.nodeType)return[e];if(Array.isArray(e)){var t=[];return e.forEach(function(e){var n=nod.getElements(e);t=t.concat(n)}),t}throw"Unknown type of elements in your `selector`: "+e},nod.getCheckFunction=function(e){if("function"==typeof e.validate)return e.validate;if(e.validate instanceof RegExp)return nod.checkFunctions.regexp(e.validate);var n=e.validate.split(":"),t=n.shift();if("one-of"!==t&&"only-one-of"!==t&&"same-as"!==t&&"some-radio"!==t||n.push(e.selector),"function"==typeof nod.checkFunctions[t])return nod.checkFunctions[t].apply(null,n);throw"Couldn't find your validator function \""+t+'" for "'+e.selector+'"'},nod.checkFunctions={presence:function(){return function(e,n){e(n.length>0)}},exact:function(e){return function(n,t){n(t===e)}},contains:function(e){return function(n,t){n(t.indexOf(e)>-1)}},not:function(e){return function(n,t){n(t!==e)}},"min-length":function(e){return function(n,t){n(t.length>=e)}},"max-length":function(e){return function(n,t){n(t.length<=e)}},"exact-length":function(e){return function(n,t){n(t.length===+e)}},"between-length":function(e,n){return function(t,o){t(o.length>=e&&o.length<=n)}},"max-number":function(e){return function(n,t){n(e>=+t)}},"min-number":function(e){return function(n,t){n(+t>=e)}},"between-number":function(e,n){return function(t,o){t(+o>=e&&n>=+o)}},integer:function(){return function(e,n){e(/^\s*\d+\s*$/.test(n))}},"float":function(){return function(e,n){e(/^[-+]?[0-9]+(\.[0-9]+)?$/.test(n))}},"same-as":function(e){var n=nod.getElement(e);return function(e,t,o){o&&o.event&&o.event.target&&o.event.target!==o.element&&0===t.length||e(t===n.value)}},"one-of":function(e){function n(){return t.reduce(function(e,n){return e+""+(n.value||"")},"")}var t=nod.getElements(e);return function(e){e(n().trim().length>0)}},"only-one-of":function(e){var n=nod.getElements(e);return function(e,t){var o=0;n.forEach(function(e){e.value&&o++}),e(1===o)}},checked:function(){return function(e,n,t){e(t.element.checked)}},"some-radio":function(e){var n=nod.getElements(e);return function(e,t,o){var r=n.reduce(function(e,n){return e||n.checked},!1);e(r)}},regexp:function(e){return function(n,t){n(e.test(t))}},email:function(){var e=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;return function(n,t){n(e.test(t))}}};try{new CustomEvent("test")}catch(e){var CustomEvent=function(e,n){var t;return n=n||{bubbles:!1,cancelable:!1,detail:void 0},t=document.createEvent("CustomEvent"),t.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),t};CustomEvent.prototype=window.Event.prototype,window.CustomEvent=CustomEvent}"undefined"!=typeof module&&module.exports&&(module.exports=nod);
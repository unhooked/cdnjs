function nod(){function e(e){var t=Array.isArray(e)?e:[e];t.forEach(function(e){var t,r;if(Array.isArray(e.validate)){if(!Array.isArray(e.errorMessage))throw'If you pass in `validate:...` as an array, then `errorMessage:...` also needs to be an array. "'+e.validate+'", and "'+e.errorMessage+'"';t=e.validate,r=e.errorMessage,t.forEach(function(t,o){e.validate=t,e.errorMessage=r[o],n(e)})}else n(e)})}function n(e){function n(e,n){var t=nod.getElements(n);t.forEach(function(n){var t=l.findOrMake(n,f);e.subscribeTo(t.id)})}var t=[],r=nod.getCheckFunction(e),o=nod.getElements(e.selector),s=o.map(function(n){return{listener:l.findOrMake(n,f,e.triggerEvents),checker:x.findOrMake(n,f),checkHandler:v.findOrMake(n,f,d),domNode:m.findOrMake(n,f,d)}});r.validate="function"==typeof e.validate?e.validate.toString():e.validate,"one-of"!==e.validate&&"only-one-of"!==e.validate&&"some-radio"!==e.validate||t.push(e.selector),"string"==typeof e.validate&&e.validate.indexOf("same-as")>-1&&t.push(e.validate.split(":")[1]),s.forEach(function(o){o.checker.subscribeTo(o.listener.id),n(o.checker,e.triggeredBy),n(o.checker,t);var s=nod.unique();o.checker.addCheck(r,s),o.checkHandler.subscribeTo(s,e.errorMessage,e.defaultStatus),o.domNode.subscribeTo(o.checkHandler.id)}),a()}function t(e,n){var t=nod.getElement(e);t.addEventListener("submit",r,!1)}function r(e){if(d.preventSubmit&&!c(nod.constants.VALID)){e.preventDefault(),x.forEach(function(n){n.performCheck({event:e})});for(var n=0,t=v.length;t>n;n++){var r=v[n];if(r.getStatus().status===nod.constants.INVALID){r.element.focus();break}}}}function o(e){var n=nod.getElements(e);n.forEach(function(e){l.removeItem(e),x.removeItem(e),v.removeItem(e),m.removeItem(e)})}function s(e,n){if(arguments.length>1){var r=e;e={},e[r]=n}for(var o in e)d[o]=e[o];(e.submit||e.disableSubmit)&&a(),e.form&&t(e.form)}function a(){d.submit&&d.disableSubmit&&(nod.getElement(d.submit).disabled=!c(nod.constants.VALID))}function c(e){for(var n=0,t=v.length;t>n;n++)if(v[n].getStatus().status!==e)return!1;return!0}function i(e){var n=nod.getElements(e.selector);n.forEach(function(n){var t=m.findOrMake(n);t.setMessageOptions(e.parent,e.errorSpan)})}function u(e,n){var t=nod.getElement(e),r=v.findOrMake(t).getStatus();return n?r:r.status}var d={},f=nod.makeMediator(),l=nod.makeCollection(nod.makeListener),x=nod.makeCollection(nod.makeChecker),v=nod.makeCollection(nod.makeCheckHandler),m=nod.makeCollection(nod.makeDomNode);return f.subscribe("all",a),f.subscribe("all",function(e){"function"==typeof d.tap&&"check"===e.type&&d.tap(e)}),{add:e,remove:o,areAll:c,getStatus:u,configure:s,setMessageOptions:i}}nod.constants={VALID:"valid",INVALID:"invalid",UNCHECKED:"unchecked"},nod.classes={successClass:"nod-success",successMessageClass:"nod-success-message",errorClass:"nod-error",errorMessageClass:"nod-error-message"},nod.unique=function(){var e=0;return function(){return e++}}(),nod.makeMediator=function(){var e=[],n=[];return{subscribe:function(t,r){"all"===t?n.push(r):(e[t]||(e[t]=[]),-1===e[t].indexOf(r)&&e[t].push(r))},fire:function(t){var r=e[t.id].concat(n);r.forEach(function(e){e(t)})}}},nod.findCollectionIndex=function(e,n){for(var t in e)if(e[t].element===n)return t;return-1},nod.makeCollection=function(e){var n=[];return n.findOrMake=function(t){var r=nod.findCollectionIndex(n,t);if(-1!==r)return n[r];var o=e.apply(null,arguments);return n.push(o),o},n.removeItem=function(e){var t=nod.findCollectionIndex(n,e),r=n[t];r&&("function"==typeof r.dispose&&r.dispose(),n.splice(t,1))},n},nod.makeListener=function(e,n,t){function r(e){n.fire({id:s,event:e,type:"change"})}function o(){e.removeEventListener("input",r,!1),e.removeEventListener("change",r,!1),e.removeEventListener("blur",r,!1),t&&t.forEach(function(n){e.removeEventListener(n,r,!1)})}var s=nod.unique();return e.addEventListener("input",r,!1),e.addEventListener("change",r,!1),e.addEventListener("blur",r,!1),t&&(t=Array.isArray(t)?t:[t],t.forEach(function(n){e.addEventListener(n,r,!1)})),{element:e,dispose:o,id:s}},nod.makeChecker=function(e,n){function t(e){n.subscribe(e,r)}function r(e){s.forEach(function(n){n(e||{})})}function o(t,r){function o(o){n.fire({id:r,type:"check",result:o,element:e,validate:t.validate})}s.push(function(n){var r=void 0!==e.value?e.value:e.innerHTML;n.element=e,t(o,r,n)})}var s=[];return{subscribeTo:t,addCheck:o,performCheck:r,element:e}},nod.makeCheckHandler=function(e,n,t){function r(e,t,r){c[e]||(c[e]={status:r||nod.constants.UNCHECKED,errorMessage:t}),n.subscribe(e,o)}function o(e){c[e.id].status=e.result?nod.constants.VALID:nod.constants.INVALID,s()}function s(){var e=a();n.fire({id:i,type:"result",result:e.status,errorMessage:e.errorMessage})}function a(){var e,n;for(var t in c)if(e=c[t].status,c[t].status===nod.constants.INVALID){n=c[t].errorMessage;break}return{status:e,errorMessage:n}}var c={},i=nod.unique();return{id:i,subscribeTo:r,checkHandler:o,getStatus:a,element:e}},nod.hasClass=function(e,n){return!!n.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},nod.removeClass=function(e,n){nod.hasClass(e,n)&&(n.className=n.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)"),""))},nod.addClass=function(e,n){nod.hasClass(e,n)||(n.className+=" "+e)},nod.getParent=function(e,n){var t=n.parentClass;return t?(t="."===t.charAt(0)?t.slice(1):t,nod.findParentWithClass(e.parentNode,t)):e.parentNode},nod.findParentWithClass=function(e,n){return e.parentNode?nod.hasClass(n,e)?e:nod.findParentWithClass(e.parentNode,n):e},nod.makeDomNode=function(e,n,t){function r(e){var n=t.successClass||nod.classes.successClass,r=t.errorClass||nod.classes.errorClass;switch(e){case nod.constants.VALID:nod.removeClass(r,u),nod.addClass(n,u);break;case nod.constants.INVALID:nod.removeClass(n,u),nod.addClass(r,u)}}function o(e,n){var r=t.successMessageClass||nod.classes.successMessageClass,o=t.errorMessageClass||nod.classes.errorMessageClass;switch(l.style.display="none",e){case nod.constants.VALID:nod.removeClass(o,l),nod.addClass(r,l),t.successMessage&&(l.textContent=t.successMessage,l.style.display="");break;case nod.constants.INVALID:nod.removeClass(r,l),nod.addClass(o,l),l.textContent=n,l.style.display=""}}function s(e){var n=e.result,s=e.errorMessage;d===nod.constants.INVALID||0===t.delay?(d=n,r(n),o(n,s)):(clearTimeout(f),f=setTimeout(function(){d=n,r(n),o(n,s),f=null},t.delay||700))}function a(e){n.subscribe(e,s)}function c(e,n){e&&(u=nod.getElement(e)),n&&(l.parentNode.removeChild(l),l=nod.getElement(n),x=!0)}function i(){nod.removeClass(t.errorClass||nod.classes.errorClass,u),nod.removeClass(t.successClass||nod.classes.successClass,u),x||l.parentNode.removeChild(l)}var u=nod.getParent(e,t),d=nod.constants.UNCHECKED,f=null,l=document.createElement("span"),x=!1;return l.style.display="none",u.appendChild(l),{subscribeTo:a,element:e,setMessageOptions:c,dispose:i}},nod.getElement=function(e){return nod.getElements(e)[0]},nod.getElements=function(e){if(!e)return[];if("string"==typeof e){if(window.jQuery)return window.jQuery(e).get();var n=document.querySelectorAll(e);return[].map.call(n,function(e){return e})}if(e.jquery)return e.get();if(1===e.nodeType)return[e];if(Array.isArray(e)){var t=[];return e.forEach(function(e){var n=nod.getElements(e);t=t.concat(n)}),t}throw"Unknown type of elements in your `selector`: "+e},nod.getCheckFunction=function(e){if("function"==typeof e.validate)return e.validate;if(e.validate instanceof RegExp)return nod.checkFunctions.regexp(e.validate);var n=e.validate.split(":"),t=n.shift();if("one-of"!==t&&"only-one-of"!==t&&"same-as"!==t&&"some-radio"!==t||n.push(e.selector),"function"==typeof nod.checkFunctions[t])return nod.checkFunctions[t].apply(null,n);throw"Couldn't find your validator function \""+t+'" for "'+e.selector+'"'},nod.checkFunctions={presence:function(){return function(e,n){e(n.length>0)}},exact:function(e){return function(n,t){n(t===e)}},contains:function(e){return function(n,t){n(t.indexOf(e)>-1)}},not:function(e){return function(n,t){n(t!==e)}},"min-length":function(e){return function(n,t){n(t.length>=e)}},"max-length":function(e){return function(n,t){n(t.length<=e)}},"exact-length":function(e){return function(n,t){n(t.length===+e)}},"between-length":function(e,n){return function(t,r){t(r.length>=e&&r.length<=n)}},"max-number":function(e){return function(n,t){n(e>=+t)}},"min-number":function(e){return function(n,t){n(e>=+t)}},"between-number":function(e,n){return function(t,r){t(+r>=e&&n>=+r)}},integer:function(){return function(e,n){e(/^\s*\d+\s*$/.test(n))}},"float":function(){return function(e,n){e(/^[-+]?[0-9]+(\.[0-9]+)?$/.test(n))}},"same-as":function(e){var n=nod.getElement(e);return function(e,t,r){r&&r.event&&r.event.target&&r.event.target!==r.element&&0===t.length||e(t===n.value)}},"one-of":function(e){function n(){return t.reduce(function(e,n){return e+""+(n.value||"")},"")}var t=nod.getElements(e);return function(e){e(n().trim().length>0)}},"only-one-of":function(e){var n=nod.getElements(e);return function(e,t){var r=0;n.forEach(function(e){e.value&&r++}),e(1===r)}},checked:function(){return function(e,n,t){e(t.element.checked)}},"some-radio":function(e){var n=nod.getElements(e);return function(e,t,r){var o=n.reduce(function(e,n){return e||r.element.checked},!1);e(o)}},regexp:function(e){return function(n,t){n(e.test(t))}},email:function(){var e=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;return function(n,t){n(e.test(t))}}};
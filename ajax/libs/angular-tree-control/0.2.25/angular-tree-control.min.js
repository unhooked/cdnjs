"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="treeControl"),function(e){"use strict";function o(e){return function(){for(var o,n=[],t=e;t&&t.node!==e.synteticRoot;)o!==t.node&&n.push(t.node),o=t.node,t=t.$parent;return n}}e.module("treeControl",[]).constant("treeConfig",{templateUrl:null}).directive("treecontrol",["$compile",function(n){function t(e,o){return e?o?'class="'+e+'"':e:""}function s(e,o,n){e.hasOwnProperty(o)||(e[o]=n)}return{restrict:"EA",require:"treecontrol",transclude:!0,scope:{treeModel:"=",selectedNode:"=?",selectedNodes:"=?",expandedNodes:"=?",onSelection:"&",onNodeToggle:"&",options:"=?",orderBy:"=?",reverseOrder:"@",filterExpression:"=?",filterComparator:"=?"},controller:["$scope","$templateCache","$interpolate","treeConfig",function(d,i,l,r){function a(e){return!e[d.options.nodeChildren]||0===e[d.options.nodeChildren].length}function c(o,n){if(e.isArray(o)){n=n||[];for(var t=0;t<o.length;t++)n[t]=o[t]}else if(e.isObject(o)){n=n||{};for(var s in o)!hasOwnProperty.call(o,s)||"$"===s.charAt(0)&&"$"===s.charAt(1)||(n[s]=o[s])}return n||o}function p(o,n){return o&&n?(o=c(o),o[d.options.nodeChildren]=[],n=c(n),n[d.options.nodeChildren]=[],e.equals(o,n)):!1}function u(){return!0}function f(e){if(!d.options.multiSelection&&d.options.equality(e,d.selectedNode))return!0;if(d.options.multiSelection&&d.selectedNodes){for(var o=0;o<d.selectedNodes.length;o++)if(d.options.equality(e,d.selectedNodes[o]))return!0;return!1}}d.options=d.options||{},s(d.options,"multiSelection",!1),s(d.options,"nodeChildren","children"),s(d.options,"dirSelectable","true"),s(d.options,"injectClasses",{}),s(d.options.injectClasses,"ul",""),s(d.options.injectClasses,"li",""),s(d.options.injectClasses,"liSelected",""),s(d.options.injectClasses,"iExpanded",""),s(d.options.injectClasses,"iCollapsed",""),s(d.options.injectClasses,"iLeaf",""),s(d.options.injectClasses,"label",""),s(d.options.injectClasses,"labelSelected",""),s(d.options,"equality",p),s(d.options,"isLeaf",a),s(d.options,"allowDeselect",!0),s(d.options,"isSelectable",u),d.selectedNodes=d.selectedNodes||[],d.expandedNodes=d.expandedNodes||[],d.expandedNodesMap={};for(var $=0;$<d.expandedNodes.length;$++)d.expandedNodesMap[""+$]=d.expandedNodes[$];d.parentScopeOfTree=d.$parent,d.headClass=function(e){var o=t(d.options.injectClasses.liSelected,!1),n="";return o&&f(e)&&(n=" "+o),d.options.isLeaf(e)?"tree-leaf"+n:d.expandedNodesMap[this.$id]?"tree-expanded"+n:"tree-collapsed"+n},d.iBranchClass=function(){return t(d.expandedNodesMap[this.$id]?d.options.injectClasses.iExpanded:d.options.injectClasses.iCollapsed)},d.nodeExpanded=function(){return!!d.expandedNodesMap[this.$id]},d.selectNodeHead=function(){var e=this,n=void 0===d.expandedNodesMap[e.$id];if(d.expandedNodesMap[e.$id]=n?e.node:void 0,n)d.expandedNodes.push(e.node);else{for(var t,s=0;s<d.expandedNodes.length&&!t;s++)d.options.equality(d.expandedNodes[s],e.node)&&(t=s);void 0!==t&&d.expandedNodes.splice(t,1)}if(d.onNodeToggle){var i=e.$parent.node===e.synteticRoot?null:e.$parent.node,l=o(e);d.onNodeToggle({node:e.node,$parentNode:i,$path:l,$index:e.$index,$first:e.$first,$middle:e.$middle,$last:e.$last,$odd:e.$odd,$even:e.$even,expanded:n})}},d.selectNodeLabel=function(e){var n=this;if(d.options.isLeaf(e)||d.options.dirSelectable&&d.options.isSelectable(e)){if(d.options.isLeaf(e)&&!d.options.isSelectable(e))return;var t=!1;if(d.options.multiSelection){for(var s=-1,i=0;i<d.selectedNodes.length;i++)if(d.options.equality(e,d.selectedNodes[i])){s=i;break}-1===s?(d.selectedNodes.push(e),t=!0):d.selectedNodes.splice(s,1)}else d.options.equality(e,d.selectedNode)&&d.options.allowDeselect?d.selectedNode=void 0:(d.selectedNode=e,t=!0);if(d.onSelection){var l=n.$parent.node===n.synteticRoot?null:n.$parent.node,r=o(n);d.onSelection({node:e,selected:t,$parentNode:l,$path:r,$index:n.$index,$first:n.$first,$middle:n.$middle,$last:n.$last,$odd:n.$odd,$even:n.$even})}}else this.selectNodeHead()},d.selectedClass=function(){var e=f(this.node),o=t(d.options.injectClasses.labelSelected,!1),n="";return o&&e&&(n=" "+o),e?"tree-selected"+n:""},d.unselectableClass=function(){var e=!d.options.isSelectable(this.node),o=t(d.options.injectClasses.labelUnselectable,!1);return e?"tree-unselectable "+o:""},d.isReverse=function(){return!("false"===d.reverseOrder||"False"===d.reverseOrder||""===d.reverseOrder||d.reverseOrder===!1)},d.orderByFunc=function(){return d.orderBy};var h,C={orderBy:d.orderBy?" | orderBy:orderByFunc():isReverse()":"",ulClass:t(d.options.injectClasses.ul,!0),nodeChildren:d.options.nodeChildren,liClass:t(d.options.injectClasses.li,!0),iLeafClass:t(d.options.injectClasses.iLeaf,!1),labelClass:t(d.options.injectClasses.label,!1)},N=d.options.templateUrl||r.templateUrl;N&&(h=i.get(N)),h||(h='<ul {{options.ulClass}} ><li ng-repeat="node in node.{{options.nodeChildren}} | filter:filterExpression:filterComparator {{options.orderBy}}" ng-class="headClass(node)" {{options.liClass}}set-node-to-data><i class="tree-branch-head" ng-class="iBranchClass()" ng-click="selectNodeHead(node)"></i><i class="tree-leaf-head {{options.iLeafClass}}"></i><div class="tree-label {{options.labelClass}}" ng-class="[selectedClass(), unselectableClass()]" ng-click="selectNodeLabel(node)" tree-transclude></div><treeitem ng-if="nodeExpanded()"></treeitem></li></ul>'),this.template=n(l(h)({options:C}))}],compile:function(o,n,t){return function(o,n,s,d){o.$watch("treeModel",function(n){if(e.isArray(n)){if(e.isDefined(o.node)&&e.equals(o.node[o.options.nodeChildren],n))return;o.node={},o.synteticRoot=o.node,o.node[o.options.nodeChildren]=n}else{if(e.equals(o.node,n))return;o.node=n}}),o.$watchCollection("expandedNodes",function(t,s){var d=0,i={},l=n.find("li"),r=[];e.forEach(l,function(o){var n=e.element(o),t={$id:n.data("scope-id"),node:n.data("node")};r.push(t)}),e.forEach(t,function(e){for(var n=!1,t=0;t<r.length&&!n;t++){var s=r[t];o.options.equality(e,s.node)&&(i[s.$id]=s.node,n=!0)}n||(i[d++]=e)}),o.expandedNodesMap=i}),d.template(o,function(e){n.html("").append(e)}),o.$treeTransclude=t}}}}]).directive("setNodeToData",["$parse",function(e){return{restrict:"A",link:function(e,o,n){o.data("node",e.node),o.data("scope-id",e.$id)}}}]).directive("treeitem",function(){return{restrict:"E",require:"^treecontrol",link:function(e,o,n,t){t.template(e,function(e){o.html("").append(e)})}}}).directive("treeTransclude",function(){return{link:function(n,t,s,d){if(n.options.isLeaf(n.node)||e.forEach(n.expandedNodesMap,function(e,o){n.options.equality(e,n.node)&&(n.expandedNodesMap[n.$id]=n.node,n.expandedNodesMap[o]=void 0)}),!n.options.multiSelection&&n.options.equality(n.node,n.selectedNode))n.selectedNode=n.node;else if(n.options.multiSelection){for(var i=[],l=0;l<n.selectedNodes.length;l++)n.options.equality(n.node,n.selectedNodes[l])&&i.push(n.node);n.selectedNodes=i}n.transcludeScope=n.parentScopeOfTree.$new(),n.transcludeScope.node=n.node,n.transcludeScope.$path=o(n),n.transcludeScope.$parentNode=n.$parent.node===n.synteticRoot?null:n.$parent.node,n.transcludeScope.$index=n.$index,n.transcludeScope.$first=n.$first,n.transcludeScope.$middle=n.$middle,n.transcludeScope.$last=n.$last,n.transcludeScope.$odd=n.$odd,n.transcludeScope.$even=n.$even,n.$on("$destroy",function(){n.transcludeScope.$destroy()}),n.$treeTransclude(n.transcludeScope,function(e){t.empty(),t.append(e)})}}})}(angular);
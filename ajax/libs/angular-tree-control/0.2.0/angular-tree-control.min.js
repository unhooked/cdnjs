"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="treeControl"),function(e){"use strict";e.module("treeControl",[]).directive("treecontrol",["$compile",function(o){function n(e,o){return e?o?'class="'+e+'"':e:""}function t(e,o,n){e.hasOwnProperty(o)||(e[o]=n)}return{restrict:"EA",require:"treecontrol",transclude:!0,scope:{treeModel:"=",selectedNode:"=?",selectedNodes:"=?",expandedNodes:"=?",onSelection:"&",onNodeToggle:"&",options:"=?",orderBy:"@",reverseOrder:"@",filterExpression:"=?",filterComparator:"=?"},controller:["$scope",function(s){function d(e){return!e[s.options.nodeChildren]||0===e[s.options.nodeChildren].length}function i(o,n){if(e.isArray(o)){n=n||[];for(var t=0;t<o.length;t++)n[t]=o[t]}else if(e.isObject(o)){n=n||{};for(var s in o)!hasOwnProperty.call(o,s)||"$"===s.charAt(0)&&"$"===s.charAt(1)||(n[s]=o[s])}return n||o}function l(o,n){return void 0===o||void 0===n?!1:(o=i(o),o[s.options.nodeChildren]=[],n=i(n),n[s.options.nodeChildren]=[],e.equals(o,n))}function a(){return!0}function r(e){if(!s.options.multiSelection&&s.options.equality(e,s.selectedNode))return!0;if(s.options.multiSelection&&s.selectedNodes){for(var o=0;o<s.selectedNodes.length;o++)if(s.options.equality(e,s.selectedNodes[o]))return!0;return!1}}s.options=s.options||{},t(s.options,"multiSelection",!1),t(s.options,"nodeChildren","children"),t(s.options,"dirSelectable","true"),t(s.options,"injectClasses",{}),t(s.options.injectClasses,"ul",""),t(s.options.injectClasses,"li",""),t(s.options.injectClasses,"liSelected",""),t(s.options.injectClasses,"iExpanded",""),t(s.options.injectClasses,"iCollapsed",""),t(s.options.injectClasses,"iLeaf",""),t(s.options.injectClasses,"label",""),t(s.options.injectClasses,"labelSelected",""),t(s.options,"equality",l),t(s.options,"isLeaf",d),t(s.options,"allowDeselect",!0),t(s.options,"isSelectable",a),s.selectedNodes=s.selectedNodes||[],s.expandedNodes=s.expandedNodes||[],s.expandedNodesMap={};for(var c=0;c<s.expandedNodes.length;c++)s.expandedNodesMap[""+c]=s.expandedNodes[c];s.parentScopeOfTree=s.$parent,s.headClass=function(e){var o=n(s.options.injectClasses.liSelected,!1),t="";return o&&r(e)&&(t=" "+o),s.options.isLeaf(e)?"tree-leaf"+t:s.expandedNodesMap[this.$id]?"tree-expanded"+t:"tree-collapsed"+t},s.iBranchClass=function(){return n(s.expandedNodesMap[this.$id]?s.options.injectClasses.iExpanded:s.options.injectClasses.iCollapsed)},s.nodeExpanded=function(){return!!s.expandedNodesMap[this.$id]},s.selectNodeHead=function(){var e=this,o=void 0===s.expandedNodesMap[e.$id];if(s.expandedNodesMap[e.$id]=o?e.node:void 0,o)s.expandedNodes.push(e.node);else{for(var n,t=0;t<s.expandedNodes.length&&!n;t++)s.options.equality(s.expandedNodes[t],e.node)&&(n=t);void 0!==n&&s.expandedNodes.splice(n,1)}if(s.onNodeToggle){var d=e.$parent.node===e.synteticRoot?null:e.$parent.node;s.onNodeToggle({node:e.node,$parentNode:d,$index:e.$index,$first:e.$first,$middle:e.$middle,$last:e.$last,$odd:e.$odd,$even:e.$even,expanded:o})}},s.selectNodeLabel=function(e){var o=this;if(s.options.isLeaf(e)||s.options.dirSelectable&&s.options.isSelectable(e)){if(s.options.isLeaf(e)&&!s.options.isSelectable(e))return;var n=!1;if(s.options.multiSelection){for(var t=-1,d=0;d<s.selectedNodes.length;d++)if(s.options.equality(e,s.selectedNodes[d])){t=d;break}-1===t?(s.selectedNodes.push(e),n=!0):s.selectedNodes.splice(t,1)}else s.options.equality(e,s.selectedNode)&&s.options.allowDeselect?s.selectedNode=void 0:(s.selectedNode=e,n=!0);if(s.onSelection){var i=o.$parent.node===o.synteticRoot?null:o.$parent.node;s.onSelection({node:e,selected:n,$parentNode:i,$index:o.$index,$first:o.$first,$middle:o.$middle,$last:o.$last,$odd:o.$odd,$even:o.$even})}}else this.selectNodeHead()},s.selectedClass=function(){var e=r(this.node),o=n(s.options.injectClasses.labelSelected,!1),t="";return o&&e&&(t=" "+o),e?"tree-selected"+t:""},s.unselectableClass=function(){var e=!s.options.isSelectable(this.node),o=n(s.options.injectClasses.labelUnselectable,!1);return e?"tree-unselectable "+o:""};var p=s.orderBy?" | orderBy:orderBy:reverseOrder":"",u="<ul "+n(s.options.injectClasses.ul,!0)+'><li ng-repeat="node in node.'+s.options.nodeChildren+" | filter:filterExpression:filterComparator "+p+'" ng-class="headClass(node)" '+n(s.options.injectClasses.li,!0)+'set-node-to-data><i class="tree-branch-head" ng-class="iBranchClass()" ng-click="selectNodeHead(node)"></i><i class="tree-leaf-head '+n(s.options.injectClasses.iLeaf,!1)+'"></i><div class="tree-label '+n(s.options.injectClasses.label,!1)+'" ng-class="[selectedClass(), unselectableClass()]" ng-click="selectNodeLabel(node)" tree-transclude></div><treeitem ng-if="nodeExpanded()"></treeitem></li></ul>';this.template=o(u)}],compile:function(o,n,t){return function(o,n,s,d){o.$watch("treeModel",function(n){if(e.isArray(n)){if(e.isDefined(o.node)&&e.equals(o.node[o.options.nodeChildren],n))return;o.node={},o.synteticRoot=o.node,o.node[o.options.nodeChildren]=n}else{if(e.equals(o.node,n))return;o.node=n}}),o.$watchCollection("expandedNodes",function(t,s){var d=0,i={},l=n.find("li"),a=[];e.forEach(l,function(o){var n=e.element(o),t={$id:n.data("scope-id"),node:n.data("node")};a.push(t)}),e.forEach(t,function(e){for(var n=!1,t=0;t<a.length&&!n;t++){var s=a[t];o.options.equality(e,s.node)&&(i[s.$id]=s.node,n=!0)}n||(i[d++]=e)}),o.expandedNodesMap=i}),d.template(o,function(e){n.html("").append(e)}),o.$treeTransclude=t}}}}]).directive("setNodeToData",["$parse",function(e){return{restrict:"A",link:function(e,o,n){o.data("node",e.node),o.data("scope-id",e.$id)}}}]).directive("treeitem",function(){return{restrict:"E",require:"^treecontrol",link:function(e,o,n,t){t.template(e,function(e){o.html("").append(e)})}}}).directive("treeTransclude",function(){return{link:function(o,n,t,s){if(o.options.isLeaf(o.node)||e.forEach(o.expandedNodesMap,function(e,n){o.options.equality(e,o.node)&&(o.expandedNodesMap[o.$id]=o.node,o.expandedNodesMap[n]=void 0)}),!o.options.multiSelection&&o.options.equality(o.node,o.selectedNode))o.selectedNode=o.node;else if(o.options.multiSelection){for(var d=[],i=0;i<o.selectedNodes.length;i++)o.options.equality(o.node,o.selectedNodes[i])&&d.push(o.node);o.selectedNodes=d}o.transcludeScope=o.parentScopeOfTree.$new(),o.transcludeScope.node=o.node,o.transcludeScope.$parentNode=o.$parent.node===o.synteticRoot?null:o.$parent.node,o.transcludeScope.$index=o.$index,o.transcludeScope.$first=o.$first,o.transcludeScope.$middle=o.$middle,o.transcludeScope.$last=o.$last,o.transcludeScope.$odd=o.$odd,o.transcludeScope.$even=o.$even,o.$on("$destroy",function(){o.transcludeScope.$destroy()}),o.$treeTransclude(o.transcludeScope,function(e){n.empty(),n.append(e)})}}})}(angular);
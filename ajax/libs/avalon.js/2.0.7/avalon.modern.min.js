!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.avalon=t():e.avalon=t()}(this,function(){return function(e){function t(a){if(n[a])return n[a].exports;var r=n[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var a=n(84);n(8),n(15),n(86),n(95),n(72),n(103),n(104),e.exports=a},,,function(e,t){(function(t){function n(e){return new n.init(e)}t.avalon=n,"undefined"!=typeof window&&(window.avalon=n),n.init=function(e){this[0]=this.element=e},n.fn=n.prototype=n.init.prototype,n.shadowCopy=function(e,t){for(var n in t)e[n]=t[n];return e};var a=/[^, ]+/g,r=t.console;n.shadowCopy(n,{noop:function(){},rword:a,inspect:{}.toString,ohasOwn:{}.hasOwnProperty,log:function(){r&&n.config.debug&&Function.apply.call(console.log,console,arguments)},warn:function(){if(r&&n.config.debug){var e=console.warn||console.log;Function.apply.call(e,console,arguments)}},error:function(e,t){throw(t||Error)(e)},oneObject:function(e,t){"string"==typeof e&&(e=e.match(a)||[]);for(var n={},r=void 0!==t?t:1,o=0,i=e.length;i>o;o++)n[e[o]]=r;return n}}),e.exports=n}).call(t,function(){return this}())},function(e,t){(function(t){var n=t,a={window:n,document:{createElement:function(){return{}},createElementNS:function(){return{}},contains:Boolean},root:{outerHTML:"x"},msie:NaN,modern:!0,avalonDiv:{},avalonFragment:null};if(n.location&&n.navigator&&n.window){var r=n.document;a.document=r,a.modern=n.dispatchEvent,a.root=r.documentElement,a.avalonDiv=r.createElement("div"),a.avalonFragment=r.createDocumentFragment(),n.VBArray&&(a.msie=r.documentMode||(n.XMLHttpRequest?7:6))}e.exports=a}).call(t,function(){return this}())},,function(e,t){function n(e,t,n){e[n.name]=avalon.parseExpr(n)}var a={},r=/([a-z\d])([A-Z]+)/g,o=/[-_][^-_]/g,i=/\d\.\d{4}/,l=/[-.*+?^${}()|[\]\/\\]/g,s=[].slice;avalon.shadowCopy(avalon,{caches:{},vmodels:{},filters:{},components:{},directives:{},eventHooks:{},eventListeners:{},validators:{},scopes:{},cssHooks:a,parsers:{number:function(e){return""===e?"":parseFloat(e)||0},string:function(e){return null===e||void 0===e?"":e+""},"boolean":function(e){return"true"===e}},version:"2.07",slice:function(e,t,n){return s.call(e,t,n)},css:function(e,t,n,r){e instanceof avalon&&(e=e[0]);var o=avalon.camelize(t);if(t=avalon.cssName(o)||o,void 0===n||"boolean"==typeof n){r=a[o+":get"]||a["@:get"],"background"===t&&(t="backgroundColor");var i=r(e,t);return n===!0?parseFloat(i)||0:i}if(""===n)e.style[t]="";else{if(null==n||n!==n)return;isFinite(n)&&!avalon.cssNumber[o]&&(n+="px"),r=a[o+":set"]||a["@:set"],r(e,t,n)}},directive:function(e,t){return t.parse=t.parse||n,this.directives[e]=t},isObject:function(e){return null!==e&&"object"==typeof e},range:function(e,t,n){n||(n=1),null==t&&(t=e||0,e=0);for(var a=-1,r=Math.max(0,Math.ceil((t-e)/n)),o=new Array(r);++a<r;)o[a]=e,e+=n;return o},hyphen:function(e){return e.replace(r,"$1-$2").toLowerCase()},camelize:function(e){return!e||e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(o,function(e){return e.charAt(1).toUpperCase()})},makeHashCode:function(e){return e=e||"avalon",String(Math.random()+Math.random()).replace(i,e)},escapeRegExp:function(e){return(e+"").replace(l,"\\$&")},Array:{merge:function(e,t){e.push.apply(e,t)},ensure:function(e,t){return-1===e.indexOf(t)?e.push(t):void 0},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(e,t){var n=e.indexOf(t);return~n?avalon.Array.removeAt(e,n):!1}}}),"undefined"!=typeof performance&&performance.now&&(avalon.makeHashCode=function(e){return e=e||"avalon",(e+performance.now()).replace(".","")});var c=1;e.exports={avalon:avalon,getLongID:function(e){return e.uuid||(e.uuid=avalon.makeHashCode("e"))},getShortID:function(e){return e.uuid||(e.uuid="_"+ ++c)}}},function(e,t){function n(e){for(var t in e)if(avalon.ohasOwn.call(e,t)){var a=e[t];"function"==typeof n.plugins[t]?n.plugins[t](a):"object"==typeof n[t]?avalon.shadowCopy(n[t],a):n[t]=a}return this}avalon.config=n;var a={interpolate:function(e){var t=e[0],a=e[1];if(t===a)throw new SyntaxError("openTag!==closeTag");var r=t+"test"+a,o=avalon.avalonDiv;if(o.innerHTML=r,o.innerHTML!==r&&o.innerHTML.indexOf("&lt;")>-1)throw new SyntaxError("此定界符不合法");o.innerHTML="",n.openTag=t,n.closeTag=a;var i=avalon.escapeRegExp(t),l=avalon.escapeRegExp(a);n.rexpr=new RegExp(i+"([\\ss\\S]*)"+l),n.rexprg=new RegExp(i+"([\\ss\\S]*)"+l,"g"),n.rbind=new RegExp(i+"[\\ss\\S]*"+l+"|\\bms-|\\bslot\\b")}};n.plugins=a,avalon.config({interpolate:["{{","}}"],debug:!0})},function(e,t,n){function a(e){return e}var r=n(9),o=n(10),i=n(11),l=n(12),s=n(13),c=n(14),u=avalon.filters;avalon.__format__=function(e){var t=u[e];return t?t.get?t.get:t:a},avalon.mix(u,{uppercase:function(e){return String(e).toUpperCase()},lowercase:function(e){return String(e).toLowerCase()},truncate:function(e,t,n){return t=t||30,n="string"==typeof n?n:"...",e.length>t?e.slice(0,t-n.length)+n:String(e)},camelize:avalon.camelize,date:l,escape:o,sanitize:i,number:r,currency:function(e,t,n){return(t||"￥")+r(e,isFinite(n)?n:2)}},s,c),e.exports=avalon},function(e,t){function n(e,t,n,a){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var r=isFinite(+e)?+e:0,o=isFinite(+t)?Math.abs(t):3,i=a||",",l=n||".",s="",c=function(e,t){var n=Math.pow(10,t);return""+(Math.round(e*n)/n).toFixed(t)};return s=(o?c(r,o):""+Math.round(r)).split("."),s[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(s[1]||"").length<o&&(s[1]=s[1]||"",s[1]+=new Array(o-s[1].length+1).join("0")),s.join(l)}e.exports=n},function(e,t){function n(e){return String(e).replace(/&/g,"&amp;").replace(a,function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+(1024*(t-55296)+(n-56320)+65536)+";"}).replace(r,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var a=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,r=/([^\#-~| |!])/g;e.exports=n},function(e,t){var n=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,a=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,r=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/gi,o={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/gi,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/gi,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/gi};e.exports=function(e){return e.replace(n,"").replace(r,function(e,t){var n=e.toLowerCase().match(/<(\w+)\s/);if(n){var r=o[n[1]];r&&(e=e.replace(r,function(e,t,n){var a=n.charAt(0);return t+"="+a+"javascript:void(0)"+a}))}return e.replace(a," ").replace(/\s+/g," ")})}},function(e,t){function n(e){return parseInt(e,10)||0}function a(e,t,n){var a="";for(0>e&&(a="-",e=-e),e=""+e;e.length<t;)e="0"+e;return n&&(e=e.substr(e.length-t)),a+e}function r(e,t,n,r){return function(o){var i=o["get"+e]();return(n>0||i>-n)&&(i+=n),0===i&&-12===n&&(i=12),a(i,t,r)}}function o(e,t){return function(n,a){var r=n["get"+e](),o=(t?"SHORT"+e:e).toUpperCase();return a[o][r]}}function i(e){var t=-1*e.getTimezoneOffset(),n=t>=0?"+":"";return n+=a(Math[t>0?"floor":"ceil"](t/60),2)+a(Math.abs(t%60),2)}function l(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}function s(e,t){var a,r,o=s.locate,i="",l=[];if(t=t||"mediumDate",t=o[t]||t,"string"==typeof e)if(/^\d+$/.test(e))e=n(e);else if(v.test(e))e=+RegExp.$1;else{var p=e.trim(),d=[0,0,0,0,0,0,0],f=new Date(0);p=p.replace(/^(\d+)\D(\d+)\D(\d+)/,function(e,t,a,r){var o=4===r.length?[r,t,a]:[t,a,r];return d[0]=n(o[0]),d[1]=n(o[1])-1,d[2]=n(o[2]),""});var h=f.setFullYear,m=f.setHours;p=p.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(e,t,a,r,o){return d[3]=n(t),d[4]=n(a),d[5]=n(r),o&&(d[6]=Math.round(1e3*parseFloat("0."+o))),""});var g=0,y=0;p=p.replace(/Z|([+-])(\d\d):?(\d\d)/,function(e,t,a,r){return h=f.setUTCFullYear,m=f.setUTCHours,t&&(g=n(t+a),y=n(t+r)),""}),d[3]-=g,d[4]-=y,h.apply(f,d.slice(0,3)),m.apply(f,d.slice(3)),e=f}if("number"==typeof e&&(e=new Date(e)),"date"===avalon.type(e)){for(;t;)r=u.exec(t),r?(l=l.concat(r.slice(1)),t=l.pop()):(l.push(t),t=null);return l.forEach(function(t){a=c[t],i+=a?a(e,o):t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),i}}var c={yyyy:r("FullYear",4),yy:r("FullYear",2,0,!0),y:r("FullYear",1),MMMM:o("Month"),MMM:o("Month",!0),MM:r("Month",2,1),M:r("Month",1,1),dd:r("Date",2),d:r("Date",1),HH:r("Hours",2),H:r("Hours",1),hh:r("Hours",2,-12),h:r("Hours",1,-12),mm:r("Minutes",2),m:r("Minutes",1),ss:r("Seconds",2),s:r("Seconds",1),sss:r("Milliseconds",3),EEEE:o("Day"),EEE:o("Day",!0),a:l,Z:i},u=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,v=/^\/Date\((\d+)\)\/$/,p={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};p.SHORTMONTH=p.MONTH,s.locate=p,e.exports=s},function(e,t){function n(e,t,n){var a=avalon.type(e);if("array"!==a&&"object"!==a)throw"orderBy只能处理对象或数组";var r=n&&0>n?-1:1;if("string"==typeof t){var o=t;t=function(e){return e&&e[o]}}e=l(e),e.forEach(function(e){e.order=t(e.value,e.key)}),e.sort(function(e,t){var n=e.order,a=t.order;return Number.isNaN(n)&&Number.isNaN(a)?0:n===a?0:n>a?r:-r});var s="array"===a,c=s?[]:{};return i(c,e,function(e){s?c.push(e.value):c[e.key]=e.value})}function a(e,t){var n=avalon.type(e);if("array"!==n&&"object"!==n)throw"filterBy只能处理对象或数组";var a=avalon.slice(arguments,2),r=avalon.type(t);if("function"===r)var o=t;else{if("string"!==r&&"number"!==r)return e;if(""===t)return e;var s=new RegExp(avalon.escapeRegExp(t),"i");o=function(e){return s.test(e)}}e=l(e).filter(function(e,t){return!!o.apply(e,[e.value,t].concat(a))});var c="array"===n,u=c?[]:{};return i(u,e,function(e){c?u.push(e.value):u[e.key]=e.value})}function r(e,t,n){if(avalon.isObject(e)&&!Array.isArray(e)){var a=[];return i(a,t,function(t){a.push(e.hasOwnProperty(t)?e[t]:n?n[t]:"")})}return e}function o(e,t,n){var a=avalon.type(e);if("array"!==a&&"object"!==a)throw"limitBy只能处理对象或数组";if(t=Math.abs(Number(t))===1/0?Number(t):parseInt(t,10),Number.isNaN(t))return e;"object"===a&&(e=l(e)),t=Math.min(e.length,t),n=!n||Number.isNaN(n)?0:~~n,0>n&&(n=Math.max(0,e.length+n));for(var r=[],o=n;t>o;o++)r.push(e[o]);var s="array"===a;if(s)return r;var c={};return i(c,r,function(e){c[e.key]=e.value})}function i(e,t,n){for(var a=0,r=t.length;r>a;a++)n(t[a]);return e}function l(e){var t=[],n=0;return avalon.each(e,function(e,a){t[n++]={value:a,key:e}}),t}Number.isNaN=Number.isNaN||function(e){return e!==e},e.exports={limitBy:o,orderBy:n,selectBy:r,filterBy:a}},function(e,t){var n={stop:function(e){return e.stopPropagation(),e},prevent:function(e){return e.preventDefault(),e}},a={esc:27,tab:9,enter:13,space:32,del:46,up:38,left:37,right:39,down:40};avalon.each(a,function(e,t){n[e]=function(e){return e.which!==t&&(e.$return=!0),e}}),e.exports=n},function(e,t,n){var a=n(16),r=n(17),o=n(18);avalon.vdomAdaptor=function(e,t){if(!e)return"toHTML"===t?"":avalon.avalonFragment.cloneNode(!1);switch(e.nodeType){case 3:return a.prototype[t].call(e);case 8:return r.prototype[t].call(e);default:return o.prototype[t].call(e)}},e.exports={VText:a,VComment:r,VElement:o}},function(e,t){function n(e){if("string"==typeof e)this.type="#text",this.nodeValue=e,this.skipContent=!a.test(e),this.nodeType=3;else for(var t in e)this[t]=e[t]}var a=avalon.config.rexpr;n.prototype={constructor:n,toDOM:function(){return document.createTextNode(this.nodeValue)},toHTML:function(){return this.nodeValue}},e.exports=n},function(e,t){function n(e){if("string"==typeof e)this.type="#comment",this.nodeValue=e,this.skipContent=!0,this.nodeType=8;else for(var t in e)this[t]=e[t]}n.prototype={constructor:n,toDOM:function(){return document.createComment(this.nodeValue)},toHTML:function(){return"<!--"+this.nodeValue+"-->"}},e.exports=n},function(e,t){function n(e,t,n){if("object"==typeof e)for(var a in e)this[a]=e[a];else this.nodeType=1,this.type=e,this.props=t,this.children=n,this.template=""}function a(e){return e!==!1&&Object(e)!==e}function r(e){document.styleSheets.length<31?document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):document.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");var t=e.split(":");1===t.length&&t.unshift("v");var n=t[1],a=t[0];return document.namespaces[a]||document.namespaces.add(a,"urn:schemas-microsoft-com:vml"),document.createElement("<"+a+":"+n+' class="rvml">')}function o(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}var i={"class":function(e,t){e.className=t},style:function(e,t){e.style.cssText=t},"for":function(e,t){e.htmlFor=t}},l=avalon.oneObject("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use,g,svg"),s=(avalon.oneObject("shape,line,polyline,rect,roundrect,oval,arc,curve,background,image,shapetype,group,fill,stroke,shadow, extrusion, textbox, imagedata, textpath"),/^\w+\:\w+/);n.prototype={constructor:n,toDOM:function(){var e,t=this.type;e=avalon.modern&&l[t]?o(t):avalon.modern||!VMLTag(t)&&!s.test(t)?document.createElement(t):r(t);for(var n in this.props){var c=this.props[n];a(c)&&(i[n]&&avalon.msie<8?i[n](e,c):e.setAttribute(n,c+""))}if(this.wid){var u=avalon.scopes[this.wid];if(u&&u.dom)return u.dom}if(this.skipContent)switch(this.type){case"script":e.text=this.template;break;case"style":case"template":e.innerHTML=this.template;break;case"noscript":e.textContent=this.template;break;default:var v=avalon.parseHTML(this.template);e.appendChild(v)}else this.isVoidTag||(this.children.length?this.children.forEach(function(t){t&&e.appendChild(avalon.vdomAdaptor(t,"toDOM"))}):e.appendChild(avalon.parseHTML(this.template)));return e},toHTML:function(){var e=[];for(var t in this.props){var n=this.props[t];a(n)&&e.push(t+"="+avalon.quote(this.props[t]+""))}e=e.length?" "+e.join(" "):"";var r="<"+this.type+e;return this.isVoidTag?r+"/>":(r+=">",r+=this.children.length?this.children.map(function(e){return e?avalon.vdomAdaptor(e,"toHTML"):""}).join(""):this.template,r+"</"+this.type+">")}},e.exports=n},,,,,function(e,t){var n={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"},a=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected,","isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(",");a.replace(/\w+/g,function(e){n[e.toLowerCase()]=e});var r=["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,contentEditable,frameBorder,longDesc,maxLength,marginWidth,marginHeight,rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(",");r.replace(/\w+/g,function(e){n[e.toLowerCase()]=e}),e.exports=n},,,,,function(e,t){function n(e){this.size=0,this.limit=e,this.head=this.tail=void 0,this._keymap={}}var a=n.prototype;a.put=function(e,t){var n={key:e,value:t};return this._keymap[e]=n,this.tail?(this.tail.newer=n,n.older=this.tail):this.head=n,this.tail=n,this.size===this.limit?this.shift():this.size++,t},a.shift=function(){var e=this.head;e&&(this.head=this.head.newer,this.head.older=e.newer=e.older=this._keymap[e.key]=void 0,delete this._keymap[e.key])},a.get=function(e){var t=this._keymap[e];if(void 0!==t)return t===this.tail?t.value:(t.newer&&(t===this.head&&(this.head=t.newer),t.newer.older=t.older),t.older&&(t.older.newer=t.newer),t.newer=void 0,t.older=this.tail,this.tail&&(this.tail.newer=t),this.tail=t,t.value)},e.exports=n},function(e,t){function n(e){var t="undefined"!=typeof e.querySelectorAll?e.querySelectorAll("script"):e.getElementsByTagName("script");if(t.length)for(var n,o=0;n=t[o++];)if(r[n.type]){var i=a.cloneNode(!1);Array.prototype.forEach.call(n.attributes,function(e){e&&e.specified&&(i[e.name]=e.value,i.setAttribute(e.name,e.value))}),i.text=n.text,n.parentNode.replaceChild(i,n)}}var a=avalon.document.createElement("script"),r=avalon.oneObject(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]);e.exports=n},,,,function(e,t){e.exports={click:!0,dblclick:!0,keydown:!0,keypress:!0,keyup:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,wheel:!0,mousewheel:!0,input:!0,change:!0,beforeinput:!0,compositionstart:!0,compositionupdate:!0,compositionend:!0,select:!0,cut:!0,copy:!0,paste:!0,beforecut:!0,beforecopy:!0,beforepaste:!0,focusin:!0,focusout:!0,DOMFocusIn:!0,DOMFocusOut:!0,DOMActivate:!0,dragend:!0,datasetchanged:!0}},,function(e,t){function n(e,t){for(var i,l=0;i=e[l++];)if(1===i.nodeType){var s=r(i);s&&++o;var c=avalon.vmodels[s];if(c&&!c.$element){a(i),avalon(i).removeClass("ms-controller"),c.$element=i;var u=new Date;i.vtree=avalon.lexer(i.outerHTML.trim());var v=new Date;avalon.log("create primitive vtree",v-u),c.$render=avalon.render(i.vtree),avalon.scopes[c.$id]={vmodel:c,local:{},dom:i,render:c.$render};var p=new Date;avalon.log("create template Function ",p-v),avalon.rerenderStart=p,avalon.batch(s,!0),"function"==typeof t&&t(c)}else s||n(i.childNodes,t)}}function a(e){for(var t,n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];3!==r.nodeType||i.test(r.nodeValue)?1===r.nodeType&&a(r):(t=e.removeChild(r),n--)}0===e.childNodes.length&&t&&e.appendChild(t)}function r(e){return e.getAttribute("ms-controller")||e.getAttribute("ms-important")}var o=0,i=/\S/;e.exports=avalon.scan=function(e,t){return e&&e.nodeType?(n([e],t),void(o=0)):void avalon.warn("[avalon.scan] first argument must be element , documentFragment, or document")}},,function(e,t,n){var a=n(38);avalon.directive("important",{priority:1,parse:function(e,t,n){var a=n.expr,r=avalon.quote(a),o=n.name;e[o]=r,t.$prepend=["(function(__vmodel__){","var important = avalon.scopes["+r+"]",'if(important && important.fast){avalon.log("不进入"+'+r+");return }","var __top__ = __vmodel__","var __synth__ =  avalon.vmodels["+r+"]","var __present__ = __synth__","var __vmodel__ = __synth__","/*controller:"+a+"*/"].join("\n")+"\n\n",e.synth="__synth__",e.local="{}",e.top="__top__",e.present="__present__",t.$append="/*controller:"+a+"*/\n})(__vmodel__);"},diff:function(e,t,n,r){t[r]!==e[r]&&a(e,this.update,n,"controller")},update:function(e,t,n){avalon.directives.controller.update(e,t,n,"important")}})},function(e,t){e.exports=function(e,t,n,a,r){r=r||"change";var o=e[r]||(e[r]=[]);avalon.Array.ensure(o,t)&&(n.count+=1,avalon.config.showDiff&&avalon.log(a+" change"))}},function(e,t,n){var a=n(38);avalon.directive("controller",{priority:2,parse:function(e,t,n){var a=n.expr,r=avalon.quote(a),o=n.name;e[o]=r,t.$prepend=["(function(__vmodel__){","var __top__ = __vmodel__","var __present__ = avalon.vmodels["+r+"]","if(__present__ && __top__ && __present__ !== __top__){","var __synth__ =  avalon.mediatorFactory(__vmodel__, __present__)","var __vmodel__ = __synth__","}else{","__vmodel__ = __top__ || __present__","}","/*controller:"+a+"*/"].join("\n")+"\n\n",e.synth="__synth__",e.local="__local__",e.top="__top__",e.present="__present__",t.$append="/*controller:"+a+"*/\n})(__vmodel__);"},diff:function(e,t,n,r){t[r]!==e[r]&&a(e,this.update,n,"controller")},update:function(e,t,n,a){var r=t.top,o=t.present,i=t.synth;if(r===o){if(void 0===r)return;var l=avalon.scopes[r.$id];if(l&&(!a||a.fast))return}if(r&&o){var s=r.$render+"",c="/*controller:"+o.$id+"*/",u=s.indexOf(c)+c.length,v=s.lastIndexOf(c),p=s.slice(u,v),d=t.local||{},f=[];for(var h in d)f.push("var "+h+" = __local__["+avalon.quote(h)+"]");f.push("var vnodes = []\n");var m=f.join("\n")+p+"\nreturn vnodes",g=avalon.render(m);i.$render=o.$render=g,i.$element=o.$element=e,avalon.scopes[o.$id]={vmodel:o,synth:i,local:d,dom:e,render:g,fast:"important"}}}})},,function(e,t,n){var a=n(38);avalon.directive("css",{diff:function(e,t,n,r){var o=e[r],i=t[r];if(Object(o)===o){if(o=o.$model||o,Array.isArray(o)&&(o=e[r]=avalon.mix.apply({},o)),"object"!=typeof i)e.changeStyle=o;else{var l={},s=!1;for(var c in o)o[c]!==i[c]&&(s=!0,l[c]=o[c]);s&&(e.changeStyle=l)}e.changeStyle&&a(e,this.update,n,"css")}else e[r]=i},update:function(e,t){var n=t.changeStyle,a=avalon(e);for(var r in n)a.css(r,n[r]);delete t.changeStyle}})},function(e,t,n){function a(e,t){var n=e.ownerDocument,r=e.nodeName,i="_"+r;if(!a[i]){var l=n.body.appendChild(n.createElement(r));t=avalon.modern?getComputedStyle(l,null).display:l.currentStyle.display,n.body.removeChild(l),t===o&&(t="block"),a[i]=t}return a[i]}var r=n(38),o="none";avalon.parseDisplay=a,avalon.directive("visible",{diff:function(e,t,n,a){var o=e[a]=!!e[a];e.displayValue=t.displayValue,o!==t.props[a]&&r(e,this.update,n,"visible")},update:function(e,t){function n(){void 0!==r&&(e.style.display=r)}var r,i=t["ms-visible"],l=e.style.display;i?(l===o&&(r=t.displayValue,r||(e.style.display="")),""===e.style.display&&avalon(e).css("display")===o&&avalon.contains(e.ownerDocument,e)&&(r=a(e))):l!==o&&(r=o,t.displayValue=l),avalon.applyEffect(e,t,{hook:i?"onEnterDone":"onLeaveDone",cb:n})}})},,function(e,t,n){var a=n(45).ident,r=n(38);avalon.directive("text",{parse:function(e,t,n){e.children="[]",e.skipContent=!0;var r=a.test(n.expr)?n.expr:avalon.parseExpr(n);e[n.name]=r},diff:function(e,t,n,a){var o=e[a],i=t[a];e.children=t.children;var l=e.dom=t.dom;return o===i&&0!==e.children.length||(e.children[0]||(e.children[0]={type:"#text",nodeType:3}),e.children[0].nodeValue=o,l?this.update(l,e):r(e,this.update,n,"text")),t.dom=null,!1},update:function(e,t){var n=t["ms-text"];"textContent"in e?e.textContent=n+"":e.innerText=n+"",t.dom=e}})},function(e,t){e.exports={ident:/^[$a-zA-Z_][$a-zA-Z0-9_]*$/,sp:/^\s+$/,leftSp:/^\s+/,rightSp:/s+$/,binding:/^ms-(\w+)-?(.*)/,string:/(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/g}},function(e,t,n){var a=n(38);n(47);avalon.htmlFactory=function(e,t,n){var a=avalon.lexer(e+""),r=avalon.render(a);return r(t,n)},avalon.directive("html",{parse:function(e,t,n){t.isVoidTag?e.children="[]":(e[n.name]=avalon.parseExpr(n),delete t.children,e.children="avalon.htmlFactory("+avalon.parseExpr(n)+",__vmodel__,__local__)")},diff:function(e,t,n,r){var o=e[r],i=t[r];o!==i&&a(e,this.update,n,"html")},update:function(e,t){if(1===e.nodeType){avalon.clearHTML(e);var n=document.createDocumentFragment();t.children.forEach(function(e){e&&n.appendChild(avalon.vdomAdaptor(e,"toDOM"))}),e.appendChild(n)}}})},function(e,t,n){function a(e){return m.test(e)?e:c(e,"text")}function r(e){return"vnodes.push("+e+");"}function o(e){return r(p(e))}function i(e){for(var t,n=["\nvar vnodes = [];"],a=[],r=0;t=e[r++];){var o=l(t,a);t.$prepend&&n.push(t.$prepend);var i=t.$append;delete t.$append,delete t.$prepend,o&&n.push(o+"\n"),i&&n.push(i)}return n.push("return vnodes\n"),n.join("\n")}function l(e,t,n){var a=avalon.directives;if(3===e.nodeType)return d.rexpr.test(e.nodeValue)?r(s(e)):o(e);if(1===e.nodeType){var l=e.props;0===e.type.indexOf("ms-")&&(l["ms-widget"]||(l["ms-widget"]="{is:"+f(e.type)+"}"));var v={props:{},type:e.type,nodeType:1,template:""},p=u(v,l);if(p.length||(v.skipAttrs=!0),v.order=p.map(function(t){return a[t.type].parse(v,e,t),t.name}).join(";;"),"widget"===e.directive&&(v.order=v.order?"ms-widget;;"+v.order:"ms-widget",v.directive="widget",v.local="__local__",v.vmodel="__vmodel__",v.wid=avalon.quote(e.props.wid),delete v.skipAttrs),e.isVoidTag)v.isVoidTag=!0;else if(!("children"in v)){var h=e.children;h.length?v.children="(function(){"+i(h)+"})()":(v.template=e.template,v.children="[]")}return o(v)}if(8===e.nodeType){var m=e.nodeValue;if(g.test(m)){0!==m.indexOf("ms-for:")&&avalon.error("ms-for指令前不能有空格"),t.push(e);var v=avalon.mix({directive:"for",vmodel:"__vmodel__"},e);return a["for"].parse(v,e,e),o(v)}if(y.test(m)){var b=t[t.length-1],w=b.signature;return 0!==m.indexOf("ms-for-end:")&&avalon.error("ms-for-end指令前不能有空格"),e.$append=o({nodeType:8,type:"#comment",nodeValue:w,key:"traceKey"})+"\n\n})",t.length&&(e.$append+="\n"+w+".end ="+o({nodeType:8,type:"#comment",signature:w,nodeValue:"ms-for-end:"})+"\n",t.pop()),""}if(0===m.indexOf("ms-js:")){var x=c(m.replace("ms-js:",""),"js")+"\n",T=o(e),C=x.match(_);return C&&C[1]?e.$append=(e.$append||"")+x+"\n__local__."+C[1]+" = "+C[1]+"\n":avalon.warn(m+" parse fail!"),T}return o(e)}}function s(e){var t=v(e.nodeValue),n="";if(1===t.length)n=a(t[0].expr);else{var r=t.map(function(e){return e.type?a(e.expr):f(e.expr)}).join(" + ");n="String("+r+")"}return'{\ntype: "#text",\nnodeType:3,\nfixIESkip: true,\nnodeValue: '+n+"\n}"}var c=n(48),u=n(50),v=n(51),p=n(52),d=avalon.config,f=avalon.quote,h=(avalon.makeHashCode,n(45)),m=h.ident,g=(h.sp,/^\s*ms\-for:/),y=/^\s*ms\-for\-end:/,_=/^\s*var\s+([$\w]+)\s*\=\s*\S+/;e.exports=i},function(e,t,n){function a(e,t){var n=e.replace(g,"").match(y);n&&n.filter(function(e){/^[@\d\-]/.test(e)||"##"===e.slice(0,2)||"$event"===e||(t[e]=1)})}function r(e){var t=[];for(var n in e)t.push("var "+n+" = __local__["+avalon.quote(n)+"]");return t}function o(e,t){function n(e){var t="??"+b++;return w[t]=e,t}function o(e){return w[e]}var g={};if(t=t||"other","object"==typeof e&&(t=e.type,g=e,e=g.expr),"string"!=typeof e)return"";var y=e,_=l.get(t+":"+y);if(_)return _;var b=1,w={},x=e.replace(s,n).replace(c,n).replace(p,n).replace(f,"$1").split(d),T=x.shift(),C={},$=T.replace(u,o).trim();if("on"===t&&m.test($)&&($+="($event)"),$=$.replace(h,"$1__vmodel__."),"js"===t)return l.put(t+":"+y,$);"on"===t&&a(T,C);var E=x.map(function(e){a(e.replace(/^\w+/g,""),C),e=e.replace(u,o).replace(h,"$1__vmodel__.");var t=!1;return e=e.replace(v,function(e,n){return t=!0,/\S/.test(n)?"(__value__,"+n+");":"(__value__);"}),t||(e+="(__value__);"),e=e.replace(/(\w+)/,'avalon.__format__("$1")'),"__value__ = "+e}),A=[];if("on"===t)E=E.map(function(e){return e.replace(/__value__/g,"$event")}),E.length&&E.push("if($event.$return){\n	return;\n}"),avalon.modern||($=$.replace(/__vmodel__\.([^(]+)\(([^)]*)\)/,function(e,t,n){return"__vmodel__."+t+".call(__vmodel__"+(/\S/.test(n)?","+n:"")+")"})),A=["function ms_on($event, __local__){","try{",r(C).join("\n"),"	var __vmodel__ = this;","	"+$,"}catch(e){",i(e,t),"}","}"],E.unshift(2,0);else{if("duplex"===t){var k=["function (__vmodel__){","try{","return "+$+"\n","}catch(e){",i(e,t).replace("parse","get"),"}","}"];l.put("duplex:"+y,k.join("\n"));var O=["function (__vmodel__,__value__){","try{","	"+$+" = __value__","}catch(e){",i(e,t).replace("parse","set"),"}","}"];if(l.put("duplex:set:"+y,O.join("\n")),x.length){var M=["function (__vmodel__, __value__){","try{",E.join("\n"),"return __value__\n","}catch(e){",i(e,t).replace("parse","format"),"}","}"];l.put("duplex:format:"+y,M.join("\n"))}return l.get("duplex:"+y)}A=["(function(){","try{","var __value__ = "+$,"text"===t?"return avalon.parsers.string(__value__)":"return __value__","}catch(e){",i(e,t),'	return ""',"}","})()"],E.unshift(3,0)}return A.splice.apply(A,E),_=A.join("\n"),l.put(t+":"+y,_),_}function i(e,t){return"	avalon.warn(e, "+avalon.quote("parse "+t+" binding【 "+e+" 】fail")+")"}var l=n(49),s=/(^|[^\/])\/(?!\/)(\[.+?]|\\.|[^\/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/g,c=n(45).string,u=/\?\?\d+/g,v=/\(([^)]*)\)/,p=/\|\|/g,d=/\|(?=\w)/,f=/\s*(\.|\|)\s*/g,h=/(^|[^\w\u00c0-\uFFFF_])(@|##)(?=[$\w])/g,m=/^(?:\@|##)[$\w]+$/i,g=/\|.+/g,y=/((?:\@|\$|\#\#)?\w+)/g;e.exports=avalon.parseExpr=o},function(e,t,n){var a=n(28);e.exports=new a(512)},function(e,t,n){function a(e,t){var n=[],a="ms-skip"in t,s={};for(var c in t){var u,v=t[c];if(!a&&(u=c.match(i))){var p=u[1],d=u[2]||"",f=c;if(l[p]){var h=parseFloat(d)||0;d=p,p="on"}if(f="ms-"+p+(d?"-"+d:""),c!==f&&(delete t[c],t[f]=v),o[p]){var m={type:p,param:d,name:f,expr:v,priority:o[p].priority||100*p.charCodeAt(0)};"on"===p&&(h=h||0,m.name+="-"+h,m.priority+=100*d.charCodeAt(0)+h),s[m.name]||(s[m.name]=1,n.push(m))}}else e.props[c]=t[c]}n.sort(r);for(var g,y=[],_=0;g=n[_++];){var p=g.type;if(y.type=p,y.push(g),"widget"===p)break}return y}function r(e,t){return e.priority-t.priority}var o=avalon.directives,i=n(45).binding,l=avalon.oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit");e.exports=a},function(e,t,n){function a(e){for(var t,n,a=[],l=0;;){if(n=e.indexOf(i.openTag,l),-1===n)break;if(t=e.slice(l,n),0===l&&(t=t.replace(o.leftSp,"")),t&&a.push({expr:t}),l=n+i.openTag.length,n=e.indexOf(i.closeTag,l),-1===n)break;t=e.slice(l,n),t&&a.push({expr:t.replace(r,""),type:"{{}}"}),l=n+avalon.config.closeTag.length}t=e.slice(l);var s=t.replace(o.rightSp,"");return s&&a.push({expr:s.replace(/^\s+$/," ")}),a}var r=/\r?\n/g,o=n(45),i=avalon.config;e.exports=a},function(e,t){function n(e){return i.test(e)||r[e]?l(e):e}function a(e){var t=[];for(var a in e)if("props"===a){var r=[];for(var i in e.props){var s=e.props[i];"string"==typeof s&&(s=l(s)),r.push(n(i)+": "+s)}t.push("props: {"+r.join(",\n")+"}")}else if(e.hasOwnProperty(a)){var c=e[a];"string"==typeof c&&(c=o[a]?l(c):c),t.push(n(a)+":"+c)}return"{\n"+t.join(",\n")+"}"}var r=avalon.oneObject("break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile"),o={type:1,template:1,innerHTML:1,outerHTML:1,order:1,nodeValue:1,directive:1,signature:1,cid:1},i=/[W-]/,l=avalon.quote;e.exports=a},function(e,t,n){function a(e){return Object.keys(e).filter(function(t){return e[t]}).join(" ")}function r(e){var t=e.target;avalon(t).addClass(t.getAttribute(u[e.type])||"")}function o(e){var t=e.target,n=u[e.type];avalon(t).removeClass(t.getAttribute(n)||""),"change-active"!==n&&avalon(t).removeClass(t.getAttribute("change-active")||"")}function i(e,t){var n=e.getAttribute("old-change-class")||"",a=t["ms-class"];avalon(e).removeClass(n).addClass(a),e.setAttribute("old-change-class",a)}var l=n(6).getLongID,s=n(38),c=avalon.directives;avalon.directive("class",{diff:function(e,t,n,i){var l=i.slice(3),c=e[i],u=t[i];if(void 0===u&&(u=""),t.classEvent)e.classEvent=t.classEvent;else{var v={};"hover"===l?(v.mouseenter=r,v.mouseleave=o):"active"===l&&(e.props.tabindex=e.props.tabindex||-1,v.tabIndex=e.props.tabindex,v.mousedown=r,v.mouseup=o,v.mouseleave=o),e.classEvent=v}t.classEvent=null;var p=avalon.noop;Array.isArray(c)?p=c.map(function(e){return e&&"object"==typeof e?a(e):e?e:""}).join(" "):avalon.isObject(c)?p=a(c):c||0===c?p=String(c):c||(p=""),p=e[i]=p.trim().replace(/\s+/," "),u!==p&&(e["change-"+l]=p,s(e,this.update,n,l))},update:function(e,t){if(e&&1===e.nodeType){var n=t.classEvent;if(n){for(var a in n)"tabIndex"===a?e[a]=n[a]:avalon.bind(e,a,n[a]);t.classEvent={}}var r=["class","hover","active"];r.forEach(function(n){var a="change-"+n,r=t[a];if(void 0!==r)if("class"===n)e&&i(e,t);else{var o=e.getAttribute("change-"+n);o&&avalon(e).removeClass(o),e.setAttribute(a,r)}})}}}),c.active=c.hover=c["class"];var u={mouseenter:"change-hover",mouseleave:"change-hover",mousedown:"change-active",mouseup:"change-active"};l(r),l(o)},function(e,t,n){var a=(n(6).getLongID,n(28)),r=(new a(128),avalon.quote,n(38));n(45).string;avalon.directive("on",{priority:3e3,parse:function(e,t,n){var a=0,r=n.name.replace("ms-on-","e").replace("-","_"),o=r+"_"+n.expr.replace(/\s/g,"").replace(/[^$a-z]/g,function(){return a++}),i=avalon.quote(o),l="(function(){\nvar fn610 = "+avalon.parseExpr(n,"on")+"\nfn610.uuid ="+i+";\nreturn fn610})()";e.vmodel="__vmodel__",e.local="__local__",e[n.name]=l},diff:function(e,t,n,a){var o=e[a],i=o.uuid,l=i.split("_").shift(),s=l.slice(1)+":"+i;e.addEvents=e.addEvents||{},e.addEvents[s]=o,avalon.eventListeners.uuid=o,r(e,this.update,n,"on")},update:function(e,t){
if(e&&!(e.nodeType>1)){var n,a,r;e._ms_context_=t.vmodel,e.local=t.local;for(n in t.addEvents)a=n.split(":").shift(),r=t.addEvents[n],avalon.bind(e,a,r);delete t.addEvents}}})},,function(e,t){function n(e,t){var n=[];e.children.forEach(function(e){"option"===e.type?n.push(e):"optgroup"===e.type&&e.children.forEach(function(e){"option"===e.type&&n.push(e)})});var a=e.props.multiple,r={},o=null===a||void 0===a||a===!1;Array.isArray(t)?t.forEach(function(e){r[e]=1}):r[t]=1;for(var i,l=0;i=n[l++];){var s="value"in i.props?i.props.value:(i.children[0]||{nodeValue:""}).nodeValue.trim();if(i.props.selected=!!r[s],r[s]&&o)break}}e.exports=n},,function(e,t,n){function a(){var e=this,t=this.__ms_duplex__;if(!e.composing&&e.value!==t.lastViewValue){if(e.caret)try{var n=t.getCaret(e);n.start!==n.end&&n.start+1!==n.end||(t.caretPos=n)}catch(a){avalon.warn("fixCaret error",a)}if(t.debounceTime>4){var o=new Date,i=o-t.time||0;t.time=o,i>=t.debounceTime?r[t.type].call(t):(clearTimeout(t.debounceID),t.debounceID=setTimeout(function(){r[t.type].call(t)},i))}else r[t.type].call(t)}}var r=n(59);e.exports=a},function(e,t){function n(e){e.validator&&avalon.directives.validate.validate(e,!1),e.callback&&e.callback.call(e.vmodel,{type:"changed",target:e.element})}var a={input:function(e){var t=this;e=e||"value";var a=t.element[e],r=t.format(t.vmodel,a);r!==a&&(t.formatedValue=r,t.element[e]=r);var o=t.parse(r);o!==t.modelValue&&(t.set(t.vmodel,o),n(t))},radio:function(){var e=this;if(e.isChecked){var t=e.modelValue=!e.modelValue;e.set(e.vmodel,t),n(e)}else a.input.call(e)},checkbox:function(){var e=this,t=e.modelValue;Array.isArray(t)||(avalon.warn("ms-duplex应用于checkbox上要对应一个数组"),t=[t]);var a=e.element.checked?"ensure":"remove";if(t[a]){var r=e.parse(e.element.value);t[a](r),n(e)}},select:function(){var e=this,t=avalon(e.element).val();t+""!=this.modelValue+""&&(t=Array.isArray(t)?t.map(function(t){return e.parse(t)}):e.parse(t),e.modelValue=t,e.set(e.vmodel,t),n(e))},contenteditable:function(){a.input.call(this,"innerHTML")}};e.exports=a},function(e,t){function n(e){r[this.tagName].call(this,e),!this.caret&&this._ms_field_&&this._ms_field_.update.call(this)}var a=!1;try{var r={},o=HTMLInputElement.prototype,i=HTMLTextAreaElement.prototype,l=HTMLInputElement.prototype;Object.getOwnPropertyNames(l),r.INPUT=Object.getOwnPropertyDescriptor(o,"value").set,Object.defineProperty(o,"value",{set:n}),r.TEXTAREA=Object.getOwnPropertyDescriptor(i,"value").set,Object.defineProperty(i,"value",{set:n}),a=!0}catch(s){}e.exports=a},,function(e,t){e.exports=function(e,t){var n=e.__ms_duplex__,a=t["ms-rules"];if(a&&!n.validator)for(;e&&1===e.nodeType;){var r=e._ms_validator_;if(r){n.rules=a,n.validator=r,avalon.Array.ensure(r.fields,n)&&r.addField(n);break}e=e.parentNode}}},function(e,t,n){function a(){var e=this.data||{};return this.message.replace(i,function(t,n){return null==e[n]?"":e[n]})}var r=n(38),o=avalon.directive("validate",{diff:function(e,t,n,a){var i=e[a],l=t[a];if(l&&l.onError&&l.addField)e[a]=l;else if(Object(i)===i){i.$id&&(i=i.$model),e[a]=i;for(var a in o.defaults)i[a]||(i[a]=o.defaults[a]);i.fields=i.fields||[],r(e,this.update,n,"validate")}},update:function(e,t){var n=t["ms-validate"];e._ms_validator_=n,n.element=e,e.setAttribute("novalidate","novalidate"),n.validateAllInSubmit&&avalon.bind(e,"submit",function(e){e.preventDefault(),o.validateAll.call(n,n.onValidateAll)}),"function"==typeof n.onInit&&n.onInit.call(e)},validateAll:function(e){var t=this,n="function"==typeof e?e:t.onValidateAll,a=t.fields.filter(function(e){var n=e.element;return n&&!n.disabled&&t.element.contains(n)}).map(function(e){return o.validate(e,!0)}),r=[];Promise.all(a).then(function(e){for(var a,o=0;a=e[o++];)r=r.concat(a);if(t.deduplicateInValidateAll){var i={};r=r.filter(function(e){var t=e.element,n=t.uniqueID||(t.uniqueID=setTimeout("1"));return i[n]?!1:(i[n]=!0,!0)})}n.call(t.element,r)})},addField:function(e){var t=this,n=e.element;!t.validateInKeyup||e.isChanged||e.debounceTime||avalon.bind(n,"keyup",function(t){o.validate(e,0,t)}),t.validateInBlur&&avalon.bind(n,"blur",function(t){o.validate(e,0,t)}),t.resetInFocus&&avalon.bind(n,"focus",function(a){t.onReset.call(n,a,e)})},validate:function(e,t,n){var r=[],o=e.modelValue,i=e.element,l=e.validator;if(!i.disabled){for(var s in e.rules){var c=e.rules[s];if(c!==!1){var u,v,p=avalon.validators[s];r.push(new Promise(function(e,t){u=e,v=t}));var d=function(t){if(e.norequired&&""===o&&(t=!0),t)u(!0);else{var n={element:i,data:e.data,message:i.getAttribute("data-"+s+"-message")||i.getAttribute("data-message")||p.message,validateRule:s,getMessage:a};u(n)}};e.data={},e.data[s]=c,p.get(o,e,d)}}var f=[],h=Promise.all(r).then(function(e){for(var a,r=0;a=e[r++];)"object"==typeof a&&f.push(a);return t||(f.length?l.onError.call(i,f,n):l.onSuccess.call(i,f,n),l.onComplete.call(i,f,n)),f});return h}}}),i=/\\?{{([^{}]+)\}}/gm;o.defaults={addField:o.addField,onError:avalon.noop,onSuccess:avalon.noop,onComplete:avalon.noop,onReset:avalon.noop,validateInBlur:!0,validateInKeyup:!0,validateAllInSubmit:!0,resetInFocus:!0,deduplicateInValidateAll:!1}},function(e,t){function n(e){return"regexp"===avalon.type(e)}function a(e){if("string"==typeof e&&e){var t=e.split("-");if(3===t.length&&4===t[0].length){var n=~~t[0],a=~~t[1]-1,r=~~t[2],o=new Date(n,a,r);return o.getFullYear()===n&&o.getMonth()===a&&o.getDate()===r}}return!1}avalon.directive("rules",{parse:function(e,t,n){var a=n.expr;/{.+}/.test(a)&&(e[n.name]=avalon.parseExpr(n))},diff:avalon.noop});var r=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/i,o=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/;avalon.shadowCopy(avalon.validators,{pattern:{message:"必须匹配{{pattern}}这样的格式",get:function(e,t,a){var r=t.element,o=t.data;if(!n(o.pattern)){var i=r.getAttribute("pattern");o.pattern=new RegExp("^(?:"+i+")$")}return a(o.pattern.test(e)),e}},digits:{message:"必须整数",get:function(e,t,n){return n(/^\-?\d+$/.test(e)),e}},number:{message:"必须数字",get:function(e,t,n){return n(isFinite(e)),e}},required:{message:"必须填写",get:function(e,t,n){return n(""!==e),e}},equalto:{message:"密码输入不一致",get:function(e,t,n){var a=String(t.data.equalto),r=avalon(document.getElementById(a)).val()||"";return n(e===r),e}},date:{message:"日期格式不正确",get:function(e,t,n){var r=t.data;return n("regexp"===avalon.type(r.date)?r.date.test(e):a(e)),e}},url:{message:"URL格式不正确",get:function(e,t,n){return n(o.test(e)),e}},email:{message:"email格式不正确",get:function(e,t,n){return n(r.test(e)),e}},minlength:{message:"最少输入{{minlength}}个字",get:function(e,t,n){var a=parseInt(t.data.minlength,10);return n(e.length>=a),e}},maxlength:{message:"最多输入{{maxlength}}个字",get:function(e,t,n){var a=parseInt(t.data.maxlength,10);return n(e.length<=a),e}},min:{message:"输入值不能小于{{min}}",get:function(e,t,n){var a=parseInt(t.data.min,10);return n(parseFloat(e)>=a),e}},max:{message:"输入值不能大于{{max}}",get:function(e,t,n){var a=parseInt(t.data.max,10);return n(parseFloat(e)<=a),e}},chs:{message:"必须是中文字符",get:function(e,t,n){return n(/^[\u4e00-\u9fa5]+$/.test(e)),e}}})},function(e,t,n){var a=n(66),r=n(38);avalon.directive("if",{priority:6,parse:function(e,t,n){t.$prepend=(t.$prepend||"")+"var varIf = "+avalon.parseExpr(n)+"\nif(varIf){\n";var a=t.$append||"";t.$append='}else{\n\nvnodes.push({\nnodeType: 8,\ndirective:"if",\ntype: "#comment",\nnodeValue:"ms-if"\n})\n}'+a},diff:function(e,t,n){e.dom=t.dom,e.nodeType!==t.nodeType&&(e.steps=n,8===e.nodeType&&(e["ms-effect"]=t["ms-effect"]),r(e,this.update,n,"if"))},update:function(e,t,n){var r=e.nodeType,o=t.nodeType;if(r!==o){if(1===o){var i=t.dom;if(!i){i=avalon.vdomAdaptor(t,"toDOM"),t.dom=i;for(var l in t)if(0===l.indexOf("ms-on")){var s=t[l];"function"==typeof s&&(i._ms_context_=t.vmodel,avalon.bind(i,l.split("-")[2],s))}}return n.replaceChild(i,e),t.steps.count&&a([i],[t],n,t.steps),avalon.applyEffect(e,t,{hook:"onEnterDone"}),t.steps=!1}8===o&&avalon.applyEffect(e,t,{hook:"onLeaveDone",cb:function(){var a=e._ms_if_||(e._ms_if_=document.createComment(t.nodeValue));delete t["ms-effect"],n.replaceChild(a,e)}})}}})},function(e,t){function n(e,t,i,l){var s=e[0];if((s||i)&&l.count){i=i||s.parentNode;for(var c=0,u=t.length;u>c;c++){var v=t[c],p=s;if(!(avalon.msie<9&&!v.fixIESkip&&3===v.nodeType&&o.test(v.nodeValue))){if(p&&(s=p.nextSibling),"for"===v.directive&&v.forDiff){if(!p)return;if(1===p.nodeType){var d=document.createComment(v.nodeValue);i.insertBefore(d,p),v.endRepeat=document.createComment("ms-for-end:"),i.insertBefore(v.endRepeat,p.nextSibling),p=d}else v.endRepeat||(v.endRepeat=a(p));8!==p.nodeType&&(p=p.nextSibling),s=v.endRepeat.nextSibling}if(!1!==r(p,v,i,l,"change")){!v.skipContent&&v.children&&p&&1===p.nodeType&&n(avalon.slice(p.childNodes),v.children,p,l);var f=v.props&&v.props["ms-controller"];if(f&&p){var h=avalon.vmodels[f];h.$render&&(h.$render.dom=p)}if(r(p,v,i,l,"afterChange"),!l.count)break}else"number"==typeof v.repeatCount&&(c+=v.repeatCount+1),r(p,v,i,l,"afterChange")}}}}function a(e){for(var e,t=0,n=[];e&&(8===e.nodeType&&(0===e.nodeValue.indexOf("ms-for:")?++t:0===e.nodeValue.indexOf("ms-for-end:")&&--t),n.push(e),e=e.nextSibling,0!==t););return n.pop()}function r(e,t,n,a,r){var o=t[r];if(o){for(var i;i=o.shift();)if(a.count-=1,!1===i(e,t,n))return!1;delete t[r]}}var o=/^\s*$/;e.exports=n},function(e,t,n){function a(e){var t=typeof e;return e&&"object"===t?e.$hashcode:t+":"+e}function r(e,t){for(var n,a=t.signature,r=[],o=[],i={children:[]},l=0;n=e[l];l++)8===n.nodeType&&n.nodeValue===a?(i.children.push(n),i.key=n.key,o.push(n.key),i.index=r.length,r.push(i),i={children:[]}):i.children.push(n);t.components=r,t.compareText=o.length+"|"+o.join(";;")}function o(e,t,n){for(var a=[],r=[],o=[],i=e;i&&i!==t;i=i.nextSibling)r.push(i),8===i.nodeType&&i.nodeValue===n?(o.push(i),a.push(o),o=[]):o.push(i);return a.all=r,a}function i(e,t){for(var n,a=0,r=[];(n=e[t++])&&("#comment"===n.type&&(0===n.nodeValue.indexOf("ms-for:")?a++:0===n.nodeValue.indexOf("ms-for-end:")&&a--),r.push(n),0!==a););return r}function l(e){for(var t,n=0;t=e[n++];)t.dom&&(t.dom=null),t.children&&l(t.children)}function s(e,t){var n=t.match(b);if(n){var a=n[1];for(var r in e){var o=r.match(w);if(o&&o[1]===a)return c(e,r)}}}function c(e,t){var n=e[t],a=t;if(n){var r=e["***"+t];if(r){var o=r.pop();return delete e[o.id],0==r.length&&delete e["***"+t],o.c}for(var i=[{id:t,c:n}];;){if(t+="_",!e[t])break;i.push({id:t,c:e[t]})}var o=i.pop();return delete e[o.id],i.length&&(e["***"+a]=i),o.c}return n}function u(e,t){var n=t.key;if(e[n]){for(;;)if(n+="_",!e[n]){e[n]=t;break}}else e[n]=t}var v=n(66),p=/ms-for\:\s*/,d=/^\s*\(\s*/,f=/\s*\)\s*$/,h=/\s*,\s*/,m=/\s+as\s+([$\w]+)/,g=n(45).ident,y=n(38),_=/^(null|undefined|NaN|window|this|\$index|\$id)$/;avalon._each=function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++){var r=e[n],o=a(r);t(n,r,o)}else for(var n in e)e.hasOwnProperty(n)&&t(n,e[n],n)},avalon.directive("for",{priority:3,parse:function(e,t,n){var a,r=t.nodeValue;r=r.replace(m,function(e,t){return!g.test(t)||_.test(t)?avalon.error("alias "+t+" is invalid --- must be a valid JS identifier which is not a reserved name."):a=t,""});var o=r.replace(p,"").split(" in "),i="var loop = "+avalon.parseExpr(o[1])+" \n",l="var "+t.signature+" = vnodes[vnodes.length-1]\n",s=a?"var "+a+" = loop\n":"",c=o[0].replace(d,"").replace(f,"").split(h);1===c.length&&c.unshift("$key"),c.push("traceKey");var u=avalon.quote,v=[u(c[0])+":"+c[0],u(c[1])+":"+c[1]];a&&v.push(u(a)+":loop");var y="{"+v.join(",\n")+"}";t.$append=i+l+s+"avalon._each(loop,function("+c.join(", ")+"){\nvar __local__ = avalon.mix(__local__, "+y+")\n"},diff:function(e,t,n,a){var o=e[a],v=t[a]||{},p=e.slice(a,o.end);if(o.items=p.slice(1,-1),r(o.items,o),delete v.forDiff,o.compareText===v.compareText)return void avalon.shadowCopy(o,v);o.forDiff=!0;var d,f,h,m=!("items"in v);if(m){var g=i(t,a);v.items=g.slice(1,-1),v.components=[],v.repeatCount=v.items.length}var _=v.components.length;o.endRepeat=v.endRepeat;var b=Math.max(p.length-2,0)-v.repeatCount;if(b>0){for(var w=[a+1,0],d=0;b>d;d++)w.push(null);t.splice.apply(t,w)}else 0>b&&t.splice.apply(t,[a,Math.abs(b)]);if(o.action=m?"init":"update",m){var x=o.cache={};for(d=0;f=o.components[d];d++)u(x,f),f.action="enter",o.fixAction&&(f.action="move",f.domIndex=d);o.removedComponents={}}else{var x=v.cache;if(!x)return;var T=o.cache={};for(d=0;f=o.components[d];d++){var h=c(x,f.key);h?_--:_&&(h=s(x,f.key),h&&_--),f.action=h?"move":"enter",h&&(l(h.children),f.domIndex=h.index),u(T,f)}for(d in x){o.removedComponents=x;break}}return v.components.length=0,o.prevItems=v.items,o.steps=n,delete v.cache,delete v.items,y(o,this.update,n,"for"),a+p.length-1},update:function(e,t,n){var a=t.endRepeat,r=t.signature,i=o(e.nextSibling,a,r);0===i.length&&i.all.forEach(function(e){n.removeChild(e)});var l,s=avalon.avalonFragment;for(var c in t.removedComponents){var u=t.removedComponents[c],p=i[u.index];p&&(p.forEach(function(e,t){e.parentNode&&avalon.applyEffect(e,u.children[t],{hook:"onLeaveDone",cb:function(){console.log(e),e.parentNode.removeChild(e)},staggerKey:r+"leave"})}),u.children.length=0)}delete t.removedComponents;for(var d=e,f=[],c=0;c<t.components.length;c++){var h=t.components[c];if("enter"===h.action){l||(l=avalon.parseHTML(t.template));var m=l.cloneNode(!0);m.appendChild(document.createComment(t.signature));var g=avalon.slice(m.childNodes);n.insertBefore(m,d.nextSibling),x(g,h.children,{hook:"onEnterDone",staggerKey:r+"enter"})}else if("move"===h.action){for(var y,_=s.cloneNode(!1),g=i[h.domIndex]||[],b=0;y=g[b++];)_.appendChild(y);n.insertBefore(_,d.nextSibling),x(g,h.children,{hook:"onMoveDone",staggerKey:r+"move"})}if(f.push.apply(f,g),d=g[g.length-1],!d)break}var w=t.items,T=t.steps,C=T.count;t.repeatCount=w.length,avalon.diff(w,t.prevItems,T),T.count!==C&&v(f,w,n,T);var $=avalon.caches[t.cid];return $&&$.call(t.vmodel,{type:"rendered",target:e,endRepeat:a,signature:t.signature}),!1}});var b=/^(string|number|boolean)/,w=/^_*(string|number|boolean)/,x=function(e,t,n){t.forEach(function(a,r){avalon.applyEffect(e[r],t[r],n)})}},,,function(e,t,n){function a(e,t){for(var n in e)if(e[n]!==t[n])return!0;return!1}function r(){if(!p.lock){var e=p[0];e&&(r.lock=!0,e())}}function o(e){var t=f.test(e)?1e3:1;return parseFloat(e)*t}function i(e,t,n){var a=e[t];a=Array.isArray(a)?a:"function"==typeof a?[a]:[],a.forEach(function(e){e&&e(n)})}function l(e){var t=e.toLowerCase();return function(n){var a,l=this.el,s=avalon(l),u=isFinite(n.stagger)?1e3*n.stagger:0;if(u&&n.staggerKey){var v=h.get(n.staggerKey)||h.put(n.staggerKey,{count:0,items:0});v.count++,v.items++}var d=v&&v.count||0,f=function(t){var o=t!==!1;l.animating=void 0,a=!0;var s=o?"Done":"Abort";i(n,"on"+e+s,l),avalon.unbind(l,c.transitionEndEvent),avalon.unbind(l,c.animationEndEvent),v&&0===--v.items&&(v.count=0),n.queue&&(p.lock=!1,p.shift(),r())};i(n,"onBefore"+e,l),n[t]?n[t](l,function(e){f(e!==!1)}):c.css&&(s.addClass(n[t+"Class"]),"leave"===t?s.removeClass(n.enterClass+" "+n.enterActiveClass):"enter"===t&&s.removeClass(n.leaveClass+" "+n.leaveActiveClass),s.bind(c.transitionEndEvent,f),s.bind(c.animationEndEvent,f),setTimeout(function(){a=NaN===avalon.root.offsetWidth,s.addClass(n[t+"ActiveClass"]);var e=window.getComputedStyle(l),r=e[c.transitionDuration],i=e[c.animationDuration],v=o(r)||o(i);0===!v?f(!1):u||setTimeout(function(){a||f(!1)},v+130)},17+u*d))}}function s(e){e.acton||(e.action=e.hook.replace(/^on/,"").replace(/Done$/,"").toLowerCase())}var c=n(71),u=n(28),v=n(38);avalon.directive("effect",{priority:5,diff:function(e,t,n,r){var o=e[r];if("string"==typeof o){var i=o;o=e[r]={is:i}}else Array.isArray(o)&&(o=e[r]=avalon.mix.apply({},o));if(o.action=o.action||"enter",Object(o)===o){var l=t[r];(Object(l)!==l||a(o,l))&&v(e,this.update,n,"effect","afterChange")}},update:function(e,t,n,a){if(!e.animating){e.animating=!0;var o=t["ms-effect"],i=o.is;if(a=a||{},!i)return avalon.warn("need is option");var l=avalon.effects;c.css&&!l[i]&&avalon.effect(i,{});var s=l[i];if(!s)return avalon.warn(i+" effect is undefined");var u=a.action||o.action,v=avalon.Effect;if("function"!=typeof v.prototype[u])return avalon.warn(u+" action is undefined");var d=new v(e),f=avalon.mix(a,s,o);f.queue?(p.push(function(){d[u](f)}),r()):setTimeout(function(){d[u](f)},4)}}});var p=[];avalon.effects={},avalon.effect=function(e,t){avalon.effects[e]=t||{},c.css&&(t.enterClass||(t.enterClass=e+"-enter"),t.enterActiveClass||(t.enterActiveClass=t.enterClass+"-active"),t.leaveClass||(t.leaveClass=e+"-leave"),t.leaveActiveClass||(t.leaveActiveClass=t.leaveClass+"-active")),t.action||(t.action="enter")};var d=function(e){this.el=e};avalon.Effect=d,d.prototype={enter:l("Enter"),leave:l("Leave"),move:l("Move")};var f=/\d+s$/,h=new u(128);avalon.applyEffect=function(e,t,n){var a=n.cb,r=n.hook,o=t["ms-effect"];if(o&&!avalon.document.hidden){var i=o[r];a&&(Array.isArray(i)?i.push(a):i?o[r]=[i,a]:o[r]=[a]),s(n),e.animate=!0,avalon.directives.effect.update(e,t,0,avalon.shadowCopy({},n))}else a&&a()}},function(e,t){var n,a,r,o=!1,i=!1,l=!1,s=avalon.cssName("transition-duration"),c=avalon.cssName("animation-duration"),u={TransitionEvent:"transitionend",WebKitTransitionEvent:"webkitTransitionEnd",OTransitionEvent:"oTransitionEnd",otransitionEvent:"otransitionEnd"},v=avalon.window;for(var p in u){if(v[p]){r=u[p];break}try{document.createEvent(p);r=u[p];break}catch(d){}}"string"==typeof r&&(o=!0,l=!0,n=r),u={AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"};var f;for(p in u)if(v[p]){f=u[p];break}"string"==typeof f&&(i=!0,l=!0,a=f),e.exports={transition:o,animation:i,css:l,transitionEndEvent:n,animationEndEvent:a,transitionDuration:s,animationDuration:c}},function(e,t,n){function a(e,t){var n=Array.isArray(e)?r(e):e,a=[];if(t)for(var o in t)a.push("var "+o+" = __local__["+avalon.quote(o)+"]");var i="__local__ = __local__ || {};\nvar __present__, __top__,__synth__;\n"+a.join(";\n")+"\n"+n,l=Function("__vmodel__","__local__",i);return l}avalon.lexer=n(73),avalon.diff=n(74),avalon.batch=n(75);var r=n(47);avalon.render=a,e.exports=avalon},function(e,t,n){function a(e){var t="??"+j++;return M[t]=e,t}function r(e){var t=M[e];return t}function o(e){return S.test(e)?e.replace(V,"").replace(k,a):e}function i(e,t,n){var i=[];if(n=n||1,"number"!=typeof t?t=0:t+=1,t>=n&&!O.rbind.test(e))return i;for(t||(e=e.replace(k,a));;){var u="",p=!1,f=e.match(_);if(f&&(u=f[0],p=new h(u.replace(E,r))),!p&&(f=e.match(b))){u=f[0],p=new m(f[1].replace(E,r));var w=p.nodeValue;if(T.test(w)){var C=i[i.length-1];C&&3===C.nodeType&&$.test(C.nodeValue)&&i.pop(),l(i)}}if(!p&&(f=e.match(g))){u=f[0];var j=f[1].toLowerCase();u=s(u,j),f=u.match(y);var S={};f[2]&&v(o(f[2]),S);var V=u.slice(f[0].length,-1*(j.length+3));p={nodeType:1,type:j,props:S,template:V.replace(E,r).trim(),children:[]},p=c(p,V,i,t,n)}if(p||(f=e.match(y),f&&(u=f[0],j=f[1].toLowerCase(),S={},f[2]&&v(o(f[2]),S),p={nodeType:1,type:j,props:S,template:"",children:[],isVoidTag:!0},p=c(p,"",i,t,n))),!p)break;i.push(p),e=e.slice(u.length),8===p.nodeType&&x.test(p.nodeValue)&&(p.signature=d("for"),e=e.replace(A,""))}return t||(M={}),i}function l(e){for(var t,n=1,a=e.length,r=[];(t=e[--a])&&(8!==t.nodeType||(x.test(t.nodeValue)?n-=1:T.test(t.nodeValue)&&(n+=1),0!==n));)r.push(avalon.vdomAdaptor(t,"toHTML"));return t.template=r.reverse().join("")}function s(e,t){var n=[],a=[],r=N[t+"open"]||(N[t+"open"]=new RegExp("<"+t+D,H)),o=N[t+"close"]||(N[t+"close"]=new RegExp("</"+t+">",H));e.replace(r,function(e,t){return n.push(("0000000000"+t+"<").slice(-10)),e.replace(L,"1")}).replace(o,function(e,t){a.push(("0000000000"+t+">").slice(-10))});for(var i=n.concat(a).sort(),l=i.join("").replace(w,""),s=0,c=0,u=0,v=l.length;v>u;u++){var p=l.charAt(u);if("<"===p?s+=1:s-=1,0===s){c=u;break}}var d=parseFloat(i[c])+t.length+3;return e.slice(0,d)}function c(e,t,n,a,r){var o=e.type;if("ms-skip"in e.props)e.skipContent=!0;else{switch(o){case"style":case"script":case"noscript":case"template":case"textarea":e.skipContent=!0,"textarea"===o&&(e.props.type="textarea");break;case"input":e.props.type||(e.props.type="text");break;case"select":e.props.hasOwnProperty("multiple")&&(e.props.multiple="multiple",e.multiple=!0);break;case"xmp":e.children.push(new h(e.template));break;case"option":e.children.push(new h(p(e.template)))}if(!e.isVoidTag){var l=i(t,a,r);e.children=l,"table"===o&&u(e.children)}var s=e.props["ms-for"];if(s){var c=e.props["data-for-rendered"],v=c+":cb";return delete e.props["ms-for"],n.push({nodeType:8,type:"#comment",nodeValue:"ms-for:"+s,signature:d("for"),cid:v,template:avalon.vdomAdaptor(e,"toHTML")}),c&&!avalon.caches[v]&&(avalon.caches[v]=Function("return "+avalon.parseExpr(c,"on"))()),n.push(e),{nodeType:8,skipContent:!0,type:"#comment",nodeValue:"ms-for-end:"}}}return e}function u(e){for(var t,n=!1,a=0,r=0,o=e.length,i=0;o>i;i++){var l=e[i];t?"tr"!==l.type&&1===l.nodeType?t=!1:(t.children.push(l),a++,e[i]=0):"tr"===l.type&&(t={nodeType:1,type:"tbody",template:"",children:[],props:{}},t.children.push(l),n=!0,0===r&&(r=i),e[i]=t)}if(n)for(i=r;o>i&&(0!==e[i]||(e.splice(i,1),i--,a--,0!==a));i++);}function v(e,t){e.replace(R,"=").replace(P,function(e){var n=e.split("="),a=n[1]||"",o=n[0].toLowerCase();2===n.length&&0===a.indexOf("??")&&(a=a.replace(E,r).slice(1,-1).replace(F,"&").replace(I,'"')),t[o]=a})}function p(e){return String(e).replace(B,"").trim()}var d=avalon.makeHashCode,f=n(15),h=f.VText,m=f.VComment,g=/^<([^\s>\/=.$<]+)(?:\s+[^=\s]+(?:=[^>\s]+)?)*\s*>(?:[\s\S]*)<\/\1>/,y=/^<([^\s>\/=.$<]+)\s*([^>]*?)\/?>/,_=/^[^<]+/,b=/^<!--([\w\W]*?)-->/,w=/\d+/g,x=/^\s*ms-for\:/,T=/^\s*ms-for-end\:/,C=n(45),$=C.sp,E=/\?\?\d+/g,A=C.leftSp,k=C.string,O=avalon.config,M={},j=1,S=/=["']/,V=/\n\s*/g,D="(?:\\s+[^>=]*?(?:=[^>]+?)?)*>",N={},L=/./g,H=avalon.msie<9?"ig":"g",F=/&amp;/g,P=/\S+/g,I=/&quot;/g,R=/\s*=\s*/g,B=/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi;e.exports=i},function(e,t,n){function a(e,t,n){if(e)for(var s=0;s<e.length;s++){var c=e[s],u=t[s]||i();switch(c.nodeType){case 3:c.skipContent||l.expr.diff(c,u,n);break;case 8:if("for"===c.directive){var v=l["for"].diff(e,t,n,s);"number"==typeof v&&(s=v)}else c.directive&&l[c.directive].diff(c,u,n);break;default:c.skipAttrs||r(c,u,n),c.skipContent||a(c.children,u.children||o,n)}}}function r(e,t,n){if(e.order){var a;try{e.order.replace(/([^;]+)/g,function(r){var o=r.match(s),c=o&&o[1];return a=c,l[c]&&l[c].diff(e,t||i(),n,r),r})}catch(r){avalon.log(a,r,r.message,"diffProps error")}}}var o=[],i=function(){return{children:[],props:{}}},l=avalon.directives,s=n(45).binding;avalon.diffProps=r,e.exports=a},function(e,t,n){function a(e){if(i)return avalon.Array.ensure(o,e);i=e;var t=avalon.scopes[e];if(!t||!document.nodeName||avalon.suspendUpdate)return i=null;var n=t.dom,l={count:0},s=t.render(t.synth||t.vmodel,t.local);avalon.diff(s,n.vtree||[],l),r([n],s,null,l),l.count=0,n.vtree=s,i=null;var c=o.indexOf(e);if(c>-1){var u=o.splice(c,1);return a(u[0])}var e=o.shift();e&&a(e)}var r=n(66),o=[],i=!1;avalon.suspendUpdate=0,e.exports=avalon.batch=a},,function(e,t){e.exports=avalon.oneObject("$id,$render,$track,$element,$watch,$fire,$events,$model,$skipArray,$accessors,$hashcode,__proxy__,__data__,__const__")},,,function(e,t,n){function a(e,t){t.__vmodel__=e;var n=p.hideProperty;n(e,"$events",t),n(e,"$watch",function(){if(2===arguments.length)return m.apply(e,arguments);throw"$watch方法参数不对"}),n(e,"$fire",function(t,n,a){var r=e.$events[t];h(r,e,t,n,a)})}function r(e,t,n){return"$"===e.charAt(0)||n[e]||"function"==typeof t||t&&t.nodeName&&t.nodeType>0}function o(e,t,n,a){if(Array.isArray(e))return p.arrayFactory(e,t,n,a);if(Object(e)===e&&"function"!=typeof e){if(t&&t.$id){if(++avalon.suspendUpdate,t.$track!==Object.keys(e).sort().join(";;"))var r=p.slaveFactory(t,e,n,a);else r=t;for(var o in e)d[o]||(r[o]=e[o]);return--avalon.suspendUpdate,r}return r=p.masterFactory(e,n,a)}return e}function i(e,t,n){function a(){return r}var r=NaN;return a.heirloom=n,{get:a,set:function(o){if(r!==o){o&&"object"==typeof o&&(o=p.modelAdaptor(o,r,n,{pathname:t,id:e}));var i=r;r=o;var u=n.__vmodel__;if(this.$hashcode&&u&&!avalon.suspendUpdate){n!==u.$events&&(a.heirloom=u.$events),s(a.$decompose,t,o,i),-1===t.indexOf("*")&&h(a.heirloom[t],u,t,o,i),l(e,u,t,o,i),c(a.heirloom,u,t,o,i),avalon.rerenderStart=new Date;var v=u.$id.indexOf(".");v>0?avalon.batch(u.$id.slice(0,v),!0):avalon.batch(u.$id,!0)}}},enumerable:!0,configurable:!0}}function l(e,t,n,a,r){if(e.indexOf(".*.")>0){var o=e.match(g),i=avalon.vmodels[o[1]];if(i){var l=o[2];h(i.$events[l],t,n,a,r)}}}function s(e,t,n,a){if(e&&e[t]){var r=e[t];if(r.$hashcode){var o=t.replace(/^[^.]+\./,"");o!==t&&h(r.$events[o],r,o,n,a)}else delete e[t]}}function c(e,t,n,a,r){e.__fuzzy__&&e.__fuzzy__.replace(avalon.rword,function(o){var i=e[o],l=i.reg;return l&&l.test(n)&&h(i,t,n,a,r),o})}function u(e){var t=e.$id;if(!t&&avalon.config.debug&&avalon.warn("vm.$id must be specified"),avalon.vmodels[t])throw Error("error:["+t+"] had defined!");var n=p.masterFactory(e,{},{pathname:"",id:t,master:!0});return avalon.vmodels[t]=n}function v(e,t,n,a){if(t&&t.splice){var r=[0,t.length].concat(e);return++avalon.suspendUpdate,t.splice.apply(t,r),--avalon.suspendUpdate,t}for(var i in y)e[i]=y[i];e.notify=function(e,t,r,o){var i=n.__vmodel__;if(i){var l=null===e||void 0===e?a.pathname:a.pathname+"."+e;i.$fire(l,t,r),o||avalon.suspendUpdate||(avalon.rerenderStart=new Date,avalon.batch(i.$id,!0))}};var l=avalon.makeHashCode("$");a.array=!0,a.hashcode=l,a.id=a.id||l,p.initViewModel(e,n,{},{},a);for(var s=0,c=e.length;c>s;s++)e[s]=o(e[s],0,{},{id:e.$id+".*",master:!0});return e}var p={},d=n(77),f=n(81),h=f.$emit,m=f.$watch;p.modelAdaptor=o;var g=/([^.]+)\.(.+)/;p.arrayFactory=v;var y={set:function(e,t){if(e>>>0===e&&this[e]!==t){if(e>this.length)throw Error(e+"set方法的第一个参数不能大于原数组长度");this.splice(e,1,t)}},contains:function(e){return-1!==this.indexOf(e)},ensure:function(e){return this.contains(e)||this.push(e),this},pushArray:function(e){return this.push.apply(this,e)},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){return e>>>0===e?this.splice(e,1):[]},clear:function(){return this.removeAll(),this}};avalon.define=u,e.exports={$$midway:p,$$skipArray:d,isSkip:r,__array__:y,initEvents:a,makeAccessor:i,modelAdaptor:o}},function(e,t){function n(e,t){var n,a=t.split(".")[0];try{e.hasOwnProperty(a)&&(n=e.$accessors?e.$accessors[a].get.heirloom.__vmodel__:Object.getOwnPropertyDescriptor(e,a).get.heirloom.__vmodel__)}catch(r){}return n||e}function a(e){var t=e.split(".");return new RegExp("^"+t.map(function(e){return"*"===e?"(?:[^.]+)":e}).join("\\.")+"$","i")}function r(e,t,n){e&&(t.__fuzzy__?-1===t.__fuzzy__.indexOf(","+n)&&(t.__fuzzy__+=","+n):t.__fuzzy__=n)}function o(e,t){var n=e.indexOf(".*")>0||"*"===e,i=n?this:o.adjust(this,e),l=i.$events,s=l[e]||(l[e]=[]);return n&&(s.reg=s.reg||a(e)),r(n,l,e),i!==this&&(r(n,this.$events,e),this.$events[e]=s),avalon.Array.ensure(s,t),function(){avalon.Array.remove(s,t)}}function i(e,t,n,a,r,o){if(e&&e.length)try{for(o=o||e.length-1;o>=0;o--){var l=e[o];l.call(t,a,r,n)}}catch(s){o-1>0&&i(e,t,n,a,r,o-1),avalon.log(s,n)}}o.adjust=n,e.exports={$emit:i,$watch:o,adjustVm:n}},,,function(e,t,n){var a=n(3),r=n(4);a.shadowCopy(a,r),n(85),n(6),n(7),e.exports=a},function(e,t){function n(e){if(e&&"object"==typeof e){var t=e.length,n=a.call(e);if(o.test(n))return!0;if("[object Object]"===n&&t===t>>>0)return!0}return!1}var a=avalon.inspect,r=/^\[object (?:Window|DOMWindow|global)\]$/,o=/(Array|List|Collection|Map|Arguments)\]$/;avalon.quote=JSON.stringify;var i={};"Boolean Number String Function Array Date RegExp Object Error".replace(avalon.rword,function(e){i["[object "+e+"]"]=e.toLowerCase()}),avalon.type=function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?i[a.call(e)]||"object":typeof e},avalon.isFunction=function(e){return"function"==typeof e},avalon.isWindow=function(e){return r.test(a.call(e))},avalon.isPlainObject=function(e){return"[object Object]"===a.call(e)&&Object.getPrototypeOf(e)===Object.prototype},avalon.mix=avalon.fn.mix=function(){var e,t,n,a,r,o,i=arguments[0]||{},l=1,s=arguments.length,c=!1;for("boolean"==typeof i&&(c=i,i=arguments[1]||{},l++),"object"!=typeof i&&"function"!=typeof i&&(i={}),l===s&&(i=this,l--);s>l;l++)if(null!=(e=arguments[l]))for(t in e){n=i[t];try{a=e[t]}catch(u){continue}i!==a&&(c&&a&&(avalon.isPlainObject(a)||(r=Array.isArray(a)))?(r?(r=!1,o=n&&Array.isArray(n)?n:[]):o=n&&avalon.isPlainObject(n)?n:{},i[t]=avalon.mix(c,o,a)):void 0!==a&&(i[t]=a))}return i},avalon.each=function(e,t){if(e){var a=0;if(n(e))for(var r=e.length;r>a&&t(a,e[a])!==!1;a++);else for(a in e)if(e.hasOwnProperty(a)&&t(a,e[a])===!1)break}},e.exports={avalon:avalon,isArrayLike:n}},function(e,t,n){n(87),n(88),n(89),n(90),n(91),n(92),n(93),n(94),e.exports=avalon},function(e,t){function n(){return(new XMLSerializer).serializeToString(this)}function a(e,t){if(e&&e.childNodes)for(var n,o=e.childNodes,i=0;n=o[i++];)if(1===n.nodeType){var l=document.createElementNS(r,n.nodeName.toLowerCase());avalon.each(n.attributes,function(e,t){l.setAttribute(t.name,t.value)}),a(n,l),t.appendChild(l)}else t.appendChild(n.cloneNode(!0))}avalon.document.contains||(Node.prototype.contains=function(e){return!!(16&this.compareDocumentPosition(e))}),avalon.contains=function(e,t){try{for(;t=t.parentNode;)if(t===e)return!0;return!1}catch(n){return!1}};var r="http://www.w3.org/2000/svg",o=avalon.document.createElementNS(r,"svg");o.innerHTML='<circle fill="red" />',/^\[object SVG\w*Element\]$/.test(o.firstChild)||Object.defineProperties(SVGElement.prototype,{outerHTML:{configurable:!0,get:n,set:function(e){var t=this.tagName.toLowerCase(),n=this.parent,r=avalon.parseHTML(e);if("svg"===t)n.insertBefore(r,this);else{var o=document.createDocumentFragment();a(r,o),n.insertBefore(o,this)}n.removeChild(this)}},innerHTML:{configurable:!0,get:function(){var e=this.outerHTML,t=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),n=new RegExp("</"+this.nodeName+">$","i");return e.replace(t,"").replace(n,"")},set:function(e){if(avalon.clearHTML){avalon.clearHTML(this);var t=avalon.parseHTML(e);a(t,this)}}}})},function(e,t){var n=/\S+/g;"add,remove".replace(avalon.rword,function(e){avalon.fn[e+"Class"]=function(t){var a=this[0]||{};return t&&"string"==typeof t&&1===a.nodeType&&t.replace(n,function(t){a.classList[e](t)}),this}}),avalon.fn.mix({hasClass:function(e){var t=this[0]||{};return 1===t.nodeType&&t.classList.contains(e)},toggleClass:function(e,t){var a="boolean"==typeof t,r=this;return String(e).replace(n,function(e){var n=a?t:!r.hasClass(e);r[n?"addClass":"removeClass"](e)}),this}})},function(e,t,n){function a(e,t){var n=t.changeAttr;if(n)for(var a in n){var i=n[a];if("src"===a&&window.chrome&&"EMBED"===e.tagName){e[a]=i;var l=e.parentNode,s=document.createComment("ms-src");l.replaceChild(s,e),l.replaceChild(e,s)}else if(0==a.indexOf("data-"))e.setAttribute(a,i);else{var c=r[a]||a;if("boolean"==typeof e[c]&&(e[c]=!!i),i===!1){e.removeAttribute(a);continue}var u=o.test(e)?!1:a in e.cloneNode(!1);u?e[c]=i+"":e.setAttribute(a,i)}}t.changeAttr=null}var r=n(23),o=/^\[object SVG\w*Element\]$/;avalon.parseJSON=JSON.parse,avalon.fn.attr=function(e,t){return 2===arguments.length?(this[0].setAttribute(e,t),this):this[0].getAttribute(e)},e.exports=a},function(e,t){function n(e,t){if(e.offsetWidth<=0){var a=getComputedStyle(e,null);if(u.test(a.display)){var r={node:e};for(var o in c)r[o]=a[o],e.style[o]=c[o];t.push(r)}var i=e.parentNode;i&&1===i.nodeType&&n(i,t)}}function a(e){return e.window||e.defaultView||!1}var r=avalon.root,o=avalon.camelize,i=avalon.cssHooks,l=["","-webkit-","-o-","-moz-","-ms-"],s={"float":"cssFloat"};avalon.cssNumber=avalon.oneObject("animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(e,t,n){if(s[e])return s[e];
t=t||r.style;for(var a=0,i=l.length;i>a;a++)if(n=o(l[a]+e),n in t)return s[e]=n;return null},avalon.fn.css=function(e,t){if(avalon.isPlainObject(e))for(var n in e)avalon.css(this,n,e[n]);else var a=avalon.css(this,e,t);return void 0!==a?a:this},avalon.fn.position=function(){var e,t,n=this[0],a={top:0,left:0};return n?("fixed"===this.css("position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),"HTML"!==e[0].tagName&&(a=e.offset()),a.top+=avalon.css(e[0],"borderTopWidth",!0),a.left+=avalon.css(e[0],"borderLeftWidth",!0),a.top-=e.scrollTop(),a.left-=e.scrollLeft()),{top:t.top-a.top-avalon.css(n,"marginTop",!0),left:t.left-a.left-avalon.css(n,"marginLeft",!0)}):a},avalon.fn.offsetParent=function(){for(var e=this[0].offsetParent;e&&"static"===avalon.css(e,"position");)e=e.offsetParent;return avalon(e||r)},i["@:set"]=function(e,t,n){e.style[t]=n},i["@:get"]=function(e,t){if(!e||!e.style)throw new Error("getComputedStyle要求传入一个节点 "+e);var n,a=getComputedStyle(e);return a&&(n="filter"===t?a.getPropertyValue(t):a[t],""===n&&(n=e.style[t])),n},i["opacity:get"]=function(e){var t=i["@:get"](e,"opacity");return""===t?"1":t},"top,left".replace(avalon.rword,function(e){i[e+":get"]=function(t){var n=i["@:get"](t,e);return/px$/.test(n)?n:avalon(t).position()[e]+"px"}});var c={position:"absolute",visibility:"hidden",display:"block"},u=/^(none|table(?!-c[ea]).+)/;avalon.each({Width:"width",Height:"height"},function(e,t){var a="client"+e,r="scroll"+e,o="offset"+e;i[t+":get"]=function(t,n,a){var r=-4;"number"==typeof a&&(r=a),n="Width"===e?["Left","Right"]:["Top","Bottom"];var i=t[o];return 2===r?i+avalon.css(t,"margin"+n[0],!0)+avalon.css(t,"margin"+n[1],!0):(0>r&&(i=i-avalon.css(t,"border"+n[0]+"Width",!0)-avalon.css(t,"border"+n[1]+"Width",!0)),-4===r&&(i=i-avalon.css(t,"padding"+n[0],!0)-avalon.css(t,"padding"+n[1],!0)),i)},i[t+"&get"]=function(e){var a=[];n(e,a);for(var r,o=i[t+":get"](e),l=0;r=a[l++];){e=r.node;for(var s in r)"string"==typeof r[s]&&(e.style[s]=r[s])}return o},avalon.fn[t]=function(n){var l=this[0];if(0===arguments.length){if(l.setTimeout)return l["inner"+e];if(9===l.nodeType){var s=l.documentElement;return Math.max(l.body[r],s[r],l.body[o],s[o],s[a])}return i[t+"&get"](l)}return this.css(t,n)},avalon.fn["inner"+e]=function(){return i[t+":get"](this[0],void 0,-2)},avalon.fn["outer"+e]=function(e){return i[t+":get"](this[0],void 0,e===!0?2:0)}}),avalon.fn.offset=function(){var e=this[0];try{var t=e.getBoundingClientRect();if(t.width||t.height||e.getClientRects().length){var n=e.ownerDocument,a=n.documentElement,r=n.defaultView;return{top:t.top+r.pageYOffset-a.clientTop,left:t.left+r.pageXOffset-a.clientLeft}}}catch(o){return{left:0,top:0}}},avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){avalon.fn[e]=function(n){var r=this[0]||{},o=a(r),i="scrollTop"===e;return arguments.length?void(o?o.scrollTo(i?o[t]:n,i?n:o[t]):r[e]=n):o?o[t]:r[e]}})},function(e,t){function n(e){var t=e.tagName.toLowerCase();return"input"===t&&/checkbox|radio/.test(e.type)?"checked":t}var a={"select:get":function r(e,t,n,o){var i,l=e.children;a["option:get"];n=t?n:e.selectedIndex,o=t?o:"select-one"===e.type||0>n,t=t||[];for(var s,c=0;s=l[c++];)if(!s.disabled)switch(s.nodeName.toLowerCase()){case"option":if(s.selected||s.index===n){if(i=s.value,o)return i;t.push(i)}break;case"optgroup":if(i=r(s,t,n,o),"string"==typeof i)return i}return o?null:t},"select:set":function(e,t,n){t=[].concat(t);for(var a,r=0;a=e.options[r++];)(a.selected=t.indexOf(a.value)>-1)&&(n=!0);n||(e.selectedIndex=-1)}};avalon.fn.val=function(e){var t=this[0];if(t&&1===t.nodeType){var r=0===arguments.length,o=r?":get":":set",i=a[n(t)+o];if(i)var l=i(t,e);else{if(r)return(t.value||"").replace(/\r/g,"");t.value=e}}return r?l:this}},function(e,t,n){var a=n(28),r=n(29),o=new function(){avalon.shadowCopy(this,{option:document.createElement("select"),thead:document.createElement("table"),td:document.createElement("tr"),area:document.createElement("map"),tr:document.createElement("tbody"),col:document.createElement("colgroup"),legend:document.createElement("fieldset"),_default:document.createElement("div"),g:document.createElementNS("http://www.w3.org/2000/svg","svg")}),this.optgroup=this.option,this.tbody=this.tfoot=this.colgroup=this.caption=this.thead,this.th=this.td},i={g:o.g};String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(avalon.rword,function(e){i[e]=o.g});var l,s=/<([\w:]+)/,c=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,u=/<|&#?\w+;/,v=new a(128),l=avalon.document.createElement("template");/HTMLTemplateElement/.test(l)||(l=null,avalon.shadowCopy(o,i)),avalon.parseHTML=function(e){var t,n=avalon.avalonFragment.cloneNode(!1);if("string"!=typeof e)return n;if(!u.test(e))return n.appendChild(document.createTextNode(e)),n;e=e.replace(c,"<$1></$2>").trim();var a=v.get(e);if(a)return a.cloneNode(!0);var t,p=(s.exec(e)||["",""])[1].toLowerCase(),d=i[p];if(d?d.innerHTML=e:l?(l.innerHTML=e,d=l.content):(d=o[p]||o._default,d.innerHTML=e),r(d),l)n=d;else for(;t=d.firstChild;)n.appendChild(t);return e.length<1024&&v.put(e,n.cloneNode(!0)),n},avalon.innerHTML=function(e,t){var n=this.parseHTML(t);this.clearHTML(e).appendChild(n)},avalon.clearHTML=function(e){for(e.textContent="";e.lastChild;)e.removeChild(e.lastChild);return e}},function(e,t,n){function a(e,t,n){var r=e.getAttribute("avalon-events");if(r&&(e.disabled!==!0||"click"!==t)){var o=[],i=h[t]||(h[t]=new RegExp(t+"\\:([^?\\s]+)","g"));r.replace(i,function(e,t){return o.push(t),e}),o.length&&n.push({elem:e,uuids:o})}e=e.parentNode;var l=avalon.gestureEvents||{};e&&e.getAttribute&&(v[t]||l[t])&&a(e,t,n)}function r(e){e=new i(e);var t=e.type,n=e.target,r=[];a(n,t,r);for(var o,l,s,c=0;(s=r[c++])&&!e.cancelBubble;)for(e.currentTarget=s.elem,o=0;(l=s.uuids[o++])&&!e.isImmediatePropagationStopped;){var u=avalon.eventListeners[l];if(u){var v=m.test(l)?s.elem._ms_context_:0;if(v&&v.$hashcode===!1)return avalon.unbind(n,t,u);if(g.test(t)){var p=+new Date;if(p-f>16){var d=u.call(v||n,e,n.local);f=p}}else d=u.call(v||n,e,n.local);d===!1&&(e.preventDefault(),e.stopPropagation())}}}function o(e){var t=c.getAttribute("delegate-events")||"";if(-1===t.indexOf(e)){var n=t.match(d)||[];n.push(e),c.setAttribute("delegate-events",n.join("??")),_(c,e,r,!!y[e])}}function i(e){if(e.originalEvent)return this;for(var t in e)w.test(t)||"function"==typeof e[t]||(this[t]=e[t]);this.timeStamp=new Date-0,this.originalEvent=e}var l=avalon.document,s=avalon.window,c=avalon.root,u=n(6).getShortID,v=n(33),p=avalon.eventHooks;avalon.bind=function(e,t,n){if(1===e.nodeType){var a=e.getAttribute("avalon-events")||"",i=u(n),l=p[t];l&&(t=l.type||t,l.fix&&(n=l.fix(e,n),n.uuid=i));var s=t+":"+i;avalon.eventListeners[n.uuid]=n,-1===a.indexOf(t+":")&&(v[t]||y[t]?o(t):_(e,t,r));var c=a.split("??");""===c[0]&&c.shift(),-1===c.indexOf(s)&&(c.push(s),e.setAttribute("avalon-events",c.join("??")))}else _(e,t,n);return n},avalon.unbind=function(e,t,n){if(1===e.nodeType){var a=e.getAttribute("avalon-events")||"";switch(arguments.length){case 1:b(e,t,r),e.removeAttribute("avalon-events");break;case 2:a=a.split("??").filter(function(e){return-1===e.indexOf(t+":")}).join("??"),e.setAttribute("avalon-events",a);break;default:var o=t+":"+n.uuid;a=a.split("??").filter(function(e){return e!==o}).join("??"),e.setAttribute("avalon-events",a),delete avalon.eventListeners[n.uuid]}}else b(e,t,n)};var d=/[^\s\?]+/g,f=Date.now(),h={},m=/^e/,g=/move|scroll/,y={focus:!0,blur:!0},_=function(e,t,n,a){e.addEventListener(t,n,a)},b=function(e,t,n){e.removeEventListener(t,n)},w=/^(?:ms|webkit|moz)/;i.prototype={preventDefault:function(){var e=this.originalEvent;this.returnValue=!1,e&&(e.returnValue=!1,e.preventDefault())},stopPropagation:function(){var e=this.originalEvent;this.cancelBubble=!0,e&&(e.cancelBubble=!0,e.stopPropagation())},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=!0,e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},avalon.fireDom=function(e,t,n){var a=l.createEvent("Events");a.initEvent(t,!0,!0),avalon.shadowCopy(a,n),e.dispatchEvent(a)};var p=avalon.eventHooks;"onmouseenter"in c||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){p[e]={type:t,fn:function(t,n){return function(a){var r=a.relatedTarget;return r&&(r===t||16&t.compareDocumentPosition(r))?void 0:(delete a.type,a.type=e,n.call(this,a))}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){s[e]&&!p.animationend&&(p.animationend={type:t})}),void 0===l.onmousewheel&&(p.mousewheel={type:"wheel",fn:function(e,t){return function(e){e.wheelDeltaY=e.wheelDelta=e.deltaY>0?-120:120,e.wheelDeltaX=0,Object.defineProperty(e,"type",{value:"mousewheel"}),t.call(this,e)}}}),avalon.fn.bind=function(e,t,n){return this[0]?avalon.bind(this[0],e,t,n):void 0},avalon.fn.unbind=function(e,t,n){return this[0]&&avalon.unbind(this[0],e,t,n),this},avalon.$$unbind=function(e){var t=e.querySelectorAll("[avalon-events]");avalon.each(t,function(e,t){avalon.unbind(t)})}},function(e,t,n){var a,r=n(35),o=avalon.document,i=avalon.window,l=[],s=function(e){for(a=!0;e=l.shift();)e(avalon)};"complete"===o.readyState?setTimeout(s):o.addEventListener("DOMContentLoaded",s),avalon.bind(i,"load",s),avalon.ready=function(e){a?e(avalon):l.push(e)},avalon.ready(function(){r(o.body)})},function(e,t,n){n(37),n(39),n(96),n(41),n(42),n(97),n(44),n(46),n(53),n(54),n(98),n(63),n(64),n(65),n(67),n(101),n(70)},function(e,t,n){var a=n(89),r=n(38);avalon.directive("attr",{diff:function(e,t,n,o){var i=e[o],l=t[o];if(Object(i)===i){if(Array.isArray(i)&&(i=e[o]=avalon.mix.apply({},i)),"object"!=typeof l)e.changeAttr=i;else{var s={},c=!1;for(var u in i)i[u]!==l[u]&&(c=!0,s[u]=i[u]);c&&(e.changeAttr=s,n.count+=1)}e.changeAttr&&r(e,a,n,"attr")}else e[o]=l},update:a})},function(e,t,n){var a=n(38);avalon.directive("expr",{parse:function(){},diff:function(e,t,n){e.nodeValue!==t.nodeValue&&a(e,this.update,n,"expr")},update:function(e,t,n){if(3!==e.nodeType){var a=document.createTextNode(t.nodeValue);n.replaceChild(a,e)}else e.nodeValue=t.nodeValue}})},function(e,t,n){function a(e){for(var t,n=0;t=this.parser[n++];){var a=avalon.parsers[t];a&&(e=a.call(this,e))}return e}var r=n(38),o=n(49),i=n(52),l=/\|\s*change\b/,s=/^(?:checkbox|radio)$/,c=/\|\s*debounce(?:\(([^)]+)\))?/,u=n(56),v=n(99),p=n(60),d=n(58),f=n(100),h=n(62);avalon.directive("duplex",{priority:2e3,parse:function(e,t,n){var a,r=n.expr,u=t.props.type,v=n.param,p=!1;v=v?"["+v.split("-").map(function(e){return"checked"===e&&(p=!0),avalon.quote(e)})+"]":"[]",s.test(u)&&p&&(v="[]",a="radio"),/input|textarea|select/.test(t.type)?a||(a="select"===t.type?"select":"checkbox"===u?"checkbox":"radio"===u?"radio":"input"):"contenteditable"in t.props&&(a="contenteditable");var d=!1,f=0;if(("input"===a||"contenteditable"===a)&&(l.test(r)&&(d=!0),!d)){var h=r.match(c);h&&(f=parseInt(h[1],10)||300)}e.vmodel="__vmodel__",e.modelValue="("+avalon.parseExpr(n,"duplex")+")(__vmodel__)",e.duplexSetter=o.get("duplex:set:"+r);var m=o.get("duplex:format:"+r),g=e.props["data-duplex-changed"];e.callback=g?avalon.parseExpr(g,"on"):"avalon.noop",e.duplexFormat=m||"function(vm, a){return a}",e.duplexData=i({type:a,isChecked:p,isChanged:d,parser:v,callback:g?avalon.parseExpr(n,"on"):"avalon.noop",debounceTime:f,vmodel:"__vmodel__"})},diff:function(e,t,n){var a=e.modelValue,o=t.modelValue,i=e.duplexFormat(e.vmodel,a);String(i)!==String(e.duplexFormat(e.vmodel,o))&&(e.viewValue=i,"select"!==e.type||e.children.length||(avalon.Array.merge(e.children,avalon.lexer(e.template,0,2)),u(e,i)),r(e,this.update,n,"duplex","afterChange"))},update:function(e,t){if(e&&1===e.nodeType){e.getAttribute("duplex-inited")||(e.__ms_duplex__=t.duplexData,e.setAttribute("duplex-inited","true"),v(e,t));var n=e.__ms_duplex__;if(n.format=t.duplexFormat,n.set=t.duplexSetter,n.parse=a,n.element=e,n.callback=t.callback,h(e,t),!avalon.msie&&p===!1&&!e.valueHijack){e.valueHijack=d;var r=setInterval(function(){avalon.contains(avalon.root,e)?e.valueHijack():clearInterval(r)},30)}if(n.viewValue!==t.viewValue){if(n.modelValue=t.modelValue,!Array.isArray(t.modelValue)){var o=n.parse(t.viewValue);o!==n.modelValue&&n.set(n.vmodel,o)}if(n.viewValue=t.viewValue,n.element=e,f[n.type].call(n),e.caret){var i=n.caretPos;i&&n.setCaret(e,i.start,i.end),n.caretPos=null}}}}})},function(e,t,n){function a(e,t){var n={},a=t.duplexData;switch(a.update=u,a.type){case"radio":"radio"===t.props.type?n.click=u:n.change=u;break;case"checkbox":case"select":n.change=u;break;case"contenteditable":a.isChanged?n.blur=u:(p.webkitURL?n.webkitEditableContentChanged=u:p.MutationEvent&&(n.DOMCharacterDataModified=u),n.input=u);break;case"input":a.isChanged?n.change=u:(n.input=u,avalon.msie||(n.compositionstart=i,n.compositionend=l))}/password|text/.test(t.props.type)&&(n.focus=r,n.blur=o,a.getCaret=s,a.setCaret=c);for(var v in n)avalon.bind(e,v,n[v])}function r(){this.caret=!0}function o(){this.caret=!1}function i(){this.composing=!0}function l(e){this.composing=!1}function s(e){var t=NaN,n=NaN;return e.setSelectionRange&&(t=e.selectionStart,n=e.selectionEnd),{start:t,end:n}}function c(e,t,n){e.value&&!e.readOnly&&(e.selectionStart=t,e.selectionEnd=n)}var u=n(58),v=n(6).getShortID,p=(avalon.msie,avalon.window);avalon.document;v(r),v(o),v(i),v(l),v(u),e.exports=a},function(e,t){var n={input:function(){this.element.value=this.viewValue},radio:function(){var e;e=this.isChecked?!!this.viewValue:this.viewValue+""===this.element.value;var t=this.element;t.checked=e},checkbox:function(){for(var e=!1,t=this.element,n=t.value,a=0;a<this.modelValue.length;a++){var r=this.modelValue[a];r+""===n&&(e=!0)}t.checked=e},select:function(){var e=Array.isArray(this.viewValue)?this.viewValue.map(String):this.viewValue+"";avalon(this.element).val(e)},contenteditable:function(){this.element.innerHTML=this.viewValue,this.update.call(this.element)}};e.exports=n},function(e,t,n){function a(e){for(var t,n=0;t=e[n++];)"for"===t.directive&&(t.fixAction=!0),t.children&&a(t.children)}var r=n(102),o=n(66),i=n(38),l=avalon.directive("widget",{priority:4,parse:function(e,t,n){var a=t.props.wid||avalon.makeHashCode("w");e.wid=avalon.quote(a),e.directive="widget",e.template=t.template,e.children="[]",e[n.name]=avalon.parseExpr(n);var r=t.$append||"";t.$append=["var il1492 = vnodes.length - 1","var el1492 = vnodes[il1492]","if(el1492.nodeType === 1){","el1492.local = __local__","el1492.vmodel = __vmodel__","avalon.component(el1492, vnodes, il1492,"+e.wid+")","}"].join("\n ")+r},define:function(){return avalon.mediatorFactory.apply(this,arguments)},diff:function(e,t,n){function r(t,n){e.vmodel.$fire("onReady",{type:"ready",target:t,wid:o,vmodel:n.vmodel})}var o=e.wid,l=avalon.scopes[o];if(8===e.nodeType)n.count+=1,e.change=[this.replaceByComment];else if(l&&1===l.renderCount)l.vmodel.$fire("onInit",{type:"init",vmodel:l.vmodel,wid:o,componentName:l.componentName}),l.renderCount=2,t.children=[],e.steps=n,a(e.children),i(e,this.replaceByComponent,n,"widget"),i(e,r,n,"widget","afterChange");else{l.renderCount++,l.pre&&t.wid===l.pre.wid&&avalon.mix(t,l.pre);var s=!e.diff||e.diff(e,t,n);e.skipContent=!s,t.wid&&e.wid!==t.wid&&!t.props.cached&&(delete avalon.scopes[t.wid],delete avalon.vmodels[t.wid]);var c=e.vmodel.$events.onViewChange;c&&c.length&&(n.count+=1,e.afterChange=[function(n,a){var r=t.outerHTML,i=e.outerHTML||(e.outerHTML=avalon.vdomAdaptor(e,"toHTML"));r!==i&&e.vmodel.$fire("onViewChange",{type:"viewchange",target:n,wid:o,vmodel:a.vmodel})}])}},addDisposeMonitor:function(e){r.byRewritePrototype(e)},replaceByComment:function(e,t,n){var a=document.createComment(t.nodeValue);e?n.replaceChild(a,e):n.appendChild(a)},replaceByComponent:function(e,t,n){var a=avalon.vdomAdaptor(t,"toDOM");t.ouerHTML=avalon.vdomAdaptor(t,"toHTML"),e?n.replaceChild(a,e):n.appendChild(a),o([a],[t],n,t.steps);var r=t.vmodel,i=avalon.scopes[r.$id];return i.dom=a,r.$element=a,a.vtree=[t],l.addDisposeMonitor(a),!1}})},function(e,t){function n(){function e(e,t){var n=a[e];a[e]=function(e,a){return t.call(this,n,e,a)}}function t(e){var t=avalon.slice(this.getElementsByTagName("*"));s.call(this,e),i(t)}if(!n.execute){n.execute=!0;var a=Node.prototype;e("removeChild",function(e,t,n){return e.call(this,t,n),1===t.nodeType&&o(t),t}),e("replaceChild",function(e,t,n){return e.call(this,t,n),1===t.nodeType&&o(t),t});var r=Element.prototype,l=Object.getOwnPropertyDescriptor(r,"innerHTML"),s=l.set;l.set=t,Object.defineProperty(r,"innerHTML",l),e("appendChild",function(e,t){return e.call(this,t),1===t.nodeType&&11===this.nodeType&&o(t),t}),e("insertBefore",function(e,t,n){return e.call(this,t,n),1===t.nodeType&&11===this.nodeType&&o(t),t})}}function a(e){for(;e;){if(9===e.nodeType)return!0;e=e.parentNode}return!1}function r(e){if(1===e.nodeType&&e.getAttribute("wid")&&!a(e)){var t=e.getAttribute("wid"),n=avalon.scopes[t];if(!n)return;var r=n.vmodel;return n.vmodel.$fire("onDispose",{type:"dispose",target:e,vmodel:r}),n&&!e.getAttribute("cached")&&(r.$element=null,r.$hashcode=!1,delete n.vmodel,delete n.dom,delete avalon.scopes[t]),!1}}function o(e){setTimeout(function(){r(e)},4)}function i(e){for(var t,n=0;t=e[n++];)r(t)}e.exports={byRewritePrototype:n}},function(e,t,n){function a(e,t){if(!e)return!0;var n=avalon.mix(t||{},e);for(var a in n)if("is"!==a&&"$id"!==a)return!1;return!0}function r(e,t,n,a,r){if(!l(e))return n[a]=g;var o=t.$id,i=avalon.scopes[o];if(i&&i.dom)i.pre=i.dom.vtree[0],i.dom.vtree=[e];else{var i={componentName:r,vmodel:t,render:t.$render,local:e.local,renderCount:1};avalon.scopes[o]=i}n[a]=e}function o(e){return y.test(e)}function i(e,t,n){for(var a in t)if(t.hasOwnProperty(a)){var r=t[a];h[a]?a in e?e[a].push(r):e[a]=[t[a]]:isFinite(n)&&(e[a]=r)}}function l(e){var t=!0;try{s(e)}catch(n){t=!1}return t}function s(e){e.children.forEach(function(e){if(8===e.nodeType){if(e===g)throw"unresolved"}else e.children&&s(e)})}function c(e,t,n){var a={};n?a[n]=t.children:t.children.forEach(function(e){if(1===e.nodeType){var t=e.props.slot||"default";a[t]?a[t].push(e):a[t]=[e]}}),u(e,a)}function u(e,t){for(var n,a=0;n=e[a++];)if(1===n.nodeType)if("slot"===n.type){var r=n.props.name||"default";if(t[r]){var o=t[r];e.splice.apply(e,[a-1,1].concat(o)),1===o.length&&3===o[0].nodeType&&v(e)}}else u(n.children,t);return e}function v(e){for(var t,n=0;t=e[n];n++)if(t.skipContent===!1&&3===t.nodeType){var a=e[n-1],r=e[n+1];a&&3===a.nodeType&&!/\S/.test(a.nodeValue)&&(avalon.Array.remove(e,a),--n),r&&3===r.nodeType&&!/\S/.test(r.nodeValue)&&avalon.Array.remove(e,r)}}var p=n(16),d=(n(47),n(77),{wbr:1,xmp:1,template:1}),f="onInit,onReady,onViewChange,onDispose",h=avalon.oneObject(f),m=f.split(",").concat("is","diff","define"),g={nodeType:8,type:"#comment",directive:"widget",nodeValue:"unresolved component placeholder"};avalon.component=function(e,t){if(arguments.length<4)avalon.components[e]||(avalon.components[e]=t);else{var n=arguments[0],l=arguments[1],s=arguments[2],v=arguments[3],f=n.vmodel,y={};if(a(n["ms-widget"],y))b=!0;else{var _=[].concat(n["ms-widget"]||[]);_.forEach(function(e,t){i(y,e,t)});var b=a(y)}var w=n.type.indexOf("-")>0?n.type:y.is;if(!avalon.components[w])return l[s]=g;var x=w.replace(/-/g,"_");f.hasOwnProperty(x)&&"object"==typeof f[x]&&(y={},_=[f[x]],i(y,f[x],0),m=[x].concat(m));var T=avalon.scopes[y.$id]||avalon.scopes[v];if(T&&T.dom){var C=T.render(T.vmodel,T.local);if(C[0])return r(C[0],T.vmodel,l,s)}var $=n.type;d[$]||o($)||avalon.warn($+"不合适做组件的标签"),"xmp"!==$&&"template"!==$&&0!==n.children.length||(n.children=avalon.lexer(n.template)),t=avalon.components[w];var E=y.diff,A=y.define;A=A||avalon.directives.widget.define;var k=y.$id||v,O=avalon.mix(!0,{},t.defaults);i(y,O,!1),defineArgs=[f,O].concat(_);var M=A.apply(function(e,t){m.forEach(function(n){delete e[n],delete t[n]})},defineArgs);M.$id=k;var j=t.template.trim();"function"==typeof t.getTemplate&&(j=t.getTemplate(M,j));var S=avalon.lexer(j);S.length>1&&avalon.error("组件必须用一个元素包起来");var V=S[0];if(avalon.vmodels[k]=M,avalon.mix(V.props,n.props),V.props.wid=k,t.soleSlot){var D={},N=t.soleSlot;D[N]=/\S/.test(n.template)?n.children:new p("{{@"+N+"}}"),u(S,D)}else n.isVoidTag||c(S,n,t.soleSlot);for(var L in h)y[L]&&y[L].forEach(function(e){M.$watch(L,e)});S[0].directive="widget";var H=avalon.render(S,n.local);M.$render=H;try{var C=H(M,n.local)}catch(L){C=[g]}var F=C[0];F.diff=E,r(F,M,l,s,w)}};var y=/^[a-z]([a-z\d]+\-)+[a-z\d]+$/},function(e,t,n){function a(){}function r(e,t,n){var r={};e.$skipArray&&(r=avalon.oneObject(e.$skipArray),delete e.$skipArray);var o={};n=n||{},t=t||{};var i={},l=m("$"),s=n.pathname||"";n.id=n.id||l,n.hashcode=l;var u,h,g;for(u in e)if(!v[u]){var y=o[u]=e[u];c(u,y,r)||(h=n.id+"."+u,g=s?s+"."+u:u,i[u]=p(h,g,t))}i.$model=f;var _=new a;Object.defineProperties(_,i);for(u in o)_[u]=o[u],u in r?delete o[u]:o[u]=!0;return d(_,t,o,i,n),_}function o(e,t,n,a){var r={},o={},i=a.pathname;n=n||{};var l,s,u;for(l in t)if(!v[l]&&(r[l]=t[l],!c(l,t[l],g))){var h=Object.getOwnPropertyDescriptor(e,l);h&&h.get?o[l]=h:(s=a.id+"."+l,u=i?i+"."+l:l,o[l]=p(s,u,n))}for(l in e)delete e[l];a.hashcode=e.$hashcode||m("$"),o.$model=f;var y=e;Object.defineProperties(y,o);for(l in r)o[l]||(y[l]=r[l]),r[l]=!0;return d(y,n,r,o,a),y}function i(e,t){for(var n,r,o={},i={},l={},s={},u={},f=avalon.slice(arguments),h=0;h<f.length;h++){var g=f[h];for(var y in g){o[y]=g[y],"$skipArray"===y&&Array.isArray(g.$skipArray)&&g.$skipArray.forEach(function(e){u[e]=1});var _=Object.getOwnPropertyDescriptor(g,y);_.set?-1===f.indexOf(g[y])?i[y]=_:(n=o[y],r=y,delete o[y]):"function"!=typeof o[y]&&(l[y]=1)}}"function"==typeof this&&this(o,l);for(y in l)v[y]||i[y]||c(y,o[y],u)||(i[y]=p(e.$id+"."+y,y,s),i[y].set(o[y]));var b=new a;Object.defineProperties(b,i);for(y in o){if(i[y]||(b[y]=o[y]),r&&i[y]&&n.hasOwnProperty(y)){var w=i[y];w.get.$decompose||(w.get.$decompose={}),w.get.$decompose[r+"."+y]=b}o[y]=!0}return d(b,s,o,i,{id:e.$id,hashcode:m("$"),master:!0}),b}function l(e,t){e.length!==t&&e.notify("length",e.length,t,!0)}var s=n(105),c=s.isSkip,u=s.$$midway,v=s.$$skipArray;delete v.$accessors,delete v.__data__,delete v.__proxy__,delete v.__const__;var p=s.makeAccessor,d=s.initViewModel,f=s.modelAccessor,h=s.modelAdaptor,m=avalon.makeHashCode;u.masterFactory=r;var g={};u.slaveFactory=o,u.mediatorFactory=avalon.mediatorFactory=i;var y=s.__array__,_=Array.prototype,b=_.splice;y.removeAll=function(e){var t=this.length;if(Array.isArray(e))for(var n=this.length-1;n>=0;n--)-1!==e.indexOf(this[n])&&b.call(this,n,1);else if("function"==typeof e)for(n=this.length-1;n>=0;n--){var a=this[n];e(a,n)&&b.call(this,n,1)}else b.call(this,0,this.length);l(this,t),this.notify()};var w=["push","pop","shift","unshift","splice"];w.forEach(function(e){var t=_[e];y[e]=function(n,a){var r=[],o=this.length;if("splice"===e&&Object(this[0])===this[0])for(var i=this.slice(n,a),s=_.slice.call(arguments,2),r=[n,a],c=0,u=s.length;u>c;c++){var v=i[c];r[c+2]=h(s[c],v,v&&v.$events||{},{id:this.$id+".*",master:!0})}else for(var p=0,d=arguments.length;d>p;p++)r[p]=h(arguments[p],0,{},{id:this.$id+".*",master:!0});var f=t.apply(this,r);return l(this,o),this.notify(),f}}),"sort,reverse".replace(avalon.rword,function(e){y[e]=function(){return _[e].apply(this,arguments),this.notify(),this}}),e.exports=avalon},function(e,t,n){function a(e){var t=avalon.type(e);if("array"===t){for(var n=[],r=0;r<e.length;r++)n[r]=a(e[r]);return n}if("object"===t){var o={};for(r in e)if(e.hasOwnProperty(r)){var i=e[r];o[r]=i&&i.nodeType?i:a(i)}return o}return e}function r(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!1,configurable:!0})}function o(e,t,n,a,o){function i(e){return n[e]===!0}o.array?Object.defineProperty(e,"$model",s):r(e,"hasOwnProperty",i),r(e,"$id",o.id),r(e,"$hashcode",o.hashcode),r(e,"$track",Object.keys(n).sort().join(";;")),o.master===!0&&(r(e,"$element",null),r(e,"$render",0),l(e,t))}var i=n(80),l=i.initEvents,s={get:function(){return a(this)},set:avalon.noop,enumerable:!1,configurable:!0};i.$$midway.hideProperty=r,i.$$midway.initViewModel=o;var c={toJson:a,initViewModel:o,modelAccessor:s};for(var u in i)c[u]=i[u];e.exports=c}])});
//# sourceMappingURL=avalon.modern.min.js.map
!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.avalon=n():e.avalon=n()}(this,function(){return function(e){function n(a){if(t[a])return t[a].exports;var r=t[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){var a=t(83);t(8),t(15),t(85),t(94),t(71),t(75),t(103),e.exports=a},,,function(e,n){(function(n){function t(e){return new t.init(e)}n.avalon=t,"undefined"!=typeof window&&(window.avalon=t),t.init=function(e){this[0]=this.element=e},t.fn=t.prototype=t.init.prototype,t.shadowCopy=function(e,n){for(var t in n)e[t]=n[t];return e};var a=/[^, ]+/g,r=n.console;t.shadowCopy(t,{noop:function(){},rword:a,inspect:{}.toString,ohasOwn:{}.hasOwnProperty,log:function(){r&&t.config.debug&&Function.apply.call(console.log,console,arguments)},warn:function(){if(r&&t.config.debug){var e=console.warn||console.log;Function.apply.call(e,console,arguments)}},error:function(e,n){throw(n||Error)(e)},oneObject:function(e,n){"string"==typeof e&&(e=e.match(a)||[]);for(var t={},r=void 0!==n?n:1,o=0,i=e.length;i>o;o++)t[e[o]]=r;return t}}),e.exports=t}).call(n,function(){return this}())},function(e,n){(function(n){var t=n,a={window:t,document:{createElement:function(){return{}},createElementNS:function(){return{}},contains:Boolean},root:{outerHTML:"x"},msie:NaN,modern:!0,avalonDiv:{},avalonFragment:null};if(t.location&&t.navigator&&t.window){var r=t.document;a.document=r,a.modern=t.dispatchEvent,a.root=r.documentElement,a.avalonDiv=r.createElement("div"),a.avalonFragment=r.createDocumentFragment(),t.VBArray&&(a.msie=r.documentMode||(t.XMLHttpRequest?7:6))}e.exports=a}).call(n,function(){return this}())},,function(e,n){var t={},a=/([a-z\d])([A-Z]+)/g,r=/[-_][^-_]/g,o=/\d\.\d{4}/,i=/[-.*+?^${}()|[\]\/\\]/g,s=[].slice;avalon.shadowCopy(avalon,{caches:{},vmodels:{},filters:{},components:{},resolvedComponents:{},directives:{},eventHooks:{},eventListeners:{},validators:{},cssHooks:t,parsers:{number:function(e){return""===e?"":parseFloat(e)||0},string:function(e){return null===e||void 0===e?"":e+""},"boolean":function(e){return"true"===e}},version:"2.02",slice:function(e,n,t){return s.call(e,n,t)},css:function(e,n,a,r){e instanceof avalon&&(e=e[0]);var o=avalon.camelize(n);if(n=avalon.cssName(o)||o,void 0===a||"boolean"==typeof a){r=t[o+":get"]||t["@:get"],"background"===n&&(n="backgroundColor");var i=r(e,n);return a===!0?parseFloat(i)||0:i}if(""===a)e.style[n]="";else{if(null==a||a!==a)return;isFinite(a)&&!avalon.cssNumber[o]&&(a+="px"),r=t[o+":set"]||t["@:set"],r(e,n,a)}},directive:function(e,n){return this.directives[e]=n},isObject:function(e){return null!==e&&"object"==typeof e},range:function(e,n,t){t||(t=1),null==n&&(n=e||0,e=0);for(var a=-1,r=Math.max(0,Math.ceil((n-e)/t)),o=new Array(r);++a<r;)o[a]=e,e+=t;return o},hyphen:function(e){return e.replace(a,"$1-$2").toLowerCase()},camelize:function(e){return!e||e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(r,function(e){return e.charAt(1).toUpperCase()})},makeHashCode:function(e){return e=e||"avalon",String(Math.random()+Math.random()).replace(o,e)},escapeRegExp:function(e){return(e+"").replace(i,"\\$&")},Array:{merge:function(e,n){e.push.apply(e,n)},ensure:function(e,n){return-1===e.indexOf(n)?e.push(n):void 0},removeAt:function(e,n){return!!e.splice(n,1).length},remove:function(e,n){var t=e.indexOf(n);return~t?avalon.Array.removeAt(e,t):!1}}});var l=1;e.exports={avalon:avalon,getLongID:function(e){return e.uuid||(e.uuid=avalon.makeHashCode("e"))},getShortID:function(e){return e.uuid||(e.uuid="_"+ ++l)}}},function(e,n){function t(e){for(var n in e)if(avalon.ohasOwn.call(e,n)){var a=e[n];"function"==typeof t.plugins[n]?t.plugins[n](a):"object"==typeof t[n]?avalon.shadowCopy(t[n],a):t[n]=a}return this}avalon.config=t;var a={interpolate:function(e){var n=e[0],a=e[1];if(n===a)throw new SyntaxError("openTag!==closeTag");var r=n+"test"+a,o=avalon.avalonDiv;if(o.innerHTML=r,o.innerHTML!==r&&o.innerHTML.indexOf("&lt;")>-1)throw new SyntaxError("此定界符不合法");o.innerHTML="",t.openTag=n,t.closeTag=a;var i=avalon.escapeRegExp(n),s=avalon.escapeRegExp(a);t.rexpr=new RegExp(i+"([\\ss\\S]*)"+s),t.rexprg=new RegExp(i+"([\\ss\\S]*)"+s,"g"),t.rbind=new RegExp(i+"[\\ss\\S]*"+s+"|\\bms-|\\bslot\\b")}};t.plugins=a,t.plugins.interpolate(["{{","}}"]),t.debug=!0},function(e,n,t){function a(e){return e}var r=t(9),o=t(10),i=t(11),s=t(12),l=t(13),c=t(14),u=avalon.filters;avalon.__format__=function(e){var n=u[e];return n?n.get?n.get:n:a},avalon.mix(u,{uppercase:function(e){return e.toUpperCase()},lowercase:function(e){return e.toLowerCase()},truncate:function(e,n,t){return n=n||30,t="string"==typeof t?t:"...",e.length>n?e.slice(0,n-t.length)+t:String(e)},camelize:avalon.camelize,date:s,escape:o,sanitize:i,number:r,currency:function(e,n,t){return(n||"￥")+r(e,isFinite(t)?t:2)}},l,c),e.exports=avalon},function(e,n){function t(e,n,t,a){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var r=isFinite(+e)?+e:0,o=isFinite(+n)?Math.abs(n):3,i=a||",",s=t||".",l="",c=function(e,n){var t=Math.pow(10,n);return""+(Math.round(e*t)/t).toFixed(n)};return l=(o?c(r,o):""+Math.round(r)).split("."),l[0].length>3&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(l[1]||"").length<o&&(l[1]=l[1]||"",l[1]+=new Array(o-l[1].length+1).join("0")),l.join(s)}e.exports=t},function(e,n){function t(e){return String(e).replace(/&/g,"&amp;").replace(a,function(e){var n=e.charCodeAt(0),t=e.charCodeAt(1);return"&#"+(1024*(n-55296)+(t-56320)+65536)+";"}).replace(r,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var a=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,r=/([^\#-~| |!])/g;e.exports=t},function(e,n){var t=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,a=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,r=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/gi,o={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/gi,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/gi,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/gi};e.exports=function(e){return e.replace(t,"").replace(r,function(e,n){var t=e.toLowerCase().match(/<(\w+)\s/);if(t){var r=o[t[1]];r&&(e=e.replace(r,function(e,n,t){var a=t.charAt(0);return n+"="+a+"javascript:void(0)"+a}))}return e.replace(a," ").replace(/\s+/g," ")})}},function(e,n){function t(e){return parseInt(e,10)||0}function a(e,n,t){var a="";for(0>e&&(a="-",e=-e),e=""+e;e.length<n;)e="0"+e;return t&&(e=e.substr(e.length-n)),a+e}function r(e,n,t,r){return function(o){var i=o["get"+e]();return(t>0||i>-t)&&(i+=t),0===i&&-12===t&&(i=12),a(i,n,r)}}function o(e,n){return function(t,a){var r=t["get"+e](),o=(n?"SHORT"+e:e).toUpperCase();return a[o][r]}}function i(e){var n=-1*e.getTimezoneOffset(),t=n>=0?"+":"";return t+=a(Math[n>0?"floor":"ceil"](n/60),2)+a(Math.abs(n%60),2)}function s(e,n){return e.getHours()<12?n.AMPMS[0]:n.AMPMS[1]}function l(e,n){var a,r,o=l.locate,i="",s=[];if(n=n||"mediumDate",n=o[n]||n,"string"==typeof e)if(/^\d+$/.test(e))e=t(e);else if(p.test(e))e=+RegExp.$1;else{var v=e.trim(),d=[0,0,0,0,0,0,0],f=new Date(0);v=v.replace(/^(\d+)\D(\d+)\D(\d+)/,function(e,n,a,r){var o=4===r.length?[r,n,a]:[n,a,r];return d[0]=t(o[0]),d[1]=t(o[1])-1,d[2]=t(o[2]),""});var h=f.setFullYear,m=f.setHours;v=v.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(e,n,a,r,o){return d[3]=t(n),d[4]=t(a),d[5]=t(r),o&&(d[6]=Math.round(1e3*parseFloat("0."+o))),""});var g=0,y=0;v=v.replace(/Z|([+-])(\d\d):?(\d\d)/,function(e,n,a,r){return h=f.setUTCFullYear,m=f.setUTCHours,n&&(g=t(n+a),y=t(n+r)),""}),d[3]-=g,d[4]-=y,h.apply(f,d.slice(0,3)),m.apply(f,d.slice(3)),e=f}if("number"==typeof e&&(e=new Date(e)),"date"===avalon.type(e)){for(;n;)r=u.exec(n),r?(s=s.concat(r.slice(1)),n=s.pop()):(s.push(n),n=null);return s.forEach(function(n){a=c[n],i+=a?a(e,o):n.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),i}}var c={yyyy:r("FullYear",4),yy:r("FullYear",2,0,!0),y:r("FullYear",1),MMMM:o("Month"),MMM:o("Month",!0),MM:r("Month",2,1),M:r("Month",1,1),dd:r("Date",2),d:r("Date",1),HH:r("Hours",2),H:r("Hours",1),hh:r("Hours",2,-12),h:r("Hours",1,-12),mm:r("Minutes",2),m:r("Minutes",1),ss:r("Seconds",2),s:r("Seconds",1),sss:r("Milliseconds",3),EEEE:o("Day"),EEE:o("Day",!0),a:s,Z:i},u=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,p=/^\/Date\((\d+)\)\/$/,v={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};v.SHORTMONTH=v.MONTH,l.locate=v,e.exports=l},function(e,n){function t(e,n,t){var a=avalon.type(e);if("array"!==a&&"object"!==a)throw"orderBy只能处理对象或数组";var r=t&&0>t?-1:1;if("string"==typeof n){var o=n;n=function(e){return e&&e[o]}}e=s(e),e.forEach(function(e){e.order=n(e.value,e.key)}),e.sort(function(e,n){var t=e.order,a=n.order;return Number.isNaN(t)&&Number.isNaN(a)?0:t===a?0:t>a?r:-r});var l="array"===a,c=l?[]:{};return i(c,e,function(e){l?c.push(e.value):c[e.key]=e.value})}function a(e,n){var t=avalon.type(e);if("array"!==t&&"object"!==t)throw"filterBy只能处理对象或数组";var a=avalon.slice(arguments,2),r=avalon.type(n);if("function"===r)var o=n;else{if("string"!==r&&"number"!==r)return e;if(""===n)return e;var l=new RegExp(avalon.escapeRegExp(n),"i");o=function(e){return l.test(e)}}e=s(e).filter(function(e,n){return!!o.apply(e,[e.value,n].concat(a))});var c="array"===t,u=c?[]:{};return i(u,e,function(e){c?u.push(e.value):u[e.key]=e.value})}function r(e,n,t){if(avalon.isObject(e)&&!Array.isArray(e)){var a=[];return i(a,n,function(n){a.push(e.hasOwnProperty(n)?e[n]:t?t[n]:"")})}return e}function o(e,n,t){var a=avalon.type(e);if("array"!==a&&"object"!==a)throw"filterBy只能处理对象或数组";if(n=Math.abs(Number(n))===1/0?Number(n):parseInt(n,10),Number.isNaN(n))return e;"object"===a&&(e=s(e)),n=Math.min(e.length,n),t=!t||Number.isNaN(t)?0:~~t,0>t&&(t=Math.max(0,e.length+t));for(var r=[],o=t;n>o;o++)r.push(e[o]);var l="array"===a;if(l)return r;var c={};return i(c,r,function(e){c[e.key]=e.value})}function i(e,n,t){for(var a=0,r=n.length;r>a;a++)t(n[a]);return e}function s(e){var n=[],t=0;return avalon.each(e,function(e,a){n[t++]={value:a,key:e}}),n}Number.isNaN=Number.isNaN||function(e){return e!==e},e.exports={limitBy:o,orderBy:t,selectBy:r,filterBy:a}},function(e,n){var t={stop:function(e){return e.stopPropagation(),e},prevent:function(e){return e.preventDefault(),e}},a={esc:27,tab:9,enter:13,space:32,del:46,up:38,left:37,right:39,down:40};avalon.each(a,function(e,n){t[e]=function(e){return e.which!==n&&(e.$return=!0),e}}),e.exports=t},function(e,n,t){var a=t(16),r=t(17),o=t(18);avalon.vdomAdaptor=function(e,n){if(!e)return"toHTML"===n?"":avalon.avalonFragment.cloneNode(!1);switch(e.nodeType){case 3:return a.prototype[n].call(e);case 8:return r.prototype[n].call(e);default:return o.prototype[n].call(e)}},e.exports={VText:a,VComment:r,VElement:o}},function(e,n){function t(e){if("string"==typeof e)this.type="#text",this.nodeValue=e,this.skipContent=!a.test(e),this.nodeType=3;else for(var n in e)this[n]=e[n]}var a=avalon.config.rexpr;t.prototype={constructor:t,toDOM:function(){return document.createTextNode(this.nodeValue)},toHTML:function(){return this.nodeValue}},e.exports=t},function(e,n){function t(e){if("string"==typeof e)this.type="#comment",this.nodeValue=e,this.skipContent=!0,this.nodeType=8;else for(var n in e)this[n]=e[n]}t.prototype={constructor:t,toDOM:function(){return document.createComment(this.nodeValue)},toHTML:function(){return"<!--"+this.nodeValue+"-->"}},e.exports=t},function(e,n){function t(e,n,t){if("object"==typeof e)for(var a in e)this[a]=e[a];else this.nodeType=1,this.type=e,this.props=n,this.children=t,this.template=""}function a(e){return e!==!1&&Object(e)!==e}var r={"class":function(e,n){e.className=n},style:function(e,n){e.style.cssText=n},"for":function(e,n){e.htmlFor=n}};t.prototype={constructor:t,toDOM:function(){var e=document.createElement(this.type);for(var n in this.props){var t=this.props[n];a(t)&&(r[n]&&avalon.msie<8?r[n](e,t):e.setAttribute(n,t+""))}if(this.skipContent)switch(this.type){case"script":e.text=this.template;break;case"style":case"template":e.innerHTML=this.template;break;case"noscript":e.textContent=this.template;break;default:var o=avalon.parseHTML(this.template);e.appendChild(o)}else this.isVoidTag||(this.children.length?this.children.forEach(function(n){n&&e.appendChild(avalon.vdomAdaptor(n,"toDOM"))}):e.appendChild(avalon.parseHTML(this.template)));return e},toHTML:function(){var e=[];for(var n in this.props){var t=this.props[n];a(t)&&e.push(n+"="+avalon.quote(this.props[n]+""))}e=e.length?" "+e.join(" "):"";var r="<"+this.type+e;return this.isVoidTag?r+"/>":(r+=">",r+=this.children.length?this.children.map(function(e){return e?avalon.vdomAdaptor(e,"toHTML"):""}).join(""):this.template,r+"</"+this.type+">")}},e.exports=t},,,,,,,,function(e,n){function t(e){this.size=0,this.limit=e,this.head=this.tail=void 0,this._keymap={}}var a=t.prototype;a.put=function(e,n){var t={key:e,value:n};return this._keymap[e]=t,this.tail?(this.tail.newer=t,t.older=this.tail):this.head=t,this.tail=t,this.size===this.limit?this.shift():this.size++,n},a.shift=function(){var e=this.head;e&&(this.head=this.head.newer,this.head.older=e.newer=e.older=this._keymap[e.key]=void 0,delete this._keymap[e.key])},a.get=function(e){var n=this._keymap[e];if(void 0!==n)return n===this.tail?n.value:(n.newer&&(n===this.head&&(this.head=n.newer),n.newer.older=n.older),n.older&&(n.older.newer=n.newer),n.newer=void 0,n.older=this.tail,this.tail&&(this.tail.newer=n),this.tail=n,n.value)},e.exports=t},function(e,n){function t(e){var n="undefined"!=typeof e.querySelectorAll?e.querySelectorAll("script"):e.getElementsByTagName("script");if(n.length)for(var t,o=0;t=n[o++];)if(r[t.type]){var i=a.cloneNode(!1);Array.prototype.forEach.call(t.attributes,function(e){e&&e.specified&&(i[e.name]=e.value,i.setAttribute(e.name,e.value))}),i.text=t.text,t.parentNode.replaceChild(i,t)}}var a=avalon.document.createElement("script"),r=avalon.oneObject(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]);e.exports=t},,,,,function(e,n){e.exports={click:!0,dblclick:!0,keydown:!0,keypress:!0,keyup:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,wheel:!0,mousewheel:!0,input:!0,change:!0,beforeinput:!0,compositionstart:!0,compositionupdate:!0,compositionend:!0,select:!0,cut:!0,copy:!0,paste:!0,beforecut:!0,beforecopy:!0,beforepaste:!0,focusin:!0,focusout:!0,DOMFocusIn:!0,DOMFocusOut:!0,DOMActivate:!0,dragend:!0,datasetchanged:!0}},,function(e,n){function t(e){for(var n,i=0;n=e[i++];)if(1===n.nodeType){var s=r(n);s&&++o;var l=avalon.vmodels[s];if(l&&!l.$element){a(n),avalon(n).removeClass("ms-controller"),l.$element=n;var c=new Date;n.vtree=avalon.lexer(n.outerHTML.trim());var u=new Date;avalon.log("create primitive vtree",u-c),l.$render=avalon.render(n.vtree);var p=new Date;avalon.log("create template Function ",p-u),avalon.rerenderStart=p,avalon.batch(s,!0)}else s||t(n.childNodes)}}function a(e){for(var n,t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];3!==r.nodeType||i.test(r.nodeValue)?1===r.nodeType&&a(r):(n=e.removeChild(r),t--)}0===e.childNodes.length&&n&&e.appendChild(n)}function r(e){return e.getAttribute("ms-controller")}var o=0,i=/\S/;e.exports=avalon.scan=function(e){return e&&e.nodeType?(t([e]),0===o&&avalon.warn('[avalon.scan] your nodes must has "ms-controller" attribute'),void(o=0)):void avalon.warn("[avalon.scan] first argument must be element , documentFragment, or document")}},,function(e,n,t){var a=t(37),r=t(43);avalon.important=function(e,n){var t=e.props.wid,a=avalon.vmodels[n];if(a){if("string"==typeof avalon.caches[t]){var r=avalon.caches[t];r="__vmodel__ =  avalon.vmodels["+avalon.quote(n)+"]\n"+r;var o=Function("__vmodel__",r),i=o();return e=avalon.caches[t]=i[0],e.order="ms-important",e.skipAttrs=!1,e.props["ms-important"]=n,e.render=o,e}return e=avalon.caches[t],e.skipAttrs=e.skipContent=!0,e}return e},avalon.directive("important",{priority:1,parse:function(e,n,t){delete t.props["ms-important"];var r=t.props.wid||(t.props.wid=avalon.makeHashCode("w")),o=a([t],n)+"\n\nreturn vnodes"+n;return avalon.caches[r]=o,t.isVoidTag=!0,["vnode"+n+".props.wid = "+avalon.quote(r),"vnode"+n+" = avalon.important(vnode"+n+","+avalon.quote(e.expr)+")"].join("\n")+"\n"},diff:function(e,n,t,a){n.props[a]!==e.props[a]&&r(e,this.update,t,"important")},update:function(e,n){var t=n.props["ms-important"],a=avalon.vmodels[t];a.$render=n.render,a.$element=e}})},function(e,n,t){function a(e){return v.test(e)?e:i(e,"text")}function r(e,n){return"(function(){\n\n"+e+"\n\nreturn vnodes"+n+"\n})();\n"}function o(e,n,t){n=n||String(new Date-0).slice(0,5);for(var p=[],v=!1,m="vnodes"+n,g="vnode"+n,y="var "+m+" = []\n",b=0;b<e.length;b++){var _=e[b];if(3!==_.nodeType)if(8!==_.nodeType){y+="var "+g+" = {\n	nodeType:1,\n	type: "+u(_.type)+",\n	props:{},\n	children: [],\n	isVoidTag: "+!!_.isVoidTag+',\n	template: ""}\n';var w=_.props["ms-widget"];!w&&_.type.indexOf("-")>0&&!_.props.resolved&&(_.props["ms-widget"]="@"+_.type.replace(/-/g,"_"));var x="",C=_.props["ms-controller"];if(x=s(_.props,n,_),x&&(y+=x),!_.isVoidTag)if(_.children.length){var v=_.props["ms-if"];v&&(y+="if("+g+"&&"+g+".nodeType === 1 ){\n"),y+=g+".children = "+r(o(_.children,n),n)+"\n",v&&(y+="}\n")}else y+=g+".template = "+u(_.template)+"\n";y+=m+".push("+g+")\n",C&&(y+="}")}else{var $=_.nodeValue;if(f.test($)){0!==$.indexOf("ms-for:")&&avalon.error("ms-for指令前不能有空格");var T=_.signature;p.push(T),y+="\nvar "+T+' = {\n	nodeType:8,\n	type:"#comment",\n	vmodel:__vmodel__,\n	directive:"for",\n	skipContent:false,\n	cid:'+u(_.cid)+",\n	start:"+m+".length,\n	signature:"+u(T)+",\n	template:"+u(_.template)+",\n	nodeValue:"+u($)+"\n}\n",y+=m+".push("+T+")\n",y+=avalon.directives["for"].parse(_,n)}else if(h.test($)){var T=p[p.length-1];if(0!==$.indexOf("ms-for-end:")&&avalon.error("ms-for-end指令前不能有空格"),y+=m+'.push({\n	nodeType: 8,\n	type:"#comment",\n	skipContent: true,\n	nodeValue:'+u(T)+",\n	key:traceKey\n})\n",y+="\n})\n",p.length){var T=p[p.length-1];y+=T+".end ="+m+'.push({\n	nodeType: 8,\n	type:"#comment",\n	skipContent: true,\n	signature: '+u(T)+',\n	nodeValue: "ms-for-end:"\n})\n',p.pop()}}else y+=0===$.indexOf("ms-js:")?i($.replace("ms-js:",""),"js")+"\n":m+".push("+u(_)+")\n\n\n"}else{y+="var "+g+' = {type:"#text",nodeType:3,skipContent:true}\n';var E=c.test(_.nodeValue);if(E){var k=l(_.nodeValue);if(1===k.length){var A=i(k[0].expr);y+=g+".nodeValue = "+a(k[0].expr)+"\n"}else A=k.map(function(e){return e.type?a(e.expr):u(e.expr)}).join(" + "),y+=g+".nodeValue = String("+A+")\n";y+=g+".fixIESkip = true\n",y+=g+".skipContent = false\n"}else y+=d.test(_.nodeValue)?g+'.nodeValue = "\\n"\n':g+".nodeValue = "+u(_.nodeValue)+"\n";y+=m+".push("+g+")\n"}}return y}var i=t(38),s=t(41),l=t(42),c=avalon.config.rexpr,u=avalon.quote,p=(avalon.makeHashCode,t(40)),v=p.ident,d=p.sp,f=/^\s*ms\-for:/,h=/^\s*ms\-for\-end:/;avalon.htmlFactory=function(e,n){var t=avalon.lexer(e+"");avalon.__html=[];var a=o(t,n)+"\nreturn (avalon.__html = vnodes"+n+")";return{render:a}},e.exports=o},function(e,n,t){function a(e,n){function t(e){var n="??"+b++;return _[n]=e,n}function a(e){return _[e]}var m={};if(n=n||"other","object"==typeof e&&(n=e.type,m=e,e=m.expr),"string"!=typeof e)return"";var g=e,y=o.get(n+":"+g);if(y)return y;var b=1,_={},w=e.replace(i,t).replace(s,t).replace(v,t).replace(f,"$1").split(d),x=w.shift().replace(l,a).trim();if("on"===n&&p.test(x)&&(x+="($event)"),x=x.replace(u,"$1__vmodel__."),"js"===n)return o.put(n+":"+g,x);var C=w.map(function(e){e=e.replace(l,a).replace(u,"$1__vmodel__.");var n=!1;return e=e.replace(c,function(e,t){return n=!0,/\S/.test(t)?"(__value__,"+t+");":"(__value__);"}),n||(e+="(__value__);"),e=e.replace(/(\w+)/,'avalon.__format__("$1")'),"__value__ = "+e}),$=[];if("on"===n)C=C.map(function(e){return e.replace(/__value__/g,"$event")}),C.length&&C.push("if($event.$return){\n	return;\n}"),avalon.modern||(x=x.replace(/__vmodel__\.([^(]+)\(([^)]*)\)/,function(e,n,t){return"__vmodel__."+n+".call(__vmodel__"+(/\S/.test(t)?","+t:"")+")"})),$=["function self($event){","try{","	var __vmodel__ = this;","	"+x,"}catch(e){",r(e,n),"}","}"],C.unshift(2,0);else{if("duplex"===n){var T=["function (__vmodel__){","try{","return "+x+"\n","}catch(e){",r(e,n),"}","}"];o.put("duplex:"+g,h(T));var E=["function (__vmodel__,__value__){","try{","	"+x+" = __value__","}catch(e){",r(e,n),"}","}"];if(o.put("duplex:set:"+g,h(E)),w.length){var k=["function (__vmodel__, __value__){","try{",C.join("\n"),"return __value__\n","}catch(e){",r(e,n),"}","}"];o.put("duplex:format:"+g,h(k))}return}$=["(function(){","try{","var __value__ = "+x,"text"===n?'return __value__ == null ? "" :__value__':"return __value__","}catch(e){",r(e,n),'	return ""',"}","})()"],C.unshift(3,0)}return $.splice.apply($,C),y=$.join("\n"),o.put(n+":"+g,y),y}function r(e,n){return"	avalon.warn(e, "+avalon.quote("parse "+n+" binding【 "+e+" 】fail")+")"}var o=t(39),i=/(^|[^\/])\/(?!\/)(\[.+?]|\\.|[^\/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/g,s=t(40).string,l=/\?\?\d+/g,c=/\(([^)]*)\)/,u=/(^|[^\w\u00c0-\uFFFF_])(@|#)(?=\w)/g,p=/^(?:\@|\#)[$\w]+$/,v=/\|\|/g,d=/\|(?=\w)/,f=/\s*(\.|\|)\s*/g,h=function(e){return"(function(){ return "+e.join("\n")+"})();\n"};e.exports=avalon.parseExpr=a},function(e,n,t){var a=t(26);e.exports=new a(512)},function(e,n){e.exports={ident:/^[$a-zA-Z_][$a-zA-Z0-9_]*$/,sp:/^\s+$/,leftSp:/^\s+/,rightSp:/s+$/,binding:/^ms-(\w+)-?(.*)/,string:/(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/g}},function(e,n,t){function a(e,n,t){var a=[],p="ms-skip"in e,v="",d={};for(var f in e){var h,m=e[f];if(!p&&(h=f.match(l))){var g=h[1],y=h[2]||"",b=f;if(c[g]){var _=parseFloat(y)||0;y=g,g="on"}if(b="ms-"+g+(y?"-"+y:""),f!==b&&(delete e[f],e[b]=m),s[g]){var w={type:g,param:y,name:b,expr:m,priority:s[g].priority||100*g.charCodeAt(0)};"on"===g&&(_=_||0,w.name+="-"+_,w.priority+=100*y.charCodeAt(0)+_),d[w.name]||(d[w.name]=1,a.push(w))}}else v+=o.test(f)||u[f]?"vnode"+n+".props["+i(f)+"] = "+i(m)+"\n":"vnode"+n+".props."+f+" = "+i(m)+"\n"}if(a.length){a.sort(r),v+="vnode"+n+'.order = "'+a.map(function(e){return e.name}).join(";;")+'"\n';var x=a[0],C=x&&"widget"===x.type;C?(a.shift(),a.forEach(function(e){v+="vnode"+n+".props["+i(e.name)+"] = "+i(e.expr)+"\n"}),v+=s.widget.parse(x,n,t)):a.forEach(function(e){v+=s[e.type].parse(e,n,t)})}else v+="	vnode"+n+".skipAttrs = true\n";return v}function r(e,n){return e.priority-n.priority}var o=/[W-]/,i=avalon.quote,s=avalon.directives,l=t(40).binding,c=avalon.oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit"),u=avalon.oneObject("break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile");e.exports=a},function(e,n,t){function a(e){for(var n,t,a=[],i=0;;){if(t=e.indexOf(avalon.config.openTag,i),-1===t)break;if(n=e.slice(i,t),0===i&&(n=n.replace(o.leftSp,"")),n&&a.push({expr:n}),i=t+avalon.config.openTag.length,t=e.indexOf(avalon.config.closeTag,i),-1===t)break;n=e.slice(i,t),n&&a.push({expr:n.replace(r,""),type:"{{}}"}),i=t+avalon.config.closeTag.length}n=e.slice(i);var s=n.replace(o.rightSp,"");return s&&a.push({expr:s}),a}var r=/\r?\n/g,o=t(40);e.exports=a},function(e,n){e.exports=function(e,n,t,a,r){r=r||"change";var o=e[r]||(e[r]=[]);avalon.Array.ensure(o,n)&&(t.count+=1,avalon.config.showDiff&&avalon.log(a+" change"))}},function(e,n,t){var a=t(43);avalon.skipController=function(e,n,t){if(e){var a=n.$render?n.$render.$id:n.$id;return e.length>a.length?0!==e.indexOf(a+";;"):0!==a.indexOf(e)}return!1},avalon.directive("controller",{priority:2,parse:function(e,n,t){var a=avalon.quote(e.expr);delete t.props["ms-controller"];var r="vm"+n,o=["if(!vnodes"+n+".vm){ vnodes"+n+".vm = __vmodel__}","__vmodel__ = vnodes"+n+".vm || __vmodel__","vnode"+n+'.props["ms-controller"] = '+a+";","var "+r+" = avalon.vmodels["+a+"]","if(!"+r+"){return }","vnode"+n+".bottom = "+r,"if(__vmodel__){","vnode"+n+".top = __vmodel__",'var __id__ = __vmodel__.$id+ "_" + '+a,"__vmodel__ = avalon.caches[__id__] || (avalon.caches[__id__] = avalon.mediatorFactory(__vmodel__,"+r+"))","vnode"+n+".mediator = __vmodel__","}else{","__vmodel__ = "+r,"}","if(!avalon.skipController(__fast__, vnode"+n+".bottom)){ "];return o.join("\n")+"\n"},diff:function(e,n,t,r){n.props[r]!==e.props[r]&&a(e,this.update,t,"controller")},update:function(e,n){function t(){return i(0,t.$id)}var a=n.top,r=n.bottom,o=n.mediator;if(a&&r&&(r.$element=a&&a.$element||e,n.top=n.mediator=n.bottom=0,!r.$render)){var i=a.$render;i.$id||(i.$id=a.$id),r.$render=t,t.dom=r.$element,t.$id=i.$id+";;"+r.$id,o&&(o.$render=t)}}})},,,function(e,n){var t={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"},a=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected,","isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(",");a.replace(/\w+/g,function(e){t[e.toLowerCase()]=e});var r=["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,contentEditable,frameBorder,longDesc,maxLength,marginWidth,marginHeight,rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(",");r.replace(/\w+/g,function(e){t[e.toLowerCase()]=e}),e.exports=t},function(e,n,t){var a=t(43);avalon.directive("css",{parse:function(e,n){return"vnode"+n+'.props["ms-css"] = '+avalon.parseExpr(e)+";\n"},diff:function(e,n,t,r){var o=e.props[r],i=n.props[r];if(Object(o)===o){if(Array.isArray(o)&&(o=e.props[r]=avalon.mix.apply({},o)),"object"!=typeof i)e.changeStyle=o;else{var s={},l=!1;for(var c in o)o[c]!==i[c]&&(l=!0,s[c]=o[c]);l&&(e.changeStyle=s)}e.changeStyle&&a(e,this.update,t,"css")}else e.props[r]=i},update:function(e,n){var t=n.changeStyle,a=avalon(e);for(var r in t)a.css(r,t[r]);delete n.changeStyle}})},function(e,n,t){function a(e,n){var t=e.ownerDocument,r=e.nodeName,i="_"+r;if(!a[i]){var s=t.body.appendChild(t.createElement(r));n=avalon.modern?getComputedStyle(s,null).display:s.currentStyle.display,t.body.removeChild(s),n===o&&(n="block"),a[i]=n}return a[i]}var r=t(43),o="none";avalon.parseDisplay=a,avalon.directive("visible",{parse:function(e,n){return"vnode"+n+'.props["ms-visible"] = '+avalon.parseExpr(e)+";\n"},diff:function(e,n,t,a){var o=e.props[a]=!!e.props[a];e.displayValue=n.displayValue,o!==n.props[a]&&r(e,this.update,t,"visible")},update:function(e,n){function t(){void 0!==r&&(e.style.display=r)}var r,i=n.props["ms-visible"],s=e.style.display;i?(s===o&&(r=n.displayValue,r||(e.style.display="")),""===e.style.display&&avalon(e).css("display")===o&&avalon.contains(e.ownerDocument,e)&&(r=a(e))):s!==o&&(r=o,n.displayValue=s),avalon.applyEffect(e,n,{hook:i?"onEnterDone":"onLeaveDone",cb:t})}})},,function(e,n,t){var a=t(40).ident,r=t(43);avalon.directive("text",{parse:function(e,n,t){t.children=[{type:"#text",nodeType:3,nodeValue:""}];var r=a.test(e.expr)?e.expr:avalon.parseExpr(e);return"vnode"+n+'.props["ms-text"] ='+r+"\n"},diff:function(e,n,t,a){var o=e.props[a],i=n.props[a];e.children=n.children,e.skipContent=!0;var s=e.dom=n.dom;return o!==i&&(e.children[0]||(e.children[0]={type:"#text",nodeType:3}),e.children[0].nodeValue=o,s?this.update(s,e):r(e,this.update,t,"text")),n.dom=null,!1},update:function(e,n){var t=n.props["ms-text"];"textContent"in e?e.textContent=t+"":e.innerText=t+"",n.dom=e}})},function(e,n,t){var a=t(43);avalon.directive("html",{parse:function(e,n,t){var a=!!t.isVoidTag;t.isVoidTag=!1;var r=["var htmlId =  "+avalon.parseExpr(e),"vnode"+n+'.props["ms-html"]  = htmlId;',"vnode"+n+"._isVoidTag  = "+a,"var obj  = avalon.htmlFactory(htmlId,"+n+");",'try{eval(" new function(){"+ obj.render +"}")}catch(e){};',"vnode"+n+".children = avalon.__html;"];return r.join("\n")+"\n"},diff:function(e,n,t,r){var o=e.props[r],i=n.props[r];e.isVoidTag=e._isVoidTag,o!==i&&a(e,this.update,t,"html")},update:function(e,n){if(1===e.nodeType){avalon.clearHTML(e);var t=document.createDocumentFragment();n.children.forEach(function(e){e&&t.appendChild(avalon.vdomAdaptor(e,"toDOM"))}),e.appendChild(t)}}})},function(e,n,t){function a(e){return Object.keys(e).filter(function(n){return e[n]}).join(" ")}function r(e){var n=e.target;avalon(n).addClass(n.getAttribute(u[e.type])||"")}function o(e){var n=e.target,t=u[e.type];avalon(n).removeClass(n.getAttribute(t)||""),"change-active"!==t&&avalon(n).removeClass(n.getAttribute("change-active")||"")}function i(e,n){var t=e.getAttribute("old-change-class")||"",a=n.props["ms-class"];avalon(e).removeClass(t).addClass(a),e.setAttribute("old-change-class",a)}var s=t(6).getLongID,l=t(43),c=avalon.directives;avalon.directive("class",{parse:function(e,n){return"vnode"+n+'.props["'+e.name+'"] = '+avalon.parseExpr(e)+";\n"},diff:function(e,n,t,i){var s=i.slice(3),c=e.props[i],u=n.props[i];if(n.classEvent)e.classEvent=n.classEvent;else{var p={};"hover"===s?(p.mouseenter=r,p.mouseleave=o):"active"===s&&(e.props.tabindex=e.props.tabindex||-1,p.tabIndex=e.props.tabindex,p.mousedown=r,p.mouseup=o,p.mouseleave=o),e.classEvent=p}n.classEvent=null;var v=avalon.noop;Array.isArray(c)?v=c.map(function(e){return e&&"object"==typeof e?a(e):e?e:""}).join(" "):avalon.isObject(c)?v=a(c):c&&(v=String(c)),v!==avalon.noop&&(v=e.props[i]=v.trim().replace(/\s+/," "),u!==v&&(e["change-"+s]=v,l(e,this.update,t,s)))},update:function(e,n){if(e&&1===e.nodeType){var t=n.classEvent;if(t){for(var a in t)"tabIndex"===a?e[a]=t[a]:avalon.bind(e,a,t[a]);n.classEvent={}}var r=["class","hover","active"];r.forEach(function(t){var a="change-"+t,r=n[a];if(void 0!==r)if("class"===t)e&&i(e,n);else{var o=e.getAttribute("change-"+t);o&&avalon(e).removeClass(o),e.setAttribute(a,r)}})}}}),c.active=c.hover=c["class"];var u={mouseenter:"change-hover",mouseleave:"change-hover",mousedown:"change-active",mouseup:"change-active"};s(r),s(o)},function(e,n,t){var a=t(6).getLongID,r=t(26),o=new r(128),i=avalon.quote,s=t(43),l=/^ms-on-([a-z]+)/,c=/\|.+/g,u=/([@$]?\w+)/g,p=t(40).string;avalon.directive("on",{priority:3e3,parse:function(e,n){var t=e.expr.replace(p," ").replace(c,"").match(u),r=t.every(function(e){return"@"===e.charAt(0)||"#"===e.charAt(0)||"$event"===e}),s="vnode"+n+".onVm = __vmodel__\n",l=i(e.name);if(r){var v=e.expr,d=o.get(v);if(!d){var d=Function("return "+avalon.parseExpr(e,"on"))(),f=a(d);o.put(v,d)}return avalon.eventListeners[f]=d,s+"vnode"+n+".props["+l+"] = avalon.eventListeners."+f+"\n"}return s+"vnode"+n+".props["+l+"] = "+avalon.parseExpr(e,"on")+"\n"},diff:function(e,n,t,r){var o=e.props[r],i=(n.props||{})[r];if(o+""!=i+""){var c=r.match(l),u=c[1],p=u+":"+a(o);e.addEvents=e.addEvents||{},e.addEvents[p]=o,"function"==typeof i&&(e.removeEvents=e.removeEvents||{},e.removeEvents[u+":"+i.uuid]=i),s(e,this.update,t,"on")}},update:function(e,n){if(e&&!(e.nodeType>1)){var t,a,r;e._ms_context_=n.onVm,delete n.onVm;for(t in n.removeEvents)a=t.split(":").shift(),r=n.removeEvents[t],avalon.unbind(e,a,r);delete n.removeEvents;for(t in n.addEvents)a=t.split(":").shift(),r=n.addEvents[t],avalon.bind(e,a,r);delete n.addEvents}}})},,function(e,n){function t(e){r[this.tagName].call(this,e),!this.caret&&this._ms_field_&&this._ms_field_.update.call(this)}var a=!1;
try{var r={},o=HTMLInputElement.prototype,i=HTMLTextAreaElement.prototype,s=HTMLInputElement.prototype;Object.getOwnPropertyNames(s),r.INPUT=Object.getOwnPropertyDescriptor(o,"value").set,Object.defineProperty(o,"value",{set:t}),r.TEXTAREA=Object.getOwnPropertyDescriptor(i,"value").set,Object.defineProperty(i,"value",{set:t}),a=!0}catch(l){}e.exports=a},function(e,n){function t(e,n){var t=e.expr,c=n.props.type,u=e.param,p="checked"===u,v=n.field={parsers:[],formatters:[],modelValue:NaN,viewValue:NaN,validators:"",parse:a,format:r};p&&(i.test(c)?(v.isChecked=!0,v.type="radio"):u=null);var d=n.props["data-duplex-changed"];if(d){var f=d+":cb";if(avalon.caches[f])v.callback=avalon.caches[f];else{var h=Function("return "+avalon.parseExpr(d,"on"));avalon.caches[f]=v.callback=h()}}var m=avalon.parsers[u];m&&v.parsers.push(m),o.test(t)&&(l.test(c)?avalon.warn(c+"不支持change过滤器"):v.isChanged=!0);var g=t.match(s);g&&(v.isChanged||(v.debounceTime=parseInt(g[1],10)||300)),e.expr=v.expr=t.trim(),/input|textarea|select/.test(n.type)?v.type||(v.type="select"===n.type?"select":"checkbox"===c?"checkbox":"radio"===c?"radio":"input"):"contenteditable"in n.props&&(v.type="contenteditable"),avalon.parseExpr(e,"duplex")}function a(e){for(var n,t=0;n=this.parsers[t++];)e=n.call(this,e);return e}function r(e){for(var n=this.formatters,t=n.length;t--;)e=n[t](e);return e}var o=/\|\s*change\b/,i=/^(?:checkbox|radio)$/,s=/\|\s*debounce(?:\(([^)]+)\))?/,l=/^(file|button|reset|submit|checkbox|radio|range)$/;e.exports=t},,function(e,n){function t(e){e.validator&&avalon.directives.validate.validate(e,!1),e.callback&&e.callback.call(e.vmodel,{type:"changed",target:e.element})}var a={input:function(e){var n=this;e=e||"value";var a=n.element[e],r=a;a=n.format(a);var o=n.parse(a);a=o+"",o!==n.modelValue&&(n.set(n.vmodel,o),t(n)),r!==a&&(n.viewValue=a,n.element[e]=a)},radio:function(){var e=this;if(e.isChecked){var n=e.modelValue=!e.modelValue;e.set(e.vmodel,n),t(e)}else a.input.call(e)},checkbox:function(){var e=this,n=e.modelValue;Array.isArray(n)||(avalon.warn("ms-duplex应用于checkbox上要对应一个数组"),n=[n]);var a=e.element.checked?"ensure":"remove";if(n[a]){var r=e.parse(e.element.value);n[a](r),t(e)}},select:function(){var e=this,n=avalon(e.element).val();n+""!=this.modelValue+""&&(n=Array.isArray(n)?n.map(function(n){return e.parse(n)}):e.parse(n),e.modelValue=n,e.set(e.vmodel,n),t(e))},contenteditable:function(){a.input.call(this,"innerHTML")}};e.exports=a},,function(e,n){e.exports=function(e,n){var t=n.field,a=n.props["ms-rules"];if(a&&!t.validator)for(;e&&1===e.nodeType;){var r=e._ms_validator_;if(r){t.rules=a,t.validator=r,avalon.Array.ensure(r.fields,t)&&r.addField(t);break}e=e.parentNode}}},function(e,n,t){function a(){var e=this.data||{};return this.message.replace(i,function(n,t){return null==e[t]?"":e[t]})}var r=t(43),o=avalon.directive("validate",{parse:function(e,n){return"vnode"+n+'.props["ms-validate"] = '+avalon.parseExpr(e)+";\n"},diff:function(e,n,t,a){var i=e.props[a],s=n.props[a];if(s&&s.onError&&s.addField)e.props[a]=s;else if(Object(i)===i){i.$id&&(i=i.$model),e.props[a]=i;for(var a in o.defaults)i[a]||(i[a]=o.defaults[a]);i.fields=i.fields||[],r(e,this.update,t,"validate")}},update:function(e,n){var t=n.props["ms-validate"];e._ms_validator_=t,t.element=e,e.setAttribute("novalidate","novalidate"),t.validateAllInSubmit&&avalon.bind(e,"submit",function(e){e.preventDefault(),o.validateAll.call(t,t.onValidateAll)}),"function"==typeof t.onInit&&t.onInit.call(e)},validateAll:function(e){var n=this,t="function"==typeof e?e:n.onValidateAll,a=n.fields.filter(function(e){var t=e.element;return t&&!t.disabled&&n.element.contains(t)}).map(function(e){return o.validate(e,!0)}),r=[];Promise.all(a).then(function(e){for(var a,o=0;a=e[o++];)r=r.concat(a);if(n.deduplicateInValidateAll){var i={};r=r.filter(function(e){var n=e.element,t=n.uniqueID||(n.uniqueID=setTimeout("1"));return i[t]?!1:(i[t]=!0,!0)})}t.call(n.element,r)})},addField:function(e){var n=this,t=e.element;!n.validateInKeyup||e.isChanged||e.debounceTime||avalon.bind(t,"keyup",function(n){o.validate(e,0,n)}),n.validateInBlur&&avalon.bind(t,"blur",function(n){o.validate(e,0,n)}),n.resetInFocus&&avalon.bind(t,"focus",function(a){n.onReset.call(t,a,e)})},validate:function(e,n,t){var r=[],o=e.get(e.vmodel),i=e.element,s=e.validator;if(!i.disabled){for(var l in e.rules){var c=e.rules[l];if(c!==!1){var u,p,v=avalon.validators[l];r.push(new Promise(function(e,n){u=e,p=n}));var d=function(n){if(e.norequired&&""===o&&(n=!0),n)u(!0);else{var t={element:i,data:e.data,message:i.getAttribute("data-"+l+"-message")||i.getAttribute("data-message")||v.message,validateRule:l,getMessage:a};u(t)}};e.data={},e.data[l]=c,v.get(o,e,d)}}var f=[],h=Promise.all(r).then(function(e){for(var a,r=0;a=e[r++];)"object"==typeof a&&f.push(a);return n||(f.length?s.onError.call(i,f,t):s.onSuccess.call(i,f,t),s.onComplete.call(i,f,t)),f});return h}}}),i=/\\?{{([^{}]+)\}}/gm;o.defaults={addField:o.addField,onError:avalon.noop,onSuccess:avalon.noop,onComplete:avalon.noop,onReset:avalon.noop,validateInBlur:!0,validateInKeyup:!0,validateAllInSubmit:!0,resetInFocus:!0,deduplicateInValidateAll:!1}},function(e,n){function t(e){return"regexp"===avalon.type(e)}function a(e){if("string"==typeof e&&e){var n=e.split("-");if(3===n.length&&4===n[0].length){var t=~~n[0],a=~~n[1]-1,r=~~n[2],o=new Date(t,a,r);return o.getFullYear()===t&&o.getMonth()===a&&o.getDate()===r}}return!1}avalon.directive("rules",{parse:function(e,n){var t=e.expr;return/{.+}/.test(t)?"vnode"+n+'.props["ms-rules"] = '+avalon.parseExpr(e)+";\n":void 0},diff:avalon.noop});var r=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/i,o=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/;avalon.shadowCopy(avalon.validators,{pattern:{message:"必须匹配{{pattern}}这样的格式",get:function(e,n,a){var r=n.element,o=n.data;if(!t(o.pattern)){var i=r.getAttribute("pattern");o.pattern=new RegExp("^(?:"+i+")$")}return a(o.pattern.test(e)),e}},digits:{message:"必须整数",get:function(e,n,t){return t(/^\-?\d+$/.test(e)),e}},number:{message:"必须数字",get:function(e,n,t){return t(isFinite(e)),e}},required:{message:"必须填写",get:function(e,n,t){return t(""!==e),e}},equalto:{message:"密码输入不一致",get:function(e,n,t){var a=String(n.data.equalto),r=avalon(document.getElementById(a)).val()||"";return t(e===r),e}},date:{message:"日期格式不正确",get:function(e,n,t){var r=n.data;return t("regexp"===avalon.type(r.date)?r.date.test(e):a(e)),e}},url:{message:"URL格式不正确",get:function(e,n,t){return t(o.test(e)),e}},email:{message:"email格式不正确",get:function(e,n,t){return t(r.test(e)),e}},minlength:{message:"最少输入{{minlength}}个字",get:function(e,n,t){var a=parseInt(n.data.minlength,10);return t(e.length>=a),e}},maxlength:{message:"最多输入{{maxlength}}个字",get:function(e,n,t){var a=parseInt(n.data.maxlength,10);return t(e.length<=a),e}},min:{message:"输入值不能小于{{min}}",get:function(e,n,t){var a=parseInt(n.data.min,10);return t(parseFloat(e)>=a),e}},max:{message:"输入值不能大于{{max}}",get:function(e,n,t){var a=parseInt(n.data.max,10);return t(parseFloat(e)<=a),e}},chs:{message:"必须是中文字符",get:function(e,n,t){return t(/^[\u4e00-\u9fa5]+$/.test(e)),e}}})},function(e,n,t){var a=t(65),r=t(43);avalon.directive("if",{priority:6,parse:function(e,n){var t="vnode"+n,a=["var ifVar = "+avalon.parseExpr(e,"if"),t+'.props["ms-if"] = ifVar;',"if(!ifVar){",t+".nodeType = 8;",t+'.directive="if";',t+'.nodeValue="ms-if"',"}"];return a.join("\n")+"\n"},diff:function(e,n,t){e.dom=n.dom,e.nodeType!==n.nodeType&&(e.steps=t,r(e,this.update,t,"if"))},update:function(e,n,t){var r=e.nodeType,o=n.nodeType;if(r!==o){if(1===o){var i=n.dom;if(!i){i=avalon.vdomAdaptor(n,"toDOM"),n.dom=i;var s=n.props;for(var l in s)if(l.match(/ms\-on/g)){var c=s[l];"function"==typeof c&&(i._ms_context_=n.onVm,avalon.bind(i,l.split("-")[2],c))}n.onVm&&delete n.onVm}return t.replaceChild(i,e),n.steps.count&&a([i],[n],t,n.steps),avalon.applyEffect(e,n,{hook:"onEnterDone"}),n.steps=!1}8===o&&avalon.applyEffect(e,n,{hook:"onLeaveDone",cb:function(){var a=e._ms_if_||(e._ms_if_=document.createComment(n.nodeValue));t.replaceChild(a,e)}})}}})},function(e,n){function t(e,n,i,s){var l=e[0];if((l||i)&&s.count){i=i||l.parentNode;for(var c=0,u=n.length;u>c;c++){var p=n[c],v=l;if(!(avalon.msie<9&&!p.fixIESkip&&3===p.nodeType&&o.test(p.nodeValue))){if(v&&(l=v.nextSibling),"for"===p.directive&&p.hasChange){if(!v)return;if(1===v.nodeType){var d=document.createComment(p.nodeValue);i.insertBefore(d,v),p.endRepeat=document.createComment("ms-for-end:"),i.insertBefore(p.endRepeat,v.nextSibling),v=d}else p.endRepeat||(p.endRepeat=a(v));8!==v.nodeType&&(v=v.nextSibling),l=p.endRepeat.nextSibling}if(!1!==r(v,p,i,s,"change")){!p.skipContent&&p.children&&v&&1===v.nodeType&&t(avalon.slice(v.childNodes),p.children,v,s);var f=p.props&&p.props["ms-controller"];if(f&&v){var h=avalon.vmodels[f];h.$render&&(h.$render.dom=v)}if(r(v,p,i,s,"afterChange"),!s.count)break}else p.repeatCount&&(c+=p.repeatCount+1),r(v,p,i,s,"afterChange")}}}}function a(e){for(var e,n=0,t=[];e&&(8===e.nodeType&&(0===e.nodeValue.indexOf("ms-for:")?++n:0===e.nodeValue.indexOf("ms-for-end:")&&--n),t.push(e),e=e.nextSibling,0!==n););return t.pop()}function r(e,n,t,a,r){var o=n[r];if(o){for(var i;i=o.shift();)if(a.count-=1,!1===i(e,n,t))return!1;delete n[r]}}var o=/^\s*$/;e.exports=t},function(e,n,t){function a(e){var n=typeof e;return e&&"object"===n?e.$hashcode:n+e}function r(e){if(Array.isArray(e))return e.length+"|"+e.map(a).join(";;");var n=0,t=[];for(var r in e)e.hasOwnProperty(r)&&(n++,t.push(r));return n+"|"+t.join(";;")}function o(e,n){for(var t,a=[],r={children:[]},o=0;t=e[o];o++)8===t.nodeType&&t.nodeValue===n?(r.children.push(t),r.key=t.key,r.index=a.length,a.push(r),r={children:[]}):r.children.push(t);return a}function i(e,n){var t=n.match(_);if(t){var a=t[1];for(var r in e){var o=r.match(w);if(o&&o[1]===a)return s(e,r)}}}function s(e,n){var t=e[n],a=n;if(t){var r=e["***"+n];if(r){var o=r.pop();return delete e[o.id],0==r.length&&delete e["***"+n],o.c}for(var i=[{id:n,c:t}];;){if(n+="_",!e[n])break;i.push({id:n,c:e[n]})}var o=i.pop();return delete e[o.id],i.length&&(e["***"+a]=i),o.c}return t}function l(e,n){var t=n.key;if(e[t]){for(;;)if(t+="_",!e[t]){e[t]=n;break}}else e[t]=n}var c=t(65),u=/ms-for\:\s*/,p=/^\s*\(\s*/,v=/\s*\)\s*$/,d=/\s*,\s*/,f=/\s+as\s+([$\w]+)/,h=t(40).ident,m=t(43),g=t(26),y=new g(600),b=/^(null|undefined|NaN|window|this|\$index|\$id)$/;avalon._each=function(e,n){if(Array.isArray(e))for(var t=0;t<e.length;t++){var r=e[t],o=a(r);n(t,r,o)}else for(var t in e)e.hasOwnProperty(t)&&n(t,e[t],t)},avalon._checkLoopChange=function(e,n){var t=r(n),a=y.get(e);return"string"!=typeof a||t!==a?(y.put(e,t),!0):!1},avalon.directive("for",{priority:3,parse:function(e,n){var t,a=e.nodeValue;a=a.replace(f,function(e,n){return!h.test(n)||b.test(n)?avalon.error("alias "+n+" is invalid --- must be a valid JS identifier which is not a reserved name."):t=n,""});var r=a.replace(u,"").split(" in "),o="var loop"+n+" = "+avalon.parseExpr(r[1])+"\n",i=e.signature+'.hasChange = avalon._checkLoopChange("'+e.signature+'", loop'+n+")\n",s=t?"var "+t+" = loop"+n+"\n":"",l=r[0].replace(p,"").replace(v,"").split(d);return 1===l.length&&l.unshift("$key"),o+i+s+"avalon._each(loop"+n+", function("+l+", traceKey){\n"},diff:function(e,n,t,a){var r,c,u,p=e[a],v=n[a]||{},d=!("directive"in v),f=!1;d&&(v.components=[],v.repeatCount=0);var h=v.components.length,g=e.slice(p.start,p.end);p.endRepeat=v.endRepeat,p.components=o(g.slice(1,-1),p.signature);var y=Math.max(g.length-2,0)-v.repeatCount;if(y>0){for(var b=[a+1,0],r=0,y=y-1;y>r;r++)b.push(null);n.splice.apply(n,b)}else 0>y&&n.splice.apply(n,[a,Math.abs(y)]);if(p.action=d?"init":"update",d){var _=t.count,w=p.cache={};for(r=0;c=p.components[r++];)avalon.diff(c.children,[],t),l(w,c);p.removedComponents={},f=0===p.components.length||t.count!==_}else{var w=v.cache,x=p.cache={};for(r=0;c=p.components[r++];){var u=s(w,c.key);u?(f||(f=c.index!==u.index),h--,c.nodes=u.nodes,avalon.diff(c.children,u.children,t)):h&&(u=i(w,c.key),u&&(h--,f=!0,c.nodes=u.nodes,avalon.diff(c.children,u.children,t))),c.nodes||(f=!0,avalon.diff(c.children,[],t)),l(x,c)}for(r in w){p.removedComponents=w,f=!0;break}}return v.components.length=0,delete v.cache,f&&(p.steps=t,m(p,this.update,t,"for")),a+g.length-1},update:function(e,n,t){var a=n.action,r=n.endRepeat,o=document.createDocumentFragment();if("init"===a){for(var i=!1,s=e.nextSibling;s&&s!==r;){if(8===s.nodeType&&(i=s.nodeValue===n.signature)){n.hasRender=!0;break}s=s.nextSibling}if(!i)for(s=e.nextSibling;s&&s!==r;)t.removeChild(s),s=e.nextSibling}var l=avalon.parseHTML(n.template),u=n.signature;for(var p in n.removedComponents){var v=n.removedComponents[p];v.nodes&&(v.nodes.forEach(function(e,n){e.parentNode&&avalon.applyEffect(e,v.children[n],{hook:"onLeaveDone",cb:function(){e.parentNode.removeChild(e)},staggerKey:u+"leave"})}),v.nodes.length=v.children.length=0)}delete n.removedComponents;for(var d=e,p=0;p<n.components.length;p++){var f=n.components[p],h=f.nodes;if(h){if(d.nextSibling!==h[0]){for(var m,g=o.cloneNode(!1),y=0;m=h[y++];)g.appendChild(m);t.insertBefore(g,d.nextSibling),x(f.nodes,f.children,{hook:"onMoveDone",staggerKey:u+"move"})}}else if(n.hasRender){var h=f.nodes=[];for(d=d.nextSibling;d&&d!==n.endRepeat&&(h.push(d),d.nodeValue!==n.signature);)d=d.nextSibling}else{var b=l.cloneNode(!0);b.appendChild(document.createComment(n.signature)),h=f.nodes=avalon.slice(b.childNodes),t.insertBefore(b,d.nextSibling),x(f.nodes,f.children,{hook:"onEnterDone",staggerKey:u+"enter"})}if(d=h[h.length-1],!d)break}var _=[],w=[];n.components.forEach(function(e){_.push.apply(_,e.nodes),w.push.apply(w,e.children)}),n.repeatCount=w.length,c(_,w,t,n.steps);var C=avalon.caches[n.cid];return C&&C.call(n.vmodel,{type:"rendered",target:e,endRepeat:r,signature:n.signature}),!1}});var _=/^(string|number|boolean)/,w=/^_*(string|number|boolean)/,x=function(e,n,t){n.forEach(function(a,r){avalon.applyEffect(e[r],n[r],t)})}},function(e,n,t){var a=t(68),r=t(65),o=t(43),i=avalon.directive("widget",{priority:4,parse:function(e,n,t){var a=!!t.isVoidTag;t.isVoidTag=!0;var r=t.props.wid||(t.props.wid=avalon.makeHashCode("w"));avalon.resolvedComponents[r]={props:avalon.shadowCopy({},t.props),template:t.template};var o=["vnode"+n+"._isVoidTag = "+a,"vnode"+n+'.props.wid = "'+r+'"',"vnode"+n+".template = "+avalon.quote(t.template),"vnode"+n+'.props["ms-widget"] = '+avalon.parseExpr(e,"widget"),"vnode"+n+" = avalon.component(vnode"+n+", __vmodel__)","if(typeof vnode"+n+'.render === "string"){',"avalon.__widget = [];","var __backup__ = __vmodel__;","__vmodel__ = vnode"+n+".vmodel;",'try{eval(" new function(){"+ vnode'+n+'.render +"}");',"}catch(e){avalon.warn(e)","}","vnode"+n+" = avalon.renderComponent(avalon.__widget[0])","}","__vmodel__ = __backup__;"];return o.join("\n")+"\n"},define:function(){return avalon.mediatorFactory.apply(this,arguments)},diff:function(e,n,t){function a(n,t){e.vmodel.$fire("onReady",{type:"ready",target:n,wid:i,vmodel:t.vmodel}),s.renderCount=2}var r=avalon.resolvedComponents,i=e.props.wid,s=r[i];if(s&&s.renderCount)if(s.renderCount&&s.renderCount<2)e.steps=t,o(e,this.replaceByComponent,t,"widget"),o(e,a,t,"widget","afterChange");else{var l=!e.diff||e.diff(e,n,t);e.skipContent=!l;var c=e.vmodel.$events.onViewChange;c&&c.length&&(t.count+=1,e.afterChange=[function(t,a){var r=n.outerHTML,o=e.outerHTML||(e.outerHTML=avalon.vdomAdaptor(e,"toHTML"));r!==o&&e.vmodel.$fire("onViewChange",{type:"viewchange",target:t,wid:i,vmodel:a.vmodel}),s.renderCount++}])}else t.count+=1,e.change=[this.replaceByComment]},addDisposeMonitor:function(e){window.chrome&&window.MutationEvent?a.byMutationEvent(e):avalon.modern&&"function"==typeof window.Node?a.byRewritePrototype(e):a.byPolling(e)},replaceByComment:function(e,n,t){var a=document.createComment(n.nodeValue);e?t.replaceChild(a,e):t.appendChild(a)},replaceByComponent:function(e,n,t){var o=n.type.indexOf("-")>0,s=!1;o&&document.registerElement&&(a.byCustomElement(n.type),s=!0);var l=avalon.vdomAdaptor(n,"toDOM");return n.ouerHTML=avalon.vdomAdaptor(n,"toHTML"),e?t.replaceChild(l,e):t.appendChild(l),r([l],[n],t,n.steps),s||i.addDisposeMonitor(l),!1}})},function(e,n){function t(e){if(!l[e]){l[e]=!0;var n=Object.create(HTMLElement.prototype);n.detachedCallback=function(){var e=this;setTimeout(function(){i(e)})},document.registerElement(e,n)}}function a(e){e.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(function(){i(e)})})}function r(){function e(e,t){var a=n[e];n[e]=function(e,n){return t.call(this,a,e,n)}}if(!r.execute){r.execute=!0;var n=Node.prototype;e("removeChild",function(e,n,t){return e.call(this,n,t),1===n.nodeType&&setTimeout(function(){i(n)}),n}),e("replaceChild",function(e,n,t){return e.call(this,n,t),1===n.nodeType&&setTimeout(function(){i(n)}),n}),e("innerHTML",function(e,n){var t=this.getElementsByTagName("*");e.call(this,n),s(t)}),e("appendChild",function(e,n){return e.call(this,n),1===n.nodeType&&11===this.nodeType&&setTimeout(function(){i(n)}),n}),e("insertBefore",function(e,n){return e.call(this,n),1===n.nodeType&&11===this.nodeType&&setTimeout(function(){i(n)}),n})}}function o(e){avalon.Array.ensure(c,e),u||(u=setInterval(function(){for(var e,n=0;e=c[n];)!1===i(e)?avalon.Array.removeAt(c,n):n++;0==c.length&&(clearInterval(u),u=0)},700))}function i(e){if(1===e.nodeType&&e.getAttribute("wid")&&!avalon.contains(avalon.root,e)){var n=e.getAttribute("wid"),t=avalon.resolvedComponents[n],a=t.vmodel,r=!!t.cached;return t.vmodel.$fire("onDispose",{type:"dispose",target:e,vmodel:a,cached:r}),t&&t.vmodel&&!r&&(a.$element=null,a.$hashcode=!1,delete t.vmodel,delete avalon.resolvedComponents[n]),!1}}function s(e){for(var n,t=0;n=e[t++];)i(n)}var l={},c=[],u=0;e.exports={byPolling:o,byMutationEvent:a,byCustomElement:t,byRewritePrototype:r}},function(e,n,t){function a(e,n){for(var t in e)if(e[t]!==n[t])return!0;return!1}function r(){if(!v.lock){var e=v[0];e&&(r.lock=!0,e())}}function o(e){var n=f.test(e)?1e3:1;return parseFloat(e)*n}function i(e,n,t){var a=e[n];a=Array.isArray(a)?a:"function"==typeof a?[a]:[],a.forEach(function(e){e&&e(t)})}function s(e){var n=e.toLowerCase();return function(t){var a,s=this.el,l=avalon(s),u=isFinite(t.stagger)?1e3*t.stagger:0;if(u&&t.staggerKey){var p=h.get(t.staggerKey)||h.put(t.staggerKey,{count:0,items:0});p.count++,p.items++}var d=p&&p.count||0,f=function(n){var o=n!==!1;s.animating=void 0,a=!0;var l=o?"Done":"Abort";i(t,"on"+e+l,s),avalon.unbind(s,c.transitionEndEvent),avalon.unbind(s,c.animationEndEvent),p&&0===--p.items&&(p.count=0),t.queue&&(v.lock=!1,v.shift(),r())};i(t,"onBefore"+e,s),t[n]?t[n](s,function(e){f(e!==!1)}):c.css&&(l.addClass(t[n+"Class"]),"leave"===n?l.removeClass(t.enterClass+" "+t.enterActiveClass):"enter"===n&&l.removeClass(t.leaveClass+" "+t.leaveActiveClass),l.bind(c.transitionEndEvent,f),l.bind(c.animationEndEvent,f),setTimeout(function(){a=NaN===avalon.root.offsetWidth,l.addClass(t[n+"ActiveClass"]);var e=window.getComputedStyle(s),r=e[c.transitionDuration],i=e[c.animationDuration],p=o(r)||o(i);0===!p?f(!1):u||setTimeout(function(){a||f(!1)},p+130)},17+u*d))}}function l(e){e.acton||(e.action=e.hook.replace(/^on/,"").replace(/Done$/,"").toLowerCase())}var c=t(70),u=t(26),p=t(43);avalon.directive("effect",{priority:5,parse:function(e,n){return"vnode"+n+'.props["ms-effect"] = '+avalon.parseExpr(e)+";\n"},diff:function(e,n,t,r){var o=e.props[r];if("string"==typeof o){var i=o;o=e.props[r]={is:i}}else Array.isArray(o)&&(o=e.props[r]=avalon.mix.apply({},o));if(o.action=o.action||"enter",Object(o)===o){var s=n.props[r];(Object(s)!==s||a(o,s))&&p(e,this.update,t,"effect","afterChange")}},update:function(e,n,t,a){if(!e.animating){e.animating=!0;var o=n.props["ms-effect"],i=o.is;if(a=a||{},!i)return avalon.warn("need is option");var s=avalon.effects;c.css&&!s[i]&&avalon.effect(i,{});var l=s[i];if(!l)return avalon.warn(i+" effect is undefined");var u=a.action||o.action,p=avalon.Effect;if("function"!=typeof p.prototype[u])return avalon.warn(u+" action is undefined");var d=new p(e),f=avalon.mix(a,l,o);f.queue?(v.push(function(){d[u](f)}),r()):setTimeout(function(){d[u](f)},4)}}});var v=[];avalon.effects={},avalon.effect=function(e,n){avalon.effects[e]=n||{},c.css&&(n.enterClass||(n.enterClass=e+"-enter"),n.enterActiveClass||(n.enterActiveClass=n.enterClass+"-active"),n.leaveClass||(n.leaveClass=e+"-leave"),n.leaveActiveClass||(n.leaveActiveClass=n.leaveClass+"-active")),n.action||(n.action="enter")};var d=function(e){this.el=e};avalon.Effect=d,d.prototype={enter:s("Enter"),leave:s("Leave"),move:s("Move")};var f=/\d+s$/,h=new u(128);avalon.applyEffect=function(e,n,t){var a=t.cb,r=t.hook,o=n.props&&n.props["ms-effect"];if(o&&!avalon.document.hidden){var i=o[r];a&&(Array.isArray(i)?i.push(a):i?o[r]=[i,a]:o[r]=[a]),l(t),e.animate=!0,avalon.directives.effect.update(e,n,0,avalon.shadowCopy({},t))}else a&&a()}},function(e,n){var t,a,r,o=!1,i=!1,s=!1,l=avalon.cssName("transition-duration"),c=avalon.cssName("animation-duration"),u={TransitionEvent:"transitionend",WebKitTransitionEvent:"webkitTransitionEnd",OTransitionEvent:"oTransitionEnd",otransitionEvent:"otransitionEnd"},p=avalon.window;for(var v in u){if(p[v]){r=u[v];break}try{document.createEvent(v);r=u[v];break}catch(d){}}"string"==typeof r&&(o=!0,s=!0,t=r),u={AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"};var f;for(v in u)if(p[v]){f=u[v];break}"string"==typeof f&&(i=!0,s=!0,a=f),e.exports={transition:o,animation:i,css:s,transitionEndEvent:t,animationEndEvent:a,transitionDuration:l,animationDuration:c}},function(e,n,t){function a(e,n,t){var n=n||String(new Date-0).slice(0,6),a=r(e,n,t)+"\n\nreturn vnodes"+n,o=Function("__vmodel__","__fast__",a);return o}avalon.lexer=t(72),avalon.diff=t(73),avalon.batch=t(74);var r=t(37);avalon.render=a,e.exports=avalon},function(e,n,t){function a(e){var n="??"+V++;return M[n]=e,n}function r(e){var n=M[e];return n}function o(e){return j.test(e)?e.replace(S,"").replace(A,a):e}function i(e,n,t){var i=[];if(t=t||1,"number"!=typeof n?n=0:n+=1,n>=t&&!O.test(e))return i;for(n||(e=e.replace(A,a));;){var u="",v=!1,f=e.match(b);if(f&&(u=f[0],v=new h(u.replace(E,r))),!v&&(f=e.match(_))){u=f[0],v=new m(f[1].replace(E,r));var w=v.nodeValue;if(C.test(w)){var $=i[i.length-1];$&&3===$.nodeType&&T.test($.nodeValue)&&i.pop(),s(i)}}if(!v&&(f=e.match(g))){u=f[0];var V=f[1].toLowerCase();u=l(u,V),f=u.match(y);var j={};f[2]&&p(o(f[2]),j);var S=u.slice(f[0].length,-1*(V.length+3));v={nodeType:1,type:V,props:j,template:S.replace(E,r).trim(),children:[]},v=c(v,S,i,n,t)}if(v||(f=e.match(y),f&&(u=f[0],V=f[1].toLowerCase(),j={},f[2]&&p(o(f[2]),j),v={nodeType:1,type:V,props:j,template:"",children:[],isVoidTag:!0},c(v,"",i,n,t))),!v)break;i.push(v),e=e.slice(u.length),8===v.nodeType&&x.test(v.nodeValue)&&(v.signature=d("for"),e=e.replace(k,""))}return n||(M={}),i}function s(e){for(var n,t=1,a=e.length,r=[];(n=e[--a])&&(8!==n.nodeType||(x.test(n.nodeValue)?t-=1:C.test(n.nodeValue)&&(t+=1),0!==t));)r.push(avalon.vdomAdaptor(n,"toHTML"));return n.template=r.reverse().join("")}function l(e,n){var t=[],a=[],r=N[n+"open"]||(N[n+"open"]=new RegExp("<"+n+D,H)),o=N[n+"close"]||(N[n+"close"]=new RegExp("</"+n+">",H));e.replace(r,function(e,n){return t.push(("0000000000"+n+"<").slice(-10)),e.replace(L,"1")}).replace(o,function(e,n){a.push(("0000000000"+n+">").slice(-10))});for(var i=t.concat(a).sort(),s=i.join("").replace(w,""),l=0,c=0,u=0,p=s.length;p>u;u++){var v=s.charAt(u);if("<"===v?l+=1:l-=1,0===l){c=u;break}}var d=parseFloat(i[c])+n.length+3;return e.slice(0,d)}function c(e,n,t,a,r){var o=e.type;if("ms-skip"in e.props)e.skipContent=!0;else{switch(o){case"style":case"script":case"noscript":case"template":case"textarea":e.skipContent=!0,"textarea"===o&&(e.props.type="textarea");break;case"input":e.props.type||(e.props.type="text");case"xmp":e.children.push(new h(e.template));break;case"option":e.children.push(new h(v(e.template)));break;default:if(!e.isVoidTag){var s=i(n,a,r);e.children=s,"table"===o&&u(e.children)}}var l=e.props["ms-for"];if(l){var c=e.props["data-for-rendered"],p=c+":cb";delete e.props["ms-for"],t.push({nodeType:8,type:"#comment",nodeValue:"ms-for:"+l,signature:d("for"),cid:p,template:avalon.vdomAdaptor(e,"toHTML")}),c&&!avalon.caches[p]&&(avalon.caches[p]=Function("return "+avalon.parseExpr(c,"on"))()),t.push(e),e={nodeType:8,skipContent:!0,type:"#comment",nodeValue:"ms-for-end:"}}}return e}function u(e){for(var n,t=!1,a=0,r=0,o=e.length,i=0;o>i;i++){var s=e[i];n?"tr"!==s.type&&1===s.nodeType?n=!1:(n.children.push(s),a++,e[i]=0):"tr"===s.type&&(n={nodeType:1,type:"tbody",template:"",children:[],props:{}},n.children.push(s),t=!0,0===r&&(r=i),e[i]=n)}if(t)for(i=r;o>i&&(0!==e[i]||(e.splice(i,1),i--,a--,0!==a));i++);}function p(e,n){e.replace(R,"=").replace(P,function(e){var t=e.split("="),a=t[1]||"",o=t[0].toLowerCase();2===t.length&&0===a.indexOf("??")&&(a=a.replace(E,r).slice(1,-1).replace(F,"&").replace(I,'"')),n[o]=a})}function v(e){return String(e).replace(B,"").trim()}var d=avalon.makeHashCode,f=t(15),h=f.VText,m=f.VComment,g=/^<([^\s>\/=.$<]+)(?:\s+[^=\s]+(?:=[^>\s]+)?)*\s*>(?:[\s\S]*)<\/\1>/,y=/^<([^\s>\/=.$<]+)\s*([^>]*?)\/?>/,b=/^[^<]+/,_=/^<!--([\w\W]*?)-->/,w=/\d+/g,x=/^\s*ms-for\:/,C=/^\s*ms-for-end\:/,$=t(40),T=$.sp,E=/\?\?\d+/g,k=$.leftSp,A=$.string,O=avalon.config.rbind,M={},V=1,j=/=["']/,S=/\n\s*/g,D="(?:\\s+[^>=]*?(?:=[^>]+?)?)*>",N={},L=/./g,H=avalon.msie<9?"ig":"g",F=/&amp;/g,P=/\S+/g,I=/&quot;/g,R=/\s*=\s*/g,B=/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi;e.exports=i},function(e,n,t){function a(e,n,t){if(e)for(var l=0;l<e.length;l++){var c=e[l],u=n[l]||i();switch(c.nodeType){case 3:c.skipContent||s.expr.diff(c,u,t);break;case 8:"for"===c.directive?c.hasChange?l=s["for"].diff(e,n,t,l):(avalon.shadowCopy(c,n[l]),delete c.hasChange):c.directive&&s[c.directive].diff(c,u,t);break;default:c.skipAttrs||r(c,u,t),c.skipContent||a(c.children,u.children||o,t)}}}function r(e,n,t){if(e.order)try{e.order.replace(/([^;]+)/g,function(a){var r=a.match(l),o=r&&r[1];return s[o]&&s[o].diff(e,n||i(),t,a),a})}catch(a){avalon.log(e,n,a,"diffProps error")}}var o=[],i=function(){return{children:[],props:{}}},s=avalon.directives,l=t(40).binding;avalon.diffProps=r,e.exports=a},function(e,n,t){function a(e,n){var t="string"==typeof e?avalon.vmodels[e]||{}:e;if(e=t.$id,s[e]?avalon.Array.ensure(l,e):s[e]=!0,"function"==typeof t.$render&&t.$element&&!c&&document.nodeName){var u=t.$element;o(function(){c=!0;var n=t.$render()||[],o={count:0};if(t.$render.dom){var l=r(n,t.$id);l&&(u=t.$render.dom,n=[l])}avalon.diff(n,u.vtree||[],o),i([u],n,null,o),o.count=0,u.vtree=n,c=!1,avalon.log("rerender",t.$id,new Date-avalon.rerenderStart),delete s[e];for(var p in s){a(p,!0);break}},n)}}function r(e,n){for(var t,a=0;t=e[a++];)if(1===t.nodeType){if(t.props["ms-controller"]===n)return t;if(t.children){var o=r(t.children,n);if(o)return o}}}function o(e,n){if(n){e();var t=l.shift();t&&a(t,!0)}else setTimeout(e,0)}var i=t(65),s={},l=[];avalon.suspendUpdate=0;var c=!1;e.exports=avalon.batch=a},function(e,n,t){function a(e){return e.length>3&&e.indexOf("-")>0&&m.test(e.charAt(0)+e.slice(-1))}function r(e,n,t){for(var a in n)if(n.hasOwnProperty(a)){var r=n[a];f[a]?a in e?e[a].push(r):e[a]=[n[a]]:isFinite(t)&&(e[a]=r)}}function o(e){var n=!0;try{i(e)}catch(t){n=!1}return n}function i(e){e.children.forEach(function(e){if(8===e.nodeType&&e.props){if("ms-widget"in e.props)throw"unresolved"}else e.children&&i(e)})}function s(e,n,t){var a={};t?a[t]=n.children:n.children.forEach(function(e){if(1===e.nodeType){var n=e.props.slot||"default";a[n]?a[n].push(e):a[n]=[e]}}),l(e,a)}function l(e,n){for(var t,a=0;t=e[a++];)if(1===t.nodeType)if("slot"===t.type){var r=t.props.name||"default";if(n[r]){var o=n[r];e.splice.apply(e,[a-1,1].concat(o)),1===o.length&&3===o[0].nodeType&&c(e)}}else l(t.children,n);return e}function c(e){for(var n,t=0;n=e[t];t++)if(n.skipContent===!1&&3===n.nodeType){var a=e[t-1],r=e[t+1];a&&3===a.nodeType&&!/\S/.test(a.nodeValue)&&(avalon.Array.remove(e,a),--t),r&&3===r.nodeType&&!/\S/.test(r.nodeValue)&&avalon.Array.remove(e,r)}}var u=t(16),p=t(37),v=avalon.resolvedComponents,d={wbr:1,xmp:1,template:1},f=avalon.oneObject("onInit,onReady,onViewChange,onDispose"),h=avalon.mix({is:1,diff:1,define:1,cached:1},f);avalon.document.createElement("slot"),avalon.component=function(e,n){if("string"!=typeof e){var t=e,o=n,i=t.props.wid,c={},m=t.props["ms-widget"]||{};if(m=Array.isArray(m)?m:[m],m.forEach(function(e,n){r(c,e,n)}),c.cached){var g=avalon.vmodels[c.$id];if(g){var y=g.$events.__wid__;delete v[i],i=y}}var b=v[i];if(b||(v[i]=t,b=t),b.render)return b;var _=t.type.indexOf("-")>0?t.type:c.is,w={nodeType:8,type:"#comment",directive:"widget",props:{"ms-widget":i},nodeValue:"ms-widget placeholder"};if(avalon.components[_]){var x=t.type;d[x]||a(x)||avalon.warn(x+"不合适做组件的标签"),"xmp"!==x&&"template"!==x&&0!==t.children.length||(t.children=avalon.lexer(b.template)),n=avalon.components[_],avalon.modern||n.fixTag||(avalon.document.createElement(_),n.fixTag=1);var C=c.diff,$=c.define;$=$||avalon.directives.widget.define;var T=c.$id||avalon.makeHashCode(_.replace(/-/g,"_")),E=n.defaults;r(c,E,!1);var k=[o,E].concat(m),A=$.apply(function(e,n){for(var t in h)delete e[t],delete n[t]},k);A.$id=T,A.$element=o.$element,avalon.vmodels[T]=A;var O=n.template.trim();"function"==typeof n.getTemplate&&(O=n.getTemplate(A,O));var M=avalon.lexer(O);M.length>1&&avalon.error("组件必须用一个元素包起来");var V=M[0];for(var j in b.props)"ms-widget"!==j&&(V.props[j]=b.props[j]);if(n.soleSlot){var S={},D=n.soleSlot;S[D]=/\S/.test(b.template)?t.children:new u("{{@"+D+"}}"),l(M,S)}else t.isVoidTag||s(M,t,n.soleSlot);for(j in f)c[j]&&c[j].forEach(function(e){A.$watch(j,e)});var N=N||String(new Date-0).slice(0,6),L=p(M,N)+"\nreturn (avalon.__widget = vnodes"+N+");\n";return A.$render=o.$render,A.$events.__wid__=i,A.$fire("onInit",{type:"init",vmodel:A,wid:i,target:null}),avalon.shadowCopy(b,{diff:C,render:L,vmodel:A,cached:!!c.cached,placeholder:w}),b}return w}avalon.components[e]||(avalon.components[e]=n)};var m=/^[a-z]+$/;avalon.renderComponent=function(e){var n=avalon.resolvedComponents[e.props.wid],t=e.order;return e.order=t?"ms-widget;;"+t:"ms-widget",o(e)?(n.renderCount||(n.renderCount=1),e.props["ms-widget"]=n.props["ms-widget"],e.vmodel=n.vmodel,e.diff=n.diff,delete e.skipAttrs,e):n.placeholder}},,,function(e,n,t){function a(e,n){n.__vmodel__=e;var t=v.hideProperty;t(e,"$events",n),t(e,"$watch",function(){if(2===arguments.length)return m.apply(e,arguments);throw"$watch方法参数不对"}),t(e,"$fire",function(n,t,a){var r=e.$events[n];h(r,e,n,t,a)})}function r(e,n,t){return"$"===e.charAt(0)||t[e]||"function"==typeof n||n&&n.nodeName&&n.nodeType>0}function o(e,n,t,a){if(Array.isArray(e))return v.arrayFactory(e,n,t,a);if(Object(e)===e&&"function"!=typeof e){if(n&&n.$id){if(++avalon.suspendUpdate,n.$track!==Object.keys(e).sort().join(";;"))var r=v.slaveFactory(n,e,t,a);else r=n;for(var o in e)d[o]||(r[o]=e[o]);return--avalon.suspendUpdate,r}return r=v.masterFactory(e,t,a)}return e}function i(e,n,t){function a(){return r}var r=NaN;return a.heirloom=t,{get:a,set:function(o){if(r!==o){o&&"object"==typeof o&&(o=v.modelAdaptor(o,r,t,{pathname:n,id:e}));var i=r;r=o;var u=t.__vmodel__;if(this.$hashcode&&u&&!avalon.suspendUpdate){t!==u.$events&&(a.heirloom=u.$events),l(a.$decompose,n,o,i),-1===n.indexOf("*")&&h(a.heirloom[n],u,n,o,i),s(e,u,n,o,i),c(a.heirloom,u,n,o,i),avalon.rerenderStart=new Date;var p=u.$id.indexOf(".");p>0?avalon.batch(u.$id.slice(0,p),!0):avalon.batch(u,!0)}}},enumerable:!0,configurable:!0}}function s(e,n,t,a,r){if(e.indexOf(".*.")>0){var o=e.match(g),i=avalon.vmodels[o[1]];if(i){var s=o[2];h(i.$events[s],n,t,a,r)}}}function l(e,n,t,a){if(e&&e[n]){var r=e[n];if(r.$hashcode){var o=n.replace(/^[^.]+\./,"");o!==n&&h(r.$events[o],r,o,t,a)}else delete e[n]}}function c(e,n,t,a,r){e.__fuzzy__&&e.__fuzzy__.replace(avalon.rword,function(o){
var i=e[o],s=i.reg;return s&&s.test(t)&&h(i,n,t,a,r),o})}function u(e){var n=e.$id;if(!n&&avalon.config.debug&&avalon.warn("vm.$id must be specified"),avalon.vmodels[n])throw Error("error:["+n+"] had defined!");var t=v.masterFactory(e,{},{pathname:"",id:n,master:!0});return avalon.vmodels[n]=t}function p(e,n,t,a){if(n&&n.splice){var r=[0,n.length].concat(e);return++avalon.suspendUpdate,n.splice.apply(n,r),--avalon.suspendUpdate,n}for(var i in y)e[i]=y[i];e.notify=function(e,n,r,o){var i=t.__vmodel__;if(i){var s=null===e||void 0===e?a.pathname:a.pathname+"."+e;i.$fire(s,n,r),o||avalon.suspendUpdate||(avalon.rerenderStart=new Date,avalon.batch(i,!0))}};var s=avalon.makeHashCode("$");a.array=!0,a.hashcode=s,a.id=a.id||s,v.makeObserver(e,t,{},{},a);for(var l=0,c=e.length;c>l;l++)e[l]=o(e[l],0,{},{id:e.$id+".*",master:!0});return e}var v={},d=t(79),f=t(80),h=f.$emit,m=f.$watch;v.modelAdaptor=o;var g=/([^.]+)\.(.+)/;v.arrayFactory=p;var y={set:function(e,n){if(e>>>0===e&&this[e]!==n){if(e>this.length)throw Error(e+"set方法的第一个参数不能大于原数组长度");this.splice(e,1,n)}},contains:function(e){return-1!==this.indexOf(e)},ensure:function(e){return this.contains(e)||this.push(e),this},pushArray:function(e){return this.push.apply(this,e)},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){return e>>>0===e?this.splice(e,1):[]},clear:function(){return this.removeAll(),this}};avalon.define=u,e.exports={$$midway:v,$$skipArray:d,isSkip:r,__array__:y,makeFire:a,makeAccessor:i,modelAdaptor:o}},function(e,n){e.exports=avalon.oneObject("$id,$render,$track,$element,$watch,$fire,$events,$model,$skipArray,$accessors,$hashcode,__proxy__,__data__,__const__")},function(e,n){function t(e,n){var t,a=n.split(".")[0];try{e.hasOwnProperty(a)&&(t=e.$accessors?e.$accessors[a].get.heirloom.__vmodel__:Object.getOwnPropertyDescriptor(e,a).get.heirloom.__vmodel__)}catch(r){}return t||e}function a(e){var n=e.split(".");return new RegExp("^"+n.map(function(e){return"*"===e?"(?:[^.]+)":e}).join("\\.")+"$","i")}function r(e,n,t){e&&(n.__fuzzy__?-1===n.__fuzzy__.indexOf(","+t)&&(n.__fuzzy__+=","+t):n.__fuzzy__=t)}function o(e,n){var t=e.indexOf(".*")>0||"*"===e,i=t?this:o.adjust(this,e),s=i.$events,l=s[e]||(s[e]=[]);return t&&(l.reg=l.reg||a(e)),r(t,s,e),i!==this&&(r(t,this.$events,e),this.$events[e]=l),avalon.Array.ensure(l,n),function(){avalon.Array.remove(l,n)}}function i(e,n,t,a,r,o){if(e&&e.length)try{for(o=o||e.length-1;o>=0;o--){var s=e[o];s.call(n,a,r,t)}}catch(l){o-1>0&&i(e,n,t,a,r,o-1),avalon.log(l,t)}}o.adjust=t,e.exports={$emit:i,$watch:o,adjustVm:t}},,,function(e,n,t){var a=t(3),r=t(4);a.shadowCopy(a,r),t(84),t(6),t(7),e.exports=a},function(e,n){function t(e){if(e&&"object"==typeof e){var n=e.length,t=a.call(e);if(o.test(t))return!0;if("[object Object]"===t&&n===n>>>0)return!0}return!1}var a=avalon.inspect,r=/^\[object (?:Window|DOMWindow|global)\]$/,o=/(Array|List|Collection|Map|Arguments)\]$/;avalon.quote=JSON.stringify;var i={};"Boolean Number String Function Array Date RegExp Object Error".replace(avalon.rword,function(e){i["[object "+e+"]"]=e.toLowerCase()}),avalon.type=function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?i[a.call(e)]||"object":typeof e},avalon.isFunction=function(e){return"function"==typeof e},avalon.isWindow=function(e){return r.test(a.call(e))},avalon.isPlainObject=function(e){return"[object Object]"===a.call(e)&&Object.getPrototypeOf(e)===Object.prototype},avalon.mix=avalon.fn.mix=function(){var e,n,t,a,r,o,i=arguments[0]||{},s=1,l=arguments.length,c=!1;for("boolean"==typeof i&&(c=i,i=arguments[1]||{},s++),"object"!=typeof i&&"function"!=typeof i&&(i={}),s===l&&(i=this,s--);l>s;s++)if(null!=(e=arguments[s]))for(n in e){t=i[n];try{a=e[n]}catch(u){continue}i!==a&&(c&&a&&(avalon.isPlainObject(a)||(r=Array.isArray(a)))?(r?(r=!1,o=t&&Array.isArray(t)?t:[]):o=t&&avalon.isPlainObject(t)?t:{},i[n]=avalon.mix(c,o,a)):void 0!==a&&(i[n]=a))}return i},avalon.each=function(e,n){if(e){var a=0;if(t(e))for(var r=e.length;r>a&&n(a,e[a])!==!1;a++);else for(a in e)if(e.hasOwnProperty(a)&&n(a,e[a])===!1)break}},e.exports={avalon:avalon,isArrayLike:t}},function(e,n,t){t(86),t(87),t(88),t(89),t(90),t(91),t(92),t(93),e.exports=avalon},function(e,n){function t(){return(new XMLSerializer).serializeToString(this)}function a(e,n){if(e&&e.childNodes)for(var t,o=e.childNodes,i=0;t=o[i++];)if(1===t.nodeType){var s=document.createElementNS(r,t.nodeName.toLowerCase());avalon.each(t.attributes,function(e,n){s.setAttribute(n.name,n.value)}),a(t,s),n.appendChild(s)}else n.appendChild(t.cloneNode(!0))}avalon.document.contains||(Node.prototype.contains=function(e){return!!(16&this.compareDocumentPosition(e))}),avalon.contains=function(e,n){try{for(;n=n.parentNode;)if(n===e)return!0;return!1}catch(t){return!1}};var r="http://www.w3.org/2000/svg",o=avalon.document.createElementNS(r,"svg");o.innerHTML='<circle fill="red" />',/^\[object SVG\w*Element\]$/.test(o.firstChild)||Object.defineProperties(SVGElement.prototype,{outerHTML:{configurable:!0,get:t,set:function(e){var n=this.tagName.toLowerCase(),t=this.parent,r=avalon.parseHTML(e);if("svg"===n)t.insertBefore(r,this);else{var o=document.createDocumentFragment();a(r,o),t.insertBefore(o,this)}t.removeChild(this)}},innerHTML:{configurable:!0,get:function(){var e=this.outerHTML,n=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),t=new RegExp("</"+this.nodeName+">$","i");return e.replace(n,"").replace(t,"")},set:function(e){if(avalon.clearHTML){avalon.clearHTML(this);var n=avalon.parseHTML(e);a(n,this)}}}})},function(e,n){var t=/\S+/g;"add,remove".replace(avalon.rword,function(e){avalon.fn[e+"Class"]=function(n){var a=this[0]||{};return n&&"string"==typeof n&&1===a.nodeType&&n.replace(t,function(n){a.classList[e](n)}),this}}),avalon.fn.mix({hasClass:function(e){var n=this[0]||{};return 1===n.nodeType&&n.classList.contains(e)},toggleClass:function(e,n){var a="boolean"==typeof n,r=this;return String(e).replace(t,function(e){var t=a?n:!r.hasClass(e);r[t?"addClass":"removeClass"](e)}),this}})},function(e,n){function t(e){try{if("object"==typeof e)return e;e="true"===e?!0:"false"===e?!1:"null"===e?null:+e+""===e?+e:a.test(e)?JSON.parse(e):e}catch(n){}return e}var a=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/;avalon.parseJSON=JSON.parse,avalon.fn.attr=function(e,n){return 2===arguments.length?(this[0].setAttribute(e,n),this):this[0].getAttribute(e)},avalon.fn.data=function(e,n){switch(e="data-"+avalon.hyphen(e||""),arguments.length){case 2:return this.attr(e,n),this;case 1:var a=this.attr(e);return t(a);case 0:var r={};return avalon.each(this[0].attributes,function(n,a){a&&(e=a.name,e.indexOf("data-")||(e=avalon.camelize(e.slice(5)),r[e]=t(a.value)))}),r}},avalon.root.dataset&&(avalon.fn.data=function(e,n){e=e&&avalon.camelize(e);var a=this[0].dataset;switch(arguments.length){case 2:return a[e]=n,this;case 1:return n=a[e],t(n);case 0:var r={};for(e in a)r[e]=t(a[e]);return r}})},function(e,n){function t(e,n){if(e.offsetWidth<=0){var a=getComputedStyle(e,null);if(u.test(a.display)){var r={node:e};for(var o in c)r[o]=a[o],e.style[o]=c[o];n.push(r)}var i=e.parentNode;i&&1===i.nodeType&&t(i,n)}}function a(e){return e.window&&e.document?e:9===e.nodeType?e.defaultView:!1}var r=avalon.root,o=avalon.camelize,i=avalon.cssHooks,s=["","-webkit-","-o-","-moz-","-ms-"],l={"float":"cssFloat"};avalon.cssNumber=avalon.oneObject("animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(e,n,t){if(l[e])return l[e];n=n||r.style;for(var a=0,i=s.length;i>a;a++)if(t=o(s[a]+e),t in n)return l[e]=t;return null},avalon.fn.css=function(e,n){if(avalon.isPlainObject(e))for(var t in e)avalon.css(this,t,e[t]);else var a=avalon.css(this,e,n);return void 0!==a?a:this},avalon.fn.position=function(){var e,n,t=this[0],a={top:0,left:0};return t?("fixed"===this.css("position")?n=t.getBoundingClientRect():(e=this.offsetParent(),n=this.offset(),"HTML"!==e[0].tagName&&(a=e.offset()),a.top+=avalon.css(e[0],"borderTopWidth",!0),a.left+=avalon.css(e[0],"borderLeftWidth",!0),a.top-=e.scrollTop(),a.left-=e.scrollLeft()),{top:n.top-a.top-avalon.css(t,"marginTop",!0),left:n.left-a.left-avalon.css(t,"marginLeft",!0)}):a},avalon.fn.offsetParent=function(){for(var e=this[0].offsetParent;e&&"static"===avalon.css(e,"position");)e=e.offsetParent;return avalon(e||r)},i["@:set"]=function(e,n,t){e.style[n]=t},i["@:get"]=function(e,n){if(!e||!e.style)throw new Error("getComputedStyle要求传入一个节点 "+e);var t,a=getComputedStyle(e);return a&&(t="filter"===n?a.getPropertyValue(n):a[n],""===t&&(t=e.style[n])),t},i["opacity:get"]=function(e){var n=i["@:get"](e,"opacity");return""===n?"1":n},"top,left".replace(avalon.rword,function(e){i[e+":get"]=function(n){var t=i["@:get"](n,e);return/px$/.test(t)?t:avalon(n).position()[e]+"px"}});var c={position:"absolute",visibility:"hidden",display:"block"},u=/^(none|table(?!-c[ea]).+)/;avalon.each({Width:"width",Height:"height"},function(e,n){var a="client"+e,r="scroll"+e,o="offset"+e;i[n+":get"]=function(n,t,a){var r=-4;"number"==typeof a&&(r=a),t="Width"===e?["Left","Right"]:["Top","Bottom"];var i=n[o];return 2===r?i+avalon.css(n,"margin"+t[0],!0)+avalon.css(n,"margin"+t[1],!0):(0>r&&(i=i-avalon.css(n,"border"+t[0]+"Width",!0)-avalon.css(n,"border"+t[1]+"Width",!0)),-4===r&&(i=i-avalon.css(n,"padding"+t[0],!0)-avalon.css(n,"padding"+t[1],!0)),i)},i[n+"&get"]=function(e){var a=[];t(e,a);for(var r,o=i[n+":get"](e),s=0;r=a[s++];){e=r.node;for(var l in r)"string"==typeof r[l]&&(e.style[l]=r[l])}return o},avalon.fn[n]=function(t){var s=this[0];if(0===arguments.length){if(s.setTimeout)return s["inner"+e];if(9===s.nodeType){var l=s.documentElement;return Math.max(s.body[r],l[r],s.body[o],l[o],l[a])}return i[n+"&get"](s)}return this.css(n,t)},avalon.fn["inner"+e]=function(){return i[n+":get"](this[0],void 0,-2)},avalon.fn["outer"+e]=function(e){return i[n+":get"](this[0],void 0,e===!0?2:0)}}),avalon.fn.offset=function(){var e=this[0];try{var n=e.getBoundingClientRect();if(n.width||n.height||e.getClientRects().length){var t=e.ownerDocument,a=t.documentElement,r=t.defaultView;return{top:n.top+r.pageYOffset-a.clientTop,left:n.left+r.pageXOffset-a.clientLeft}}}catch(o){return{left:0,top:0}}},avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){avalon.fn[e]=function(t){var r=this[0]||{},o=a(r),i="scrollTop"===e;return arguments.length?void(o?o.scrollTo(i?o[n]:t,i?t:o[n]):r[e]=t):o?o[n]:r[e]}})},function(e,n){function t(e){var n=e.tagName.toLowerCase();return"input"===n&&/checkbox|radio/.test(e.type)?"checked":n}var a={"select:get":function r(e,n,t,o){var i,s=e.children;a["option:get"];t=n?t:e.selectedIndex,o=n?o:"select-one"===e.type||0>t,n=n||[];for(var l,c=0;l=s[c++];)if(!l.disabled)switch(l.nodeName.toLowerCase()){case"option":if(l.selected||l.index===t){if(i=l.value,o)return i;n.push(i)}break;case"optgroup":if(i=r(l,n,t,o),"string"==typeof i)return i}return o?null:n},"select:set":function(e,n,t){n=[].concat(n);for(var a,r=0;a=e.options[r++];)(a.selected=n.indexOf(a.value)>-1)&&(t=!0);t||(e.selectedIndex=-1)}};avalon.fn.val=function(e){var n=this[0];if(n&&1===n.nodeType){var r=0===arguments.length,o=r?":get":":set",i=a[t(n)+o];if(i)var s=i(n,e);else{if(r)return(n.value||"").replace(/\r/g,"");n.value=e}}return r?s:this}},function(e,n,t){var a=t(26),r=t(27),o=new function(){avalon.shadowCopy(this,{option:document.createElement("select"),thead:document.createElement("table"),td:document.createElement("tr"),area:document.createElement("map"),tr:document.createElement("tbody"),col:document.createElement("colgroup"),legend:document.createElement("fieldset"),_default:document.createElement("div"),g:document.createElementNS("http://www.w3.org/2000/svg","svg")}),this.optgroup=this.option,this.tbody=this.tfoot=this.colgroup=this.caption=this.thead,this.th=this.td},i={g:o.g};String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(avalon.rword,function(e){i[e]=o.g});var s,l=/<([\w:]+)/,c=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,u=/<|&#?\w+;/,p=new a(128),s=avalon.document.createElement("template");/HTMLTemplateElement/.test(s)||(s=null,avalon.shadowCopy(o,i)),avalon.parseHTML=function(e){var n,t=avalon.avalonFragment.cloneNode(!1);if("string"!=typeof e)return t;if(!u.test(e))return t.appendChild(document.createTextNode(e)),t;e=e.replace(c,"<$1></$2>").trim();var a=p.get(e);if(a)return a.cloneNode(!0);var n,v=(l.exec(e)||["",""])[1].toLowerCase(),d=i[v];if(d?d.innerHTML=e:s?(s.innerHTML=e,d=s.content):(d=o[v]||o._default,d.innerHTML=e),r(d),s)t=d;else for(;n=d.firstChild;)t.appendChild(n);return e.length<1024&&p.put(e,t.cloneNode(!0)),t},avalon.innerHTML=function(e,n){var t=this.parseHTML(n);this.clearHTML(e).appendChild(t)},avalon.clearHTML=function(e){for(avalon.$$unbind(e),e.textContent="";e.lastChild;)e.removeChild(e.lastChild);return e}},function(e,n,t){function a(e,n,t){var r=e.getAttribute("avalon-events");if(r&&(e.disabled!==!0||"click"!==n)){var o=[],i=h[n]||(h[n]=new RegExp(n+"\\:([^?s]+)","g"));r.replace(i,function(e,n){return o.push(n),e}),o.length&&t.push({elem:e,uuids:o})}e=e.parentNode,e&&e.getAttribute&&p[n]&&a(e,n,t)}function r(e){e=new i(e);var n=e.type,t=e.target,r=[];a(t,n,r);for(var o,s,l,c=0;(l=r[c++])&&!e.cancelBubble;)for(e.currentTarget=l.elem,o=0;(s=l.uuids[o++])&&!e.isImmediatePropagationStopped;){var u=avalon.eventListeners[s];if(u){var p=m.test(s)?l.elem._ms_context_:0;if(p&&p.$hashcode===!1)return avalon.unbind(t,n,u);if(g.test(n)){var v=+new Date;v-f>16&&(u.call(p||t,e),f=v)}else u.call(p||t,e)}}}function o(e){var n=c.getAttribute("delegate-events")||"";if(-1===n.indexOf(e)){var t=n.match(d)||[];t.push(e),c.setAttribute("delegate-events",t.join("??")),b(c,e,r,!!y[e])}}function i(e){if(e.originalEvent)return this;for(var n in e)w.test(n)||"function"==typeof e[n]||(this[n]=e[n]);this.timeStamp=new Date-0,this.originalEvent=e}var s=avalon.document,l=avalon.window,c=avalon.root,u=t(6).getShortID,p=t(32),v=avalon.eventHooks;avalon.bind=function(e,n,t){if(1===e.nodeType){var a=e.getAttribute("avalon-events")||"",i=u(t),s=n+":"+i,l=v[n];l&&(n=l.type,l.fix&&(t=l.fix(e,t),t.uuid=i+"0"),s=n+":"+t.uuid),avalon.eventListeners[t.uuid]=t,-1===a.indexOf(n+":")&&(p[n]||y[n]?o(n):b(e,n,r));var c=a.split("??");""===c[0]&&c.shift(),-1===c.indexOf(s)&&(c.push(s),e.setAttribute("avalon-events",c.join("??")))}else b(e,n,t);return t},avalon.unbind=function(e,n,t){if(1===e.nodeType){var a=e.getAttribute("avalon-events")||"";switch(arguments.length){case 1:_(e,n,r),e.removeAttribute("avalon-events");break;case 2:a=a.split("??").filter(function(e){return-1===e.indexOf(n+":")}).join("??"),e.setAttribute("avalon-events",a);break;default:var o=n+":"+t.uuid;a=a.split("??").filter(function(e){return e!==o}).join("??"),e.setAttribute("avalon-events",a),delete avalon.eventListeners[t.uuid]}}else _(e,n,t)};var d=/[^\s\?]+/g,f=+new Date,h={},m=/^e\d+/,g=/move|scroll/,y={focus:!0,blur:!0},b=function(e,n,t,a){e.addEventListener(n,t,a)},_=function(e,n,t){e.removeEventListener(n,t)},w=/^(?:ms|webkit|moz)/;i.prototype={preventDefault:function(){var e=this.originalEvent;this.returnValue=!1,e&&(e.returnValue=!1,e.preventDefault())},stopPropagation:function(){var e=this.originalEvent;this.cancelBubble=!0,e&&(e.cancelBubble=!0,e.stopPropagation())},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=!0,e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},avalon.fireDom=function(e,n,t){var a=s.createEvent("Events");a.initEvent(n,!0,!0),avalon.shadowCopy(a,t),e.dispatchEvent(a)};var v=avalon.eventHooks;"onmouseenter"in c||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,n){v[e]={type:n,fn:function(n,t){return function(a){var r=a.relatedTarget;return r&&(r===n||16&n.compareDocumentPosition(r))?void 0:(delete a.type,a.type=e,t.call(this,a))}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,n){l[e]&&!v.animationend&&(v.animationend={type:n})}),void 0===s.onmousewheel&&(v.mousewheel={type:"wheel",fn:function(e,n){return function(e){e.wheelDeltaY=e.wheelDelta=e.deltaY>0?-120:120,e.wheelDeltaX=0,Object.defineProperty(e,"type",{value:"mousewheel"}),n.call(this,e)}}}),avalon.fn.bind=function(e,n,t){return this[0]?avalon.bind(this[0],e,n,t):void 0},avalon.fn.unbind=function(e,n,t){return this[0]&&avalon.unbind(this[0],e,n,t),this},avalon.$$unbind=function(e){var n=e.querySelectorAll("[avalon-events]");avalon.each(n,function(e,n){avalon.unbind(n)})}},function(e,n,t){var a,r=t(34),o=avalon.document,i=avalon.window,s=[],l=function(e){for(a=!0;e=s.shift();)e(avalon)};"complete"===o.readyState?setTimeout(l):o.addEventListener("DOMContentLoaded",l),avalon.bind(i,"load",l),avalon.ready=function(e){a?e(avalon):s.push(e)},avalon.ready(function(){r(o.body)})},function(e,n,t){t(36),t(44),t(95),t(48),t(49),t(97),t(51),t(52),t(53),t(54),t(98),t(62),t(63),t(64),t(66),t(67),t(69)},function(e,n,t){var a=t(96),r=t(43);avalon.directive("attr",{parse:function(e,n){return"vnode"+n+'.props["ms-attr"] = '+avalon.parseExpr(e)+";\n"},diff:function(e,n,t,o){var i=e.props[o],s=n.props[o];if(Object(i)===i){if(Array.isArray(i)&&(i=e.props[o]=avalon.mix.apply({},i)),"object"!=typeof s)e.changeAttr=i;else{var l={},c=!1;for(var u in i)i[u]!==s[u]&&(c=!0,l[u]=i[u]);c&&(e.changeAttr=l,t.count+=1)}e.changeAttr&&r(e,a,t,"attr")}else e.props[o]=s},update:a})},function(e,n,t){function a(e,n){var t=n.changeAttr;if(t)for(var a in t){var i=t[a];if("src"===a&&window.chrome&&"EMBED"===e.tagName){e[a]=i;var s=e.parentNode,l=document.createComment("ms-src");s.replaceChild(l,e),s.replaceChild(e,l)}else if(0==a.indexOf("data-"))e.setAttribute(a,i);else{var c=r[a]||a;if("boolean"==typeof e[c]&&(e[c]=!!i),i===!1){e.removeAttribute(a);continue}var u=o.test(e)?!1:a in e.cloneNode(!1);u?e[c]=i+"":e.setAttribute(a,i)}}n.changeAttr=null}var r=t(47),o=/^\[object SVG\w*Element\]$/;e.exports=a},function(e,n,t){var a=t(43);avalon.directive("expr",{parse:function(){},diff:function(e,n,t){e.nodeValue!==n.nodeValue&&a(e,this.update,t,"expr")},update:function(e,n,t){if(3!==e.nodeType){var a=document.createTextNode(n.nodeValue);t.replaceChild(a,e)}else e.nodeValue=n.nodeValue}})},function(e,n,t){function a(e,n){var t=[];e.children.forEach(function(e){"option"===e.type?t.push(e):"optgroup"===e.type&&e.children.forEach(function(e){"option"===e.type&&t.push(e)})});var a=e.props.multiple,r={},o=null===a||void 0===a||a===!1;Array.isArray(n)?n.forEach(function(e){r[e]=1}):r[n]=1;for(var i,s=0;i=t[s++];){var l="value"in i.props?i.props.value:(i.children[0]||{nodeValue:""}).nodeValue.trim();if(i.props.selected=!!r[l],r[l]&&o)break}}var r=t(56),o=t(57),i=t(99),s=t(100),l=t(61),c=t(43),u=t(39);avalon.directive("duplex",{priority:2e3,parse:function(e,n,t){var a=e.expr;o(e,t),avalon.caches[a]=t.field;var r="vnode"+n+".duplexVm = __vmodel__;\nvnode"+n+'.props["ms-duplex"] = '+avalon.quote(a)+";\nvnode"+n+'.props["data-duplex-get"] = '+u.get("duplex:"+a)+"\nvnode"+n+'.props["data-duplex-set"] = '+u.get("duplex:set:"+a)+"\n",i=u.get("duplex:format:"+a);return i&&(r+="vnode"+n+'.props["data-duplex-format"] = '+i),r},diff:function(e,n,t){var r=e.props["ms-duplex"];e.field=n.field||avalon.mix({},avalon.caches[r]);var o=e.field;o.set||i(e),e.duplexVm=null;var s=e.props.value=o.get(o.vmodel);if("select"!==e.type||e.children.length||(avalon.Array.merge(e.children,avalon.lexer(e.template,0,2)),a(e,s)),o.element){var l=n.props.value;u=Array.isArray(s)?s+""==l+"":s===l}else var u=!1;u||(o.modelValue=s,c(e,this.update,t,"duplex","afterChange"))},update:function(e,n){var t=e._ms_field_=n.field;if(!t.element){t.element=e;var a=t.events;for(var o in a)avalon.bind(e,o,a[o]),delete a[o]}if(l(e,n),!avalon.msie&&r===!1&&!e.valueHijack){e.valueHijack=t.update;var i=setInterval(function(){avalon.contains(avalon.root,e)?e.valueHijack():clearInterval(i)},30)}var c=t.format(t.modelValue);if(t.viewValue!==c&&(t.viewValue=c,s[t.type].call(t),e.caret)){var u=t.caretPos;u&&t.updateCaret(e,u.start,u.end),t.caretPos=null}}})},function(e,n,t){function a(e){var n=e.field;n.update=r,n.updateCaret=u,n.get=e.props["data-duplex-get"],n.set=e.props["data-duplex-set"];var t=e.props["data-duplex-format"];t&&n.formatters.push(function(e){return t(n.vmodel,e)}),n.vmodel=e.duplexVm;var a=n.events={};switch(n.type){case"radio":"radio"===e.props.type?a.click=r:a.change=r;break;case"checkbox":case"select":a.change=r;break;case"contenteditable":n.isChanged?a.blur=r:(p.webkitURL?a.webkitEditableContentChanged=r:p.MutationEvent&&(a.DOMCharacterDataModified=r),a.input=r);break;case"input":n.isChanged?a.change=r:(a.input=r,avalon.msie||(a.compositionstart=s,a.compositionend=l))}/password|text/.test(e.props.type)&&(a.focus=o,a.blur=i)}function r(){var e=this,n=this._ms_field_;if(!e.composing&&e.value!==n.lastViewValue){if(e.caret)try{var t=c(e);t.start!==t.end&&t.start+1!==t.end||(n.caretPos=t)}catch(a){avalon.warn("fixCaret error",a)}if(n.debounceTime>4){var r=new Date,o=r-n.time||0;n.time=r,o>=n.debounceTime?v[n.type].call(n):(clearTimeout(n.debounceID),n.debounceID=setTimeout(function(){v[n.type].call(n)},o))}else v[n.type].call(n)}}function o(){this.caret=!0}function i(){this.caret=!1}function s(){this.composing=!0}function l(e){this.composing=!1,r.call(this,e)}function c(e){var n=NaN,t=NaN;return e.setSelectionRange&&(n=e.selectionStart,t=e.selectionEnd),{start:n,end:t}}function u(e,n,t){e.value&&!e.readOnly&&(e.selectionStart=n,e.selectionEnd=t)}var p=avalon.window,v=t(59),d=t(6).getShortID;d(o),d(i),d(s),d(l),d(r),e.exports=a},function(e,n){var t={input:function(){this.element.value=this.viewValue},radio:function(){var e;e=this.isChecked?!!this.viewValue:this.viewValue+""===this.element.value,this.element.checked=e},checkbox:function(){for(var e=!1,n=this.element,t=n.value,a=0;a<this.modelValue.length;a++){var r=this.modelValue[a];r+""===t&&(e=!0)}n.checked=e},select:function(){var e=Array.isArray(this.viewValue)?this.viewValue.map(String):this.viewValue+"";avalon(this.element).val(e)},contenteditable:function(){this.element.innerHTML=this.viewValue,this.update.call(this.element)}};e.exports=t},,,function(e,n,t){function a(e,n,t){return!t[e]&&"$"!==e.charAt(0)&&n&&!n.$id&&"object"==typeof n&&!n.nodeType&&!n.nodeName}function r(e){return(";;"+this.$track+";;").indexOf(";;"+e+";;")>-1}function o(e){var n=avalon.type(e);if("array"===n){for(var t=[],a=0;a<e.length;a++)t[a]=o(e[a]);return t}if("object"===n){var r={};return e.$track.split("??").forEach(function(n){var t=e[n];r[n]=t&&t.nodeType?t:o(t)}),r}return e}function i(e,n){if(e.$compose){var t=n.split(".")[0];return e.$compose[t]||e}return e}function s(e,n,t){var a=this.$events[e];_(a,this,e,n,t)}function l(e,n,t){var r={};e.$skipArray&&(r=avalon.oneObject(e.$skipArray),delete e.$skipArray),t=t||{};var o=y("$");t.id=t.id||o,t.hashcode=o;var i=[];for(var s in e)if(!m[s]){i.push(s);var l=e[s];a(s,l,r)&&(e[s]=h.modelAdaptor(l,0,n,{id:e.$id+"."+s}))}e.$track=i.sort().join(";;");var u=c(e);return v(u,n,{},{},t)}function c(e){return Proxy.create?Proxy.create(e,E):new Proxy(e,E)}function u(e,n,t){for(var r in n)if(!m[r]&&!e.hasOwnProperty(r)){var o=n[r];a(r,o,{})&&(e[r]=h.modelAdaptor(o,0,t,{id:e.$id+"."+r}))}return r in e&&n.hasOwnProperty(r)&&delete e[r],e.$track=Object.keys(n).sort().join(";;"),e}function p(e){for(var n,t={},r={},o={},i={},s=0;s<arguments.length;s++){var l=arguments[s],u=l.$id&&l.$events;for(var p in l)if(!m[p]){var d=r[p]=l[p];a(p,d,t)&&(r[p]=h.modelAdaptor(d,0,i,{id:r.$id+"."+p})),u&&(o[p]=l)}u&&(n=l)}"function"==typeof this&&this(o,r),r.$track=Object.keys(r).sort().join(";;");var f=c(r);f.$compose=o;for(var s in o){var g=o[s];g.$decompose||(g.$decompose={}),g.$decompose[s]=f}return v(f,i,{},{},{id:e.$id,hashcode:y("$"),master:!0})}function v(e,n,t,a,i){return i.array?Object.defineProperty(e,"$model",{get:function(){return o(this)},set:avalon.noop,enumerable:!1,configurable:!0}):e.hasOwnProperty=r,e.$id=i.id,e.$hashcode=i.hashcode,e.$events=n,i.master===!0&&(e.$element=null,e.$render=0,e.$fire=s,e.$watch=w,n.__vmodel__=e),e}function d(e,n){e.length!==n&&e.notify("length",e.length,n,!0)}var f=t(78),h=f.$$midway,m=f.$$skipArray;m.$compose=!0,m.$decompose=!0,delete m;var g=f.modelAdaptor,y=avalon.makeHashCode,b=t(80),_=b.$emit,w=b.$watch;if(f.toJson=o,avalon.window.Proxy){w.adjust=i,h.masterFactory=l,h.slaveFactory=u,avalon.mediatorFactory=h.mediatorFactory=p,h.makeObserver=v;var x=f.__array__,C=Array.prototype,$=C.splice;x.removeAll=function(e){var n=this.length;if(Array.isArray(e))for(var t=this.length-1;t>=0;t--)-1!==e.indexOf(this[t])&&$.call(this,t,1);else if("function"==typeof e)for(t=this.length-1;t>=0;t--){var a=this[t];e(a,t)&&$.call(this,t,1)}else $.call(this,0,this.length);d(this,n),this.notify()};var T=["push","pop","shift","unshift","splice"];T.forEach(function(e){var n=C[e];x[e]=function(t,a){var r=[],o=this.length;if("splice"===e&&Object(this[0])===this[0])for(var i=this.slice(t,a),s=C.slice.call(arguments,2),r=[t,a],l=0,c=s.length;c>l;l++){var u=i[l];r[l+2]=g(s[l],u,u&&u.$events,{id:this.$id+".*",master:!0})}else for(var p=0,v=arguments.length;v>p;p++)r[p]=g(arguments[p],0,{},{id:this.$id+".*",master:!0});var f=n.apply(this,r);return d(this,o),this.notify(),f}}),"sort,reverse".replace(avalon.rword,function(e){x[e]=function(){return C[e].apply(this,arguments),this.notify(),this}})}var E={deleteProperty:function(e,n){e.hasOwnProperty(n)&&(e.$track=(";;"+e.$track+";;").replace(";;"+n+";;","").slice(2,-2))},get:function(e,n){return"$model"===n?o(e):e[n]},set:function(e,n,t){if("$model"!==n){var a=e[n];if(a!==t){if(!m[n]&&void 0===a&&!e.hasOwnProperty(n)){var r=e.$track.split(";;");r.push(n),e.$track=r.sort().join(";;")}if(e[n]=t,e.$decompose){var o=e.$decompose[n];if(o&&n in o)return void(o.$hashcode?o[n]=t:delete e.$decompose[n])}if(!m[n]){var s=e.$events.__vmodel__,r=e.$id.split("."),l=r.shift(),c=r.concat(n).join("."),u=i(s,c);t&&"object"==typeof t&&!t.$id&&(t=h.modelAdaptor(t,a,u.$events,{pathname:c,id:e.$id}),e[n]=t);var p=u.$events[c];p&&p.length&&_(p,u,c,t,a),avalon.rerenderStart=Date.now(),avalon.batch(l,!0)}}}},has:function(e,n){return e.hasOwnProperty(n)}};e.exports=avalon}])});
//# sourceMappingURL=avalon.next.min.js.map
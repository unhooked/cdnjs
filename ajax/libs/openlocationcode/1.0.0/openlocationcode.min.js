!function(a,b){"function"==typeof define&&define.amd?define(["b"],function(c){return a.returnExportsGlobal=b(c)}):"object"==typeof module&&module.exports?module.exports=b(require("b")):a.OpenLocationCode=b()}(this,function(){var a={},b="+",c=8,d="0",e="23456789CFGHJMPQRVWX",f=e.length,g=90,h=180,i=10,j=[20,1,.05,.0025,125e-6],k=4,l=5,m=125e-6,n=6,p=(a.getAlphabet=function(){return e},a.isValid=function(a){if(!a)return!1;if(-1==a.indexOf(b))return!1;if(a.indexOf(b)!=a.lastIndexOf(b))return!1;if(1==a.length)return!1;if(a.indexOf(b)>c||a.indexOf(b)%2==1)return!1;if(a.indexOf(d)>-1){if(0==a.indexOf(d))return!1;var f=a.match(new RegExp("("+d+"+)","g"));if(f.length>1||f[0].length%2==1||f[0].length>c-2)return!1;if(a.charAt(a.length-1)!=b)return!1}if(a.length-a.indexOf(b)-1==1)return!1;a=a.replace(new RegExp("\\"+b+"+"),"").replace(new RegExp(d+"+"),"");for(var g=0,h=a.length;h>g;g++){var i=a.charAt(g).toUpperCase();if(i!=b&&-1==e.indexOf(i))return!1}return!0}),q=a.isShort=function(a){return p(a)&&a.indexOf(b)>=0&&a.indexOf(b)<c?!0:!1},r=a.isFull=function(a){if(!p(a))return!1;if(q(a))return!1;var b=e.indexOf(a.charAt(0).toUpperCase())*f;if(b>=2*g)return!1;if(a.length>1){var c=e.indexOf(a.charAt(1).toUpperCase())*f;if(c>=2*h)return!1}return!0},s=a.encode=function(a,b,d){if("undefined"==typeof d&&(d=i),2>d||c>d&&d%2==1)throw"IllegalArgumentException: Invalid Open Location Code length";a=w(a),b=y(b),90==a&&(a-=x(d));var e=z(a,b,Math.min(d,i));return d>i&&(e+=A(a,b,d-i)),e},t=a.decode=function(a){if(!r(a))throw"IllegalArgumentException: Passed Open Location Code is not a valid full code: "+a;a=a.replace(b,""),a=a.replace(new RegExp(d+"+"),""),a=a.toUpperCase();var c=B(a.substring(0,i));if(a.length<=i)return c;var e=D(a.substring(i));return E(c.latitudeLo+e.latitudeLo,c.longitudeLo+e.longitudeLo,c.latitudeLo+e.latitudeHi,c.longitudeLo+e.longitudeHi,c.codeLength+e.codeLength)},w=(a.recoverNearest=function(a,d,e){if(!q(a)){if(r(a))return a;throw"ValueError: Passed short code is not valid: "+a}d=w(d),e=y(e),a=a.toUpperCase();var f=c-a.indexOf(b),g=Math.pow(20,2-f/2),h=g/2,i=Math.floor(d/g)*g,j=Math.floor(e/g)*g,k=t(s(i,j).substr(0,f)+a),l=k.latitudeCenter-d;return l>h?k.latitudeCenter-=g:-h>l&&(k.latitudeCenter+=g),l=k.longitudeCenter-e,l>h?k.longitudeCenter-=g:-h>l&&(k.longitudeCenter+=g),s(k.latitudeCenter,k.longitudeCenter,k.codeLength)},a.shorten=function(a,b,c){if(!r(a))throw"ValueError: Passed code is not valid and full: "+a;if(-1!=a.indexOf(d))throw"ValueError: Cannot shorten padded codes: "+a;var a=a.toUpperCase(),e=t(a);if(e.codeLength<n)throw"ValueError: Code length must be at least "+n;b=w(b),c=y(c);for(var f=Math.max(Math.abs(e.latitudeCenter-b),Math.abs(e.longitudeCenter-c)),g=j.length-2;g>=1;g--)if(f<.3*j[g])return a.substring(2*(g+1));return a},function(a){return Math.min(90,Math.max(-90,a))}),x=function(a){return 10>=a?Math.pow(20,Math.floor(a/-2+2)):Math.pow(20,-3)/Math.pow(l,a-10)},y=function(a){for(;-180>a;)a+=360;for(;a>=180;)a-=360;return a},z=function(a,f,i){for(var k="",l=a+g,m=f+h,n=0;i>n;){var o=j[Math.floor(n/2)],p=Math.floor(l/o);l-=p*o,k+=e.charAt(p),n+=1,p=Math.floor(m/o),m-=p*o,k+=e.charAt(p),n+=1,n==c&&i>n&&(k+=b)}return k.length<c&&(k+=Array(c-k.length+1).join(d)),k.length==c&&(k+=b),k},A=function(a,b,c){for(var d="",f=m,i=m,j=(a+g)%f,n=(b+h)%i,o=0;c>o;o++){var p=Math.floor(j/(f/l)),q=Math.floor(n/(i/k));f/=l,i/=k,j-=p*f,n-=q*i,d+=e.charAt(p*k+q)}return d},B=function(a){var b=C(a,0),c=C(a,1);return new E(b[0]-g,c[0]-h,b[1]-g,c[1]-h,a.length)},C=function(a,b){for(var c=0,d=0;2*c+b<a.length;)d+=e.indexOf(a.charAt(2*c+b))*j[c],c+=1;return[d,d+j[c-1]]},D=function(a){for(var b=0,c=0,d=m,f=m,g=0;g<a.length;){var h=e.indexOf(a.charAt(g)),i=Math.floor(h/k),j=h%k;d/=l,f/=k,b+=i*d,c+=j*f,g+=1}return E(b,c,b+d,c+f,a.length)},E=a.CodeArea=function(b,c,d,e,f){return new a.CodeArea.fn.init(b,c,d,e,f)};return E.fn=E.prototype={init:function(a,b,c,d,e){this.latitudeLo=a,this.longitudeLo=b,this.latitudeHi=c,this.longitudeHi=d,this.codeLength=e,this.latitudeCenter=Math.min(a+(c-a)/2,g),this.longitudeCenter=Math.min(b+(d-b)/2,h)}},E.fn.init.prototype=E.fn,a});

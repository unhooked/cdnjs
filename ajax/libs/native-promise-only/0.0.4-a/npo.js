/*! Native Promise Only
    v0.0.4-a (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
!function(e,t,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):t[e]=t[e]||i(e,t)}("Promise",this,function(){"use strict";function e(e){a?(a=!1,e()):"undefined"!=typeof setImmediate?setImmediate(e):setTimeout(e,0)}function t(e,t){var i;return null===e||"object"!=typeof e&&"function"!=typeof e?!1:t?"then"in e:(i=e.then,"function"==typeof i?i:!1)}function i(){if(0===this.state)return a=!1;var e,i,n,r,s;for(1===this.state&&(s=this.success),2===this.state&&(s=this.failure);(e=s.shift())||e===!1;){r=this.chained.shift();try{e===!1?(a=!0,r.reject(this.msg)):(i=e===!0?this.msg:e(this.msg),a=!0,i===r.promise?r.reject(new TypeError("Illegal promise chain cycle")):(n=t(i))?n.call(i,r.resolve,r.reject):r.resolve(i))}catch(o){a=!0,r.reject(o)}}}function n(r){var o,c,u;if(this.def){if(this.triggered)return a=!1;this.triggered=!0,c=this.def}else c=this;if(0!==c.state)return a=!1;u={def:c,triggered:!1};try{(o=t(r))?o.call(r,n.bind(u),s.bind(u)):(c.msg=r,c.state=1,e(i.bind(c)))}catch(h){s.call(u,h)}}function r(e){return this.triggered?void(a=!1):(this.triggered=!0,void n.call(this,e))}function s(t){var n;if(this.def){if(this.triggered)return a=!1;this.triggered=!0,n=this.def}else n=this;return 0!==n.state?a=!1:(n.msg=t,n.state=2,void e(i.bind(n)))}function o(e){return this.triggered?void(a=!1):(this.triggered=!0,void s.call(this,e))}function c(e,t){this.chained.push({resolve:e,reject:t})}function u(t,n){this.success.push("function"==typeof t?t:!0),this.failure.push("function"==typeof n?n:!1);var r=new f(c.bind(this));return this.chained[this.chained.length-1].promise=r,e(i.bind(this)),r}function h(e){return this.promise.then(void 0,e)}function f(e){var t={promise:this,state:0,triggered:!1,success:[],failure:[],chained:[]};this.then=u.bind(t),this["catch"]=h.bind(t);try{e(r.bind(t),o.bind(t))}catch(i){s.call(t,i)}}f.resolve=function(e){return new f(function(t){a=!0,t(e)})},f.reject=function(e){return new f(function(t,i){a=!0,i(e)})},f.all=function(e){if(!Array.isArray(e))throw new TypeError("Promise.all requires an array");return new f(function(i,n){function r(e,t){s[e]=t,o++,o===c&&i(s)}var s,o=0,c=e.length;0===c&&i([]),s=[],e.forEach(function(e,i){t(e,!0)||(e=f.resolve(e)),e.then(r.bind(null,i),n)})})},f.race=function(e){if(!Array.isArray(e))throw new TypeError("Promise.race requires an array");return new f(function(i,n){e.some(function(e){return t(e,!0)?void e.then(i,n):(i(e),!0)})})};var a=!1;return f});

!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define("d3-dsv",["exports"],n):n(r.d3_dsv={})}(this,function(r){"use strict";function n(r){return new t(r)}function t(r){function n(n){return n.map(t).join(r)}function t(r){return e.test(r)?'"'+r.replace(/\"/g,'""')+'"':r}var e=new RegExp('["'+r+"\n]"),o=r.charCodeAt(0);this.parse=function(r,n){var t;return this.parseRows(r,function(r,e){if(t)return t(r,e-1);var o=new Function("d","return {"+r.map(function(r,n){return JSON.stringify(r)+": d["+n+"]"}).join(",")+"}");t=n?function(r,t){return n(o(r),t)}:o})},this.parseRows=function(r,n){function t(){if(s>=c)return f;if(i)return i=!1,u;var n=s;if(34===r.charCodeAt(n)){for(var t=n;t++<c;)if(34===r.charCodeAt(t)){if(34!==r.charCodeAt(t+1))break;++t}s=t+2;var e=r.charCodeAt(t+1);return 13===e?(i=!0,10===r.charCodeAt(t+2)&&++s):10===e&&(i=!0),r.slice(n+1,t).replace(/""/g,'"')}for(;c>s;){var e=r.charCodeAt(s++),a=1;if(10===e)i=!0;else if(13===e)i=!0,10===r.charCodeAt(s)&&(++s,++a);else if(e!==o)continue;return r.slice(n,s-a)}return r.slice(n)}for(var e,i,u={},f={},a=[],c=r.length,s=0,p=0;(e=t())!==f;){for(var d=[];e!==u&&e!==f;)d.push(e),e=t();n&&null==(d=n(d,p++))||a.push(d)}return a},this.format=function(n){if(Array.isArray(n[0]))return this.formatRows(n);var e=Object.create(null),o=[];return n.forEach(function(r){for(var n in r)(n+="")in e||o.push(e[n]=n)}),[o.map(t).join(r)].concat(n.map(function(n){return o.map(function(r){return t(n[r])}).join(r)})).join("\n")},this.formatRows=function(r){return r.map(n).join("\n")}}n.prototype=t.prototype;var e=n(","),o=n("	"),i="0.1.9";r.version=i,r.dsv=n,r.csv=e,r.tsv=o});
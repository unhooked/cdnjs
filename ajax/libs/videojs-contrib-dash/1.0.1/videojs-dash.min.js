/*! videojs-contrib-dash - v1.0.1 - 2015-07-13
 * Copyright (c) 2015 Brightcove  */
!function(a,b){"use strict";function c(a,d){var e,f=d.options();this.tech_=d,this.el_=d.el(),this.elParent_=this.el_.parentNode,a.src&&(d.isReady_=!1,e=a.src,this.keySystemOptions_=c.buildDashJSProtData(a.keySystemOptions),c.hideErrors(this.elParent_),c.useVideoJSDebug(b),c.context_=c.context_||new Dash.di.DashContext,this.mediaPlayer_=new MediaPlayer(c.context_),this.mediaPlayer_.startup(),this.mediaPlayer_.attachView(this.el_),f.autoplay||this.mediaPlayer_.setAutoPlay(!1),this.mediaPlayer_.retrieveManifest(e,b.bind(this,this.initializeDashJS)))}c.prototype.initializeDashJS=function(a,d){var e={};return d?(c.showErrors(this.elParent_),this.tech_.triggerReady(),void this.dispose()):(c.getWidevineProtectionData&&(e=c.getWidevineProtectionData(a),this.keySystemOptions_=b.obj.deepMerge(this.keySystemOptions_,e)),void this.resetSrc_(b.bind(this,function(){c.showErrors(this.elParent_),this.mediaPlayer_.attachSource(a,null,this.keySystemOptions_),this.tech_.triggerReady()})))},c.useVideoJSDebug=function(a){c.originalDebug||a&&a.log&&a.log.debug&&(c.originalDebug=MediaPlayer.utils.Debug,MediaPlayer.utils.Debug=function(){var b,c=!0,d=!1,e=!1,f=(new Date).getTime();return{system:void 0,eventBus:void 0,setup:function(){this.system.mapValue("log",this.log),b=this.eventBus},setLogTimestampVisible:function(a){d=a},showCalleeName:function(a){e=a},setLogToBrowserConsole:function(a){c=a},getLogToBrowserConsole:function(){return c},log:function(){var g="",h=null;d&&(h=(new Date).getTime(),g+="["+(h-f)+"]"),e&&this.getName&&(g+="["+this.getName()+"]"),this.getMediaType&&this.getMediaType()&&(g+="["+this.getMediaType()+"]"),g.length>0&&(g+=" "),Array.apply(null,arguments).forEach(function(a){g+=a+" "}),c&&a.log.debug(g),b.dispatchEvent({type:"log",message:g})}}})},c.hideErrors=function(a){b.addClass(a,"vjs-dashjs-hide-errors")},c.showErrors=function(a){setTimeout(function(){b.removeClass(a,"vjs-dashjs-hide-errors")},250)},c.buildDashJSProtData=function(a){var c,d,e,f={};if(!a||!b.obj.isArray(a))return f;for(e=0;e<a.length;e++)c=a[e],d=b.obj.deepMerge({},c.options),d.licenseUrl&&(d.laURL=d.licenseUrl,delete d.licenseUrl),f[c.name]=d;return f},c.prototype.resetSrc_=function(a){this.el_&&(this.el_.src="",this.el_.setMediaKeys?this.el_.setMediaKeys(null).then(a,a):a())},c.prototype.dispose=function(){this.mediaPlayer_&&this.mediaPlayer_.reset(),this.resetSrc_(function(){})},a.MediaSource&&b.Html5.registerSourceHandler({canHandleSource:function(a){var b=/^application\/dash\+xml/i,c=/\.mpd/i;return b.test(a.type)?"probably":c.test(a.src)?"maybe":""},handleSource:function(a,b){return new c(a,b)}}),b.Html5DashJS=c}(window,window.videojs);
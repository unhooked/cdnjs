/*! responsiveCarousel.JS - v1.0
 * http://basilio.github.com/responsiveCarousel
 *
 * Copyright (c) 2013 Basilio C‡ceres <basilio.caceres@gmail.com>;
 * Licensed under the MIT license */

(function(e){"use strict";e.fn.carousel=function(t){var n={infinite:true,visible:1,speed:"fast",overflow:false,autoRotate:false,navigation:e(this).data("navigation"),itemMinWidth:0,itemEqualHeight:false,itemMargin:0,itemClassActive:"crsl-active"};return e(this).each(function(){var r=e(this);if(e.isEmptyObject(t)==false)e.extend(n,t);if(e.isEmptyObject(e(r).data("crsl"))==false)e.extend(n,e(r).data("crsl"));e(window).ready(function(){e(r).trigger("initCarousel",[n,r]);r.init(n,r);r.config(n,r);if(n.itemEqualHeight!==false){e(window).load(function(){r.equalHeights(n,r)})}e(window).resize(function(){if(this.resizeTO)clearTimeout(this.resizeTO);this.resizeTO=setTimeout(function(){e(this).trigger("resizeEnd")},100)});if(n.autoRotate!==false){r.rotateTime=window.setInterval(function(){r.rotate(n,r)},n.autoRotate)}});e("#"+n.navigation).delegate(".previous, .next","click",function(t){t.preventDefault();r.prepareExecute(n,r);if(e(this).hasClass("previous")&&e(".crsl-wrap",r).find(".crsl-item").index(r.itemActive)>0){r.previous(n,r)}else if(e(this).hasClass("next")&&(!n.infinite&&r.wrapWidth-r.wrapMargin==n.itemWidth*n.total||n.infinite)){r.next(n,r)}});e(window).on("resizeEnd",function(){if(n.itemWidth!==e(r).outerWidth()){r.config(n,r)}});var i=false;e(window).on("mouseover",function(t){if(t.target){var n=t.target}else if(t.srcElement){var n=t.srcElement}if(e(n).parents(".crsl-items").data("navigation")==e(r).data("navigation")){i=true}else{i=false}return false});e(window).on("keydown",function(e){if(e.keyCode===37&&i===true){r.prepareExecute(n,r);r.previous(n,r)}else if(e.keyCode===39&&i===true){r.prepareExecute(n,r);r.next(n,r)}return});if(typeof e(document).hammer=="function"){var s=false;e(document).hammer().on("swipe",function(t){if(t.target){var i=t.target}else if(t.srcElement){var i=t.srcElement}if(e(i).parents(".crsl-items").data("navigation")==e(r).data("navigation")){s=true}else{s=false}if(t.gesture.direction=="left"&&s===true){r.prepareExecute(n,r);r.next(n,r)}else if(t.gesture.direction=="right"&&s===true){r.prepareExecute(n,r);r.previous(n,r)}})}r.init=function(t,n){t.total=e(n).find(".crsl-item").length;t.itemWidth=e(n).outerWidth();t.visibleDefault=t.visible;e(n).css({width:"100%"});e(n).find(".crsl-item").css({position:"relative","float":"left",overflow:"hidden",height:"auto"});e(n).find(".wide-image").css({display:"block",width:"100%",height:"auto"});e(n).find(".crsl-item iframe").attr({width:"100%"});e(n).find(".crsl-item:first-child").addClass(t.itemClassActive);if(t.infinite&&t.visible<t.total){e(n).find(".crsl-item:first-child").before(e(".crsl-item:last-child",n))}if(t.overflow===false){e(n).css({overflow:"hidden"})}else{e("html, body").css({"overflow-x":"hidden"})}};r.config=function(t,n){t.itemWidth=Math.floor((e(n).outerWidth()-t.itemMargin*(t.visibleDefault-1))/t.visibleDefault);if(t.itemWidth<=t.itemMinWidth){t.visible=Math.floor((e(n).outerWidth()-t.itemMargin*(t.visible-1))/t.itemMinWidth)===1?Math.floor(e(n).outerWidth()/t.itemMinWidth):Math.floor((e(n).outerWidth()-t.itemMargin)/t.itemMinWidth);t.visible=t.visible<1?1:t.visible;t.itemWidth=t.visible===1?Math.floor(e(n).outerWidth()):Math.floor((e(n).outerWidth()-t.itemMargin*(t.visible-1))/t.visible)}else{t.visible=t.visibleDefault}n.wrapWidth=Math.floor((t.itemWidth+t.itemMargin)*t.total);n.wrapMargin=n.wrapMarginDefault=t.infinite&&t.visible<t.total?parseInt((t.itemWidth+t.itemMargin)*-1):0;if(t.infinite&&t.visible<t.total&&e(n).find(".crsl-item."+t.itemClassActive).index()===0){e(n).find(".crsl-item:first-child").before(e(".crsl-item:last-child",n));n.wrapMargin=n.wrapMarginDefault=parseInt((t.itemWidth+t.itemMargin)*-1)}e(n).find(".crsl-wrap").css({width:n.wrapWidth+"px",marginLeft:n.wrapMargin});e(n).find(".crsl-item").css({width:t.itemWidth+"px",marginRight:t.itemMargin+"px"});n.equalHeights(t,n);if(t.visible>=t.total){t.autoRotate=false;e("#"+t.navigation).hide()}else{e("#"+t.navigation).show()}};r.prepareExecute=function(t,n){if(t.autoRotate!==false){clearInterval(n.rotateTime)}if(e(n).find(".crsl-wrap:animated").length>0){mouseOverCarousel=false;return false}n.itemActive=e(n).find(".crsl-item."+t.itemClassActive);return true};r.rotate=function(t,n){if(e(n).find(".crsl-wrap:animated").length>0){mouseOverCarousel=false;return false}n.itemActive=e(n).find(".crsl-item."+t.itemClassActive);n.next(t,n);return true};r.equalHeights=function(t,n){if(t.itemEqualHeight!==false){var r=0;e(n).find(".crsl-item").each(function(){e(this).css({height:"auto"});if(e(this).outerHeight()>r){r=e(this).outerHeight()}});e(n).find(".crsl-item").css({height:r+"px"})}return true};r.previous=function(t,n){n.wrapMargin=t.infinite?n.wrapMarginDefault+e(n.itemActive).outerWidth(true):n.wrapMargin+e(itemActive).outerWidth(true);var r=e(n.itemActive).index();var i=e(n.itemActive).prev(".crsl-item");var s="previous";e(n).trigger("beginCarousel",[t,n,s]);e(n).find(".crsl-wrap").animate({marginLeft:n.wrapMargin+"px"},t.speed,function(){e(n.itemActive).removeClass(t.itemClassActive);e(i).addClass(t.itemClassActive);if(t.infinite){e(this).css({marginLeft:n.wrapMarginDefault}).find(".crsl-item:first-child").before(e(".crsl-item:last-child",n))}else{if(n.wrapMargin>=n.wrapMarginDefault)e("#"+t.navigation).find(".previous").addClass("previous-inactive");if(n.wrapWidth-n.wrapMargin==t.itemWidth*t.total)e("#"+t.navigation).find(".next").removeClass("next-inactive")}e(this).trigger("endCarousel",[t,n,s])})};r.next=function(t,n){n.wrapMargin=t.infinite?n.wrapMarginDefault-e(n.itemActive).outerWidth(true):n.wrapMargin-e(itemActive).outerWidth(true);var r=e(n.itemActive).index();var i=e(n.itemActive).next(".crsl-item");var s="next";e(n).trigger("beginCarousel",[t,n,s]);e(n).find(".crsl-wrap").animate({marginLeft:n.wrapMargin+"px"},t.speed,function(){e(n.itemActive).removeClass(t.itemClassActive);e(i).addClass(t.itemClassActive);if(t.infinite){e(this).css({marginLeft:n.wrapMarginDefault}).find(".crsl-item:last-child").after(e(".crsl-item:first-child",n))}else{if(n.wrapMargin<n.wrapMarginDefault)e("#"+t.navigation).find(".previous").removeClass("previous-inactive");if(n.wrapWidth-n.wrapMargin!=t.itemWidth*t.total)e("#"+t.navigation).find(".next").addClass("next-inactive")}e(this).trigger("endCarousel",[t,n,s])})}})}})(jQuery)
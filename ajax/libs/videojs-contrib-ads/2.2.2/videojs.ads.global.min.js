/*! videojs-contrib-ads - v2.2.2 - 2016-01-25
* Copyright (c) 2016 Brightcove; Licensed  */
!function(a,b,c,d){"use strict";var e=function(a){var b,c,d;for(c=1;c<arguments.length;c++){b=arguments[c];for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}return a},f=function(a,b,c){var d,e,f=Object.prototype.toString.call(b),g=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c);else if(a.on)a.on(b,c);else{if(!a.attachEvent)throw new Error("object has no mechanism for adding event listeners");a.attachEvent("on"+b,c)}};switch(f){case"[object String]":g(a,b,c);break;case"[object Array]":for(d=0,e=b.length;e>d;d++)g(a,b[d],c);break;case"[object Object]":for(d in b)b.hasOwnProperty(d)&&g(a,d,b[d]);break;default:throw new Error("Unrecognized events parameter type: "+f)}return a},g=function(b){return(a.setImmediate||a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.setTimeout)(b,0)},h=function(b){return(a.clearImmediate||a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.mozCancelAnimationFrame||a.clearTimeout)(b)},i=function(a){a.ads.cancelPlayTimeout||(a.ads.cancelPlayTimeout=g(function(){a.ads.cancelPlayTimeout=null,a.paused()||a.pause(),a.one("contentplayback",function(){a.paused()&&a.play()})}))},j=function(a){var b,c,d=a.el().querySelector(".vjs-tech"),e=a.remoteTextTracks?a.remoteTextTracks():[],f=[],g={ended:a.ended(),currentSrc:a.currentSrc(),src:a.src(),currentTime:a.currentTime(),type:a.currentType()};for(d&&(g.nativePoster=d.poster,g.style=d.getAttribute("style")),c=e.length;c--;)b=e[c],f.push({track:b,mode:b.mode}),b.mode="disabled";return g.suppressedTracks=f,g},k=function(a,b){for(var c=a.className.split(/\s+/),d=c.length,e=[];d--;)c[d]!==b&&e.push(c[d]);a.className=e.join(" ")},l=function(b,c){var e,f,g=b.el().querySelector(".vjs-tech"),h=20,i=c.suppressedTracks,j=function(){for(var a=i.length;a--;)e=i[a],e.track.mode=e.mode},k=function(){var d=!1,e=function(){d=!0};b.currentTime(c.currentTime),c.ended?(a.setTimeout(function(){d||b.play(),b.off("ended",e)},250),b.on("ended",e)):b.play()},l=function(){return g.readyState>1?k():g.seekable===d?k():g.seekable.length>0?k():void(h--?setTimeout(l,50):!function(){try{k()}catch(a){videojs.log.warn("Failed to resume the content after an advertisement",a)}}())};c.nativePoster&&(g.poster=c.nativePoster),"style"in c&&g.setAttribute("style",c.style||""),f=b.src()!==c.src||b.currentSrc()!==c.currentSrc,f?(b.one("contentloadedmetadata",j),b.src({src:c.currentSrc,type:c.type}),b.load(),b.one("contentcanplay",l)):b.ended()&&c.ended||(j(),b.play())},m=function(a){var b=a.el().querySelector(".vjs-tech");b&&b.removeAttribute("poster")},n={timeout:5e3,prerollTimeout:100,postrollTimeout:100,debug:!1},o=function(b){var d,o=this,p=e({},n,b||{});!function(){var a,b=videojs.Html5.Events,c=function(){return!0},d=function(a,b){b.isImmediatePropagationStopped=c,b.cancelBubble=!0,b.isPropagationStopped=c,o.trigger({type:a+b.type,state:o.ads.state,originalEvent:b})},e=function(a){if("ad-playback"===o.ads.state)d("ad",a);else if("content-playback"===o.ads.state&&"ended"===a.type)d("content",a);else if("content-resuming"===o.ads.state){if(o.ads.snapshot){if(o.currentSrc()!==o.ads.snapshot.currentSrc){if("loadstart"===a.type)return;return d("content",a)}if(o.ads.snapshot.ended)return"pause"===a.type||"ended"===a.type?void o.addClass("vjs-has-started"):d("content",a)}"playing"!==a.type&&d("content",a)}};for(b.push("firstplay"),b.push("loadedalldata"),a=b.length;a--;)o.on(b[a],e);return e}(),o.on(["addurationchange","adcanplay"],function(){var a=o.ads.snapshot;o.currentSrc()!==a.currentSrc&&o.play()}),o.ads={state:"content-set",startLinearAdMode:function(){"ad-playback"!==o.ads.state&&o.trigger("adstart")},endLinearAdMode:function(){"ad-playback"===o.ads.state&&o.trigger("adend")},skipLinearAdMode:function(){"ad-playback"!==o.ads.state&&o.trigger("adskip")}},d=function(b){var c={"content-set":{events:{adscanceled:function(){this.state="content-playback"},adsready:function(){this.state="ads-ready"},play:function(){this.state="ads-ready?",i(o),m(o)},adserror:function(){this.state="content-playback"},adskip:function(){this.state="content-playback"}}},"ads-ready":{events:{play:function(){this.state="preroll?",i(o)},adskip:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"preroll?":{enter:function(){o.el().className+=" vjs-ad-loading",o.ads.timeout=a.setTimeout(function(){o.trigger("adtimeout")},p.prerollTimeout),o.trigger("readyforpreroll")},leave:function(){a.clearTimeout(o.ads.timeout),k(o.el(),"vjs-ad-loading")},events:{play:function(){i(o)},adstart:function(){this.state="ad-playback"},adskip:function(){this.state="content-playback"},adtimeout:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"ads-ready?":{enter:function(){o.el().className+=" vjs-ad-loading",o.ads.timeout=a.setTimeout(function(){o.trigger("adtimeout")},p.timeout)},leave:function(){a.clearTimeout(o.ads.timeout),k(o.el(),"vjs-ad-loading")},events:{play:function(){i(o)},adscanceled:function(){this.state="content-playback"},adsready:function(){this.state="preroll?"},adskip:function(){this.state="content-playback"},adtimeout:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"ad-playback":{enter:function(){this.snapshot=j(o),o.el().className+=" vjs-ad-playing",m(o),o.ads.cancelPlayTimeout&&(h(o.ads.cancelPlayTimeout),o.ads.cancelPlayTimeout=null)},leave:function(){k(o.el(),"vjs-ad-playing"),l(o,this.snapshot),"adend"!==o.ads.triggerevent&&o.trigger("adend")},events:{adend:function(){this.state="content-resuming"},adserror:function(){this.state="content-resuming"}}},"content-resuming":{enter:function(){this.snapshot.ended&&(a.clearTimeout(o.ads._fireEndedTimeout),o.ads._fireEndedTimeout=a.setTimeout(function(){o.trigger("ended")},1e3))},leave:function(){a.clearTimeout(o.ads._fireEndedTimeout)},events:{contentupdate:function(){this.state="content-set"},playing:function(){this.state="content-playback"},ended:function(){this.state="content-playback"}}},"postroll?":{enter:function(){this.snapshot=j(o),o.el().className+=" vjs-ad-loading",o.ads.timeout=a.setTimeout(function(){o.trigger("adtimeout")},p.postrollTimeout)},leave:function(){a.clearTimeout(o.ads.timeout),k(o.el(),"vjs-ad-loading")},events:{adstart:function(){this.state="ad-playback"},adskip:function(){this.state="content-resuming",g(function(){o.trigger("ended")})},adtimeout:function(){this.state="content-resuming",g(function(){o.trigger("ended")})},adserror:function(){this.state="content-resuming",g(function(){o.trigger("ended")})}}},"content-playback":{enter:function(){o.ads.cancelPlayTimeout&&(h(o.ads.cancelPlayTimeout),o.ads.cancelPlayTimeout=null),o.trigger({type:"contentplayback",triggerevent:o.ads.triggerevent})},events:{adsready:function(){o.trigger("readyforpreroll")},adstart:function(){this.state="ad-playback"},contentupdate:function(){o.paused()?this.state="content-set":this.state="ads-ready?"},contentended:function(){this.state="postroll?"}}}};!function(a){var d=function(){};((c[a].events||{})[b.type]||d).apply(o.ads),a!==o.ads.state&&(o.ads.triggerevent=b.type,(c[a].leave||d).apply(o.ads),(c[o.ads.state].enter||d).apply(o.ads),p.debug&&videojs.log("ads",o.ads.triggerevent+" triggered: "+a+" -> "+o.ads.state))}(o.ads.state)},f(o,c.Html5.Events.concat(["adtimeout","contentupdate","contentplaying","contentended","adsready","adserror","adscanceled","adstart","adend","adskip"]),d),o.ads.contentSrc=o.currentSrc(),function(){var a=function(){var a;"ad-playback"!==o.ads.state&&(a=o.currentSrc(),a!==o.ads.contentSrc&&(o.trigger({type:"contentupdate",oldValue:o.ads.contentSrc,newValue:a}),o.ads.contentSrc=a))};o.on(["loadstart"],a),g(a)}(),o.paused()||d({type:"play"})};c.plugin("ads",o)}(window,document,videojs);